[{"body":"","link":"https://jianlin-li.github.io/","section":"","tags":null,"title":""},{"body":"","link":"https://jianlin-li.github.io/categories/","section":"categories","tags":null,"title":"Categories"},{"body":"","link":"https://jianlin-li.github.io/tags/go/","section":"tags","tags":null,"title":"Go"},{"body":"","link":"https://jianlin-li.github.io/categories/go%E8%AF%AD%E8%A8%80/","section":"categories","tags":null,"title":"Goè¯­è¨€"},{"body":"Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ net/http åŒ…æä¾›äº† HTTP å®¢æˆ·ç«¯ï¼ˆclientï¼‰å’Œ HTTP æœåŠ¡ç«¯ï¼ˆserverï¼‰ çš„å®Œæ•´å®ç°ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹åº“å³å¯æ„å»ºé«˜æ€§èƒ½çš„ Web åº”ç”¨æˆ–å‘èµ· HTTP è¯·æ±‚ã€‚ âœ… 1. HTTP æœåŠ¡ç«¯ï¼ˆServerï¼‰ ä½ å¯ä»¥ç”¨ net/http è½»æ¾åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼š\n1package main 2 3import ( 4 \u0026#34;fmt\u0026#34; 5 \u0026#34;net/http\u0026#34; 6) 7 8func handler(w http.ResponseWriter, r *http.Request) { 9 fmt.Fprintf(w, \u0026#34;Hello, you\u0026#39;ve requested: %s\\n\u0026#34;, r.URL.Path) 10} 11 12func main() { 13 http.HandleFunc(\u0026#34;/\u0026#34;, handler) 14 fmt.Println(\u0026#34;Starting server on :8080\u0026#34;) 15 http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) 16} http.HandleFuncï¼šæ³¨å†Œè·¯ç”±å¤„ç†å‡½æ•°ã€‚ http.ListenAndServeï¼šå¯åŠ¨ HTTP æœåŠ¡ç›‘å¬æŒ‡å®šç«¯å£ã€‚ http.ResponseWriter å’Œ *http.Requestï¼šç”¨äºå“åº”å’Œè¯»å–è¯·æ±‚ã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ http.Handler æ¥å£å®ç°æ›´å¤æ‚çš„é€»è¾‘ã€‚\nâœ… 2. HTTP å®¢æˆ·ç«¯ï¼ˆClientï¼‰ net/http ä¹Ÿå†…ç½®äº†å¼ºå¤§çš„ HTTP å®¢æˆ·ç«¯ï¼Œæœ€å¸¸ç”¨çš„æ˜¯å…¨å±€å˜é‡ http.Getã€http.Post ç­‰ï¼Œåº•å±‚éƒ½åŸºäº http.DefaultClientï¼š\nç®€å• GET è¯·æ±‚ï¼š 1resp, err := http.Get(\u0026#34;https://httpbin.org/get\u0026#34;) 2if err != nil { 3 panic(err) 4} 5defer resp.Body.Close() 6 7body, _ := io.ReadAll(resp.Body) 8fmt.Println(string(body)) è‡ªå®šä¹‰ Clientï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰ï¼š 1client := \u0026amp;http.Client{ 2 Timeout: 10 * time.Second, 3} 4 5resp, err := client.Get(\u0026#34;https://example.com\u0026#34;) 6// ... å¤„ç†å“åº” æ”¯æŒï¼š\nè®¾ç½®è¶…æ—¶ï¼ˆTimeoutï¼‰ è‡ªå®šä¹‰ Header å‘é€ POST/PUT/DELETE ç­‰è¯·æ±‚ å¤„ç† Cookieã€é‡å®šå‘ç­–ç•¥ç­‰ ğŸ”’ è¡¥å……è¯´æ˜ HTTPS æ”¯æŒï¼šnet/http è‡ªåŠ¨å¤„ç† TLSï¼Œè®¿é—® https:// åœ°å€æ— éœ€é¢å¤–é…ç½®ã€‚ å¹¶å‘å®‰å…¨ï¼šhttp.Client æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå¯å¤ç”¨ï¼›http.Server å¤©ç„¶æ”¯æŒé«˜å¹¶å‘ï¼ˆæ¯ä¸ªè¯·æ±‚åœ¨ä¸€ä¸ª goroutine ä¸­å¤„ç†ï¼‰ã€‚ ä¸­é—´ä»¶æ¨¡å¼ï¼šå¯é€šè¿‡åŒ…è£… http.Handler å®ç°æ—¥å¿—ã€è®¤è¯ã€CORS ç­‰ä¸­é—´ä»¶ã€‚ ğŸ“¦ å…¸å‹åº”ç”¨åœºæ™¯ åœºæ™¯ ä½¿ç”¨æ–¹å¼ æ„å»º RESTful API http.ListenAndServe + è·¯ç”±å¤„ç†å‡½æ•° è°ƒç”¨ç¬¬ä¸‰æ–¹ API http.Client å‘èµ·è¯·æ±‚ å¾®æœåŠ¡é€šä¿¡ ä½œä¸ºè½»é‡çº§ HTTP å®¢æˆ·ç«¯/æœåŠ¡ç«¯ Webhook æ¥æ”¶å™¨ å¯åŠ¨ HTTP Server ç›‘å¬äº‹ä»¶ å› æ­¤ï¼Œnet/http æ˜¯ Go è¯­è¨€â€œè‡ªå¸¦ç”µæ± â€å“²å­¦çš„å…¸èŒƒ â€”â€” åŠŸèƒ½å¼ºå¤§ã€ç®€æ´é«˜æ•ˆï¼Œæ˜¯ Go æ„å»ºç½‘ç»œæœåŠ¡çš„æ ¸å¿ƒåŸºçŸ³ã€‚\nä¸‹é¢æ˜¯å¯¹ Go è¯­è¨€æ ‡å‡†åº“ä¸­ net/http åŒ…çš„å®Œæ•´æ¦‚æ‹¬ï¼Œæ¶µç›–å…¶æ ¸å¿ƒåŠŸèƒ½ã€å…³é”®ç±»å‹ã€å¸¸ç”¨æ–¹æ³•ï¼Œå¹¶é™„å¸¦æ¸…æ™°å®ç”¨çš„ç¤ºä¾‹ã€‚ ğŸ“¦ net/http åŒ…å®Œæ•´æ¦‚æ‹¬ net/http æ˜¯ Go æ ‡å‡†åº“ä¸­ç”¨äºå®ç° HTTP/1.1 åè®®å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ çš„æ ¸å¿ƒåŒ…ã€‚å®ƒè®¾è®¡ç®€æ´ã€æ€§èƒ½ä¼˜å¼‚ã€å¹¶å‘å®‰å…¨ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹ä¾èµ–å³å¯æ„å»ºå®Œæ•´çš„ Web åº”ç”¨æˆ–å‘èµ· HTTP è¯·æ±‚ã€‚\nä¸€ã€æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ åŠŸèƒ½ è¯´æ˜ âœ… HTTP æœåŠ¡ç«¯ å¯åŠ¨ Web æœåŠ¡å™¨ï¼Œå¤„ç†è¯·æ±‚ï¼ˆæ”¯æŒè·¯ç”±ã€ä¸­é—´ä»¶ç­‰ï¼‰ âœ… HTTP å®¢æˆ·ç«¯ å‘èµ· GET/POST ç­‰è¯·æ±‚ï¼Œæ”¯æŒè¶…æ—¶ã€Headerã€Body ç­‰æ§åˆ¶ âœ… HTTPS/TLS æ”¯æŒ è‡ªåŠ¨å¤„ç† TLS åŠ å¯†ï¼ˆæœåŠ¡ç«¯éœ€æä¾›è¯ä¹¦ï¼‰ âœ… å¹¶å‘æ¨¡å‹ æ¯ä¸ªè¯·æ±‚åœ¨ç‹¬ç«‹ goroutine ä¸­å¤„ç†ï¼Œå¤©ç„¶é«˜å¹¶å‘ âœ… å¯æ‰©å±•æ€§ é€šè¿‡å®ç° http.Handler æ¥å£è‡ªå®šä¹‰é€»è¾‘ äºŒã€å…³é”®ç±»å‹ä¸æ¥å£ 1. http.ResponseWriter ç”¨äºå‘å®¢æˆ·ç«¯å†™å…¥å“åº”ï¼ˆçŠ¶æ€ç ã€Headerã€Bodyï¼‰ã€‚ æ–¹æ³•ï¼šWrite([]byte), WriteHeader(statusCode), Header() http.Header 2. *http.Request è¡¨ç¤ºå®¢æˆ·ç«¯å‘æ¥çš„ HTTP è¯·æ±‚ã€‚ åŒ…å« URLã€Methodã€Headerã€Bodyã€Formã€Cookies ç­‰ä¿¡æ¯ã€‚ 3. http.Handler æ¥å£ 1type Handler interface { 2 ServeHTTP(ResponseWriter, *Request) 3} æ‰€æœ‰ HTTP å¤„ç†å™¨æœ€ç»ˆéƒ½è¦å®ç°æ­¤æ¥å£ã€‚ 4. http.HandlerFunc å‡½æ•°ç±»å‹ï¼Œè®©æ™®é€šå‡½æ•°å¯ä½œä¸º Handler ä½¿ç”¨ï¼š 1type HandlerFunc func(ResponseWriter, *Request) 2func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } 5. http.Client ç”¨äºå‘èµ· HTTP è¯·æ±‚ï¼Œæ”¯æŒé…ç½®è¶…æ—¶ã€Transportã€CookieJar ç­‰ã€‚ 6. http.Server æ›´ç²¾ç»†åœ°æ§åˆ¶æœåŠ¡ç«¯è¡Œä¸ºï¼ˆå¦‚ä¼˜é›…å…³é—­ã€TLS é…ç½®ç­‰ï¼‰ã€‚ ä¸‰ã€HTTP æœåŠ¡ç«¯ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šåŸºç¡€ Web æœåŠ¡å™¨ 1package main 2 3import ( 4 \u0026#34;fmt\u0026#34; 5 \u0026#34;log\u0026#34; 6 \u0026#34;net/http\u0026#34; 7) 8 9func helloHandler(w http.ResponseWriter, r *http.Request) { 10 fmt.Fprintf(w, \u0026#34;Hello from Go HTTP server! Path: %s\u0026#34;, r.URL.Path) 11} 12 13func main() { 14 http.HandleFunc(\u0026#34;/hello\u0026#34;, helloHandler) 15 log.Println(\u0026#34;Server starting on :8080\u0026#34;) 16 log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) 17} è®¿é—® http://localhost:8080/hello å³å¯çœ‹åˆ°å“åº”ã€‚\nç¤ºä¾‹ 2ï¼šä½¿ç”¨è‡ªå®šä¹‰ Handler å’Œä¸­é—´ä»¶ 1type MyHandler struct{} 2 3func (h MyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { 4 w.WriteHeader(http.StatusOK) 5 w.Write([]byte(\u0026#34;Handled by custom Handler\u0026#34;)) 6} 7 8// æ—¥å¿—ä¸­é—´ä»¶ 9func loggingMiddleware(next http.Handler) http.Handler { 10 return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { 11 log.Printf(\u0026#34;Received %s %s\u0026#34;, r.Method, r.URL.Path) 12 next.ServeHTTP(w, r) 13 }) 14} 15 16func main() { 17 handler := loggingMiddleware(MyHandler{}) 18 server := \u0026amp;http.Server{ 19 Addr: \u0026#34;:8080\u0026#34;, 20 Handler: handler, 21 } 22 log.Fatal(server.ListenAndServe()) 23} ç¤ºä¾‹ 3ï¼šå¤„ç† JSON è¯·æ±‚ï¼ˆRESTful APIï¼‰ 1type User struct { 2 Name string `json:\u0026#34;name\u0026#34;` 3 Email string `json:\u0026#34;email\u0026#34;` 4} 5 6func createUser(w http.ResponseWriter, r *http.Request) { 7 if r.Method != http.MethodPost { 8 http.Error(w, \u0026#34;Only POST allowed\u0026#34;, http.StatusMethodNotAllowed) 9 return 10 } 11 12 var user User 13 if err := json.NewDecoder(r.Body).Decode(\u0026amp;user); err != nil { 14 http.Error(w, err.Error(), http.StatusBadRequest) 15 return 16 } 17 18 // æ¨¡æ‹Ÿä¿å­˜ 19 w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) 20 json.NewEncoder(w).Encode(map[string]interface{}{ 21 \u0026#34;status\u0026#34;: \u0026#34;created\u0026#34;, 22 \u0026#34;user\u0026#34;: user, 23 }) 24} æ³¨å†Œè·¯ç”±ï¼š\n1http.HandleFunc(\u0026#34;/users\u0026#34;, createUser) æµ‹è¯•ï¼š\n1curl -X POST http://localhost:8080/users \\ 2 -H \u0026#34;Content-Type: application/json\u0026#34; \\ 3 -d \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;Alice\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;alice@example.com\u0026#34;}\u0026#39; å››ã€HTTP å®¢æˆ·ç«¯ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šç®€å• GET è¯·æ±‚ 1resp, err := http.Get(\u0026#34;https://httpbin.org/get\u0026#34;) 2if err != nil { 3 log.Fatal(err) 4} 5defer resp.Body.Close() 6 7body, _ := io.ReadAll(resp.Body) 8fmt.Println(string(body)) ç¤ºä¾‹ 2ï¼šå¸¦è¶…æ—¶å’Œ Header çš„ POST è¯·æ±‚ï¼ˆå‘é€ JSONï¼‰ 1client := \u0026amp;http.Client{ 2 Timeout: 10 * time.Second, 3} 4 5data := map[string]string{\u0026#34;username\u0026#34;: \u0026#34;alice\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;secret\u0026#34;} 6jsonData, _ := json.Marshal(data) 7 8req, _ := http.NewRequest(\u0026#34;POST\u0026#34;, \u0026#34;https://httpbin.org/post\u0026#34;, bytes.NewBuffer(jsonData)) 9req.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) 10 11resp, err := client.Do(req) 12if err != nil { 13 log.Fatal(err) 14} 15defer resp.Body.Close() 16 17result, _ := io.ReadAll(resp.Body) 18fmt.Println(string(result)) ç¤ºä¾‹ 3ï¼šå¤ç”¨ Clientï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰ 1var httpClient = \u0026amp;http.Client{ 2 Timeout: 30 * time.Second, 3 Transport: \u0026amp;http.Transport{ 4 MaxIdleConns: 100, 5 IdleConnTimeout: 90 * time.Second, 6 TLSHandshakeTimeout: 10 * time.Second, 7 }, 8} âš ï¸ ä¸è¦æ¯æ¬¡è¯·æ±‚éƒ½æ–°å»º http.Clientï¼Œåº”å¤ç”¨ä»¥æå‡æ€§èƒ½å’Œè¿æ¥å¤ç”¨ã€‚\näº”ã€é«˜çº§ç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ HTTPS æœåŠ¡ç«¯ ä½¿ç”¨ ListenAndServeTLS(certFile, keyFile) ä¼˜é›…å…³é—­ è°ƒç”¨ server.Shutdown(ctx) å®ç°å¹³æ»‘é€€å‡º æ–‡ä»¶æœåŠ¡ http.FileServer(http.Dir(\u0026quot;./static\u0026quot;)) å¿«é€Ÿæä¾›é™æ€æ–‡ä»¶ Cookie æ”¯æŒ r.Cookies(), w.Header().Set(\u0026quot;Set-Cookie\u0026quot;, ...) é‡å®šå‘æ§åˆ¶ é€šè¿‡ Client.CheckRedirect è‡ªå®šä¹‰ç­–ç•¥ å…­ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ é—®é¢˜ å»ºè®® å¿˜è®°å…³é—­ resp.Body æ€»æ˜¯ defer resp.Body.Close() ä½¿ç”¨å…¨å±€ http.DefaultClient æ— è¶…æ—¶ ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…è‡ªå®šä¹‰ http.Client å¹¶è®¾ç½®è¶…æ—¶ è¿”å› nil slice vs empty slice æ³¨æ„ JSON åºåˆ—åŒ–å·®å¼‚ï¼ˆnull vs []ï¼‰ è·¯ç”±å†²çª ä½¿ç”¨æ›´å¼ºå¤§çš„è·¯ç”±å™¨ï¼ˆå¦‚ gorilla/mux æˆ– chiï¼‰å¤„ç†å¤æ‚è·¯ç”± æ€»ç»“ âœ… net/http æ˜¯ Go æ„å»ºç½‘ç»œåº”ç”¨çš„åŸºçŸ³\nâœ… æœåŠ¡ç«¯ + å®¢æˆ·ç«¯ä¸€ä½“åŒ–ï¼Œå¼€ç®±å³ç”¨\nâœ… é«˜æ€§èƒ½ã€ä½ä¾èµ–ã€é€‚åˆå¾®æœåŠ¡ä¸ API å¼€å‘\nè™½ç„¶å¯¹äºå¤æ‚è·¯ç”±ã€å‚æ•°è§£æç­‰åœºæ™¯ï¼Œç¤¾åŒºå¸¸æ­é… ginã€echoã€chi ç­‰æ¡†æ¶ï¼Œä½†ç†è§£ net/http æ˜¯æŒæ¡ Go Web ç¼–ç¨‹çš„å…³é”®ç¬¬ä¸€æ­¥ã€‚\nåœ¨ Go è¯­è¨€ä¸­ï¼Œstrings.Builder æ˜¯æ ‡å‡†åº“ strings åŒ…æä¾›çš„ä¸€ä¸ªé«˜æ•ˆæ„å»ºå­—ç¬¦ä¸²çš„å·¥å…·ç±»å‹ã€‚å®ƒä¸“ä¸ºå¤šæ¬¡æ‹¼æ¥å­—ç¬¦ä¸²çš„åœºæ™¯è®¾è®¡ï¼Œé¿å…äº†ä¼ ç»Ÿä½¿ç”¨ + æˆ– fmt.Sprintf å¸¦æ¥çš„é¢‘ç¹å†…å­˜åˆ†é…å’Œæ€§èƒ½å¼€é”€ã€‚ ğŸ§± ä¸ºä»€ä¹ˆéœ€è¦ strings.Builderï¼Ÿ Go ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ã€‚æ¯æ¬¡ç”¨ s += \u0026quot;xxx\u0026quot; æ‹¼æ¥æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¤åˆ¶æ—§å†…å®¹ + æ–°å†…å®¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ï¼Œåœ¨å¤§é‡æ‹¼æ¥æ—¶æ€§èƒ½å¾ˆå·®ã€‚\nè€Œ strings.Builder å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªå¯å¢é•¿çš„å­—èŠ‚åˆ‡ç‰‡ï¼ˆ[]byteï¼‰ä½œä¸ºç¼“å†²åŒºï¼Œåªåœ¨å¿…è¦æ—¶æ‰©å®¹ï¼Œæœ€ç»ˆé€šè¿‡ String() æ–¹æ³•ä¸€æ¬¡æ€§ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œæ•ˆç‡æ¥è¿‘ O(n)ã€‚\nâœ… æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ é›¶åˆ†é…åˆå§‹åŒ– å¯ç›´æ¥å£°æ˜ä½¿ç”¨ï¼Œæ— éœ€ make é«˜æ•ˆæ‹¼æ¥ å†…éƒ¨ä½¿ç”¨ []byte ç¼“å†²ï¼Œé¿å…é‡å¤æ‹·è´ ä¸å¯å¤åˆ¶ Builder ç»“æ„ä½“åŒ…å«æŒ‡é’ˆå­—æ®µï¼Œç¦æ­¢å¤åˆ¶ï¼ˆç¼–è¯‘å™¨ä¼šæ£€æŸ¥ï¼‰ ä¸€æ¬¡æ€§è¾“å‡º è°ƒç”¨ String() åä»å¯ç»§ç»­å†™å…¥ï¼ˆä½†ä¸å»ºè®®æ··ç”¨ï¼‰ ğŸ“š å¸¸ç”¨æ–¹æ³• 1func (b *Builder) Write(p []byte) (int, error) 2func (b *Builder) WriteByte(c byte) error 3func (b *Builder) WriteRune(r rune) error 4func (b *Builder) WriteString(s string) (int, error) 5func (b *Builder) String() string 6func (b *Builder) Reset() æ‰€æœ‰å†™å…¥æ–¹æ³•éƒ½å®ç°äº† io.Writer æ¥å£ï¼Œå› æ­¤ Builder å¯ç”¨äºä»»ä½•æ¥å— io.Writer çš„åœ°æ–¹ï¼ˆå¦‚ fmt.Fprintfï¼‰ã€‚\nğŸ’¡ ç¤ºä¾‹ä»£ç  ç¤ºä¾‹ 1ï¼šåŸºç¡€ç”¨æ³• 1package main 2 3import ( 4 \u0026#34;fmt\u0026#34; 5 \u0026#34;strings\u0026#34; 6) 7 8func main() { 9 var b strings.Builder 10 11 b.WriteString(\u0026#34;Hello\u0026#34;) 12 b.WriteString(\u0026#34;, \u0026#34;) 13 b.WriteString(\u0026#34;World!\u0026#34;) 14 b.WriteByte(\u0026#39;\\n\u0026#39;) 15 b.WriteRune(\u0026#39;ğŸŒŸ\u0026#39;) 16 17 result := b.String() 18 fmt.Print(result) 19} è¾“å‡ºï¼š\n1Hello, World! 2ğŸŒŸ ç¤ºä¾‹ 2ï¼šä¸ fmt.Fprintf é…åˆï¼ˆå®ç°æ ¼å¼åŒ–æ‹¼æ¥ï¼‰ 1var b strings.Builder 2name := \u0026#34;Alice\u0026#34; 3age := 30 4 5fmt.Fprintf(\u0026amp;b, \u0026#34;Name: %s, Age: %d\u0026#34;, name, age) 6fmt.Println(b.String()) // Name: Alice, Age: 30 å› ä¸º *Builder å®ç°äº† io.Writerï¼Œæ‰€ä»¥å¯ä»¥å–åœ°å€ä¼ ç»™ Fprintfã€‚\nç¤ºä¾‹ 3ï¼šæ€§èƒ½å¯¹æ¯”ï¼ˆvs å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰ 1// âŒ ä½æ•ˆæ–¹å¼ï¼ˆO(nÂ²)ï¼‰ 2var s string 3for i := 0; i \u0026lt; 10000; i++ { 4 s += \u0026#34;a\u0026#34; // æ¯æ¬¡éƒ½æ–°å»ºå­—ç¬¦ä¸² 5} 6 7// âœ… é«˜æ•ˆæ–¹å¼ 8var b strings.Builder 9for i := 0; i \u0026lt; 10000; i++ { 10 b.WriteString(\u0026#34;a\u0026#34;) 11} 12s := b.String() åœ¨å¾ªç¯æ¬¡æ•°å¤šæ—¶ï¼ŒBuilder æ€§èƒ½ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼ˆå®æµ‹å¿«å‡ åå€ï¼Œå†…å­˜åˆ†é…å°‘æ•°ç™¾å€ï¼‰ã€‚\nç¤ºä¾‹ 4ï¼šé‡ç”¨ Builderï¼ˆè°ƒç”¨ Reset()ï¼‰ 1var b strings.Builder 2 3b.WriteString(\u0026#34;Part 1\u0026#34;) 4fmt.Println(b.String()) // Part 1 5 6b.Reset() // æ¸…ç©ºå†…å®¹ï¼Œå¯å¤ç”¨ 7 8b.WriteString(\u0026#34;Part 2\u0026#34;) 9fmt.Println(b.String()) // Part 2 Reset() ä¼šæ¸…ç©ºå†…å®¹ï¼Œä½†åº•å±‚ç¼“å†²åŒºå¯èƒ½ä¿ç•™ä»¥ä¾›å¤ç”¨ï¼Œå‡å°‘åç»­åˆ†é…ã€‚\nâš ï¸ æ³¨æ„äº‹é¡¹ ä¸è¦å¤åˆ¶ Builder\n1b1 := strings.Builder{} 2b2 := b1 // ç¼–è¯‘é”™è¯¯ï¼cannot use b1 (type strings.Builder) as type ... (contains sync.noCopy) Go 1.10+ åœ¨ Builder ä¸­åµŒå…¥äº† noCopy æ ‡è®°ï¼Œç¦æ­¢å¤åˆ¶ã€‚\nä¸è¦å¹¶å‘ä½¿ç”¨åŒä¸€ä¸ª Builder\nå®ƒä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚å¦‚éœ€å¹¶å‘ï¼Œæ¯ä¸ª goroutine åº”ä½¿ç”¨è‡ªå·±çš„å®ä¾‹ã€‚\né¿å…åœ¨ String() åç»§ç»­å†™å…¥å¹¶åå¤è°ƒç”¨ String()\nè™½ç„¶å…è®¸ï¼Œä½†æ¯æ¬¡ String() éƒ½ä¼šè¿›è¡Œä¸€æ¬¡ string(copy)ï¼Œå¯èƒ½å¸¦æ¥é¢å¤–å¼€é”€ã€‚\nğŸ†š å¯¹æ¯”å…¶ä»–æ‹¼æ¥æ–¹å¼ æ–¹å¼ é€‚ç”¨åœºæ™¯ æ€§èƒ½ å†…å­˜åˆ†é… s += \u0026quot;x\u0026quot; å°‘é‡æ‹¼æ¥ï¼ˆ\u0026lt;5 æ¬¡ï¼‰ å·® å¤š strings.Join() å·²çŸ¥æ‰€æœ‰ç‰‡æ®µ å¥½ 1 æ¬¡ fmt.Sprintf æ ¼å¼åŒ–ç®€å•å­—ç¬¦ä¸² ä¸­ç­‰ ä¸­ç­‰ strings.Builder å¾ªç¯/åŠ¨æ€æ‹¼æ¥ ä¼˜ç§€ æå°‘ âœ… æœ€ä½³å®è·µ å½“ä½ éœ€è¦åœ¨å¾ªç¯ä¸­æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼˜å…ˆä½¿ç”¨ strings.Builderã€‚ å¦‚æœå·²çŸ¥æ‰€æœ‰è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²ç‰‡æ®µï¼Œç”¨ strings.Join(slides, \u0026quot;\u0026quot;) æ›´ç®€æ´ã€‚ åœ¨é«˜é¢‘æ—¥å¿—ã€JSON æ„é€ ã€æ¨¡æ¿æ¸²æŸ“ç­‰åœºæ™¯ï¼ŒBuilder æ˜¯é¦–é€‰ã€‚ åœ¨ Go è¯­è¨€ä¸­ï¼Œjson.NewDecoder() å’Œ json.NewEncoder() æ˜¯æ ‡å‡†åº“ encoding/json åŒ…æä¾›çš„ä¸¤ä¸ªé«˜æ•ˆå·¥å…·ï¼Œç”¨äºç›´æ¥ä» io.Reader æµå¼è¯»å– JSON æ•°æ®æˆ–å‘ io.Writer æµå¼å†™å…¥ JSON æ•°æ®ã€‚å®ƒä»¬ç‰¹åˆ«é€‚åˆå¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ I/O æˆ– HTTP æ¥å£ä¸­çš„ JSON ç¼–è§£ç ã€‚ ğŸ§© ä¸€ã€æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯” æ–¹æ³• ç”¨é€” è¾“å…¥/è¾“å‡º json.NewDecoder(r io.Reader) è§£ç ï¼ˆååºåˆ—åŒ–ï¼‰JSON ä» io.Readerï¼ˆå¦‚ http.Response.Bodyã€os.Fileï¼‰è¯»å–å¹¶è§£æä¸º Go ç»“æ„ä½“ json.NewEncoder(w io.Writer) ç¼–ç ï¼ˆåºåˆ—åŒ–ï¼‰JSON å°† Go ç»“æ„ä½“å†™å…¥ io.Writerï¼ˆå¦‚ http.ResponseWriterã€os.Fileï¼‰ âœ… å®ƒä»¬æ“ä½œçš„æ˜¯æµï¼ˆstreamï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—èŠ‚åˆ‡ç‰‡ï¼Œå› æ­¤å†…å­˜æ•ˆç‡é«˜ï¼Œé€‚åˆå¤§ JSON æˆ–æŒç»­æ•°æ®æµã€‚\nğŸ”½ äºŒã€json.NewDecoder â€”â€” ä»æµä¸­è¯»å– JSON åŸºæœ¬ç”¨æ³• 1type Person struct { 2 Name string `json:\u0026#34;name\u0026#34;` 3 Age int `json:\u0026#34;age\u0026#34;` 4} 5 6func main() { 7 // æ¨¡æ‹Ÿä¸€ä¸ª io.Readerï¼ˆæ¯”å¦‚ HTTP å“åº”ä½“æˆ–æ–‡ä»¶ï¼‰ 8 r := strings.NewReader(`{\u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;age\u0026#34;: 30}`) 9 10 var p Person 11 dec := json.NewDecoder(r) 12 if err := dec.Decode(\u0026amp;p); err != nil { 13 log.Fatal(err) 14 } 15 16 fmt.Printf(\u0026#34;Decoded: %+v\\n\u0026#34;, p) // Decoded: {Name:Alice Age:30} 17} å…¸å‹åº”ç”¨åœºæ™¯ 1. è§£æ HTTP è¯·æ±‚ä½“ï¼ˆæœåŠ¡ç«¯ï¼‰ 1func handleUser(w http.ResponseWriter, r *http.Request) { 2 var user User 3 if err := json.NewDecoder(r.Body).Decode(\u0026amp;user); err != nil { 4 http.Error(w, \u0026#34;Invalid JSON\u0026#34;, http.StatusBadRequest) 5 return 6 } 7 // å¤„ç† user... 8} 2. è¯»å– JSON æ–‡ä»¶ 1file, _ := os.Open(\u0026#34;data.json\u0026#34;) 2defer file.Close() 3 4var config Config 5if err := json.NewDecoder(file).Decode(\u0026amp;config); err != nil { 6 log.Fatal(err) 7} ğŸ’¡ ç›¸æ¯” ioutil.ReadAll + json.Unmarshalï¼ŒNewDecoder ä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ï¼Œæ›´çœå†…å­˜ã€‚\nğŸ”¼ ä¸‰ã€json.NewEncoder â€”â€” å‘æµä¸­å†™å…¥ JSON åŸºæœ¬ç”¨æ³• 1func main() { 2 var buf bytes.Buffer // å®ç° io.Writer 3 4 p := Person{Name: \u0026#34;Bob\u0026#34;, Age: 25} 5 enc := json.NewEncoder(\u0026amp;buf) 6 if err := enc.Encode(p); err != nil { 7 log.Fatal(err) 8 } 9 10 fmt.Println(buf.String()) // {\u0026#34;name\u0026#34;:\u0026#34;Bob\u0026#34;,\u0026#34;age\u0026#34;:25}\\n 11} âš ï¸ æ³¨æ„ï¼šEncode() ä¼šåœ¨ JSON åè‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ \\nï¼ˆç¬¦åˆ JSON Lines æ ¼å¼ï¼‰ã€‚\nå…¸å‹åº”ç”¨åœºæ™¯ 1. è¿”å› JSON å“åº”ï¼ˆHTTP æœåŠ¡ç«¯ï¼‰ 1func getUser(w http.ResponseWriter, r *http.Request) { 2 user := User{ID: 1, Name: \u0026#34;Charlie\u0026#34;} 3 w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) 4 if err := json.NewEncoder(w).Encode(user); err != nil { 5 http.Error(w, \u0026#34;Server error\u0026#34;, http.StatusInternalServerError) 6 } 7} 2. å†™å…¥ JSON æ–‡ä»¶ 1file, _ := os.Create(\u0026#34;output.json\u0026#34;) 2defer file.Close() 3 4data := map[string]int{\u0026#34;count\u0026#34;: 42} 5if err := json.NewEncoder(file).Encode(data); err != nil { 6 log.Fatal(err) 7} ğŸ” å››ã€æµå¼å¤„ç†å¤šä¸ª JSON å¯¹è±¡ï¼ˆJSON Lines / NDJSONï¼‰ Decoder æ”¯æŒè¿ç»­è¯»å–å¤šä¸ªç‹¬ç«‹çš„ JSON å¯¹è±¡ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼Œéå¸¸é€‚åˆæ—¥å¿—æˆ–æ‰¹é‡æ•°æ®ï¼š\n1input := `{\u0026#34;name\u0026#34;:\u0026#34;A\u0026#34;} 2{\u0026#34;name\u0026#34;:\u0026#34;B\u0026#34;} 3{\u0026#34;name\u0026#34;:\u0026#34;C\u0026#34;}` 4 5r := strings.NewReader(input) 6dec := json.NewDecoder(r) 7 8var person Person 9for dec.More() { // å¯é€‰ï¼šæ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤š token 10 if err := dec.Decode(\u0026amp;person); err == io.EOF { 11 break 12 } else if err != nil { 13 log.Fatal(err) 14 } 15 fmt.Println(person.Name) 16} 17// è¾“å‡º: A B C è¿™ç§æ ¼å¼ç§°ä¸º JSON Lines æˆ– NDJSONï¼ˆNewline Delimited JSONï¼‰ã€‚\nğŸ†š äº”ã€ä¸ json.Marshal / json.Unmarshal å¯¹æ¯” æ–¹æ³• è¾“å…¥/è¾“å‡º é€‚ç”¨åœºæ™¯ json.Unmarshal([]byte, \u0026amp;v) å­—èŠ‚åˆ‡ç‰‡ â†’ Go å¯¹è±¡ å·²æœ‰å®Œæ•´ JSON å­—ç¬¦ä¸²/å­—èŠ‚ json.Marshal(v) Go å¯¹è±¡ â†’ []byte éœ€è¦ç”Ÿæˆ JSON å­—ç¬¦ä¸² json.NewDecoder(r).Decode(\u0026amp;v) io.Reader â†’ Go å¯¹è±¡ æµå¼è¯»å–ï¼ˆç½‘ç»œã€æ–‡ä»¶ï¼‰ json.NewEncoder(w).Encode(v) Go å¯¹è±¡ â†’ io.Writer æµå¼å†™å…¥ï¼ˆå“åº”ã€æ–‡ä»¶ï¼‰ âœ… æ¨èåŸåˆ™ï¼š\nå¦‚æœä½ å·²ç»æœ‰ []byte æˆ– stringï¼Œç”¨ Unmarshal/Marshalã€‚ å¦‚æœä½ åœ¨å¤„ç† http.Request.Bodyã€os.Fileã€bytes.Buffer ç­‰ æµå¼ I/Oï¼Œç”¨ Decoder/Encoderã€‚ âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ è®°å¾—å…³é—­ io.ReadCloser\nå¦‚ resp.Bodyï¼Œä½¿ç”¨åè¦ defer resp.Body.Close()ã€‚\nEncode() è‡ªåŠ¨åŠ æ¢è¡Œ\nè‹¥ä¸éœ€è¦ \\nï¼Œå¯æ”¹ç”¨ json.Marshal + w.Write()ã€‚\né”™è¯¯å¤„ç†ä¸å¯çœç•¥\nDecode/Encode è¿”å›çš„ error å¿…é¡»æ£€æŸ¥ã€‚\nç»“æ„ä½“å­—æ®µéœ€å¯¼å‡ºä¸”å¸¦ tag\n1type User struct { 2 Name string `json:\u0026#34;name\u0026#34;` // å¿…é¡»å¤§å†™ + json tag 3} âœ… æ€»ç»“ å·¥å…· ä¼˜åŠ¿ å…¸å‹ç”¨é€” json.NewDecoder æµå¼è§£æï¼Œçœå†…å­˜ HTTP è¯·æ±‚ä½“ã€å¤§ JSON æ–‡ä»¶ json.NewEncoder æµå¼ç”Ÿæˆï¼Œé«˜æ•ˆå†™å…¥ HTTP å“åº”ã€æ—¥å¿—è¾“å‡ºã€é…ç½®ä¿å­˜ å®ƒä»¬æ˜¯ Go ä¸­å¤„ç† JSON I/O çš„æœ€ä½³å®è·µï¼Œå°¤å…¶åœ¨ Web å¼€å‘å’Œç³»ç»Ÿç¼–ç¨‹ä¸­æ— å¤„ä¸åœ¨ã€‚\nå¦‚æœä½ éœ€è¦ï¼š\nè‡ªå®šä¹‰ JSON ç¼–è§£ç è¡Œä¸ºï¼ˆå®ç° json.Marshaler/Unmarshalerï¼‰ å¤„ç†æ—¶é—´æ ¼å¼ï¼ˆå¦‚ RFC3339ï¼‰ å¿½ç•¥æœªçŸ¥å­—æ®µï¼ˆDecoder.DisallowUnknownFields()ï¼‰ åœ¨ Go è¯­è¨€ä¸­ï¼Œcontextï¼ˆä¸Šä¸‹æ–‡ï¼‰æ˜¯æ ‡å‡†åº“ context åŒ…æä¾›çš„ä¸€ä¸ªå¼ºå¤§æœºåˆ¶ï¼Œç”¨äºåœ¨ goroutine ä¹‹é—´ä¼ é€’è¯·æ±‚èŒƒå›´çš„å€¼ã€å–æ¶ˆä¿¡å·å’Œæˆªæ­¢æ—¶é—´ï¼ˆdeadlineï¼‰ã€‚å®ƒæ˜¯æ„å»ºå¯å–æ¶ˆã€å¯è¶…æ—¶ã€å¯è¿½è¸ªçš„å¹¶å‘ç¨‹åºçš„æ ¸å¿ƒå·¥å…·ï¼Œå°¤å…¶åœ¨ Web æœåŠ¡ã€å¾®æœåŠ¡ã€æ•°æ®åº“æ“ä½œç­‰åœºæ™¯ä¸­è‡³å…³é‡è¦ã€‚ ğŸ§  ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Contextï¼Ÿ Go ç¨‹åºå¤§é‡ä½¿ç”¨ goroutine å®ç°å¹¶å‘ã€‚ä½†å½“ä¸€ä¸ªè¯·æ±‚è¢«å–æ¶ˆï¼ˆå¦‚å®¢æˆ·ç«¯æ–­å¼€ï¼‰ã€è¶…æ—¶æˆ–éœ€è¦ä¼ é€’ç”¨æˆ·èº«ä»½ç­‰ä¿¡æ¯æ—¶ï¼Œå¦‚ä½•ï¼š\né€šçŸ¥æ‰€æœ‰ç›¸å…³ goroutine åœæ­¢å·¥ä½œï¼Ÿ é¿å…èµ„æºæ³„æ¼ï¼ˆå¦‚æœªå…³é—­çš„æ•°æ®åº“è¿æ¥ã€HTTP è¯·æ±‚ï¼‰ï¼Ÿ åœ¨è°ƒç”¨é“¾ä¸­ä¼ é€’è¯·æ±‚å…ƒæ•°æ®ï¼ˆå¦‚ trace IDã€user IDï¼‰ï¼Ÿ context.Context æ­£æ˜¯ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œè®¾è®¡çš„ã€‚\nâœ… å®ƒæ˜¯ Go å¹¶å‘ç¼–ç¨‹çš„â€œæœ€ä½³å®è·µâ€ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„æ§åˆ¶æµç®¡ç†æ–¹å¼ã€‚\nğŸ“¦ äºŒã€Context çš„æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ å–æ¶ˆï¼ˆCancellationï¼‰ é€šè¿‡ cancel() å‡½æ•°æˆ–è¶…æ—¶è‡ªåŠ¨è§¦å‘ï¼Œé€šçŸ¥ä¸‹æ¸¸åœæ­¢ æˆªæ­¢æ—¶é—´ï¼ˆDeadlineï¼‰ è®¾ç½®æ“ä½œçš„æœ€å¤§æ‰§è¡Œæ—¶é—´ æºå¸¦å€¼ï¼ˆValueï¼‰ åœ¨è¯·æ±‚é“¾è·¯ä¸­ä¼ é€’è¯·æ±‚ä½œç”¨åŸŸçš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ· IDã€trace IDï¼‰ æ ‘å½¢ä¼ æ’­ å­ context ç»§æ‰¿çˆ¶ contextï¼Œå–æ¶ˆä¿¡å·è‡ªä¸Šè€Œä¸‹ä¼ æ’­ ä¸å¯å˜æ€§ æ¯æ¬¡æ´¾ç”Ÿæ–° context éƒ½è¿”å›æ–°å®ä¾‹ï¼ŒåŸ context ä¸å˜ ğŸ”‘ ä¸‰ã€æ ¸å¿ƒæ¥å£ä¸å‡½æ•° 1. context.Context æ¥å£ 1type Context interface { 2 Deadline() (deadline time.Time, ok bool) 3 Done() \u0026lt;-chan struct{} 4 Err() error 5 Value(key any) any 6} Done()ï¼šè¿”å›ä¸€ä¸ªåªè¯» channelï¼Œå½“ context è¢«å–æ¶ˆæˆ–è¶…æ—¶æ—¶å…³é—­ã€‚ Err()ï¼šè¿”å›å–æ¶ˆåŸå› ï¼ˆcontext.Canceled æˆ– context.DeadlineExceededï¼‰ã€‚ Value(key)ï¼šè·å–ç»‘å®šåˆ° context çš„å€¼ï¼ˆä»…ç”¨äºä¼ é€’è¯·æ±‚ä½œç”¨åŸŸæ•°æ®ï¼Œä¸è¦ä¼ å‡½æ•°å‚æ•°ï¼ï¼‰ 2. åˆ›å»º Context çš„å·¥å‚å‡½æ•° å‡½æ•° ç”¨é€” context.Background() ä¸»åŠ¨åˆ›å»º context çš„æ ¹ï¼ˆmainã€initã€æµ‹è¯•ä¸­ä½¿ç”¨ï¼‰ context.TODO() ä¸ç¡®å®šç”¨ä»€ä¹ˆ context æ—¶çš„å ä½ç¬¦ï¼ˆåæœŸåº”æ›¿æ¢ï¼‰ context.WithCancel(parent) è¿”å›å¯æ‰‹åŠ¨å–æ¶ˆçš„å­ context context.WithTimeout(parent, timeout) å¸¦è¶…æ—¶è‡ªåŠ¨å–æ¶ˆçš„ context context.WithDeadline(parent, d) å¸¦ç»å¯¹æˆªæ­¢æ—¶é—´çš„ context context.WithValue(parent, key, val) æºå¸¦é”®å€¼å¯¹çš„ contextï¼ˆkey åº”ä¸ºè‡ªå®šä¹‰æœªå¯¼å‡ºç±»å‹ï¼‰ ğŸ’¡ å››ã€å¸¸ç”¨ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šæ‰‹åŠ¨å–æ¶ˆï¼ˆWithCancelï¼‰ 1func main() { 2 ctx, cancel := context.WithCancel(context.Background()) 3 defer cancel() // ç¡®ä¿èµ„æºé‡Šæ”¾ 4 5 go doWork(ctx) 6 7 time.Sleep(2 * time.Second) 8 cancel() // å‘é€å–æ¶ˆä¿¡å· 9 time.Sleep(1 * time.Second) // ç­‰å¾… goroutine é€€å‡º 10} 11 12func doWork(ctx context.Context) { 13 for { 14 select { 15 case \u0026lt;-ctx.Done(): 16 fmt.Println(\u0026#34;Work cancelled:\u0026#34;, ctx.Err()) 17 return 18 default: 19 fmt.Println(\u0026#34;Working...\u0026#34;) 20 time.Sleep(500 * time.Millisecond) 21 } 22 } 23} ç¤ºä¾‹ 2ï¼šè¶…æ—¶æ§åˆ¶ï¼ˆWithTimeoutï¼‰ 1func fetchUserData(ctx context.Context, userID string) error { 2 // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆå¦‚ HTTP è¯·æ±‚ã€DB æŸ¥è¯¢ï¼‰ 3 ch := make(chan error, 1) 4 go func() { 5 time.Sleep(3 * time.Second) // æ¨¡æ‹Ÿæ…¢å“åº” 6 ch \u0026lt;- nil 7 }() 8 9 select { 10 case \u0026lt;-ctx.Done(): 11 return ctx.Err() // è¶…æ—¶æˆ–å–æ¶ˆ 12 case err := \u0026lt;-ch: 13 return err 14 } 15} 16 17func main() { 18 ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second) 19 defer cancel() 20 21 if err := fetchUserData(ctx, \u0026#34;123\u0026#34;); err != nil { 22 log.Println(\u0026#34;Error:\u0026#34;, err) // context deadline exceeded 23 } 24} ç¤ºä¾‹ 3ï¼šä¼ é€’è¯·æ±‚ä½œç”¨åŸŸçš„å€¼ï¼ˆWithValueï¼‰ âš ï¸ æ³¨æ„ï¼šä»…ç”¨äºè·¨ API è¾¹ç•Œçš„è¯·æ±‚æ•°æ®ï¼ˆå¦‚ trace IDï¼‰ï¼Œä¸è¦æ›¿ä»£å‡½æ•°å‚æ•°ï¼\n1type contextKey string 2 3const UserIDKey contextKey = \u0026#34;userID\u0026#34; 4 5func main() { 6 ctx := context.WithValue(context.Background(), UserIDKey, \u0026#34;user-789\u0026#34;) 7 8 handleRequest(ctx) 9} 10 11func handleRequest(ctx context.Context) { 12 if userID, ok := ctx.Value(UserIDKey).(string); ok { 13 log.Printf(\u0026#34;Handling request for user: %s\u0026#34;, userID) 14 // è°ƒç”¨ DBã€RPC ç­‰ï¼Œç»§ç»­ä¼ é€’ ctx 15 processOrder(ctx, userID) 16 } 17} 18 19func processOrder(ctx context.Context, userID string) { 20 // ç»§ç»­ä½¿ç”¨ ctx... 21} ğŸ”’ å®‰å…¨å»ºè®®ï¼škey åº”ä¸ºæœªå¯¼å‡ºçš„è‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ contextKeyï¼‰ï¼Œé¿å…ä¸å…¶ä»–åŒ…å†²çªã€‚\nğŸŒ äº”ã€åœ¨ HTTP æœåŠ¡ä¸­çš„å…¸å‹åº”ç”¨ Go çš„ net/http åŒ…å¤©ç„¶æ”¯æŒ contextï¼š\næ¯ä¸ª *http.Request è‡ªå¸¦ Context() æ–¹æ³• å¯é€šè¿‡ r.Context() è·å–ï¼Œå¹¶ä¼ é€’ç»™ä¸‹æ¸¸é€»è¾‘ å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œè¯¥ context ä¼šè‡ªåŠ¨å–æ¶ˆ 1func handler(w http.ResponseWriter, r *http.Request) { 2 ctx := r.Context() 3 4 // è®¾ç½®æ€»å¤„ç†æ—¶é—´ä¸è¶…è¿‡ 5 ç§’ 5 ctx, cancel := context.WithTimeout(ctx, 5*time.Second) 6 defer cancel() 7 8 result, err := expensiveOperation(ctx) 9 if err != nil { 10 http.Error(w, err.Error(), http.StatusGatewayTimeout) 11 return 12 } 13 14 w.Write([]byte(result)) 15} ğŸš« å…­ã€å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ è¯¯åŒº æ­£ç¡®åšæ³• ç”¨ context ä¼ é€’å‡½æ•°å‚æ•° âŒ ä»…ç”¨äºè¯·æ±‚ä½œç”¨åŸŸå…ƒæ•°æ®ï¼ˆå¦‚ trace IDï¼‰ å¿½ç•¥ Done() é€šé“ âœ… åœ¨é•¿æ—¶é—´è¿è¡Œçš„ goroutine ä¸­å¿…é¡»ç›‘å¬ ctx.Done() å¤ç”¨ context è€Œä¸æ´¾ç”Ÿ âŒ æ¯ä¸ªé€»è¾‘æ­¥éª¤åº”åŸºäºçˆ¶ context æ´¾ç”Ÿæ–° context ä½¿ç”¨å­—ç¬¦ä¸²/æ•´æ•°ä½œä¸º Value çš„ key âŒ ä½¿ç”¨æœªå¯¼å‡ºçš„è‡ªå®šä¹‰ç±»å‹é¿å…å†²çª ä¸è°ƒç”¨ cancel() âœ… å³ä½¿æœ‰è¶…æ—¶ï¼Œä¹Ÿåº” defer cancel() é˜²æ­¢èµ„æºæ³„æ¼ ğŸ§© ä¸ƒã€Context çš„åº•å±‚åŸç†ï¼ˆç®€è¦ï¼‰ context æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªå­ context æŒ‡å‘çˆ¶ contextã€‚ å–æ¶ˆä¿¡å·é€šè¿‡å†…éƒ¨ channel å¹¿æ’­ï¼Œæ‰€æœ‰ç›‘å¬ Done() çš„ goroutine ä¼šè¢«é€šçŸ¥ã€‚ WithValue åˆ›å»ºçš„æ–° context ä¼šä¿å­˜ key-value å¯¹ï¼Œå¹¶åœ¨ Value() è¢«è°ƒç”¨æ—¶æ²¿çˆ¶é“¾æŸ¥æ‰¾ã€‚ âœ… æ€»ç»“ åœºæ™¯ æ¨è Context ç±»å‹ ä¸»å‡½æ•°ã€æµ‹è¯• context.Background() æœªçŸ¥ä¸Šä¸‹æ–‡ context.TODO()ï¼ˆä¸´æ—¶ï¼‰ éœ€è¦æ‰‹åŠ¨å–æ¶ˆ context.WithCancel æ¥å£è°ƒç”¨ã€HTTP å¤„ç† context.WithTimeout ä¼ é€’ trace ID / user ID context.WithValueï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ ğŸ“Œ é»„é‡‘æ³•åˆ™ï¼šä»»ä½•å¯èƒ½é˜»å¡æˆ–å¯åŠ¨ goroutine çš„å‡½æ•°ï¼Œéƒ½åº”æ¥å— context.Context ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚\nåœ¨ Go è¯­è¨€ä¸­ï¼Œç»“æ„ä½“ï¼ˆstructï¼‰å­—æ®µçš„ tagï¼ˆæ ‡ç­¾ï¼‰ æ˜¯ä¸€ç§é™„åŠ åœ¨å­—æ®µå£°æ˜åé¢çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç”¨äºä¸ºåå°„ï¼ˆreflectionï¼‰æä¾›å…ƒæ•°æ®ã€‚å®ƒæœ¬èº«å¯¹ç¨‹åºé€»è¾‘æ²¡æœ‰ç›´æ¥å½±å“ï¼Œä½†è¢«æ ‡å‡†åº“ï¼ˆå¦‚ encoding/jsonã€encoding/xmlã€database/sqlï¼‰å’Œç¬¬ä¸‰æ–¹åº“å¹¿æ³›ç”¨äºæ§åˆ¶åºåˆ—åŒ–ã€ååºåˆ—åŒ–ã€æ•°æ®åº“æ˜ å°„ç­‰è¡Œä¸ºã€‚ ğŸ“Œ ä¸€ã€åŸºæœ¬è¯­æ³• 1type User struct { 2 Name string `json:\u0026#34;name\u0026#34; db:\u0026#34;user_name\u0026#34;` 3 Age int `json:\u0026#34;age,omitempty\u0026#34; validate:\u0026#34;min=0,max=150\u0026#34;` 4 Secret string `json:\u0026#34;-\u0026#34;` // å¿½ç•¥è¯¥å­—æ®µ 5} Tag å†™åœ¨å­—æ®µç±»å‹åé¢ï¼Œç”¨åå¼•å· ` åŒ…è£¹ã€‚ é€šå¸¸ä»¥ key:\u0026quot;value\u0026quot; çš„å½¢å¼ç»„ç»‡ï¼Œå¤šä¸ª key-value å¯¹ç”¨ç©ºæ ¼åˆ†éš”ã€‚ è§£ææ—¶é€šè¿‡ reflect.StructTag æä¾›çš„ .Get(\u0026quot;key\u0026quot;) æ–¹æ³•è¯»å–ã€‚ ğŸ” äºŒã€Tag çš„åº•å±‚æœºåˆ¶ï¼ˆé€šè¿‡åå°„ï¼‰ Go åœ¨è¿è¡Œæ—¶å¯é€šè¿‡ reflect åŒ…è·å–å­—æ®µçš„ tagï¼š\n1t := reflect.TypeOf(User{}) 2field, _ := t.FieldByName(\u0026#34;Name\u0026#34;) 3fmt.Println(field.Tag.Get(\u0026#34;json\u0026#34;)) // è¾“å‡º: name 4fmt.Println(field.Tag.Get(\u0026#34;db\u0026#34;)) // è¾“å‡º: user_name âš ï¸ æ³¨æ„ï¼štag æ˜¯çº¯å­—ç¬¦ä¸²ï¼ŒGo ä¸éªŒè¯å…¶æ ¼å¼ï¼Œè§£æé€»è¾‘ç”±ä½¿ç”¨æ–¹ï¼ˆå¦‚ json åŒ…ï¼‰å®ç°ã€‚\nğŸ§© ä¸‰ã€å¸¸è§æ ‡å‡†åº“ä¸­çš„ Tag ç”¨æ³• 1. encoding/json â€” JSON åºåˆ—åŒ–/ååºåˆ—åŒ– Tag å€¼ è¯´æ˜ json:\u0026quot;name\u0026quot; å­—æ®µåœ¨ JSON ä¸­çš„é”®åä¸º \u0026quot;name\u0026quot; json:\u0026quot;name,omitempty\u0026quot; å¦‚æœå­—æ®µä¸ºé›¶å€¼ï¼ˆå¦‚ \u0026quot;\u0026quot;, 0, nilï¼‰ï¼Œåˆ™ä¸è¾“å‡ºåˆ° JSON json:\u0026quot;-\u0026quot; å®Œå…¨å¿½ç•¥è¯¥å­—æ®µï¼ˆä¸ç¼–ç ä¹Ÿä¸è§£ç ï¼‰ json:\u0026quot;,string\u0026quot; å°†æ•°å€¼æˆ–å¸ƒå°”å€¼ç¼–ç ä¸º JSON å­—ç¬¦ä¸²ï¼ˆå¦‚ \u0026quot;123\u0026quot; è€Œé 123ï¼‰ âœ… ç¤ºä¾‹ï¼š\n1type Person struct { 2 ID int `json:\u0026#34;id\u0026#34;` 3 Name string `json:\u0026#34;name,omitempty\u0026#34;` 4 Hidden string `json:\u0026#34;-\u0026#34;` 5 Count int `json:\u0026#34;count,string\u0026#34;` 6} 1p := Person{ID: 1, Count: 42} 2data, _ := json.Marshal(p) 3// ç»“æœ: {\u0026#34;id\u0026#34;:1,\u0026#34;count\u0026#34;:\u0026#34;42\u0026#34;} ï¼ˆName ä¸ºé›¶å€¼è¢« omitï¼ŒHidden è¢«å¿½ç•¥ï¼‰ 2. database/sql + ORMï¼ˆå¦‚ GORMã€sqlxï¼‰ è™½ç„¶æ ‡å‡†åº“ database/sql æœ¬èº«ä¸ç›´æ¥ä½¿ç”¨ tagï¼Œä½†æµè¡Œ ORM ä¼šï¼š\nsqlx ç¤ºä¾‹ï¼š 1type User struct { 2 ID int `db:\u0026#34;id\u0026#34;` 3 Name string `db:\u0026#34;full_name\u0026#34;` 4} 1var u User 2sqlx.DB.Get(\u0026amp;u, \u0026#34;SELECT id, full_name FROM users WHERE id = $1\u0026#34;, 1) GORM ç¤ºä¾‹ï¼š 1type Product struct { 2 ID uint `gorm:\u0026#34;primaryKey\u0026#34;` 3 Name string `gorm:\u0026#34;size:100;not null\u0026#34;` 4 Price float64 5 Description string `gorm:\u0026#34;type:text\u0026#34;` 6} 3. encoding/xml 1type Person struct { 2 XMLName xml.Name `xml:\u0026#34;person\u0026#34;` 3 Name string `xml:\u0026#34;full_name\u0026#34;` 4 Age int `xml:\u0026#34;age,attr\u0026#34;` // ä½œä¸º XML å±æ€§ 5} è¾“å‡ºï¼š\n1\u0026lt;person age=\u0026#34;30\u0026#34;\u0026gt; 2 \u0026lt;full_name\u0026gt;Alice\u0026lt;/full_name\u0026gt; 3\u0026lt;/person\u0026gt; 4. è¡¨å•è§£æï¼ˆnet/http + r.ParseForm()ï¼‰ Go æ ‡å‡†åº“æ”¯æŒ form tag ç”¨äºè§£æ URL è¡¨å•æˆ– multipart è¡¨å•ï¼š\n1type LoginForm struct { 2 Username string `form:\u0026#34;username\u0026#34;` 3 Password string `form:\u0026#34;password\u0026#34;` 4} 1func handler(w http.ResponseWriter, r *http.Request) { 2 r.ParseForm() 3 var form LoginForm 4 if err := schema.NewDecoder().Decode(\u0026amp;form, r.PostForm); err != nil { 5 // éœ€è¦ç¬¬ä¸‰æ–¹åº“å¦‚ github.com/gorilla/schema 6 } 7} ğŸ’¡ æ ‡å‡†åº“ http.Request.FormValue() ä¸ç›´æ¥ä½¿ç”¨ struct tagï¼Œä½†å¾ˆå¤š Web æ¡†æ¶ï¼ˆå¦‚ Ginã€Echoï¼‰æ”¯æŒã€‚\nğŸ›¡ï¸ å››ã€è‡ªå®šä¹‰ Tag çš„æœ€ä½³å®è·µ âœ… æ¨èåšæ³•ï¼š ä½¿ç”¨æœªå¯¼å‡ºçš„ç±»å‹ä½œä¸º keyï¼ˆå¦‚æœè‡ªå·±è§£æï¼‰ 1type validateKey string 2// ä½† tag ä»æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥é€šå¸¸ç›´æ¥ç”¨å­—ç¬¦ä¸² key ä¿æŒ tag ç®€æ´ã€è¯­ä¹‰æ¸…æ™° é¿å…åœ¨ tag ä¸­å­˜æ”¾ä¸šåŠ¡é€»è¾‘ âŒ é¿å…ï¼š æŠŠæ•æ„Ÿä¿¡æ¯æ”¾åœ¨ tag ä¸­ï¼ˆtag å¯é€šè¿‡åå°„è¯»å–ï¼‰ è¿‡åº¦è®¾è®¡å¤æ‚çš„ tag è¯­æ³• ç”¨ tag æ›¿ä»£å‡½æ•°å‚æ•°æˆ–é…ç½®å¯¹è±¡ ğŸ”§ äº”ã€å¦‚ä½•è§£æè‡ªå®šä¹‰ Tagï¼Ÿ ä½ å¯ä»¥è‡ªå·±å†™ä»£ç è§£æ tagï¼š\n1func getJSONTag(st interface{}) map[string]string { 2 t := reflect.TypeOf(st) 3 if t.Kind() == reflect.Ptr { 4 t = t.Elem() 5 } 6 7 tags := make(map[string]string) 8 for i := 0; i \u0026lt; t.NumField(); i++ { 9 field := t.Field(i) 10 jsonTag := field.Tag.Get(\u0026#34;json\u0026#34;) 11 if jsonTag != \u0026#34;\u0026#34; \u0026amp;\u0026amp; jsonTag != \u0026#34;-\u0026#34; { 12 // å¤„ç† omitempty ç­‰åç¼€ 13 name := strings.Split(jsonTag, \u0026#34;,\u0026#34;)[0] 14 tags[field.Name] = name 15 } 16 } 17 return tags 18} âœ… æ€»ç»“ï¼šStruct Tag çš„æ ¸å¿ƒä½œç”¨ ç”¨é€” å…¸å‹ Tag Key ä½¿ç”¨åœºæ™¯ JSON ç¼–è§£ç  json Web APIã€é…ç½®æ–‡ä»¶ æ•°æ®åº“æ˜ å°„ db, gorm ORMã€SQL æŸ¥è¯¢ XML å¤„ç† xml ä¸æ—§ç³»ç»Ÿäº¤äº’ è¡¨å•ç»‘å®š form Web è¡¨å•æäº¤ å‚æ•°æ ¡éªŒ validate ç»“åˆ validator åº“ï¼ˆå¦‚ go-playground/validatorï¼‰ æ—¥å¿—/è°ƒè¯• logï¼ˆè‡ªå®šä¹‰ï¼‰ è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºå­—æ®µå ğŸ“Œ è®°ä½ï¼šTag æ˜¯ Go å®ç°â€œçº¦å®šä¼˜äºé…ç½®â€å’Œâ€œé›¶æˆæœ¬æŠ½è±¡â€çš„é‡è¦æ‰‹æ®µâ€”â€”ç¼–è¯‘æ—¶ä¸äº§ç”Ÿå¼€é”€ï¼Œè¿è¡Œæ—¶æŒ‰éœ€åå°„è§£æã€‚\nGo è¯­è¨€ä¸­çš„åå°„ï¼ˆReflectionï¼‰ æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥ã€ä¿®æ”¹è‡ªèº«ç»“æ„å’Œè¡Œä¸ºçš„èƒ½åŠ›ã€‚å®ƒç”±æ ‡å‡†åº“ reflect åŒ…æä¾›ï¼Œå…è®¸ä½ åœ¨ä¸çŸ¥é“å…·ä½“ç±»å‹çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ“ä½œå˜é‡çš„ç±»å‹ï¼ˆTypeï¼‰å’Œå€¼ï¼ˆValueï¼‰ã€‚ âš ï¸ æ³¨æ„ï¼šåå°„å¼ºå¤§ä½†æœ‰ä»£ä»·â€”â€”æ€§èƒ½è¾ƒä½ã€ä»£ç å¯è¯»æ€§å·®ã€æ˜“å‡ºé”™ã€‚åº”ä¼˜å…ˆä½¿ç”¨æ¥å£ã€æ³›å‹ï¼ˆGo 1.18+ï¼‰ç­‰é™æ€æœºåˆ¶ï¼Œä»…åœ¨å¿…è¦æ—¶ï¼ˆå¦‚åºåˆ—åŒ–åº“ã€ORMã€æµ‹è¯•æ¡†æ¶ï¼‰ä½¿ç”¨åå°„ã€‚\nğŸ§± ä¸€ã€åå°„çš„æ ¸å¿ƒæ¦‚å¿µ Go çš„åå°„åŸºäºä¸¤ä¸ªæ ¸å¿ƒç±»å‹ï¼š\nç±»å‹ è¯´æ˜ reflect.Type è¡¨ç¤º Go ç±»å‹çš„å…ƒä¿¡æ¯ï¼ˆå¦‚ intã€stringã€*Userã€[]intï¼‰ reflect.Value è¡¨ç¤ºä¸€ä¸ªå…·ä½“å˜é‡çš„å€¼åŠå…¶å¯æ“ä½œæ€§ï¼ˆå¯è¯»ã€å¯å†™ã€å¯å¯»å€ç­‰ï¼‰ è·å–æ–¹å¼ï¼š 1var x int = 42 2t := reflect.TypeOf(x) // Type: int 3v := reflect.ValueOf(x) // Value: 42 ğŸ” äºŒã€åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ 1. æ£€æŸ¥ç±»å‹å’Œå€¼ 1package main 2 3import ( 4 \u0026#34;fmt\u0026#34; 5 \u0026#34;reflect\u0026#34; 6) 7 8func main() { 9 var s = \u0026#34;Hello, Go\u0026#34; 10 t := reflect.TypeOf(s) 11 v := reflect.ValueOf(s) 12 13 fmt.Println(\u0026#34;Type:\u0026#34;, t) // string 14 fmt.Println(\u0026#34;Kind:\u0026#34;, t.Kind()) // kind æ˜¯åº•å±‚ç±»å‹ï¼ˆstringï¼‰ 15 fmt.Println(\u0026#34;Value:\u0026#34;, v) // Hello, Go 16 fmt.Println(\u0026#34;Interface:\u0026#34;, v.Interface()) // è½¬å› interface{} â†’ \u0026#34;Hello, Go\u0026#34; 17} âœ… Kind() è¿”å›çš„æ˜¯åº•å±‚ç±»åˆ«ï¼ˆå¦‚ slice, struct, ptr, stringï¼‰ï¼Œè€Œ Type æ˜¯å…·ä½“ç±»å‹ï¼ˆå¦‚ []string, *Userï¼‰ã€‚\n2. ä¿®æ”¹å˜é‡çš„å€¼ï¼ˆéœ€ä¼ æŒ‡é’ˆï¼‰ 1func main() { 2 x := 10 3 v := reflect.ValueOf(\u0026amp;x).Elem() // å¿…é¡»å–åœ°å€å† Elem() 4 5 if v.CanSet() { 6 v.SetInt(20) 7 } 8 fmt.Println(x) // è¾“å‡º: 20 9} â— å…³é”®ç‚¹ï¼š\nreflect.ValueOf(x) å¾—åˆ°çš„æ˜¯å‰¯æœ¬ï¼Œä¸å¯ä¿®æ”¹ã€‚ è¦ä¿®æ”¹åŸå˜é‡ï¼Œå¿…é¡»ä¼ å…¥æŒ‡é’ˆï¼šreflect.ValueOf(\u0026amp;x).Elem() ä½¿ç”¨å‰åŠ¡å¿…æ£€æŸ¥ CanSet() 3. éå†ç»“æ„ä½“å­—æ®µï¼ˆå« tagï¼‰ 1type User struct { 2 Name string `json:\u0026#34;name\u0026#34; validate:\u0026#34;required\u0026#34;` 3 Age int `json:\u0026#34;age\u0026#34;` 4} 5 6func main() { 7 u := User{Name: \u0026#34;Alice\u0026#34;, Age: 30} 8 t := reflect.TypeOf(u) 9 v := reflect.ValueOf(u) 10 11 for i := 0; i \u0026lt; t.NumField(); i++ { 12 field := t.Field(i) 13 value := v.Field(i) 14 15 fmt.Printf(\u0026#34;Field: %s, Value: %v, Tag: %s\\n\u0026#34;, 16 field.Name, 17 value.Interface(), 18 field.Tag.Get(\u0026#34;json\u0026#34;)) 19 } 20} è¾“å‡ºï¼š\n1Field: Name, Value: Alice, Tag: name 2Field: Age, Value: 30, Tag: age ğŸ’¡ è¿™æ˜¯ JSON åºåˆ—åŒ–åº“ï¼ˆå¦‚ encoding/jsonï¼‰è¯»å– struct tag çš„åŸç†ã€‚\n4. è°ƒç”¨å‡½æ•°æˆ–æ–¹æ³• 1func Add(a, b int) int { 2 return a + b 3} 4 5func main() { 6 f := reflect.ValueOf(Add) 7 args := []reflect.Value{ 8 reflect.ValueOf(3), 9 reflect.ValueOf(5), 10 } 11 result := f.Call(args) 12 fmt.Println(result[0].Int()) // 8 13} å¯ç”¨äºå®ç°æ’ä»¶ç³»ç»Ÿã€RPC è°ƒç”¨ç­‰ã€‚\nğŸ§© ä¸‰ã€åå°„çš„å…¸å‹åº”ç”¨åœºæ™¯ åœºæ™¯ è¯´æ˜ JSON/XML åºåˆ—åŒ– encoding/json é€šè¿‡åå°„è¯»å– struct å­—æ®µå’Œ tag æ•°æ®åº“ ORM GORMã€sqlx ç”¨åå°„å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ° struct å‚æ•°æ ¡éªŒ go-playground/validator é€šè¿‡ tag å’Œåå°„éªŒè¯å­—æ®µ ä¾èµ–æ³¨å…¥æ¡†æ¶ åŠ¨æ€åˆ›å»ºå¯¹è±¡å¹¶æ³¨å…¥ä¾èµ– æµ‹è¯•å·¥å…· testify/mock ç­‰ mock åº“åˆ©ç”¨åå°„æ‹¦æˆªæ–¹æ³•è°ƒç”¨ é€šç”¨å·¥å…·å‡½æ•° å¦‚æ·±æ‹·è´ã€æ¯”è¾ƒã€æ‰“å°ä»»æ„ç»“æ„ âš ï¸ å››ã€åå°„çš„å±€é™ä¸é™·é˜± 1. æ€§èƒ½å¼€é”€å¤§ åå°„è°ƒç”¨æ¯”ç›´æ¥è°ƒç”¨æ…¢ 10~100 å€ã€‚ é¿å…åœ¨ hot pathï¼ˆé«˜é¢‘è·¯å¾„ï¼‰ä½¿ç”¨ã€‚ 2. ä¸§å¤±ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨ é”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶æš´éœ²ï¼ˆå¦‚å­—æ®µä¸å­˜åœ¨ã€ç±»å‹ä¸åŒ¹é…ï¼‰ã€‚ 3. ä¸èƒ½è®¿é—®æœªå¯¼å‡ºï¼ˆå°å†™ï¼‰å­—æ®µ/æ–¹æ³• 1type secret struct { 2 hidden string // å°å†™å­—æ®µ 3} 4// reflect æ— æ³• Set æˆ– Call å®ƒï¼ˆé™¤éåœ¨åŒä¸€åŒ…å†…ï¼‰ 4. å¤æ‚ç±»å‹å¤„ç†ç¹ç å¤„ç†åµŒå¥— structã€interface{}ã€mapã€channel éœ€å¤§é‡ç±»å‹åˆ¤æ–­ã€‚ 5. Go æ³›å‹ï¼ˆ1.18+ï¼‰å‡å°‘äº†å¯¹åå°„çš„éœ€æ±‚ å¾ˆå¤šä»¥å‰éœ€åå°„çš„é€šç”¨é€»è¾‘ï¼Œç°åœ¨å¯ç”¨æ³›å‹å®‰å…¨å®ç°ã€‚ âœ… äº”ã€æœ€ä½³å®è·µ å»ºè®® è¯´æ˜ ä¼˜å…ˆä½¿ç”¨æ¥å£æˆ–æ³›å‹ å¦‚ io.Readerã€sort.Interface ç¼“å­˜ reflect.Type é¿å…é‡å¤è°ƒç”¨ reflect.TypeOf å§‹ç»ˆæ£€æŸ¥ CanSet() / IsValid() é˜²æ­¢ panic é™åˆ¶åå°„èŒƒå›´ ä»…ç”¨äºæ¡†æ¶å±‚ï¼Œä¸šåŠ¡ä»£ç å°½é‡é¿å… é…åˆ struct tag ä½¿ç”¨ å®ç°é…ç½®é©±åŠ¨çš„è¡Œä¸º ğŸ”š å…­ã€æ€»ç»“ ç‰¹æ€§ è¯´æ˜ èƒ½åŠ› è¿è¡Œæ—¶è·å–ç±»å‹ã€ä¿®æ”¹å€¼ã€è°ƒç”¨å‡½æ•°ã€éå†ç»“æ„ å…¥å£ reflect.TypeOf() å’Œ reflect.ValueOf() æ ¸å¿ƒç±»å‹ reflect.Typeï¼ˆç±»å‹ä¿¡æ¯ï¼‰ã€reflect.Valueï¼ˆå€¼æ“ä½œï¼‰ é€‚ç”¨åœºæ™¯ åºåˆ—åŒ–ã€ORMã€æµ‹è¯•ã€æ¡†æ¶å¼€å‘ æ›¿ä»£æ–¹æ¡ˆ æ¥å£ã€æ³›å‹ã€ä»£ç ç”Ÿæˆï¼ˆå¦‚ stringerï¼‰ ğŸ“Œ è®°ä½ï¼š\nâ€œWith great power comes great responsibility.â€\nâ€”â€” åå°„æ˜¯â€œæœ€åçš„æ‰‹æ®µâ€ï¼Œä¸æ˜¯â€œé¦–é€‰å·¥å…·â€ã€‚\nGo è¯­è¨€ä¸­çš„ Go Modulesï¼ˆGo æ¨¡å—ï¼‰ æ˜¯ Go 1.11 å¼•å…¥ã€å¹¶åœ¨ Go 1.16 èµ·æˆä¸ºé»˜è®¤ä¾èµ–ç®¡ç†æœºåˆ¶çš„å®˜æ–¹æ–¹æ¡ˆï¼Œç”¨äºç®¡ç†é¡¹ç›®ä¾èµ–çš„ç‰ˆæœ¬ã€è§£å†³ä¾èµ–å†²çªã€å®ç°å¯é‡ç°æ„å»ºï¼ˆreproducible buildsï¼‰ã€‚å®ƒå–ä»£äº†æ—©æœŸçš„ GOPATH æ¨¡å¼ï¼Œä½¿ Go é¡¹ç›®å¯ä»¥è„±ç¦» GOPATH ç‹¬ç«‹å¼€å‘ã€‚ ğŸ§© ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Go Modulesï¼Ÿ åœ¨ Go Modules å‡ºç°å‰ï¼ŒGo ä¾èµ–ç®¡ç†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\nä¾èµ–å­˜å‚¨åœ¨ $GOPATH/srcï¼Œæ— æ³•æ”¯æŒå¤šç‰ˆæœ¬å…±å­˜ã€‚ æ²¡æœ‰æ˜¾å¼çš„ä¾èµ–ç‰ˆæœ¬é”å®šï¼Œæ„å»ºç»“æœä¸å¯é‡ç°ã€‚ æ— æ³•è½»æ¾ç®¡ç†ç§æœ‰ä»“åº“ä¾èµ–ã€‚ Go Modules è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå¸¦æ¥ï¼š âœ… ç‰ˆæœ¬åŒ–ä¾èµ–\nâœ… è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼ˆSemVerï¼‰\nâœ… ä¾èµ–éš”ç¦»ï¼ˆæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ï¼‰\nâœ… å¯ç¦»çº¿æ„å»ºï¼ˆé€šè¿‡æœ¬åœ°ç¼“å­˜ï¼‰\nâœ… æ”¯æŒç§æœ‰æ¨¡å—\nğŸ“ äºŒã€æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ è¯´æ˜ Moduleï¼ˆæ¨¡å—ï¼‰ ä¸€ä¸ªåŒ…å« go.mod æ–‡ä»¶çš„ç›®å½•åŠå…¶å­ç›®å½•ï¼Œä»£è¡¨ä¸€ä¸ªç‹¬ç«‹é¡¹ç›® go.mod æ¨¡å—çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œå£°æ˜æ¨¡å—è·¯å¾„ã€Go ç‰ˆæœ¬ã€ä¾èµ–é¡¹ go.sum ä¾èµ–æ ¡éªŒå’Œæ–‡ä»¶ï¼Œç¡®ä¿ä¾èµ–å†…å®¹æœªè¢«ç¯¡æ”¹ï¼ˆç±»ä¼¼ package-lock.jsonï¼‰ Module Path æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸æ˜¯ Git ä»“åº“ URLï¼ˆå¦‚ github.com/user/projectï¼‰ Version éµå¾ª è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆå¦‚ v1.2.3ï¼‰ï¼Œä¹Ÿæ”¯æŒ pseudo-versionï¼ˆä¼ªç‰ˆæœ¬ï¼‰ ğŸ› ï¸ ä¸‰ã€å¸¸ç”¨å‘½ä»¤ 1. åˆå§‹åŒ–æ¨¡å— 1# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ 2go mod init \u0026lt;module-path\u0026gt; 3 4# ç¤ºä¾‹ 5go mod init github.com/yourname/myproject ç”Ÿæˆ go.mod æ–‡ä»¶ã€‚\n2. æ·»åŠ /å‡çº§ä¾èµ– 1# è‡ªåŠ¨ä¸‹è½½å¹¶æ·»åŠ ç¼ºå¤±çš„ä¾èµ–ï¼ˆæ ¹æ®ä»£ç  importï¼‰ 2go mod tidy 3 4# æ‰‹åŠ¨æŒ‡å®šä¾èµ–ç‰ˆæœ¬ 5go get github.com/gin-gonic/gin@v1.9.1 6 7# å‡çº§åˆ°æœ€æ–° patch ç‰ˆæœ¬ 8go get -u=patch github.com/gin-gonic/gin 9 10# å‡çº§æ‰€æœ‰ç›´æ¥ä¾èµ–åˆ°æœ€æ–°å…¼å®¹ç‰ˆæœ¬ 11go get -u 3. æŸ¥çœ‹ä¾èµ–å›¾ 1# åˆ—å‡ºæ‰€æœ‰ä¾èµ– 2go list -m all 3 4# æŸ¥çœ‹ä¾èµ–æ ‘ 5go mod graph 6 7# æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ 8go list -m -versions github.com/gin-gonic/gin 4. éªŒè¯ä¸æ¸…ç† 1# éªŒè¯ä¾èµ–ä¸€è‡´æ€§ï¼ˆæ£€æŸ¥ go.sumï¼‰ 2go mod verify 3 4# ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ– 5go mod tidy 6 7# ä¸‹è½½æ‰€æœ‰ä¾èµ–åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆä¾¿äºç¦»çº¿å·¥ä½œï¼‰ 8go mod download ğŸ“„ å››ã€go.mod æ–‡ä»¶ç¤ºä¾‹ 1module github.com/yourname/myproject 2 3go 1.22 4 5require ( 6 github.com/gin-gonic/gin v1.9.1 7 golang.org/x/crypto v0.15.0 8) 9 10replace ( 11 // æ›¿æ¢ä¾èµ–ï¼ˆç”¨äºè°ƒè¯•æˆ–ç§æœ‰ forkï¼‰ 12 github.com/gin-gonic/gin =\u0026gt; ../local-gin 13) 14 15exclude ( 16 // æ’é™¤ç‰¹å®šç‰ˆæœ¬ï¼ˆæå°‘ä½¿ç”¨ï¼‰ 17 golang.org/x/crypto v0.10.0 18) moduleï¼šå½“å‰æ¨¡å—è·¯å¾„ goï¼šæœ€ä½å…¼å®¹çš„ Go ç‰ˆæœ¬ requireï¼šç›´æ¥ä¾èµ–åŠå…¶ç‰ˆæœ¬ replaceï¼šæ›¿æ¢ä¾èµ–æºï¼ˆå¼€å‘è°ƒè¯•ç¥å™¨ï¼‰ excludeï¼šæ’é™¤ç‰¹å®šç‰ˆæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ ğŸ” äº”ã€go.sum æ–‡ä»¶è¯´æ˜ 1github.com/gin-gonic/gin v1.9.1 h1:...æ ¡éªŒå’Œ... 2github.com/gin-gonic/gin v1.9.1/go.mod h1:...æ ¡éªŒå’Œ... 3golang.org/x/crypto v0.15.0 h1:...æ ¡éªŒå’Œ... è®°å½•æ¯ä¸ªä¾èµ–æ¨¡å—çš„å“ˆå¸Œå€¼ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä»£ç ã€‚ ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ï¼Œç”± go å‘½ä»¤è‡ªåŠ¨ç»´æŠ¤ã€‚ æäº¤åˆ° Gitï¼ˆç¡®ä¿å›¢é˜Ÿæ„å»ºä¸€è‡´ï¼‰ã€‚ ğŸŒ å…­ã€ç§æœ‰æ¨¡å—æ”¯æŒ 1. ä½¿ç”¨ç§æœ‰ Git ä»“åº“ 1# å‘Šè¯‰ Go è¯¥åŸŸåä¸èµ°ä»£ç†ï¼Œç›´æ¥èµ° Git 2git config --global url.\u0026#34;git@private.corp:\u0026#34;.insteadOf \u0026#34;https://private.corp/\u0026#34; 2. ç¦ç”¨ä»£ç†ï¼ˆé’ˆå¯¹ç§æœ‰æ¨¡å—ï¼‰ 1# è®¾ç½® GOPRIVATEï¼ˆåŒ¹é…çš„æ¨¡å—ä¸èµ° proxyï¼Œä¹Ÿä¸æ ¡éªŒ checksumï¼‰ 2go env -w GOPRIVATE=private.corp/* å¸¸è§ç¯å¢ƒå˜é‡ï¼š\nGOPROXYï¼šè®¾ç½®ä»£ç†ï¼ˆé»˜è®¤ https://proxy.golang.org,directï¼‰ GOSUMDBï¼šæ ¡éªŒå’Œæ•°æ®åº“ï¼ˆé»˜è®¤ sum.golang.orgï¼‰ GOPRIVATEï¼šæŒ‡å®šç§æœ‰æ¨¡å—ï¼ˆè‡ªåŠ¨è®¾ç½® GOPROXY=...,direct å’Œ GOSUMDB=offï¼‰ ğŸ”„ ä¸ƒã€ç‰ˆæœ¬é€‰æ‹©æœºåˆ¶ï¼ˆMinimal Version Selection, MVSï¼‰ Go ä½¿ç”¨ MVS ç®—æ³•é€‰æ‹©ä¾èµ–ç‰ˆæœ¬ï¼š\nä¿è¯æ„å»ºä½¿ç”¨æ»¡è¶³æ‰€æœ‰çº¦æŸçš„æœ€å°å…¼å®¹ç‰ˆæœ¬ã€‚ é¿å…â€œä¾èµ–åœ°ç‹±â€ï¼Œç¡®ä¿å¯é‡ç°æ„å»ºã€‚ ä¾‹å¦‚ï¼š\nA ä¾èµ– X@v1.2 B ä¾èµ– X@v1.3\nâ†’ æœ€ç»ˆé€‰æ‹© X@v1.3ï¼ˆæ»¡è¶³ä¸¤è€…è¦æ±‚çš„æœ€å°ç‰ˆæœ¬ï¼‰ ğŸ› ï¸ å…«ã€å¼€å‘æŠ€å·§ 1. æœ¬åœ°è°ƒè¯•ä¾èµ–ï¼ˆä½¿ç”¨ replaceï¼‰ 1// go.mod 2replace github.com/yourname/shared =\u0026gt; ../shared ä¿®æ”¹ ../shared ä»£ç åï¼Œä¸»é¡¹ç›®ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€æ¨é€åˆ°è¿œç¨‹ã€‚\n2. åˆ›å»ºå¯å‘å¸ƒçš„æ¨¡å— ç¡®ä¿ module path ä¸ Git ä»“åº“ URL ä¸€è‡´ã€‚ ä½¿ç”¨ git tag v1.0.0 æ‰“ç‰ˆæœ¬æ ‡ç­¾ï¼ˆGo ä¼šè¯†åˆ«ï¼‰ã€‚ é¦–æ¬¡å‘å¸ƒå»ºè®®ä» v0.x æˆ– v1.0.0 å¼€å§‹ã€‚ âš ï¸ æ³¨æ„ï¼šv0 å’Œ v1 è¡Œä¸ºä¸åŒï¼š\nv0.x.yï¼šå…è®¸ç ´åæ€§å˜æ›´ v1+ï¼šå¿…é¡»éµå¾ª SemVerï¼ˆä¸»ç‰ˆæœ¬å˜æ›´éœ€æ”¹ module pathï¼Œå¦‚ /v2ï¼‰ 3. å¤šä¸»ç‰ˆæœ¬æ”¯æŒï¼ˆMajor Subdirectoryï¼‰ 1module github.com/user/repo/v2 2 3// å¯¼å…¥æ—¶ 4import \u0026#34;github.com/user/repo/v2\u0026#34; âœ… ä¹ã€æœ€ä½³å®è·µ å»ºè®® è¯´æ˜ å§‹ç»ˆæäº¤ go.mod å’Œ go.sum ç¡®ä¿å›¢é˜Ÿæ„å»ºä¸€è‡´ å®šæœŸè¿è¡Œ go mod tidy æ¸…ç†æ— ç”¨ä¾èµ– é¿å…æ‰‹åŠ¨ç¼–è¾‘ go.sum ç”±å·¥å…·ç»´æŠ¤ ä½¿ç”¨ GOPRIVATE ç®¡ç†ç§æœ‰åº“ é¿å…æ³„éœ²æˆ–æ ¡éªŒå¤±è´¥ ä¸»ç‰ˆæœ¬å˜æ›´æ—¶æ›´æ–° module path å¦‚ /v2ã€/v3 ä¼˜å…ˆä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾ è€Œéåˆ†æ”¯æˆ– commit hash ğŸ“Œ æ€»ç»“ ç‰¹æ€§ è¯´æ˜ æ›¿ä»£ GOPATH é¡¹ç›®å¯æ”¾åœ¨ä»»æ„ç›®å½• ç‰ˆæœ¬åŒ–ä¾èµ– åŸºäº SemVer å¯é‡ç°æ„å»º é€šè¿‡ go.sum é”å®šå†…å®¹ å®˜æ–¹æ ‡å‡† Go 1.16+ é»˜è®¤å¯ç”¨ ç”Ÿæ€å‹å¥½ ä¸ä¸»æµä»£ç†ï¼ˆå¦‚ proxy.golang.orgã€Goproxy.cnï¼‰å…¼å®¹ ğŸ’¡ ä¸€å¥è¯è®°ä½ï¼š\ngo mod init â†’ å†™ä»£ç  â†’ go run / go build â†’ è‡ªåŠ¨ç®¡ç†ä¾èµ–\n","link":"https://jianlin-li.github.io/post/go_review_2/","section":"post","tags":["Go"],"title":"Goè¯­è¨€çš„çŸ¥è¯†ç‚¹-2"},{"body":"","link":"https://jianlin-li.github.io/post/","section":"post","tags":null,"title":"Posts"},{"body":"","link":"https://jianlin-li.github.io/tags/","section":"tags","tags":null,"title":"Tags"},{"body":"åŸºæœ¬ç±»å‹ä»‹ç» Golang æ›´æ˜ç¡®çš„æ•°å­—ç±»å‹å‘½åï¼Œæ”¯æŒ Unicodeï¼Œæ”¯æŒå¸¸ç”¨æ•°æ®ç»“æ„ã€‚\nç±»å‹ é•¿åº¦(å­—èŠ‚) é»˜è®¤å€¼ è¯´æ˜ bool 1 false byte 1 0 uint8 rune 4 0 Unicode Code Point, int32 int, uint 4æˆ–8 0 32 æˆ– 64 ä½ int8, uint8 1 0 -128 ~ 127, 0 ~ 255ï¼Œbyteæ˜¯uint8 çš„åˆ«å int16, uint16 2 0 -32768 ~ 32767, 0 ~ 65535 int32, uint32 4 0 -21äº¿~ 21äº¿, 0 ~ 42äº¿ï¼Œruneæ˜¯int32 çš„åˆ«å int64, uint64 8 0 float32 4 0.0 float64 8 0.0 complex64 8 complex128 16 uintptr 4æˆ–8 ä»¥å­˜å‚¨æŒ‡é’ˆçš„ uint32 æˆ– uint64 æ•´æ•° array å€¼ç±»å‹ struct å€¼ç±»å‹ string â€œâ€ UTF-8 å­—ç¬¦ä¸² slice nil å¼•ç”¨ç±»å‹ map nil å¼•ç”¨ç±»å‹ channel nil å¼•ç”¨ç±»å‹ interface nil æ¥å£ function nil å‡½æ•° æ”¯æŒå…«è¿›åˆ¶ã€ å…­è¿›åˆ¶ï¼Œä»¥åŠç§‘å­¦è®°æ•°æ³•ã€‚æ ‡å‡†åº“ math å®šä¹‰äº†å„æ•°å­—ç±»å‹å–å€¼èŒƒå›´ã€‚\n1 a, b, c, d := 071, 0x1F, 1e9, math.MinInt16 ç©ºæŒ‡é’ˆå€¼ nilï¼Œè€ŒéC/C++ NULLã€‚\næ•´å‹ æ•´å‹åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªå¤§ç±»ï¼š æŒ‰é•¿åº¦åˆ†ä¸ºï¼šint8ã€int16ã€int32ã€int64å¯¹åº”çš„æ— ç¬¦å·æ•´å‹ï¼šuint8ã€uint16ã€uint32ã€uint64\nå…¶ä¸­ï¼Œuint8å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„byteå‹ï¼Œint16å¯¹åº”Cè¯­è¨€ä¸­çš„shortå‹ï¼Œint64å¯¹åº”Cè¯­è¨€ä¸­çš„longå‹ã€‚\næµ®ç‚¹å‹ Goè¯­è¨€æ”¯æŒä¸¤ç§æµ®ç‚¹å‹æ•°ï¼šfloat32å’Œfloat64ã€‚è¿™ä¸¤ç§æµ®ç‚¹å‹æ•°æ®æ ¼å¼éµå¾ªIEEE 754æ ‡å‡†ï¼š float32 çš„æµ®ç‚¹æ•°çš„æœ€å¤§èŒƒå›´çº¦ä¸º3.4e38ï¼Œå¯ä»¥ä½¿ç”¨å¸¸é‡å®šä¹‰ï¼šmath.MaxFloat32ã€‚ float64 çš„æµ®ç‚¹æ•°çš„æœ€å¤§èŒƒå›´çº¦ä¸º 1.8e308ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¸¸é‡å®šä¹‰ï¼šmath.MaxFloat64ã€‚\nå¤æ•° 1complex64`å’Œ`complex128 å¤æ•°æœ‰å®éƒ¨å’Œè™šéƒ¨ï¼Œcomplex64çš„å®éƒ¨å’Œè™šéƒ¨ä¸º32ä½ï¼Œcomplex128çš„å®éƒ¨å’Œè™šéƒ¨ä¸º64ä½ã€‚\nå¸ƒå°”å€¼ Goè¯­è¨€ä¸­ä»¥boolç±»å‹è¿›è¡Œå£°æ˜å¸ƒå°”å‹æ•°æ®ï¼Œå¸ƒå°”å‹æ•°æ®åªæœ‰trueï¼ˆçœŸï¼‰å’Œfalseï¼ˆå‡ï¼‰ä¸¤ä¸ªå€¼ã€‚\n1 æ³¨æ„ï¼š 2 3 å¸ƒå°”ç±»å‹å˜é‡çš„é»˜è®¤å€¼ä¸ºfalseã€‚ 4 5 Go è¯­è¨€ä¸­ä¸å…è®¸å°†æ•´å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¸ƒå°”å‹. 6 7 å¸ƒå°”å‹æ— æ³•å‚ä¸æ•°å€¼è¿ç®—ï¼Œä¹Ÿæ— æ³•ä¸å…¶ä»–ç±»å‹è¿›è¡Œè½¬æ¢ã€‚ å­—ç¬¦ä¸² Goè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ä»¥åŸç”Ÿæ•°æ®ç±»å‹å‡ºç°ï¼Œä½¿ç”¨å­—ç¬¦ä¸²å°±åƒä½¿ç”¨å…¶ä»–åŸç”Ÿæ•°æ®ç±»å‹ï¼ˆintã€boolã€float32ã€float64 ç­‰ï¼‰ä¸€æ ·ã€‚ Go è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²çš„å†…éƒ¨å®ç°ä½¿ç”¨UTF-8ç¼–ç ã€‚ å­—ç¬¦ä¸²çš„å€¼ä¸ºåŒå¼•å·(â€œ)ä¸­çš„å†…å®¹ï¼Œå¯ä»¥åœ¨Goè¯­è¨€çš„æºç ä¸­ç›´æ¥æ·»åŠ éASCIIç å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š\n1s1 := \u0026#34;hello\u0026#34; 2s2 := \u0026#34;ä½ å¥½\u0026#34; å­—ç¬¦ä¸²è½¬ä¹‰ç¬¦ Go è¯­è¨€çš„å­—ç¬¦ä¸²å¸¸è§è½¬ä¹‰ç¬¦åŒ…å«å›è½¦ã€æ¢è¡Œã€å•åŒå¼•å·ã€åˆ¶è¡¨ç¬¦ç­‰ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚\nè½¬ä¹‰ å«ä¹‰ \\r å›è½¦ç¬¦ï¼ˆè¿”å›è¡Œé¦–ï¼‰ \\n æ¢è¡Œç¬¦ï¼ˆç›´æ¥è·³åˆ°ä¸‹ä¸€è¡Œçš„åŒåˆ—ä½ç½®ï¼‰ \\t åˆ¶è¡¨ç¬¦ ' å•å¼•å· \u0026quot; åŒå¼•å· \\ åæ–œæ  ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦æ‰“å°ä¸€ä¸ªWindowså¹³å°ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼š\n1package main 2import ( 3 \u0026#34;fmt\u0026#34; 4) 5func main() { 6 fmt.Println(\u0026#34;str := \\\u0026#34;c:\\\\pprof\\\\main.exe\\\u0026#34;\u0026#34;) 7} å¤šè¡Œå­—ç¬¦ä¸² Goè¯­è¨€ä¸­è¦å®šä¹‰ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²æ—¶ï¼Œå°±å¿…é¡»ä½¿ç”¨åå¼•å·å­—ç¬¦ï¼š\n1 s1 := `ç¬¬ä¸€è¡Œ 2 ç¬¬äºŒè¡Œ 3 ç¬¬ä¸‰è¡Œ 4 ` 5 fmt.Println(s1) åå¼•å·é—´æ¢è¡Œå°†è¢«ä½œä¸ºå­—ç¬¦ä¸²ä¸­çš„æ¢è¡Œï¼Œä½†æ˜¯æ‰€æœ‰çš„è½¬ä¹‰å­—ç¬¦å‡æ— æ•ˆï¼Œæ–‡æœ¬å°†ä¼šåŸæ ·è¾“å‡ºã€‚\nå­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ æ–¹æ³• ä»‹ç» len(str) æ±‚é•¿åº¦ +æˆ–fmt.Sprintf æ‹¼æ¥å­—ç¬¦ä¸² strings.Split åˆ†å‰² strings.Contains åˆ¤æ–­æ˜¯å¦åŒ…å« strings.HasPrefix,strings.HasSuffix å‰ç¼€/åç¼€åˆ¤æ–­ strings.Index(),strings.LastIndex() å­ä¸²å‡ºç°çš„ä½ç½® strings.Join(a[]string, sep string) joinæ“ä½œ byteå’Œruneç±»å‹ ç»„æˆæ¯ä¸ªå­—ç¬¦ä¸²çš„å…ƒç´ å«åšâ€œå­—ç¬¦â€ï¼Œå¯ä»¥é€šè¿‡éå†æˆ–è€…å•ä¸ªè·å–å­—ç¬¦ä¸²å…ƒç´ è·å¾—å­—ç¬¦ã€‚ å­—ç¬¦ç”¨å•å¼•å·ï¼ˆâ€™ï¼‰åŒ…è£¹èµ·æ¥ï¼Œå¦‚ï¼š\n1 var a := \u0026#39;ä¸­\u0026#39; 2 3 var b := \u0026#39;x\u0026#39; Go è¯­è¨€çš„å­—ç¬¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š\n1 uint8ç±»å‹ï¼Œæˆ–è€…å« byte å‹ï¼Œä»£è¡¨äº†ASCIIç çš„ä¸€ä¸ªå­—ç¬¦ã€‚ 2 3 runeç±»å‹ï¼Œä»£è¡¨ä¸€ä¸ª UTF-8å­—ç¬¦ã€‚ å½“éœ€è¦å¤„ç†ä¸­æ–‡ã€æ—¥æ–‡æˆ–è€…å…¶ä»–å¤åˆå­—ç¬¦æ—¶ï¼Œåˆ™éœ€è¦ç”¨åˆ°runeç±»å‹ã€‚runeç±»å‹å®é™…æ˜¯ä¸€ä¸ªint32ã€‚ Go ä½¿ç”¨äº†ç‰¹æ®Šçš„ rune ç±»å‹æ¥å¤„ç† Unicodeï¼Œè®©åŸºäº Unicodeçš„æ–‡æœ¬å¤„ç†æ›´ä¸ºæ–¹ä¾¿ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ byte å‹è¿›è¡Œé»˜è®¤å­—ç¬¦ä¸²å¤„ç†ï¼Œæ€§èƒ½å’Œæ‰©å±•æ€§éƒ½æœ‰ç…§é¡¾\n1 // éå†å­—ç¬¦ä¸² 2 func traversalString() { 3 s := \u0026#34;pprof.cnåšå®¢\u0026#34; 4 for i := 0; i \u0026lt; len(s); i++ { //byte 5 fmt.Printf(\u0026#34;%v(%c) \u0026#34;, s[i], s[i]) 6 } 7 fmt.Println() 8 for _, r := range s { //rune 9 fmt.Printf(\u0026#34;%v(%c) \u0026#34;, r, r) 10 } 11 fmt.Println() 12 } è¾“å‡ºï¼š\n1 112(p) 112(p) 114(r) 111(o) 102(f) 46(.) 99(c) 110(n) 229(Ã¥) 141() 154() 229(Ã¥) 174(Â®) 162(Â¢) 2 112(p) 112(p) 114(r) 111(o) 102(f) 46(.) 99(c) 110(n) 21338(åš) 23458(å®¢) å› ä¸ºUTF8ç¼–ç ä¸‹ä¸€ä¸ªä¸­æ–‡æ±‰å­—ç”±3~4ä¸ªå­—èŠ‚ç»„æˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç®€å•çš„æŒ‰ç…§å­—èŠ‚å»éå†ä¸€ä¸ªåŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸Šé¢è¾“å‡ºä¸­ç¬¬ä¸€è¡Œçš„ç»“æœã€‚\nå­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªbyteæ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥å’Œ[]byteç±»å‹ç›¸äº’è½¬æ¢ã€‚å­—ç¬¦ä¸²æ˜¯ä¸èƒ½ä¿®æ”¹çš„ å­—ç¬¦ä¸²æ˜¯ç”±byteå­—èŠ‚ç»„æˆï¼Œæ‰€ä»¥å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯byteå­—èŠ‚çš„é•¿åº¦ã€‚ runeç±»å‹ç”¨æ¥è¡¨ç¤ºutf8å­—ç¬¦ï¼Œä¸€ä¸ªruneå­—ç¬¦ç”±ä¸€ä¸ªæˆ–å¤šä¸ªbyteç»„æˆã€‚\nä¿®æ”¹å­—ç¬¦ä¸² è¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œéœ€è¦å…ˆå°†å…¶è½¬æ¢æˆ[]runeæˆ–[]byteï¼Œå®Œæˆåå†è½¬æ¢ä¸ºstringã€‚æ— è®ºå“ªç§è½¬æ¢ï¼Œéƒ½ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼Œå¹¶å¤åˆ¶å­—èŠ‚æ•°ç»„ã€‚\n1 func changeString() { 2 s1 := \u0026#34;hello\u0026#34; 3 // å¼ºåˆ¶ç±»å‹è½¬æ¢ 4 byteS1 := []byte(s1) 5 byteS1[0] = \u0026#39;H\u0026#39; 6 fmt.Println(string(byteS1)) 7 8 s2 := \u0026#34;åšå®¢\u0026#34; 9 runeS2 := []rune(s2) 10 runeS2[0] = \u0026#39;ç‹—\u0026#39; 11 fmt.Println(string(runeS2)) 12 } ç±»å‹è½¬æ¢ Goè¯­è¨€ä¸­åªæœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ²¡æœ‰éšå¼ç±»å‹è½¬æ¢ã€‚è¯¥è¯­æ³•åªèƒ½åœ¨ä¸¤ä¸ªç±»å‹ä¹‹é—´æ”¯æŒç›¸äº’è½¬æ¢çš„æ—¶å€™ä½¿ç”¨ã€‚\nå¼ºåˆ¶ç±»å‹è½¬æ¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\n1 T(è¡¨è¾¾å¼) å…¶ä¸­ï¼ŒTè¡¨ç¤ºè¦è½¬æ¢çš„ç±»å‹ã€‚è¡¨è¾¾å¼åŒ…æ‹¬å˜é‡ã€å¤æ‚ç®—å­å’Œå‡½æ•°è¿”å›å€¼ç­‰.\næ¯”å¦‚è®¡ç®—ç›´è§’ä¸‰è§’å½¢çš„æ–œè¾¹é•¿æ—¶ä½¿ç”¨mathåŒ…çš„Sqrt()å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶çš„æ˜¯float64ç±»å‹çš„å‚æ•°ï¼Œè€Œå˜é‡aå’Œbéƒ½æ˜¯intç±»å‹çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å°†aå’Œbå¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºfloat64ç±»å‹ã€‚\n1 func sqrtDemo() { 2 var a, b = 3, 4 3 var c int 4 // math.Sqrt()æ¥æ”¶çš„å‚æ•°æ˜¯float64ç±»å‹ï¼Œéœ€è¦å¼ºåˆ¶è½¬æ¢ 5 c = int(math.Sqrt(float64(a*a + b*b))) 6 fmt.Println(c) 7 } å†…ç½®æ¥å£error 1type error interface { //åªè¦å®ç°äº†Error()å‡½æ•°,è¿”å›å€¼ä¸ºStringçš„éƒ½å®ç°äº†erræ¥å£ 2 3 Error() String 4 5 } Initå‡½æ•°å’Œmainå‡½æ•° initå‡½æ•° goè¯­è¨€ä¸­initå‡½æ•°ç”¨äºåŒ…(package)çš„åˆå§‹åŒ–,è¯¥å‡½æ•°æ˜¯goè¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§.æœ‰ä¸‹é¢çš„ç‰¹å¾: 11. initå‡½æ•°æ˜¯ç”¨äºç¨‹åºæ‰§è¡Œå‰åšåŒ…çš„åˆå§‹åŒ–çš„å‡½æ•°,æ¯”å¦‚åˆå§‹åŒ–åŒ…é‡Œçš„å˜é‡ç­‰ 2 32 æ¯ä¸ªåŒ…å¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•° 4 53 åŒ…çš„æ¯ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•° 6 74 åŒä¸€ä¸ªåŒ…ä¸­å¤šä¸ªinitå‡½æ•°çš„æ‰§è¡Œé¡ºåºgoè¯­è¨€æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰(è¯´æ˜) 8 95 ä¸åŒåŒ…çš„initå‡½æ•°æŒ‰ç…§åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šè¯¥åˆå§‹åŒ–å‡½æ•°çš„æ‰§è¡Œé¡ºåº 10 116 initå‡½æ•°ä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨,è€Œæ˜¯åœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰,è‡ªåŠ¨è¢«è°ƒç”¨ mainå‡½æ•° 1Goè¯­è¨€ç¨‹åºçš„é»˜è®¤å…¥å£å‡½æ•°(ä¸»å‡½æ•°):func main() 2å‡½æ•°ä½“ç”¨{}ä¸€å¯¹æ‹¬å·åŒ…è£¹. 3 4func main(){ 5//å‡½æ•°ä½“ 6} mainå‡½æ•°initå‡½æ•°çš„åŒºåˆ« 1ç›¸åŒç‚¹: 2 ä¸¤ä¸ªå‡½æ•°åœ¨å®šä¹‰æ—¶ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°å’Œè¿”å›å€¼,ä¸”Goç¨‹åºè‡ªåŠ¨è°ƒç”¨. 3 ä¸åŒç‚¹: 4 initå¯ä»¥åº”ç”¨äºä»»æ„åŒ…ä¸­,ä¸”å¯ä»¥é‡å¤å®šä¹‰å¤šä¸ª. 5 mainå‡½æ•°åªèƒ½ç”¨äºmainåŒ…ä¸­,ä¸”åªèƒ½å®šä¹‰ä¸€ä¸ª. 6 7ä¸¤ä¸ªå‡½æ•°çš„æ‰§è¡Œé¡ºåº: 8 9å¯¹åŒä¸€ä¸ªgoæ–‡ä»¶çš„init()è°ƒç”¨é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹çš„. 10 11å¯¹åŒä¸€ä¸ªpackageä¸­ä¸åŒæ–‡ä»¶æ˜¯æŒ‰æ–‡ä»¶åå­—ç¬¦ä¸²æ¯”è¾ƒ\u0026#34;ä»å°åˆ°å¤§\u0026#34;é¡ºåºè°ƒç”¨å„æ–‡ä»¶ä¸­çš„init()å‡½æ•°. 12 13å¯¹äºä¸åŒçš„package,å¦‚æœä¸ç›¸äº’ä¾èµ–çš„è¯,æŒ‰ç…§mainåŒ…ä¸­\u0026#34;å…ˆimportçš„åè°ƒç”¨\u0026#34;çš„é¡ºåºè°ƒç”¨å…¶åŒ…ä¸­çš„init(),å¦‚æœpackageå­˜åœ¨ä¾èµ–,åˆ™å…ˆè°ƒç”¨æœ€æ—©è¢«ä¾èµ–çš„packageä¸­çš„init(),æœ€åè°ƒç”¨mainå‡½æ•°. 14 15å¦‚æœinitå‡½æ•°ä¸­ä½¿ç”¨äº†println()æˆ–è€…print()ä½ ä¼šå‘ç°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿™ä¸¤ä¸ªä¸ä¼šæŒ‰ç…§ä½ æƒ³è±¡ä¸­çš„é¡ºåºæ‰§è¡Œ.è¿™ä¸¤ä¸ªå‡½æ•°å®˜æ–¹åªæ¨èåœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨,å¯¹äºæ­£å¼ç¯å¢ƒä¸è¦ä½¿ç”¨. const åœ¨å‡½æ•°å¤–å’Œå‡½æ•°å†…åŒæ—¶å®šä¹‰åŒä¸€ä¸ªåå­—ï¼Œä¼šæ€æ ·ï¼Ÿ åœ¨ Go è¯­è¨€ä¸­ï¼Œconstï¼ˆå¸¸é‡ï¼‰ æ˜¯ç¼–è¯‘æœŸç¡®å®šçš„å€¼ï¼Œå…¶ä½œç”¨åŸŸéµå¾ªä¸å˜é‡ç›¸åŒçš„è§„åˆ™ã€‚ä½ æå‡ºçš„é—®é¢˜ï¼š\nâ€œconst åœ¨å‡½æ•°å¤–å’Œå‡½æ•°å†…åŒæ—¶å®šä¹‰åŒä¸€ä¸ªåå­—ï¼Œä¼šæ€æ ·ï¼Ÿâ€\nç­”æ¡ˆæ˜¯ï¼šâœ… è¿™æ˜¯å®Œå…¨å…è®¸çš„ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šå†²çªã€‚\nè¿™æ˜¯å› ä¸º Go æ”¯æŒ ä½œç”¨åŸŸåµŒå¥—ï¼ˆscope shadowingï¼‰ï¼Œå‡½æ•°å†…çš„å¸¸é‡ä¼šâ€œé®è”½â€ï¼ˆshadowï¼‰å‡½æ•°å¤–çš„åŒåå¸¸é‡ã€‚\nâœ… ç¤ºä¾‹æ¼”ç¤º 1package main 2 3import \u0026#34;fmt\u0026#34; 4 5const Name = \u0026#34;Global\u0026#34; // åŒ…çº§å¸¸é‡ï¼ˆå‡½æ•°å¤–ï¼‰ 6 7func main() { 8 const Name = \u0026#34;Local\u0026#34; // å‡½æ•°å†…å¸¸é‡ï¼ˆåŒåï¼‰ 9 10 fmt.Println(Name) // è¾“å‡º: Local 11} è¾“å‡ºï¼š 1Local è§£é‡Šï¼š åœ¨ main å‡½æ•°å†…éƒ¨ï¼ŒName æŒ‡çš„æ˜¯å‡½æ•°å†…å®šä¹‰çš„ \u0026quot;Local\u0026quot;ã€‚ å¤–å±‚çš„ Name = \u0026quot;Global\u0026quot; ä»ç„¶å­˜åœ¨ï¼Œä½†åœ¨å‡½æ•°å†…éƒ¨ä¸å¯è§ï¼ˆè¢«é®è”½äº†ï¼‰ã€‚ è¿™ç§ç°è±¡ç§°ä¸º å˜é‡/å¸¸é‡é®è”½ï¼ˆvariable/constant shadowingï¼‰ã€‚ âœ… æ›´å¤æ‚çš„ä¾‹å­ï¼šå¤šå±‚ä½œç”¨åŸŸ 1package main 2 3import \u0026#34;fmt\u0026#34; 4 5const Value = 100 6 7func main() { 8 const Value = 200 9 10 { 11 const Value = 300 12 fmt.Println(\u0026#34;Inner block:\u0026#34;, Value) // 300 13 } 14 15 fmt.Println(\u0026#34;Function scope:\u0026#34;, Value) // 200 16 fmt.Println(\u0026#34;Package scope:\u0026#34;, Value) // 200ï¼ˆæ³¨æ„ï¼šè¿™é‡Œè®¿é—®çš„æ˜¯å‡½æ•°å†…çš„ Valueï¼‰ 17} â— æ³¨æ„ï¼šåœ¨ main å‡½æ•°å†…ï¼Œå¤–å±‚çš„åŒ…çº§ Value å·²ç»è¢«é®è”½ï¼Œæ— æ³•ç›´æ¥è®¿é—®ã€‚\nâœ… å¦‚ä½•è®¿é—®è¢«é®è”½çš„å¤–å±‚å¸¸é‡ï¼Ÿ Go æ²¡æœ‰åƒ this æˆ– super è¿™æ ·çš„å…³é”®å­—æ¥è®¿é—®å¤–å±‚ä½œç”¨åŸŸã€‚ä¸€æ—¦è¢«é®è”½ï¼Œåœ¨å½“å‰ä½œç”¨åŸŸå†…æ— æ³•ç›´æ¥è®¿é—®å¤–å±‚åŒåæ ‡è¯†ç¬¦ã€‚\nè§£å†³æ–¹æ¡ˆï¼šé¿å…é®è”½ï¼Œæˆ–æ”¹å 1package main 2 3import \u0026#34;fmt\u0026#34; 4 5const AppName = \u0026#34;MyApp\u0026#34; // æ›´å…·ä½“çš„å‘½å 6 7func main() { 8 const Name = \u0026#34;User\u0026#34; // ä¸åŒåï¼Œé¿å…å†²çª 9 10 fmt.Println(AppName) // å¯ä»¥è®¿é—® 11 fmt.Println(Name) // å¯ä»¥è®¿é—® 12} ğŸ” ä¸ºä»€ä¹ˆ Go å…è®¸å¸¸é‡é®è”½ï¼Ÿ ä½œç”¨åŸŸéš”ç¦»ï¼š\nå‡½æ•°å†…éƒ¨çš„é€»è¾‘å¯èƒ½éœ€è¦ä¸€ä¸ªä¸´æ—¶çš„ã€åŒåçš„å¸¸é‡ï¼Œä¸åº”å—å¤–å±‚å½±å“ã€‚ ä¾‹å¦‚ï¼šæµ‹è¯•ä¸­æ¨¡æ‹Ÿä¸åŒé…ç½®ã€‚ çµæ´»æ€§ï¼š\nå¼€å‘è€…å¯ä»¥è‡ªç”±å‘½åå±€éƒ¨å¸¸é‡ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¸åŒ…çº§å¸¸é‡å†²çªã€‚ ç¼–è¯‘æœŸæ£€æŸ¥ï¼š\næ‰€æœ‰ const éƒ½åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œä¸ä¼šå¯¼è‡´è¿è¡Œæ—¶æ€§èƒ½é—®é¢˜ã€‚ âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ é—®é¢˜ å»ºè®® é®è”½å¯¼è‡´æ··æ·† é¿å…ä¸å¿…è¦çš„åŒåé®è”½ï¼Œå°¤å…¶æ˜¯å¤§é¡¹ç›®ä¸­ã€‚ è°ƒè¯•å›°éš¾ å¦‚æœä¸å°å¿ƒé®è”½äº†å…³é”®å¸¸é‡ï¼Œå¯èƒ½éš¾ä»¥å‘ç°ã€‚ ä»£ç å¯è¯»æ€§ å»ºè®®ä½¿ç”¨æ›´å…·æè¿°æ€§çš„åå­—ï¼Œå¦‚ DefaultTimeoutã€MaxRetriesã€‚ å·¥å…·æ”¯æŒ IDE é€šå¸¸ä¼šé«˜äº®é®è”½çš„å˜é‡/å¸¸é‡ï¼Œå¸®åŠ©è¯†åˆ«ã€‚ âœ… æ€»ç»“ æƒ…å†µ ç»“æœ const åœ¨å‡½æ•°å¤–å’Œå‡½æ•°å†…åŒå âœ… å…è®¸ å‡½æ•°å†…è®¿é—®è¯¥åå­— âœ… è®¿é—®çš„æ˜¯å‡½æ•°å†…çš„å¸¸é‡ï¼ˆé®è”½å¤–å±‚ï¼‰ èƒ½å¦åŒæ—¶å­˜åœ¨ âœ… å¯ä»¥ï¼Œä¸åŒä½œç”¨åŸŸ æ˜¯å¦æŠ¥é”™ âŒ ä¸ä¼šç¼–è¯‘é”™è¯¯ æ˜¯å¦æ¨è âš ï¸ æŠ€æœ¯ä¸Šå…è®¸ï¼Œä½†ä¸æ¨èï¼Œæ˜“é€ æˆæ··æ·† âœ… æœ€ä½³å®è·µå»ºè®®ï¼š é¿å…é®è”½ï¼šå°½é‡ä¸è¦åœ¨å‡½æ•°å†…å®šä¹‰ä¸åŒ…çº§å¸¸é‡åŒåçš„ constã€‚ å‘½åæ¸…æ™°ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åå­—ï¼Œå¦‚ GlobalConfig, DefaultPortã€‚ ä½¿ç”¨å·¥å…·ï¼šå¯ç”¨ golint æˆ– staticcheckï¼Œå®ƒä»¬å¯ä»¥è­¦å‘Šé®è”½é—®é¢˜ã€‚ è™½ç„¶ Go å…è®¸ä½ è¿™ä¹ˆåšï¼Œä½†ä¸ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸è¦æ»¥ç”¨é®è”½ã€‚\næ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç° æ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°\nnew å’Œ make çš„è¯¦ç»†å¯¹æ¯”åˆ†æ åœ¨ Go è¯­è¨€ä¸­ï¼Œnew å’Œ make éƒ½æ˜¯å†…ç½®å‡½æ•°ï¼Œç”¨äºå†…å­˜åˆ†é…ï¼Œä½†å®ƒä»¬çš„ç”¨é€”ã€è¿”å›å€¼å’Œé€‚ç”¨ç±»å‹å®Œå…¨ä¸åŒã€‚è¿™æ˜¯ Go åˆå­¦è€…æœ€å®¹æ˜“æ··æ·†çš„æ¦‚å¿µä¹‹ä¸€ã€‚\nä¸‹é¢æ˜¯å¯¹ new å’Œ make çš„è¯¦ç»†å¯¹æ¯”åˆ†æï¼Œå¸®åŠ©ä½ å½»åº•ç†è§£å®ƒä»¬çš„åŒºåˆ«ã€‚\nä¸€ã€æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ ç‰¹æ€§ new(T) make(T, args...) ç”¨é€” åˆ†é…é›¶å€¼å†…å­˜ï¼Œè¿”å›æŒ‡å‘è¯¥å†…å­˜çš„æŒ‡é’ˆ åˆå§‹åŒ– sliceã€mapã€channelï¼Œä½¿å…¶å¯ç”¨ è¿”å›ç±»å‹ *Tï¼ˆæŒ‡å‘ T çš„æŒ‡é’ˆï¼‰ Tï¼ˆç±»å‹æœ¬èº«ï¼Œä¸æ˜¯æŒ‡é’ˆï¼‰ é€‚ç”¨ç±»å‹ ä»»æ„ç±»å‹ï¼ˆå¦‚ int, struct, *T ç­‰ï¼‰ ä»…é™ä¸‰ç§å†…ç½®å¼•ç”¨ç±»å‹ï¼šsliceã€mapã€channel æ˜¯å¦åˆå§‹åŒ– åªåˆ†é…å†…å­˜å¹¶ç½®ä¸ºé›¶å€¼ åˆ†é…å†…å­˜å¹¶å®Œæˆç±»å‹ç‰¹å®šçš„åˆå§‹åŒ–ï¼ˆå¦‚åˆ›å»ºåº•å±‚æ•°ç»„ã€å“ˆå¸Œè¡¨ç­‰ï¼‰ èƒ½å¦ç›´æ¥ä½¿ç”¨ æ˜¯ï¼ˆä½†å†…å®¹ä¸ºé›¶å€¼ï¼‰ æ˜¯ï¼ˆå¯ä»¥ç›´æ¥ appendã€rangeã€send ç­‰ï¼‰ äºŒã€new(T) è¯¦è§£ 1. åŠŸèƒ½ ä¸ºç±»å‹ T åˆ†é…ä¸€å—å†…å­˜ã€‚ å°†è¿™å—å†…å­˜åˆå§‹åŒ–ä¸º é›¶å€¼ï¼ˆzero valueï¼‰ã€‚ è¿”å›ä¸€ä¸ªæŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆï¼š*Tã€‚ 2. è¯­æ³• 1ptr := new(T) 3. ç¤ºä¾‹ 1// åˆ†é…ä¸€ä¸ª intï¼Œåˆå§‹å€¼ä¸º 0 2p := new(int) 3fmt.Println(*p) // è¾“å‡º: 0 4*p = 42 5fmt.Println(*p) // è¾“å‡º: 42 6 7// åˆ†é…ä¸€ä¸ªç»“æ„ä½“ 8type Person struct { 9 Name string 10 Age int 11} 12pp := new(Person) 13pp.Name = \u0026#34;Alice\u0026#34; 14pp.Age = 30 15// ç­‰ä»·äº \u0026amp;Person{} 4. æ³¨æ„äº‹é¡¹ new è¿”å›çš„æ˜¯æŒ‡é’ˆã€‚ å¯¹äºå¤åˆç±»å‹ï¼ˆå¦‚ structï¼‰ï¼Œnew(T) ç­‰ä»·äº \u0026amp;T{}ã€‚ new ä¸èƒ½ç”¨äº sliceã€mapã€channel â€”â€” è™½ç„¶è¯­æ³•ä¸Šå¯ä»¥ new([]int)ï¼Œä½†è¿”å›çš„æ˜¯ *[]intï¼Œä½¿ç”¨èµ·æ¥éå¸¸ä¸ä¾¿ï¼Œä¸”ä¸æ¨èã€‚ ä¸‰ã€make(T, args...) è¯¦è§£ 1. åŠŸèƒ½ åˆå§‹åŒ–ä¸‰ç§å¼•ç”¨ç±»å‹ï¼šsliceã€mapã€channelã€‚ ä¸ºå®ƒä»¬åˆ†é…å¿…è¦çš„å†…éƒ¨ç»“æ„ï¼ˆå¦‚åº•å±‚æ•°ç»„ã€å“ˆå¸Œè¡¨ã€ç¼“å†²åŒºç­‰ï¼‰ã€‚ è¿”å›ç±»å‹æœ¬èº«ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ 2. è¯­æ³•ä¸ç¤ºä¾‹ âœ… åˆ›å»º slice 1s1 := make([]int, 5) // é•¿åº¦=5ï¼Œå®¹é‡=5ï¼Œå…ƒç´ å…¨ä¸º0 2s2 := make([]int, 3, 10) // é•¿åº¦=3ï¼Œå®¹é‡=10 3 4fmt.Println(len(s1), cap(s1)) // 5 5 5fmt.Println(len(s2), cap(s2)) // 3 10 âœ… åˆ›å»º map 1m := make(map[string]int, 10) // é¢„åˆ†é…10ä¸ªæ¡¶çš„ç©ºé—´ 2m[\u0026#34;one\u0026#34;] = 1 3m[\u0026#34;two\u0026#34;] = 2 âœ… åˆ›å»º channel 1ch1 := make(chan int) // æ— ç¼“å†² channel 2ch2 := make(chan string, 5) // æœ‰ç¼“å†² channelï¼Œç¼“å†²åŒºå¤§å°=5 3. æ³¨æ„äº‹é¡¹ make åªèƒ½ç”¨äº sliceã€mapã€channelã€‚ make è¿”å›çš„æ˜¯ç±»å‹æœ¬èº«ï¼Œä¸æ˜¯æŒ‡é’ˆã€‚ å¦‚æœä¸ä½¿ç”¨ make ç›´æ¥ä½¿ç”¨è¿™äº›ç±»å‹ï¼Œä¼šå¯¼è‡´ panicï¼š 1var m map[string]int 2m[\u0026#34;key\u0026#34;] = \u0026#34;value\u0026#34; // panic: assignment to entry in nil map å››ã€ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ new æ›¿ä»£ makeï¼Ÿ âŒ é”™è¯¯ç¤ºä¾‹ï¼šç”¨ new åˆ›å»º map 1m := new(map[string]int) // m æ˜¯ *map[string]int 2*m = make(map[string]int) // å¿…é¡»å†ç”¨ make åˆå§‹åŒ– 3(*m)[\u0026#34;key\u0026#34;] = \u0026#34;value\u0026#34; // ä½¿ç”¨éº»çƒ¦ è¿™ç­‰ä»·äºï¼š\n1var m map[string]int 2m = make(map[string]int) 3m[\u0026#34;key\u0026#34;] = \u0026#34;value\u0026#34; æ˜¾ç„¶ï¼Œç›´æ¥ç”¨ make æ›´ç®€æ´ã€‚\nâŒ new(slice) çš„é—®é¢˜ 1s := new([]int) // s æ˜¯ *[]int 2*s = append(*s, 1, 2, 3) 3fmt.Println(*s) // [1 2 3] è™½ç„¶å¯è¡Œï¼Œä½†è¿œä¸å¦‚ï¼š\n1s := make([]int, 0, 10) 2s = append(s, 1, 2, 3) äº”ã€å½¢è±¡æ¯”å–» å‡½æ•° æ¯”å–» new(T) ç»™ä½ ä¸€æŠŠç©ºé’¥åŒ™ï¼ˆæŒ‡é’ˆï¼‰ï¼ŒæŒ‡å‘ä¸€ä¸ªåˆšå»ºå¥½çš„ç©ºæˆ¿å­ï¼ˆé›¶å€¼å†…å­˜ï¼‰ã€‚ä½ å¯ä»¥å¾€é‡Œæ”¾ä¸œè¥¿ã€‚ make(T) ä¸ä»…ç»™ä½ æˆ¿å­ï¼Œè¿˜å¸®ä½ è£…ä¿®å¥½ã€é€šæ°´ç”µã€ä¹°å®¶å…·ï¼Œè®©ä½ å¯ä»¥ç›´æ¥å…¥ä½ã€‚åªé€‚ç”¨äºç‰¹å®šæˆ¿å‹ï¼ˆslice/map/channelï¼‰ã€‚ å…­ã€æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ åœºæ™¯ ä½¿ç”¨ æƒ³è¦ä¸€ä¸ªæŒ‡å‘ä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œä¸”å†…å®¹ä¸ºé›¶å€¼ âœ… new(T) åˆå§‹åŒ– slice å¹¶è®¾ç½®é•¿åº¦/å®¹é‡ âœ… make([]T, len, cap) åˆå§‹åŒ– map å¹¶é¢„åˆ†é…ç©ºé—´ âœ… make(map[K]V, hint) åˆ›å»º channelï¼ˆæ— è®ºæœ‰æ— ç¼“å†²ï¼‰ âœ… make(chan T, buf) åˆ›å»ºç»“æ„ä½“å®ä¾‹ âœ… æ¨è \u0026amp;Struct{} æˆ– new(Struct) âœ… æœ€ç»ˆç»“è®º newï¼šé€šç”¨å†…å­˜åˆ†é…å™¨ï¼Œè¿”å› *Tï¼Œé€‚ç”¨äºæ‰€æœ‰ç±»å‹ï¼Œä½†å¯¹ slice/map/channel ä¸å®ç”¨ã€‚ makeï¼šä¸“ç”¨åˆå§‹åŒ–å·¥å…·ï¼Œä»…ç”¨äº sliceã€mapã€channelï¼Œè¿”å›å¯ç”¨çš„å€¼ã€‚ ğŸ“Œ è®°ä½ä¸€å¥è¯ï¼š\nmake ç”¨äºåˆ›å»ºâ€œå¯ä½¿ç”¨çš„â€ sliceã€mapã€channelï¼›\nnew ç”¨äºåˆ›å»ºâ€œé›¶å€¼æŒ‡é’ˆâ€æŒ‡å‘ä»»ä½•ç±»å‹ã€‚\nä¸¤è€…ä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯å„å¸å…¶èŒã€‚\nğŸ“Œ Go åˆ‡ç‰‡ append å®Œå…¨æ€»ç»“ 1. åŸºæœ¬è¯­æ³• 1slice = append(slice, element) // è¿½åŠ ä¸€ä¸ªå…ƒç´  2slice = append(slice, elem1, elem2) // è¿½åŠ å¤šä¸ªå…ƒç´  3slice = append(slice, anotherSlice...) // è¿½åŠ å¦ä¸€ä¸ªåˆ‡ç‰‡ï¼ˆéœ€å±•å¼€ï¼‰ âœ… å¿…é¡»æ¥æ”¶è¿”å›å€¼å¹¶é‡æ–°èµ‹å€¼ï¼\nappend ä¸ä¼šä¿®æ”¹åŸåˆ‡ç‰‡å˜é‡æœ¬èº«ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°åˆ‡ç‰‡å€¼ã€‚\n2. append çš„æ ¸å¿ƒè¡Œä¸º æ¡ä»¶ è¡Œä¸º å®¹é‡è¶³å¤Ÿï¼ˆlen \u0026lt; capï¼‰ - åœ¨åŸåº•å±‚æ•°ç»„æœ«å°¾å†™å…¥\n- è¿”å›æ–°åˆ‡ç‰‡ï¼ˆlen+1ï¼Œcap ä¸å˜ï¼‰\n- ä¸åŸåˆ‡ç‰‡å…±äº«åº•å±‚æ•°ç»„ å®¹é‡ä¸è¶³ï¼ˆlen == capï¼‰ - åˆ†é…æ›´å¤§çš„æ–°åº•å±‚æ•°ç»„ï¼ˆé€šå¸¸ 2 å€æ‰©å®¹ï¼‰\n- æ‹·è´åŸæ•°æ® + æ–°å…ƒç´ \n- è¿”å›æŒ‡å‘æ–°æ•°ç»„çš„åˆ‡ç‰‡\n- ä¸åŸåˆ‡ç‰‡å®Œå…¨ç‹¬ç«‹ 3. å…³é”®ç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ æ€»æ˜¯è¿”å›æ–°åˆ‡ç‰‡å€¼ å³ä½¿åº•å±‚æœªæ‰©å®¹ï¼Œlen å·²å˜ï¼Œé€»è¾‘ä¸Šæ˜¯æ–°åˆ‡ç‰‡ é›¶åˆ†é…ä¼˜åŒ– å¦‚æœå®¹é‡è¶³å¤Ÿï¼Œappend æ˜¯é›¶å†…å­˜åˆ†é…ï¼ˆé«˜æ•ˆï¼‰ æ‰©å®¹ç­–ç•¥ Go 1.18+ï¼šå°åˆ‡ç‰‡æŒ‰ 2 å€å¢é•¿ï¼Œå¤§åˆ‡ç‰‡æŒ‰ 1.25 å€ï¼ˆå…·ä½“ç‰ˆæœ¬å¯èƒ½å¾®è°ƒï¼‰ ä¸èƒ½è¶Šç•Œèµ‹å€¼ä»£æ›¿ append s[2] = x åœ¨ len â‰¤ 2 æ—¶ä¼š panic 4. å¸¸è§é”™è¯¯ \u0026amp; è¯¯åŒº âŒ é”™è¯¯ 1ï¼šå¿½ç•¥è¿”å›å€¼ 1append(mySlice, \u0026#34;new\u0026#34;) // æ— æ•ˆï¼mySlice æœªæ”¹å˜ âœ… æ­£ç¡®ï¼š\n1mySlice = append(mySlice, \u0026#34;new\u0026#34;) âŒ é”™è¯¯ 2ï¼šå‡½æ•°å†… append ä¸å½±å“è°ƒç”¨è€… 1func add(s []int) { 2 s = append(s, 100) // åªä¿®æ”¹å±€éƒ¨å‰¯æœ¬ 3} âœ… æ­£ç¡®åšæ³•ï¼š\n1func add(s []int) []int { 2 return append(s, 100) 3} 4// è°ƒç”¨ï¼šslice = add(slice) âŒ é”™è¯¯ 3ï¼šç›´æ¥ç”¨ç´¢å¼•â€œæ–°å¢â€å…ƒç´  1s := []int{1, 2} 2s[2] = 3 // panic: index out of range âœ… æ­£ç¡®ï¼š\n1s = append(s, 3) âŒ é”™è¯¯ 4ï¼šè¿½åŠ åˆ‡ç‰‡å¿˜è®° ... 1s1 := []int{1, 2} 2s2 := []int{3, 4} 3s1 = append(s1, s2) // âŒ ç¼–è¯‘é”™è¯¯ï¼šcannot use s2 (type []int) as type int âœ… æ­£ç¡®ï¼š\n1s1 = append(s1, s2...) // âœ… å±•å¼€ 5. æ€§èƒ½å»ºè®® åœºæ™¯ å»ºè®® çŸ¥é“æœ€ç»ˆå¤§å° é¢„åˆ†é…å®¹é‡ï¼šmake([]T, 0, N)ï¼Œé¿å…å¤šæ¬¡æ‰©å®¹ é¢‘ç¹ append é¢„ä¼°å®¹é‡ï¼Œå‡å°‘å†…å­˜åˆ†é… å¤§å¯¹è±¡åˆ‡ç‰‡ æ³¨æ„æ‰©å®¹æ—¶çš„æ‹·è´å¼€é”€ï¼ˆæŒ‡é’ˆåˆ‡ç‰‡æ›´é«˜æ•ˆï¼‰ 1// æ¨èï¼šé¢„åˆ†é… 2items := make([]string, 0, 1000) 3for i := 0; i \u0026lt; 1000; i++ { 4 items = append(items, fmt.Sprintf(\u0026#34;item-%d\u0026#34;, i)) 5} 6. append ä¸ nil åˆ‡ç‰‡ âœ… append å¯ä»¥å®‰å…¨ç”¨äº nil åˆ‡ç‰‡ï¼š\n1var s []int // nil slice, len=0, cap=0 2s = append(s, 1) // è‡ªåŠ¨åˆ†é…åº•å±‚æ•°ç»„ 3fmt.Println(s) // [1] ğŸ’¡ nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ï¼ˆ[]int{}ï¼‰åœ¨ append è¡Œä¸ºä¸Šä¸€è‡´ã€‚\n7. ä¸€å¥è¯å£è¯€ â€œappend å¿…èµ‹å€¼ï¼Œæ‰©å®¹çœ‹å®¹é‡ï¼Œå…±äº«æˆ–ç‹¬ç«‹ï¼Œè¿”å›æ˜¯æ–°ç‰‡ã€‚â€\n8. é€ŸæŸ¥è¡¨ æ“ä½œ æ˜¯å¦ä¿®æ”¹åŸå˜é‡ æ˜¯å¦å…±äº«åº•å±‚æ•°ç»„ æ˜¯å¦å®‰å…¨ s = append(s, x) âœ… æ˜¯ï¼ˆé€šè¿‡èµ‹å€¼ï¼‰ å¯èƒ½ï¼ˆçœ‹æ˜¯å¦æ‰©å®¹ï¼‰ âœ… å®‰å…¨ append(s, x)ï¼ˆå¿½ç•¥è¿”å›ï¼‰ âŒ å¦ â€” âŒ æ— æ•ˆ s[i] = xï¼ˆi \u0026lt; lenï¼‰ âœ… æ˜¯ âœ… æ˜¯ âœ… å®‰å…¨ s[i] = xï¼ˆi â‰¥ lenï¼‰ âŒ â€” â€” âŒ panic âœ… æ€»ç»“ append æ˜¯ Go ä¸­å”¯ä¸€å®‰å…¨ã€æ ‡å‡†çš„åˆ‡ç‰‡å¢é•¿æ–¹å¼ã€‚ æ°¸è¿œä¸è¦å¿½ç•¥å®ƒçš„è¿”å›å€¼ã€‚ ç†è§£ â€œåˆ‡ç‰‡æ˜¯å€¼ï¼Œåº•å±‚æ•°ç»„æ˜¯æŒ‡é’ˆâ€ æ˜¯æŒæ¡ append çš„å…³é”®ã€‚ åœ¨å¹¶å‘æˆ–å‡½æ•°ä¼ å‚æ—¶ï¼Œç‰¹åˆ«æ³¨æ„ append çš„å±€éƒ¨æ€§ã€‚ Go è¯­è¨€ä¸­çš„ switch è¯­å¥æ˜¯ä¸€ç§å¼ºå¤§ã€çµæ´»ä¸”å®‰å…¨çš„æ§åˆ¶ç»“æ„ï¼Œç›¸æ¯” C/C++/Java ç­‰è¯­è¨€ï¼Œå®ƒåšäº†å¤šé¡¹æ”¹è¿›ï¼Œé»˜è®¤ä¸ä¼š fallthroughï¼ˆç©¿é€ï¼‰ï¼Œè¯­æ³•æ›´ç®€æ´ï¼Œå¹¶æ”¯æŒå¤šç§åŒ¹é…æ¨¡å¼ã€‚ ä¸€ã€åŸºæœ¬è¯­æ³• 1. è¡¨è¾¾å¼ switchï¼ˆæœ€å¸¸ç”¨ï¼‰ 1switch expression { 2case value1: 3 // æ‰§è¡Œè¯­å¥ 4case value2, value3: // å¤šä¸ªå€¼ç”¨é€—å·åˆ†éš” 5 // æ‰§è¡Œè¯­å¥ 6default: 7 // å¯é€‰ï¼Œé»˜è®¤åˆ†æ”¯ 8} âœ… ç‰¹ç‚¹ï¼š\nè‡ªåŠ¨ breakï¼Œä¸ä¼š fallthrough expression å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ˆintã€stringã€struct ç­‰ï¼‰ case å€¼å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„å¸¸é‡æˆ–å­—é¢é‡ ç¤ºä¾‹ï¼š 1day := \u0026#34;Mon\u0026#34; 2switch day { 3case \u0026#34;Mon\u0026#34;, \u0026#34;Tue\u0026#34;, \u0026#34;Wed\u0026#34;, \u0026#34;Thu\u0026#34;, \u0026#34;Fri\u0026#34;: 4 fmt.Println(\u0026#34;å·¥ä½œæ—¥\u0026#34;) 5case \u0026#34;Sat\u0026#34;, \u0026#34;Sun\u0026#34;: 6 fmt.Println(\u0026#34;å‘¨æœ«\u0026#34;) 7default: 8 fmt.Println(\u0026#34;æ— æ•ˆæ—¥æœŸ\u0026#34;) 9} äºŒã€æ— è¡¨è¾¾å¼ switchï¼ˆç±»ä¼¼ if-else é“¾ï¼‰ å½“ switch åä¸å†™è¡¨è¾¾å¼æ—¶ï¼Œç›¸å½“äº switch trueï¼Œç”¨äºæ›¿ä»£å¤æ‚çš„ if-elseï¼š\n1score := 85 2switch { 3case score \u0026gt;= 90: 4 fmt.Println(\u0026#34;A\u0026#34;) 5case score \u0026gt;= 80: 6 fmt.Println(\u0026#34;B\u0026#34;) 7case score \u0026gt;= 70: 8 fmt.Println(\u0026#34;C\u0026#34;) 9default: 10 fmt.Println(\u0026#34;D\u0026#34;) 11} âœ… è¿™æ˜¯ Go ä¸­æ¨èçš„å¤šæ¡ä»¶åˆ¤æ–­å†™æ³•ï¼Œæ¯”ä¸€é•¿ä¸² if-else æ›´æ¸…æ™°ã€‚\nä¸‰ã€å¸¦åˆå§‹åŒ–è¯­å¥çš„ switch Go æ”¯æŒåœ¨ switch å‰åŠ åˆå§‹åŒ–è¯­å¥ï¼ˆä½œç”¨åŸŸä»…é™äºè¯¥ switchï¼‰ï¼š\n1switch n := rand.Intn(10); { 2case n \u0026lt; 3: 3 fmt.Println(\u0026#34;å°:\u0026#34;, n) 4case n \u0026lt; 7: 5 fmt.Println(\u0026#34;ä¸­:\u0026#34;, n) 6default: 7 fmt.Println(\u0026#34;å¤§:\u0026#34;, n) 8} ç­‰ä»·äºï¼š\n1n := rand.Intn(10) 2switch { 3case n \u0026lt; 3: 4 ... 5} å››ã€ç±»å‹ switchï¼ˆç”¨äºæ¥å£ç±»å‹æ–­è¨€ï¼‰ å½“æ“ä½œçš„æ˜¯ interface{} ç±»å‹æ—¶ï¼Œå¯ç”¨ switch v := x.(type) åˆ¤æ–­å…·ä½“ç±»å‹ï¼š\n1var i interface{} = \u0026#34;hello\u0026#34; 2 3switch v := i.(type) { 4case string: 5 fmt.Printf(\u0026#34;å­—ç¬¦ä¸²: %s\\n\u0026#34;, v) 6case int: 7 fmt.Printf(\u0026#34;æ•´æ•°: %d\\n\u0026#34;, v) 8case bool: 9 fmt.Printf(\u0026#34;å¸ƒå°”å€¼: %t\\n\u0026#34;, v) 10default: 11 fmt.Println(\u0026#34;æœªçŸ¥ç±»å‹\u0026#34;) 12} ğŸ” v åœ¨æ¯ä¸ª case ä¸­è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”ç±»å‹ï¼Œæ— éœ€å†æ–­è¨€ã€‚\näº”ã€fallthroughï¼šå¼ºåˆ¶ç©¿é€ï¼ˆæ…ç”¨ï¼ï¼‰ è™½ç„¶ Go é»˜è®¤ä¸ç©¿é€ï¼Œä½†å¯ä»¥ç”¨ fallthrough æ‰‹åŠ¨å¯ç”¨ï¼š\n1i := 2 2switch i { 3case 1: 4 fmt.Println(\u0026#34;1\u0026#34;) 5case 2: 6 fmt.Println(\u0026#34;2\u0026#34;) 7 fallthrough // ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª case 8case 3: 9 fmt.Println(\u0026#34;3\u0026#34;) 10} è¾“å‡ºï¼š\n12 23 âš ï¸ æ³¨æ„ï¼š\nfallthrough ä¸ä¼šåˆ¤æ–­ä¸‹ä¸€ä¸ª case çš„æ¡ä»¶ï¼Œç›´æ¥æ‰§è¡Œå…¶ä»£ç å— ä¸èƒ½åœ¨æœ€åä¸€ä¸ª case æˆ– default ä¸­ä½¿ç”¨ fallthrough ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œå®¹æ˜“å¼•å‘é€»è¾‘é”™è¯¯ å…­ã€switch çš„é«˜çº§ç‰¹æ€§ 1. case ä¸­å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼ˆGo 1.16+ æ›´çµæ´»ï¼‰ 1x := 5 2switch { 3case x \u0026gt; 0 \u0026amp;\u0026amp; x \u0026lt; 10: 4 fmt.Println(\u0026#34;ä¸ªä½æ­£æ•°\u0026#34;) 5} 2. æ”¯æŒç»“æ„ä½“ã€æ•°ç»„ç­‰å¯æ¯”è¾ƒç±»å‹ 1type Point struct{ X, Y int } 2 3p := Point{1, 2} 4switch p { 5case Point{1, 2}: 6 fmt.Println(\u0026#34;åŸç‚¹åç§»\u0026#34;) 7} âœ… è¦æ±‚ç±»å‹æ”¯æŒ == æ¯”è¾ƒï¼ˆsliceã€mapã€function ä¸è¡Œï¼‰\nä¸ƒã€å¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ âŒ é”™è¯¯ 1ï¼šè¯•å›¾åœ¨ case ä¸­å£°æ˜å˜é‡ï¼ˆä½œç”¨åŸŸé—®é¢˜ï¼‰ 1switch x { 2case 1: 3 y := 10 4case 2: 5 fmt.Println(y) // âŒ ç¼–è¯‘é”™è¯¯ï¼šy æœªå®šä¹‰ 6} âœ… æ­£ç¡®åšæ³•ï¼šæå‰å£°æ˜ï¼Œæˆ–ç”¨ {} åŒ…è£¹ï¼ˆä½†é€šå¸¸æ²¡å¿…è¦ï¼‰\nâŒ é”™è¯¯ 2ï¼šå¯¹ä¸å¯æ¯”è¾ƒç±»å‹ä½¿ç”¨ switch 1s := []int{1, 2} 2switch s { // âŒ ç¼–è¯‘é”™è¯¯ï¼šslice ä¸èƒ½æ¯”è¾ƒ 3} âœ… è§£å†³ï¼šæ”¹ç”¨ if æˆ–å…¶ä»–é€»è¾‘\nâœ… æœ€ä½³å®è·µ åœºæ™¯ æ¨èå†™æ³• å¤šå€¼ç›¸ç­‰åˆ¤æ–­ switch val { case v1, v2: ... } å¤šæ¡ä»¶åˆ¤æ–­ switch { case cond1: ... }ï¼ˆä»£æ›¿ if-elseï¼‰ æ¥å£ç±»å‹å¤„ç† ä½¿ç”¨ ç±»å‹ switch æ€§èƒ½æ•æ„Ÿåœºæ™¯ æŠŠæœ€å¯èƒ½å‘½ä¸­çš„ case æ”¾å‰é¢ï¼ˆGo ä¸ä¿è¯è·³è½¬è¡¨ä¼˜åŒ–ï¼‰ é¿å…å¤æ‚é€»è¾‘ å•ä¸ª case ä»£ç ä¸å®œè¿‡é•¿ï¼Œå¯æå–å‡½æ•° å…«ã€ä¸ if-else çš„å¯¹æ¯” ç‰¹æ€§ switch if-else å¯è¯»æ€§ï¼ˆå¤šåˆ†æ”¯ï¼‰ âœ… æ›´æ¸…æ™° âŒ æ˜“æ··ä¹± æ€§èƒ½ åŸºæœ¬ç›¸åŒï¼ˆGo ç¼–è¯‘å™¨ä¼˜åŒ–åï¼‰ ç›¸åŒ çµæ´»æ€§ æ”¯æŒç±»å‹åˆ¤æ–­ã€è¡¨è¾¾å¼ç­‰ æ›´é€šç”¨ é»˜è®¤ break âœ… æ˜¯ N/A ğŸ’¡ å»ºè®®ï¼š\nç®€å•ä¸¤ä¸‰ä¸ªåˆ†æ”¯ â†’ if-else ä¸‰ä¸ªä»¥ä¸Šç­‰å€¼åˆ¤æ–­æˆ–ç±»å‹åˆ¤æ–­ â†’ switch ä¹ã€æ€»ç»“ï¼šGo switch çš„æ ¸å¿ƒä¼˜åŠ¿ å®‰å…¨ï¼šé»˜è®¤ä¸ fallthroughï¼Œé¿å…ç»å…¸ bug ç®€æ´ï¼šæ”¯æŒå¤šå€¼ã€æ— è¡¨è¾¾å¼ã€åˆå§‹åŒ–è¯­å¥ å¼ºå¤§ï¼šæ”¯æŒç±»å‹ switchï¼Œå®Œç¾é…åˆ interface çµæ´»ï¼šå¯ç”¨äºä»»ä½•å¯æ¯”è¾ƒç±»å‹ ğŸŒŸ è®°ä½ï¼š\nGo çš„ switch ä¸æ˜¯ C çš„ switchï¼Œå®ƒæ˜¯ä¸ºç°ä»£ç¼–ç¨‹é‡æ–°è®¾è®¡çš„â€”â€”æ›´å®‰å…¨ã€æ›´æ¸…æ™°ã€æ›´ Goã€‚\nGo è¯­è¨€ä¸­çš„ select æ˜¯ä¸“ä¸º channel æ“ä½œè®¾è®¡çš„æ§åˆ¶ç»“æ„ï¼Œç”¨äºåœ¨å¤šä¸ª goroutine é€šä¿¡ï¼ˆchannel è¯»å†™ï¼‰ ä¸­è¿›è¡Œéé˜»å¡æˆ–å¤šè·¯å¤ç”¨çš„é€‰æ‹©ã€‚å®ƒæ˜¯ Go å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚ âœ… ä¸€å¥è¯æ€»ç»“ select è®©ä½ â€œåŒæ—¶ç›‘å¬å¤šä¸ª channelâ€ï¼Œå½“ä»»æ„ä¸€ä¸ª channel å¯è¯»/å¯å†™æ—¶ï¼Œå°±æ‰§è¡Œå¯¹åº”çš„åˆ†æ”¯ï¼›å¦‚æœå¤šä¸ªå°±ç»ªï¼Œåˆ™éšæœºé€‰ä¸€ä¸ªæ‰§è¡Œã€‚\nä¸€ã€åŸºæœ¬è¯­æ³• 1select { 2case v := \u0026lt;-ch1: // ä» ch1 æ¥æ”¶ 3 // å¤„ç† v 4case ch2 \u0026lt;- x: // å‘ ch2 å‘é€ x 5 // å‘é€æˆåŠŸåçš„é€»è¾‘ 6case v, ok := \u0026lt;-ch3: // å¸¦ ok çš„æ¥æ”¶ï¼ˆæ£€æµ‹ channel æ˜¯å¦å…³é—­ï¼‰ 7 if ok { 8 // æ­£å¸¸æ¥æ”¶ 9 } else { 10 // ch3 å·²å…³é—­ 11 } 12default: // å¯é€‰ï¼šéé˜»å¡åˆ†æ”¯ 13 // æ‰€æœ‰ channel éƒ½æœªå°±ç»ªæ—¶æ‰§è¡Œ 14} ğŸ”” æ³¨æ„ï¼šselect åªèƒ½ç”¨äº channel æ“ä½œï¼Œä¸èƒ½ç”¨äºæ™®é€šå˜é‡æˆ–æ¡ä»¶åˆ¤æ–­ï¼ˆé‚£æ˜¯ switch çš„äº‹ï¼‰ã€‚\näºŒã€æ ¸å¿ƒç‰¹æ€§ 1. å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰ åŒæ—¶ç­‰å¾…å¤šä¸ª channel çš„è¯»/å†™æ“ä½œ å“ªä¸ª channel å…ˆâ€œå‡†å¤‡å¥½â€ï¼Œå°±æ‰§è¡Œå“ªä¸ª case 2. éšæœºé€‰æ‹©ï¼ˆRandom Selectionï¼‰ å¦‚æœå¤šä¸ª channel åŒæ—¶å°±ç»ªï¼ŒGo è¿è¡Œæ—¶ä¼šéšæœºé€‰ä¸€ä¸ªæ‰§è¡Œï¼ˆé¿å…é¥¥é¥¿ï¼‰ 3. é˜»å¡ vs éé˜»å¡ æ²¡æœ‰ default â†’ select ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æŸä¸ª channel å°±ç»ª æœ‰ default â†’ æ°¸ä¸é˜»å¡ï¼Œç«‹å³æ‰§è¡Œï¼ˆå³ä½¿æ‰€æœ‰ channel éƒ½æœªå°±ç»ªï¼‰ ä¸‰ã€ç»å…¸ä½¿ç”¨åœºæ™¯ åœºæ™¯ 1ï¼šè¶…æ—¶æ§åˆ¶ï¼ˆTimeoutï¼‰ 1ch := make(chan string) 2go func() { 3 time.Sleep(2 * time.Second) 4 ch \u0026lt;- \u0026#34;result\u0026#34; 5}() 6 7select { 8case res := \u0026lt;-ch: 9 fmt.Println(\u0026#34;æ”¶åˆ°:\u0026#34;, res) 10case \u0026lt;-time.After(1 * time.Second): // è¶…æ—¶ 11 fmt.Println(\u0026#34;è¶…æ—¶ï¼\u0026#34;) 12} 13// è¾“å‡ºï¼šè¶…æ—¶ï¼ ğŸ’¡ time.After(d) è¿”å›ä¸€ä¸ª \u0026lt;-chan Timeï¼Œå¸¸ç”¨äºè¶…æ—¶ã€‚\nåœºæ™¯ 2ï¼šä¼˜é›…é€€å‡ºï¼ˆGraceful Shutdownï¼‰ 1done := make(chan bool) 2go worker(done) 3 4// ä¸» goroutine ç­‰å¾…ä¿¡å·æˆ–å®Œæˆ 5select { 6case \u0026lt;-done: 7 fmt.Println(\u0026#34;å·¥ä½œå®Œæˆ\u0026#34;) 8case \u0026lt;-time.After(5 * time.Second): 9 fmt.Println(\u0026#34;å¼ºåˆ¶è¶…æ—¶é€€å‡º\u0026#34;) 10} åœºæ™¯ 3ï¼šéé˜»å¡ channel æ“ä½œï¼ˆå¸¦ defaultï¼‰ 1select { 2case msg := \u0026lt;-ch: 3 fmt.Println(\u0026#34;æ”¶åˆ°æ¶ˆæ¯:\u0026#34;, msg) 4default: 5 fmt.Println(\u0026#34;æ²¡æ¶ˆæ¯ï¼Œç»§ç»­åšåˆ«çš„äº‹...\u0026#34;) 6 // ä¸ä¼šå¡ä½ï¼ 7} åœºæ™¯ 4ï¼šå¤„ç†å¤šä¸ªè¾“å…¥æº 1ch1 := make(chan int) 2ch2 := make(chan int) 3 4go func() { ch1 \u0026lt;- 1 }() 5go func() { ch2 \u0026lt;- 2 }() 6 7select { 8case v := \u0026lt;-ch1: 9 fmt.Println(\u0026#34;æ¥è‡ª ch1:\u0026#34;, v) 10case v := \u0026lt;-ch2: 11 fmt.Println(\u0026#34;æ¥è‡ª ch2:\u0026#34;, v) 12} 13// éšæœºè¾“å‡º ch1 æˆ– ch2 çš„å€¼ å››ã€ç‰¹æ®Šå½¢å¼ 1. ç©º selectï¼šæ°¸ä¹…é˜»å¡ 1select {} å¸¸ç”¨äºä¸» goroutine ç­‰å¾…å…¶ä»– goroutine å®Œæˆï¼ˆé…åˆ sync.WaitGroup æ›´å®‰å…¨ï¼‰ ç­‰ä»·äº for {}ï¼Œä½†æ›´è¯­ä¹‰åŒ– 2. nil channel è¡Œä¸º å¯¹ nil channel æ‰§è¡Œè¯»å†™ä¼šæ°¸è¿œé˜»å¡ åœ¨ select ä¸­ï¼Œnil channel çš„ case æ°¸è¿œä¸ä¼šè¢«é€‰ä¸­ 1var ch chan int // nil 2select { 3case \u0026lt;-ch: // æ°¸è¿œä¸ä¼šæ‰§è¡Œ 4 fmt.Println(\u0026#34;ä¸å¯èƒ½\u0026#34;) 5default: 6 fmt.Println(\u0026#34;è·³è¿‡ nil channel\u0026#34;) // âœ… æ‰§è¡Œè¿™é‡Œ 7} âœ… å¯ç”¨äºåŠ¨æ€å¯ç”¨/ç¦ç”¨æŸäº›åˆ†æ”¯ï¼ˆæŠŠ channel è®¾ä¸º nilï¼‰\näº”ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ âŒ é™·é˜± 1ï¼šå¿˜è®°å…³é—­ channel å¯¼è‡´æ­»é” 1ch := make(chan int) 2go func() { 3 ch \u0026lt;- 1 4 // å¿˜è®° close(ch) 5}() 6select { 7case v := \u0026lt;-ch: 8 fmt.Println(v) 9case v := \u0026lt;-ch: // ç¬¬äºŒæ¬¡è¯»ä¼šæ°¸è¿œé˜»å¡ï¼ 10 fmt.Println(v) 11} âœ… è§£å†³ï¼šåˆç†è®¾è®¡ channel ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–ä½¿ç”¨å¸¦ç¼“å†² channelã€‚\nâŒ é™·é˜± 2ï¼šdefault å¯¼è‡´å¿™ç­‰å¾…ï¼ˆbusy-waitï¼‰ 1for { 2 select { 3 case v := \u0026lt;-ch: 4 process(v) 5 default: 6 // æ²¡æœ‰ sleepï¼CPU 100% 7 } 8} âœ… æ”¹è¿›ï¼š\n1for { 2 select { 3 case v := \u0026lt;-ch: 4 process(v) 5 default: 6 time.Sleep(10 * time.Millisecond) // æˆ–åšå…¶ä»–å·¥ä½œ 7 } 8} æˆ–è€…æ”¹ç”¨é˜»å¡å¼ selectï¼ˆå»æ‰ defaultï¼‰ã€‚\nâœ… æœ€ä½³å®è·µ åœºæ™¯ å»ºè®® è¶…æ—¶æ§åˆ¶ ç”¨ time.After() ä¼˜é›…é€€å‡º ç”¨ done channel + select éé˜»å¡æ£€æŸ¥ ç”¨ default é¿å…æ­»é” ç¡®ä¿ channel æœ‰ reader/writerï¼ŒåŠæ—¶ close æ€§èƒ½æ•æ„Ÿ é¿å…åœ¨ tight loop ä¸­ä½¿ç”¨å¸¦ default çš„ select å…­ã€select vs switch ç‰¹æ€§ select switch ç”¨é€” ä»…ç”¨äº channel é€šç”¨æ¡ä»¶åˆ†æ”¯ é˜»å¡è¡Œä¸º å¯é˜»å¡/éé˜»å¡ æ°¸ä¸é˜»å¡ é»˜è®¤è¡Œä¸º éšæœºé€‰æ‹©å°±ç»ª case é¡ºåºåŒ¹é… fallthrough ä¸æ”¯æŒ æ”¯æŒï¼ˆéœ€æ˜¾å¼å†™ï¼‰ åˆå§‹åŒ–è¯­å¥ ä¸æ”¯æŒ æ”¯æŒï¼ˆswitch x := ...; x {ï¼‰ ğŸ“Œ è®°ä½ï¼š\næ“ä½œ channelï¼Ÿâ†’ ç”¨ select å…¶ä»–åˆ¤æ–­ï¼Ÿâ†’ ç”¨ switch ä¸ƒã€æ€»ç»“ å…³é”®ç‚¹ è¯´æ˜ ä¸“ä¸º channel è®¾è®¡ ä¸èƒ½ç”¨äºæ™®é€šå˜é‡ å¤šè·¯å¤ç”¨ åŒæ—¶ç›‘å¬å¤šä¸ª channel éšæœºé€‰æ‹© å¤šä¸ªå°±ç»ªæ—¶éšæœºæ‰§è¡Œ default = éé˜»å¡ æ²¡æœ‰ default å°±ä¼šé˜»å¡ ç©º select = æ°¸ä¹…é˜»å¡ å¸¸ç”¨äº main ç­‰å¾… nil channel æ°¸ä¸å°±ç»ª å¯ç”¨äºåŠ¨æ€å¼€å…³åˆ†æ”¯ ğŸ’¡ Go å¹¶å‘å“²å­¦ï¼š\nâ€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ã€‚â€\nè€Œ select æ­£æ˜¯å®ç°è¿™ä¸€å“²å­¦çš„å…³é”®å·¥å…·ï¼ æŒæ¡ selectï¼Œä½ å°±æŒæ¡äº† Go å¹¶å‘ç¼–ç¨‹çš„â€œæ–¹å‘ç›˜â€ ğŸš—ğŸ’¨\nåœ¨ Go è¯­è¨€ä¸­ï¼Œgotoã€break å’Œ continue æ˜¯æ§åˆ¶æµç¨‹çš„å…³é”®å­—ï¼Œä½†å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å’Œé™åˆ¶ä¸è®¸å¤šå…¶ä»–è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰æœ‰æ‰€ä¸åŒã€‚Go åœ¨è®¾è®¡ä¸Šé¼“åŠ±æ¸…æ™°ã€å¯è¯»çš„ä»£ç ï¼Œå› æ­¤å¯¹è¿™äº›å…³é”®å­—åšäº†æœ‰æ„çš„é™åˆ¶ã€‚ ä¸€ã€breakï¼šè·³å‡ºå¾ªç¯æˆ– switch 1. åŸºæœ¬ç”¨æ³• åœ¨ forã€rangeã€switchã€select ä¸­ä½¿ç”¨ é»˜è®¤åªè·³å‡ºæœ€å†…å±‚ç»“æ„ 1for i := 0; i \u0026lt; 3; i++ { 2 for j := 0; j \u0026lt; 3; j++ { 3 if i == 1 \u0026amp;\u0026amp; j == 1 { 4 break // åªè·³å‡ºå†…å±‚ for 5 } 6 fmt.Printf(\u0026#34;(%d,%d) \u0026#34;, i, j) 7 } 8} 9// è¾“å‡º: (0,0) (0,1) (0,2) (1,0) (2,0) (2,1) (2,2) 2. å¸¦æ ‡ç­¾çš„ breakï¼ˆè·³å‡ºå¤šå±‚ï¼‰ Go æ”¯æŒæ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œç”¨äºè·³å‡ºæŒ‡å®šå¤–å±‚ç»“æ„ï¼š\n1outer: 2for i := 0; i \u0026lt; 3; i++ { 3 for j := 0; j \u0026lt; 3; j++ { 4 if i == 1 \u0026amp;\u0026amp; j == 1 { 5 break outer // è·³å‡º outer æ ‡ç­¾æ‰€åœ¨çš„å¾ªç¯ 6 } 7 fmt.Printf(\u0026#34;(%d,%d) \u0026#34;, i, j) 8 } 9} 10// è¾“å‡º: (0,0) (0,1) (0,2) (1,0) âœ… é€‚ç”¨åœºæ™¯ï¼šåµŒå¥—å¾ªç¯ä¸­éœ€è¦ç«‹å³é€€å‡ºå¤šå±‚ã€‚\näºŒã€continueï¼šè·³è¿‡æœ¬æ¬¡å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡ 1. åŸºæœ¬ç”¨æ³• ä»…ç”¨äº for å’Œ range å¾ªç¯ è·³è¿‡å½“å‰è¿­ä»£å‰©ä½™ä»£ç ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ 1for i := 0; i \u0026lt; 5; i++ { 2 if i%2 == 0 { 3 continue // è·³è¿‡å¶æ•° 4 } 5 fmt.Print(i, \u0026#34; \u0026#34;) // è¾“å‡º: 1 3 6} 2. å¸¦æ ‡ç­¾çš„ continue å¯ç”¨äºè·³åˆ°å¤–å±‚å¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£ï¼š\n1outer: 2for i := 0; i \u0026lt; 3; i++ { 3 for j := 0; j \u0026lt; 3; j++ { 4 if i == 1 { 5 continue outer // è·³è¿‡æ•´ä¸ª i=1 çš„å¤–å±‚å¾ªç¯ 6 } 7 fmt.Printf(\u0026#34;(%d,%d) \u0026#34;, i, j) 8 } 9} 10// è¾“å‡º: (0,0) (0,1) (0,2) (2,0) (2,1) (2,2) âš ï¸ æ³¨æ„ï¼šcontinue ä¸èƒ½ç”¨äº switch æˆ– selectï¼ˆå› ä¸ºå®ƒä»¬ä¸æ˜¯å¾ªç¯ï¼‰ã€‚\nä¸‰ã€gotoï¼šè·³è½¬åˆ°æ ‡ç­¾ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ 1. åŸºæœ¬è¯­æ³• 1goto LABEL 2... 3LABEL: 4 // æ‰§è¡Œåˆ°è¿™é‡Œ 2. ä¸¥æ ¼é™åˆ¶ï¼ˆGo çš„å®‰å…¨è®¾è®¡ï¼‰ Go å¯¹ goto åšäº†éå¸¸ä¸¥æ ¼çš„é™åˆ¶ï¼Œä»¥é˜²æ­¢ç ´åä½œç”¨åŸŸå’Œé€»è¾‘ï¼š\nä¸èƒ½è·³è¿‡å˜é‡å£°æ˜ï¼ˆä¼šç¼–è¯‘é”™è¯¯ï¼‰ ä¸èƒ½è·³å…¥å…¶ä»–ä»£ç å—ï¼ˆå¦‚ ifã€for å†…éƒ¨ï¼‰ åªèƒ½åœ¨åŒä¸€å‡½æ•°å†…è·³è½¬ âœ… åˆæ³•ç¤ºä¾‹ï¼š\n1func main() { 2 i := 0 3loop: 4 if i \u0026lt; 3 { 5 fmt.Println(i) 6 i++ 7 goto loop 8 } 9} 10// è¾“å‡º: 0 1 2 âŒ éæ³•ç¤ºä¾‹ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰ï¼š\n1goto skip 2x := 10 // é”™è¯¯ï¼šgoto è·³è¿‡äº†å˜é‡ x çš„å£°æ˜ 3skip: 4fmt.Println(x) 3. å®é™…ç”¨é€”ï¼ˆæå°‘ï¼‰ Go å®˜æ–¹å’Œç¤¾åŒºå¼ºçƒˆä¸æ¨èä½¿ç”¨ gotoï¼Œä½†åœ¨æå°‘æ•°åœºæ™¯ä¸‹å¯èƒ½æœ‰ç”¨ï¼š\né”™è¯¯å¤„ç†ï¼ˆç±»ä¼¼ C çš„ cleanup æ¨¡å¼ï¼Œä½† Go æ›´æ¨è deferï¼‰ çŠ¶æ€æœºï¼ˆä½†é€šå¸¸ç”¨ switch + for æ›´æ¸…æ™°ï¼‰ ğŸ“Œ Rob Pikeï¼ˆGo åˆ›å§‹äººä¹‹ä¸€ï¼‰è¯´ï¼š\nâ€œæˆ‘ä»¬ä¿ç•™ goto æ˜¯ä¸ºäº†å¤„ç†é‚£äº›â€˜ç†è®ºä¸Šå¯èƒ½ä½†å®è·µä¸­å‡ ä¹ä¸ä¼šé‡åˆ°â€™çš„æƒ…å†µã€‚â€\nå››ã€å¯¹æ¯”æ€»ç»“ å…³é”®å­— ç”¨é€” æ˜¯å¦æ”¯æŒæ ‡ç­¾ å…¸å‹åœºæ™¯ æ¨èåº¦ break è·³å‡º for/switch/select âœ… æå‰é€€å‡ºå¾ªç¯æˆ–åˆ†æ”¯ â­â­â­â­ continue è·³è¿‡æœ¬æ¬¡å¾ªç¯ âœ… è¿‡æ»¤æ¡ä»¶ã€è·³è¿‡å¤„ç† â­â­â­â­ goto ä»»æ„è·³è½¬ï¼ˆå—é™ï¼‰ âœ…ï¼ˆå¿…é¡»ï¼‰ æå°‘æ•°ç‰¹æ®Šé€»è¾‘ â­ï¼ˆæ…ç”¨ï¼‰ äº”ã€æœ€ä½³å®è·µå»ºè®® âœ… æ¨èåšæ³• ä¼˜å…ˆä½¿ç”¨ for + if + break/continue å®ç°é€»è¾‘ å¤šå±‚å¾ªç¯é€€å‡ºæ—¶ï¼Œåˆç†ä½¿ç”¨å¸¦æ ‡ç­¾çš„ break ç”¨ return æˆ– error ä»£æ›¿ goto åšé”™è¯¯å¤„ç† âŒ é¿å…åšæ³• ä¸è¦ç”¨ goto å®ç°æ™®é€šæ§åˆ¶æµï¼ˆå¦‚è·³è½¬åˆ°å‰é¢é‡å¤æ‰§è¡Œï¼‰ ä¸è¦ä¸ºäº†â€œå°‘å†™å‡ è¡Œâ€è€Œç‰ºç‰²å¯è¯»æ€§ ä¸è¦åœ¨å¤§å‹å‡½æ•°ä¸­ä½¿ç”¨ gotoï¼ˆææ˜“é€ æˆâ€œé¢æ¡ä»£ç â€ï¼‰ å…­ã€æ›¿ä»£ goto çš„ç°ä»£å†™æ³• åœºæ™¯ï¼šé”™è¯¯å¤„ç† âŒ æ—§å¼ï¼ˆC é£æ ¼ï¼‰ï¼š\n1err := doA() 2if err != nil { 3 goto cleanup 4} 5err = doB() 6if err != nil { 7 goto cleanup 8} 9cleanup: 10 close(resource) âœ… Go é£æ ¼ï¼š\n1func process() error { 2 resource := open() 3 defer close(resource) // è‡ªåŠ¨æ¸…ç† 4 5 if err := doA(); err != nil { 6 return err 7 } 8 if err := doB(); err != nil { 9 return err 10 } 11 return nil 12} æ€»ç»“ break å’Œ continue æ˜¯å®‰å…¨ã€å¸¸ç”¨ã€æ¨èçš„æ§åˆ¶æµå·¥å…·ï¼Œå°¤å…¶é…åˆæ ‡ç­¾å¯ä¼˜é›…å¤„ç†åµŒå¥—ã€‚ goto åœ¨ Go ä¸­è¢«ä¸¥æ ¼é™åˆ¶ï¼Œå‡ ä¹ä¸éœ€è¦ä½¿ç”¨ã€‚å¦‚æœä½ è§‰å¾—éœ€è¦ gotoï¼Œå¤§æ¦‚ç‡æœ‰æ›´å¥½çš„å†™æ³•ï¼ˆå¦‚æå–å‡½æ•°ã€ç”¨çŠ¶æ€å˜é‡ç­‰ï¼‰ã€‚ Go çš„å“²å­¦æ˜¯ï¼šç®€å•ã€æ¸…æ™°ã€å¯ç»´æŠ¤ã€‚\næ§åˆ¶æµè¶Šç›´ç™½ï¼Œä»£ç è¶Šå¥å£®ã€‚ ğŸ’¡ è®°ä½ï¼šèƒ½ä¸ç”¨ gotoï¼Œå°±ä¸ç”¨ goto â€”â€” è¿™æ˜¯ Go ç¤¾åŒºçš„å…±è¯†ã€‚\nåœ¨ Go è¯­è¨€ä¸­å®šä¹‰å‡½æ•°ç±»å‹ï¼ˆfunction typeï¼‰æ—¶ï¼Œå‚æ•°åˆ—è¡¨ä¸­å¯ä»¥åªå†™å‚æ•°ç±»å‹ï¼Œçœç•¥å‚æ•°åç§°ã€‚è¿™æ˜¯å®Œå…¨åˆæ³•ä¸”å¸¸è§çš„åšæ³•ã€‚ âœ… æ­£ç¡®è¯­æ³•ç¤ºä¾‹ 1. å¸¦å‚æ•°åï¼ˆå¯è¯»æ€§å¥½ï¼Œä½†éå¿…é¡»ï¼‰ 1type Handler func(w http.ResponseWriter, r *http.Request) 2. ä¸å¸¦å‚æ•°åï¼ˆæ›´ç®€æ´ï¼ŒGo å®˜æ–¹ä¹Ÿå¸¸ç”¨ï¼‰ 1type Handler func(http.ResponseWriter, *http.Request) âœ… ä¸¤è€…å®Œå…¨ç­‰ä»·ï¼Œç¼–è¯‘å™¨åªå…³å¿ƒå‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹ï¼Œä¸å…³å¿ƒå‚æ•°åã€‚\nğŸ” å®˜æ–¹æ ‡å‡†åº“ä¸­çš„ä¾‹å­ Go æ ‡å‡†åº“å¤§é‡ä½¿ç”¨â€œæ— å‚æ•°åâ€çš„å‡½æ•°ç±»å‹å®šä¹‰ï¼š\n1// net/http/server.go 2type HandlerFunc func(ResponseWriter, *Request) 3 4// sort/slice.go 5type LessFunc func(i, j int) bool // è¿™é‡Œå†™äº† i,jï¼ˆå¯é€‰ï¼‰ 6type SwapFunc func(i, j int) // åŒä¸Š 7 8// context/context.go 9type CancelFunc func() æ³¨æ„ï¼šHandlerFunc çš„å®šä¹‰ä¸­å°±æ²¡æœ‰å†™å‚æ•°åï¼Œç›´æ¥ç”¨ç±»å‹ã€‚\nğŸ“Œ è§„åˆ™æ€»ç»“ åœºæ™¯ æ˜¯å¦å…è®¸çœç•¥å‚æ•°å å‡½æ•°ç±»å‹å®šä¹‰ï¼ˆtype F func(...)ï¼‰ âœ… å…è®¸ï¼Œæ¨èç®€æ´å†™æ³• å…·ä½“å‡½æ•°å®ç°ï¼ˆfunc myFunc(a int) {...}ï¼‰ âŒ ä¸å…è®¸ï¼Œå¿…é¡»å†™å‚æ•°å æ¥å£ä¸­çš„æ–¹æ³•ç­¾å âœ… å…è®¸çœç•¥ï¼ˆä½†é€šå¸¸å†™ä¸Šä»¥æé«˜å¯è¯»æ€§ï¼‰ ç¤ºä¾‹å¯¹æ¯”ï¼š 1// âœ… å‡½æ•°ç±»å‹å®šä¹‰ï¼šå¯ä»¥çœç•¥å‚æ•°å 2type MathOp func(int, int) int 3 4// âœ… å…·ä½“å‡½æ•°å®ç°ï¼šå¿…é¡»å†™å‚æ•°å 5func Add(a, b int) int { 6 return a + b 7} 8 9// ä½¿ç”¨ 10var op MathOp = Add ğŸ’¡ ä¸ºä»€ä¹ˆå…è®¸çœç•¥ï¼Ÿ å› ä¸ºå‡½æ•°ç±»å‹çš„æœ¬è´¨æ˜¯â€œè°ƒç”¨å¥‘çº¦â€ï¼š\nè°ƒç”¨è€…åªéœ€è¦çŸ¥é“ï¼šä¼ ä»€ä¹ˆç±»å‹çš„å‚æ•°ã€è¿”å›ä»€ä¹ˆç±»å‹ å‚æ•°å«ä»€ä¹ˆåå­—ï¼Œå¯¹ç±»å‹ç³»ç»Ÿæ¥è¯´æ— å…³ç´§è¦ ä¾‹å¦‚ï¼š\n1type Fn func(string, int) bool è¡¨ç¤ºï¼šâ€œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ª string å’Œä¸€ä¸ª intï¼Œè¿”å› boolâ€ã€‚è‡³äº string å« name è¿˜æ˜¯ sï¼Œint å« age è¿˜æ˜¯ xï¼Œä¸å½±å“ç±»å‹åŒ¹é…ã€‚\nâš ï¸ æ³¨æ„äº‹é¡¹ è¿”å›å€¼ä¹Ÿä¸èƒ½å†™åå­—ï¼ˆåœ¨å‡½æ•°ç±»å‹å®šä¹‰ä¸­ï¼‰ï¼š\n1type F func() (int, error) // âœ… æ­£ç¡® 2type F func() (n int, err error) // âŒ é”™è¯¯ï¼å‡½æ•°ç±»å‹ä¸­ä¸èƒ½å‘½åè¿”å›å€¼ å¯å˜å‚æ•°ï¼ˆvariadicï¼‰å†™æ³•ï¼š\n1type LogFunc func(...interface{}) // âœ… æ­£ç¡® å¦‚æœè¿½æ±‚å¯è¯»æ€§ï¼Œä¹Ÿå¯ä»¥ä¿ç•™å‚æ•°åï¼ˆå°¤å…¶åœ¨å¤æ‚ç±»å‹ä¸­ï¼‰ï¼š\n1// æ›´æ˜“ç†è§£ 2type Validator func(value string, minLen int) error 3// vs 4type Validator func(string, int) error ğŸ“ å»ºè®®ï¼š\nç®€å•ç±»å‹ï¼ˆå¦‚ func(int, int) intï¼‰â†’ çœç•¥å‚æ•°å å¤æ‚æˆ–è¯­ä¹‰ä¸æ˜ç¡®çš„ç±»å‹ â†’ ä¿ç•™å‚æ•°åæé«˜å¯è¯»æ€§ âœ… æ€»ç»“ é—®é¢˜ ç­”æ¡ˆ å‡½æ•°ç±»å‹å®šä¹‰ä¸­èƒ½å¦çœç•¥å‚æ•°åï¼Ÿ âœ… èƒ½ æ˜¯å¦å½±å“å‡½æ•°èµ‹å€¼æˆ–è°ƒç”¨ï¼Ÿ âŒ ä¸å½±å“ï¼Œç±»å‹åªçœ‹å‚æ•°/è¿”å›å€¼ç±»å‹ è¿”å›å€¼èƒ½å¦å‘½åï¼Ÿ âŒ ä¸èƒ½ï¼ˆåœ¨å‡½æ•°ç±»å‹å®šä¹‰ä¸­ï¼‰ æ¨èå†™æ³•ï¼Ÿ ç®€å•ç±»å‹çœç•¥ï¼Œå¤æ‚ç±»å‹å¯ä¿ç•™å‚æ•°åä»¥æé«˜å¯è¯»æ€§ ğŸ’¡ è®°ä½ï¼š\nå‡½æ•°ç±»å‹ = å‚æ•°ç±»å‹åˆ—è¡¨ + è¿”å›å€¼ç±»å‹åˆ—è¡¨ï¼Œåå­—åªæ˜¯â€œæ³¨é‡Šâ€ã€‚\næ‰€ä»¥ä½ å¯ä»¥æ”¾å¿ƒåœ°å†™ï¼š\n1type MyFunc func(int, string, bool) error è¿™æ˜¯åœ°é“ä¸”é«˜æ•ˆçš„ Go é£æ ¼ï¼\n#åœ¨ Go è¯­è¨€ä¸­ï¼Œpanic å’Œ error æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒå±‚æ¬¡çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚æ­£ç¡®åŒºåˆ†å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯å†™å‡º å¥å£®ã€å¯ç»´æŠ¤ã€ç¬¦åˆ Go é£æ ¼ ä»£ç çš„å…³é”®ã€‚ âœ… æ ¸å¿ƒåŸåˆ™ï¼ˆä¸€å¥è¯æ€»ç»“ï¼‰ ç”¨ error å¤„ç†â€œé¢„æœŸä¸­çš„é”™è¯¯â€ï¼ˆå¦‚æ–‡ä»¶ä¸å­˜åœ¨ã€ç½‘ç»œè¶…æ—¶ï¼‰ï¼›\nç”¨ panic è¡¨ç¤ºâ€œä¸åº”è¯¥å‘ç”Ÿçš„ç¨‹åº bugâ€ï¼ˆå¦‚ç©ºæŒ‡é’ˆã€çŠ¶æ€ä¸ä¸€è‡´ï¼‰ã€‚\nä¸€ã€errorï¼šå¸¸è§„é”™è¯¯å¤„ç†ï¼ˆ99% çš„åœºæ™¯ï¼‰ âœ… é€‚ç”¨åœºæ™¯ å¯æ¢å¤çš„ã€ä¸šåŠ¡é€»è¾‘ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ è°ƒç”¨è€…æœ‰èƒ½åŠ›ä¸”åº”è¯¥å¤„ç†çš„é”™è¯¯ ğŸ“Œ å…¸å‹ä¾‹å­ åœºæ™¯ é”™è¯¯ç±»å‹ æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶ os.ErrNotExist ç½‘ç»œè¯·æ±‚è¶…æ—¶ context.DeadlineExceeded JSON è§£æå¤±è´¥ *json.SyntaxError æ•°æ®åº“è¿æ¥å¤±è´¥ driver è¿”å›çš„ error ç”¨æˆ·è¾“å…¥æ ¼å¼é”™è¯¯ è‡ªå®šä¹‰ error ğŸ’¡ ä½¿ç”¨æ–¹å¼ 1file, err := os.Open(\u0026#34;not-exist.txt\u0026#34;) 2if err != nil { 3 // æ­£å¸¸å¤„ç†ï¼šè®°å½•æ—¥å¿—ã€è¿”å›ç»™ä¸Šå±‚ã€é‡è¯•ç­‰ 4 log.Printf(\u0026#34;æ‰“å¼€æ–‡ä»¶å¤±è´¥: %v\u0026#34;, err) 5 return err 6} 7defer file.Close() âœ… Go çš„è®¾è®¡å“²å­¦ æ˜¾å¼é”™è¯¯å¤„ç†ï¼šå¼ºåˆ¶ä½ æ£€æŸ¥ err é”™è¯¯æ˜¯å€¼ï¼šå¯ä»¥ä¼ é€’ã€åŒ…è£…ã€æ¯”è¾ƒ ä¸ä¸­æ–­æ§åˆ¶æµï¼šç¨‹åºç»§ç»­è¿è¡Œ äºŒã€panicï¼šå¼‚å¸¸ç»ˆæ­¢ï¼ˆ\u0026lt;1% çš„åœºæ™¯ï¼‰ âœ… é€‚ç”¨åœºæ™¯ï¼ˆä»…é™ä»¥ä¸‹æƒ…å†µï¼ï¼‰ ç¨‹åºå¤„äºä¸å¯æ¢å¤çš„éæ³•çŠ¶æ€ å‘ç”Ÿäº†ç¨‹åºå‘˜çš„é€»è¾‘é”™è¯¯ï¼ˆbugï¼‰ å‰ç½®æ¡ä»¶ï¼ˆpreconditionï¼‰è¢«è¿å ğŸ“Œ å…¸å‹ä¾‹å­ åœºæ™¯ è¯´æ˜ è®¿é—®ç©ºæŒ‡é’ˆï¼ˆnil pointer dereferenceï¼‰ è¿è¡Œæ—¶è‡ªåŠ¨ panic æ•°ç»„è¶Šç•Œ è¿è¡Œæ—¶è‡ªåŠ¨ panic sync.Mutex æœªåŠ é”å°± Unlock æ ‡å‡†åº“ä¸»åŠ¨ panic å‡½æ•°è¦æ±‚å‚æ•°é nilï¼Œä½†ä¼ äº† nil å¯ä¸»åŠ¨ panic è¡¨ç¤ºâ€œè°ƒç”¨æ–¹çŠ¯é”™â€ åˆå§‹åŒ–å¤±è´¥ï¼ˆå¦‚ config è§£æè‡´å‘½é”™è¯¯ï¼‰ åœ¨ main æˆ– init ä¸­å¯ panic ğŸ’¡ ä½¿ç”¨æ–¹å¼ï¼ˆè°¨æ…ï¼ï¼‰ 1func MustParseInt(s string) int { 2 n, err := strconv.Atoi(s) 3 if err != nil { 4 // è¡¨ç¤ºï¼šè°ƒç”¨è€…ä¼ äº†éæ³•å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ bugï¼ 5 panic(fmt.Sprintf(\u0026#34;MustParseInt: invalid string %q\u0026#34;, s)) 6 } 7 return n 8} ğŸ”” æ³¨æ„ï¼šè¿™ç±»å‡½æ•°é€šå¸¸å‘½åä¸º MustXXXï¼Œæ˜ç¡®å‘ŠçŸ¥ä½¿ç”¨è€…â€œå‡ºé”™å°±å´©â€ã€‚\nä¸‰ã€å…³é”®åŒºåˆ«å¯¹æ¯”è¡¨ ç‰¹æ€§ error panic ç›®çš„ å¤„ç†é¢„æœŸä¸­çš„å¤±è´¥ æŠ¥å‘Šç¨‹åº bug æˆ–è‡´å‘½é”™è¯¯ æ§åˆ¶æµ æ­£å¸¸è¿”å›ï¼Œç”±è°ƒç”¨è€…å¤„ç† ç«‹å³ä¸­æ–­å½“å‰ goroutineï¼Œå¼€å§‹æ ˆå±•å¼€ æ¢å¤æ–¹å¼ ç›´æ¥ if åˆ¤æ–­ å¿…é¡»ç”¨ recover()ï¼ˆä¸”åªèƒ½åœ¨ defer ä¸­ï¼‰ æ€§èƒ½ è½»é‡ï¼ˆåªæ˜¯ä¸€ä¸ªæ¥å£å€¼ï¼‰ æ˜‚è´µï¼ˆæ ˆå±•å¼€ã€runtime å¹²é¢„ï¼‰ Go æƒ¯ä¾‹ é¦–é€‰æ–¹å¼ï¼Œæ— å¤„ä¸åœ¨ æåŠ›é¿å…ï¼Œä»…ç”¨äºæç«¯æƒ…å†µ æ˜¯å¦ä¼ æ’­ æ˜¾å¼è¿”å›ç»™è°ƒç”¨è€… è‡ªåŠ¨å‘ä¸Šä¼ æ’­ï¼Œç›´åˆ°è¢« recover æˆ–è¿›ç¨‹é€€å‡º é€‚ç”¨å±‚çº§ ä»»ä½•å‡½æ•° é€šå¸¸åªåœ¨åº“çš„è¾¹ç•Œæˆ–åˆå§‹åŒ–æ—¶ å››ã€å¸¸è§è¯¯åŒº \u0026amp; æœ€ä½³å®è·µ âŒ è¯¯åŒº 1ï¼šç”¨ panic å¤„ç†æ™®é€šé”™è¯¯ 1// é”™è¯¯ç¤ºèŒƒï¼ 2func ReadFile(path string) []byte { 3 data, err := os.ReadFile(path) 4 if err != nil { 5 panic(err) // âŒ ä¸åº”è¯¥ï¼è°ƒç”¨è€…å¯èƒ½æƒ³å¤„ç†â€œæ–‡ä»¶ä¸å­˜åœ¨â€ 6 } 7 return data 8} âœ… æ­£ç¡®åšæ³•ï¼š\n1func ReadFile(path string) ([]byte, error) { 2 return os.ReadFile(path) // ç›´æ¥è¿”å› error 3} âŒ è¯¯åŒº 2ï¼šåœ¨åº“å‡½æ•°ä¸­éšæ„ panic åº“ä½œè€…ä¸åº”å‡è®¾è°ƒç”¨è€…èƒ½æ¥å—å´©æºƒ åº”è¯¥è¿”å› errorï¼Œè®©åº”ç”¨å±‚å†³å®šæ˜¯å¦ panic âœ… ä¾‹å¤–ï¼šæä¾› MustXXX ç‰ˆæœ¬ä¾›é€‰æ‹©\n1// æ ‡å‡†åº“é£æ ¼ 2func Parse(template string) (*Template, error) { ... } 3func MustParse(template string) *Template { 4 t, err := Parse(template) 5 if err != nil { 6 panic(err) 7 } 8 return t 9} âœ… æœ€ä½³å®è·µï¼šä½•æ—¶è€ƒè™‘ panicï¼Ÿ åœºæ™¯ å»ºè®® main å‡½æ•°åˆå§‹åŒ–å¤±è´¥ âœ… å¯ panicï¼ˆå¦‚é…ç½®åŠ è½½å¤±è´¥ï¼‰ æµ‹è¯•ä»£ç  âœ… å¯ panicï¼ˆç®€åŒ–æ–­è¨€ï¼‰ ä¸å¯æ¢å¤çš„å†…éƒ¨çŠ¶æ€é”™è¯¯ âœ… å¦‚å¹¶å‘ map å†™å†²çª ç¬¬ä¸‰æ–¹ API è°ƒç”¨å¤±è´¥ âŒ è¿”å› error ç”¨æˆ·è¾“å…¥éªŒè¯å¤±è´¥ âŒ è¿”å› error ç½‘ç»œ/IO å¤±è´¥ âŒ è¿”å› error äº”ã€çœŸå®ä¸–ç•Œç±»æ¯” æ¦‚å¿µ ç°å®ç±»æ¯” error â€œå¿«é€’æ²¡é€åˆ°ï¼Œæˆ‘å†ä¸‹å•ä¸€æ¬¡â€ â€”â€” å¯æ¢å¤çš„æ“ä½œ panic â€œæˆ¿å­ç€ç«äº†ï¼â€ â€”â€” å¿…é¡»ç«‹å³é€ƒç”Ÿï¼ˆç»ˆæ­¢ç¨‹åºï¼‰ ä½ ä¸ä¼šå› ä¸ºå¿«é€’è¿Ÿåˆ°å°±çƒ§æˆ¿å­ï¼Œå¯¹å§ï¼ŸåŒç†ï¼Œä¸è¦å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨å°± panicã€‚\nå…­ã€æ€»ç»“ï¼šå†³ç­–æµç¨‹å›¾ 1å‘ç”Ÿäº†é”™è¯¯ï¼Ÿ 2â”‚ 3â”œâ”€ æ˜¯é¢„æœŸä¸­çš„å—ï¼Ÿï¼ˆå¦‚ç½‘ç»œè¶…æ—¶ã€æ–‡ä»¶ä¸å­˜åœ¨ï¼‰ â†’ ç”¨ error 4â”‚ 5â””â”€ æ˜¯ç¨‹åº bug å—ï¼Ÿï¼ˆå¦‚ç©ºæŒ‡é’ˆã€çŠ¶æ€çŸ›ç›¾ã€å‰ç½®æ¡ä»¶è¿åï¼‰ 6 â”‚ 7 â”œâ”€ èƒ½åœ¨å½“å‰å±‚ä¿®å¤å—ï¼Ÿ â†’ ä¿®å¤å®ƒï¼ˆç†è®ºä¸Šä¸è¯¥å‘ç”Ÿï¼‰ 8 â”‚ 9 â””â”€ ä¸èƒ½ä¿®å¤ï¼Ÿ â†’ panicï¼ˆè¡¨ç¤ºâ€œè¿™é‡Œå‡ºå¤§é—®é¢˜äº†ï¼â€ï¼‰ ğŸŒŸ ç»ˆæå»ºè®® â€œWhen in doubt, use error.â€\nï¼ˆå½“ä½ ä¸ç¡®å®šæ—¶ï¼Œå°±ç”¨ errorã€‚ï¼‰\nGo çš„æˆåŠŸå¾ˆå¤§ç¨‹åº¦ä¸Šå½’åŠŸäºå…¶æ˜¾å¼ã€ç®€å•ã€å¯ç»„åˆçš„é”™è¯¯å¤„ç†æ¨¡å‹ã€‚\npanic æ˜¯å®‰å…¨ç½‘ï¼Œä¸æ˜¯å¸¸è§„å·¥å…·ã€‚\néµå¾ªè¿™ä¸ªåŸåˆ™ï¼Œä½ çš„ Go ä»£ç å°†æ›´å¥å£®ã€æ›´æ˜“è°ƒè¯•ã€æ›´ç¬¦åˆç¤¾åŒºè§„èŒƒã€‚\nMethod Value å’Œ Method Expression åœ¨ Go å®é™…é¡¹ç›®ä¸­è™½ç„¶ä¸å¸¸è¢«æ˜¾å¼æåŠï¼Œä½†å®ƒä»¬æ˜¯å®ç°é«˜é˜¶å‡½æ•°ã€å›è°ƒæœºåˆ¶ã€é€šç”¨æ“ä½œå’Œæ ‡å‡†åº“é›†æˆçš„å…³é”®æŠ€æœ¯ã€‚ä¸‹é¢é€šè¿‡ çœŸå®åœºæ™¯ + å¯è¿è¡Œä»£ç  å±•ç¤ºå®ƒä»¬çš„å…¸å‹åº”ç”¨ã€‚ âœ… ä¸€ã€Method Valueï¼šç»‘å®šå®ä¾‹çš„æ–¹æ³•ï¼ˆé—­åŒ…é£æ ¼ï¼‰ ğŸ¯ æ ¸å¿ƒç”¨é€”ï¼šå°†å¯¹è±¡æ–¹æ³•ä½œä¸ºå›è°ƒå‡½æ•°ä¼ é€’ åœºæ™¯ 1ï¼šHTTP Handlerï¼ˆæœ€å¸¸è§ï¼ï¼‰ Go çš„ http.HandlerFunc æ˜¯ func(http.ResponseWriter, *http.Request)ï¼Œè€Œä½ çš„ä¸šåŠ¡é€»è¾‘å¾€å¾€å°è£…åœ¨ç»“æ„ä½“æ–¹æ³•ä¸­ã€‚\n1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;net/http\u0026#34; 6) 7 8type APIHandler struct { 9\tprefix string 10\tdb string // æ¨¡æ‹Ÿä¾èµ– 11} 12 13// æ–¹æ³•ï¼šå¤„ç†è¯·æ±‚ 14func (h *APIHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { 15\tmsg := fmt.Sprintf(\u0026#34;[%s] Handling %s on DB=%s\u0026#34;, h.prefix, r.URL.Path, h.db) 16\tw.Write([]byte(msg)) 17} 18 19func main() { 20\t// åˆ›å»º handler å®ä¾‹ 21\tuserAPI := \u0026amp;APIHandler{prefix: \u0026#34;USER\u0026#34;, db: \u0026#34;users_db\u0026#34;} 22\tadminAPI := \u0026amp;APIHandler{prefix: \u0026#34;ADMIN\u0026#34;, db: \u0026#34;admin_db\u0026#34;} 23 24\t// âœ… Method Valueï¼šè‡ªåŠ¨ç»‘å®š receiver 25\thttp.Handle(\u0026#34;/user/\u0026#34;, userAPI.ServeHTTP) // ç­‰ä»·äº func(w,r){ userAPI.ServeHTTP(w,r) } 26\thttp.Handle(\u0026#34;/admin/\u0026#34;, adminAPI.ServeHTTP) 27 28\tfmt.Println(\u0026#34;Server running on :8080\u0026#34;) 29\thttp.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) 30} ğŸ” userAPI.ServeHTTP æ˜¯ä¸€ä¸ª method valueï¼Œç±»å‹ä¸º func(http.ResponseWriter, *http.Request)ï¼Œå®Œç¾åŒ¹é… http.Handle è¦æ±‚ã€‚\nåœºæ™¯ 2ï¼šäº‹ä»¶å›è°ƒï¼ˆå¦‚å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯å¤„ç†ï¼‰ 1type EmailService struct { 2\tsmtpHost string 3} 4 5func (e *EmailService) SendWelcome(user string) { 6\tfmt.Printf(\u0026#34;Sending welcome email to %s via %s\\n\u0026#34;, user, e.smtpHost) 7} 8 9func scheduleTask(callback func(string), user string) { 10\t// æ¨¡æ‹Ÿå»¶è¿Ÿæ‰§è¡Œ 11\tgo func() { 12\ttime.Sleep(1 * time.Second) 13\tcallback(user) 14\t}() 15} 16 17func main() { 18\temailer := \u0026amp;EmailService{smtpHost: \u0026#34;smtp.example.com\u0026#34;} 19 20\t// âœ… Method Value ä½œä¸ºå›è°ƒ 21\tscheduleTask(emailer.SendWelcome, \u0026#34;alice\u0026#34;) // è‡ªåŠ¨ç»‘å®š emailer 22} ğŸ’¡ æ— éœ€å†™åŒ¿åå‡½æ•°åŒ…è£…ï¼šfunc(u string) { emailer.SendWelcome(u) }\nåœºæ™¯ 3ï¼šæ’åºè‡ªå®šä¹‰æ¯”è¾ƒå™¨ 1type Person struct{ Name string; Age int } 2 3type ByAge []Person 4 5func (a ByAge) Len() int { return len(a) } 6func (a ByAge) Swap(i, j int) { a[i], a[j] = a[j], a[i] } 7func (a ByAge) Less(i, j int) bool { return a[i].Age \u0026lt; a[j].Age } 8 9func main() { 10\tpeople := []Person{{\u0026#34;Alice\u0026#34;, 30}, {\u0026#34;Bob\u0026#34;, 25}} 11 12\t// âœ… Method Value ä¼ é€’ç»™ sort.Sort 13\tsort.Sort(ByAge(people)) // ByAge(people).Less æ˜¯ method value 14\tfmt.Println(people) // [{Bob 25} {Alice 30}] 15} ğŸ“Œ sort.Sort æ¥æ”¶ sort.Interfaceï¼Œå…¶ Less æ–¹æ³•é€šè¿‡ method value è¢«è°ƒç”¨ã€‚\nâœ… äºŒã€Method Expressionï¼šé€šç”¨æ–¹æ³•æ“ä½œï¼ˆå‡½æ•°å¼é£æ ¼ï¼‰ ğŸ¯ æ ¸å¿ƒç”¨é€”ï¼šå¯¹å¤šä¸ªå®ä¾‹ç»Ÿä¸€åº”ç”¨åŒä¸€æ–¹æ³• åœºæ™¯ 1ï¼šæ‰¹é‡å¤„ç†å¯¹è±¡ 1type User struct { 2\tID int 3\tName string 4} 5 6func (u User) Validate() error { 7\tif u.Name == \u0026#34;\u0026#34; { 8\treturn fmt.Errorf(\u0026#34;user %d: name is empty\u0026#34;, u.ID) 9\t} 10\treturn nil 11} 12 13func main() { 14\tusers := []User{ 15\t{1, \u0026#34;Alice\u0026#34;}, 16\t{2, \u0026#34;\u0026#34;}, 17\t{3, \u0026#34;Bob\u0026#34;}, 18\t} 19 20\t// âœ… Method Expressionï¼šè·å–é€šç”¨éªŒè¯å‡½æ•° 21\tvalidate := User.Validate // func(User) error 22 23\tvar errs []error 24\tfor _, u := range users { 25\tif err := validate(u); err != nil { // æ˜¾å¼ä¼ å…¥ receiver 26\terrs = append(errs, err) 27\t} 28\t} 29 30\tfmt.Println(\u0026#34;Errors:\u0026#34;, errs) // [user 2: name is empty] 31} ğŸ’¡ å¦‚æœç”¨ method valueï¼Œä½ éœ€è¦ä¸ºæ¯ä¸ª user å•ç‹¬åˆ›å»ºå‡½æ•°ï¼Œæ•ˆç‡ä½ä¸”å†—ä½™ã€‚\nåœºæ™¯ 2ï¼šåå°„æˆ–æ³›å‹ä¸­çš„æ–¹æ³•è°ƒç”¨ï¼ˆé«˜çº§ï¼‰ åœ¨éœ€è¦åŠ¨æ€è°ƒç”¨æ–¹æ³•æ—¶ï¼Œmethod expression æä¾›ç»Ÿä¸€å…¥å£ï¼š\n1// é€šç”¨æ—¥å¿—è£…é¥°å™¨ 2func LogMethod[T any](method func(T, string) string, receiver T, arg string) { 3\tresult := method(receiver, arg) 4\tfmt.Printf(\u0026#34;Called method with %v -\u0026gt; %s\\n\u0026#34;, receiver, result) 5} 6 7type Greeter struct{ Prefix string } 8 9func (g Greeter) Say(msg string) string { 10\treturn g.Prefix + msg 11} 12 13func main() { 14\tg := Greeter{\u0026#34;Hello, \u0026#34;} 15\t16\t// âœ… Method Expression ä½œä¸ºå‚æ•°ä¼ é€’ 17\tLogMethod(Greeter.Say, g, \u0026#34;world!\u0026#34;) 18\t// è¾“å‡º: Called method with {Hello, } -\u0026gt; Hello, world! 19} ğŸ”§ è¿™åœ¨æ„å»ºä¸­é—´ä»¶ã€AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ—¶éå¸¸æœ‰ç”¨ã€‚\nåœºæ™¯ 3ï¼šä¸æ ‡å‡†åº“ sort.Slice é…åˆï¼ˆGo 1.8+ï¼‰ 1type Product struct { 2\tName string 3\tPrice float64 4} 5 6func (p Product) IsExpensive() bool { 7\treturn p.Price \u0026gt; 100 8} 9 10func main() { 11\tproducts := []Product{ 12\t{\u0026#34;Laptop\u0026#34;, 1200}, 13\t{\u0026#34;Mouse\u0026#34;, 20}, 14\t{\u0026#34;Phone\u0026#34;, 800}, 15\t} 16 17\t// ä½¿ç”¨ method expression è¿‡æ»¤ 18\tvar expensive []Product 19\tfor _, p := range products { 20\tif Product.IsExpensive(p) { // æ˜¾å¼ä¼  receiver 21\texpensive = append(expensive, p) 22\t} 23\t} 24 25\tfmt.Println(\u0026#34;Expensive:\u0026#34;, expensive) 26} ğŸ†š å¯¹æ¯” method valueï¼š\n1// ä¸é€‚ç”¨ï¼å› ä¸ºæ¯ä¸ª p éƒ½ä¸åŒï¼Œæ— æ³•æå‰ç»‘å®š 2// filter := p.IsExpensive âŒ p æœªå®šä¹‰ âœ… ä¸‰ã€å¯¹æ¯”æ€»ç»“ï¼šä½•æ—¶ç”¨å“ªä¸ªï¼Ÿ åœºæ™¯ æ¨èæ–¹å¼ åŸå›  å›ºå®šå¯¹è±¡çš„æ–¹æ³•ä½œä¸ºå›è°ƒ\nï¼ˆå¦‚ HTTP handlerã€äº‹ä»¶ç›‘å¬ï¼‰ âœ… Method Value è‡ªåŠ¨ç»‘å®šå®ä¾‹ï¼Œç®€æ´æ— å†—ä½™ å¯¹å¤šä¸ªå¯¹è±¡åº”ç”¨åŒä¸€æ–¹æ³•\nï¼ˆå¦‚æ‰¹é‡éªŒè¯ã€è¿‡æ»¤ã€è½¬æ¢ï¼‰ âœ… Method Expression é¿å…é‡å¤åˆ›å»ºé—­åŒ…ï¼Œæ›´é«˜æ•ˆ éœ€è¦å°†æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ é€’ç»™é«˜é˜¶å‡½æ•° âš–ï¸ çœ‹æ˜¯å¦éœ€å›ºå®š receiverï¼š\n- å›ºå®š â†’ value\n- åŠ¨æ€ â†’ expression çµæ´»é€‚é… å®ç°æ¥å£ï¼ˆå¦‚ http.Handlerï¼‰ âœ… Method Value æ¥å£æ–¹æ³•è‡ªåŠ¨æˆä¸º method value âš ï¸ æ³¨æ„äº‹é¡¹ æ€§èƒ½ï¼š\nMethod Value ä¼šåˆ›å»ºé—­åŒ…ï¼ˆè½»å¾®å¼€é”€ï¼‰ Method Expression æ˜¯æ™®é€šå‡½æ•°è°ƒç”¨ï¼ˆé›¶å¼€é”€ï¼‰ ä½†åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå·®å¼‚å¯å¿½ç•¥ nil receiverï¼š\n1var p *Person = nil 2f := p.Greet // method value: è°ƒç”¨æ—¶ panic 3f2 := (*Person).Greet // method expression: å¯ä¼  nilï¼Œä½†æ–¹æ³•å†…ä¸èƒ½è§£å¼•ç”¨ å€¼ vs æŒ‡é’ˆ receiverï¼š\nç¡®ä¿ method value/expression çš„ receiver ç±»å‹ä¸æ–¹æ³•å®šä¹‰ä¸€è‡´ âœ… æœ€ä½³å®è·µå»ºè®® ä¼˜å…ˆä½¿ç”¨ Method Value å½“ä½ éœ€è¦â€œè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•â€ä½œä¸ºå‡½æ•°ï¼ˆæœ€å¸¸è§äºå›è°ƒï¼‰ ä½¿ç”¨ Method Expression å½“ä½ éœ€è¦â€œè¿™ä¸ªç±»å‹çš„æ–¹æ³•â€ä½œç”¨äºå¤šä¸ªå®ä¾‹ ä¸è¦ä¸ºäº†ç‚«æŠ€è€Œç”¨ â€”â€” ä»£ç å¯è¯»æ€§ä¼˜å…ˆ åœ¨ HTTP handlerã€sort.Interfaceã€callback ç­‰æ ‡å‡†æ¨¡å¼ä¸­ï¼Œå®ƒä»¬æ˜¯ idiomatic Go çš„ä¸€éƒ¨åˆ† ğŸ’¡ æ€»ç»“ä¸€å¥è¯ï¼š Method Value = â€œè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•â€ï¼ˆé—­åŒ…ï¼‰\nMethod Expression = â€œè¿™ä¸ªç±»å‹çš„æ–¹æ³•â€ï¼ˆæ™®é€šå‡½æ•°ï¼‰\næŒæ¡å®ƒä»¬ï¼Œä½ å°±èƒ½å†™å‡ºæ›´ç®€æ´ã€æ›´ç¬¦åˆ Go é£æ ¼çš„é«˜é˜¶å‡½æ•°å’Œå›è°ƒä»£ç ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œä½¿ç”¨ sync.Once æ˜¯å®ç°çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ çš„æœ€æ¨èã€æœ€ç®€æ´ã€æœ€é«˜æ•ˆçš„æ–¹å¼ã€‚ âœ… ä¸ºä»€ä¹ˆç”¨ sync.Onceï¼Ÿ ä¿è¯åˆå§‹åŒ–å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ æ— é”å¼€é”€ï¼ˆå†…éƒ¨ä½¿ç”¨åŸå­æ“ä½œ + mutexï¼Œä½†ä»…åœ¨é¦–æ¬¡è°ƒç”¨æ—¶æœ‰å¼€é”€ï¼‰ ä»£ç æ¸…æ™°ã€ä¸æ˜“å‡ºé”™ ğŸ§© åŸºæœ¬å®ç°ï¼šæ‡’åŠ è½½å•ä¾‹ï¼ˆLazy Initializationï¼‰ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6) 7 8// Singleton å•ä¾‹ç»“æ„ä½“ 9type Singleton struct { 10\tdata string 11} 12 13// å…¨å±€å˜é‡ 14var ( 15\tinstance *Singleton 16\tonce sync.Once 17) 18 19// GetInstance è·å–å•ä¾‹å®ä¾‹ 20func GetInstance() *Singleton { 21\tonce.Do(func() { 22\tfmt.Println(\u0026#34;Creating Singleton instance...\u0026#34;) 23\tinstance = \u0026amp;Singleton{data: \u0026#34;I am singleton\u0026#34;} 24\t}) 25\treturn instance 26} 27 28func main() { 29\t// å¹¶å‘æµ‹è¯• 30\tvar wg sync.WaitGroup 31\tfor i := 0; i \u0026lt; 10; i++ { 32\twg.Add(1) 33\tgo func(id int) { 34\tdefer wg.Done() 35\ts := GetInstance() 36\tfmt.Printf(\u0026#34;Goroutine %d: %p - %s\\n\u0026#34;, id, s, s.data) 37\t}(i) 38\t} 39\twg.Wait() 40} ğŸ” è¾“å‡ºç¤ºä¾‹ï¼š 1Creating Singleton instance... 2Goroutine 5: 0xc0000a4030 - I am singleton 3Goroutine 0: 0xc0000a4030 - I am singleton 4... 5ï¼ˆæ‰€æœ‰ goroutine æ‰“å°ç›¸åŒçš„åœ°å€ï¼‰ âœ… å…³é”®ç‚¹ï¼š\n\u0026quot;Creating Singleton instance...\u0026quot; åªæ‰“å°ä¸€æ¬¡ æ‰€æœ‰ goroutine æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªæŒ‡é’ˆ ğŸ› ï¸ å°è£…å»ºè®®ï¼šå°† once å’Œ instance ç§æœ‰åŒ– ä¸ºäº†é˜²æ­¢å¤–éƒ¨ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ï¼Œå»ºè®®å°†å•ä¾‹å°è£…åœ¨åŒ…å†…ï¼š\n1// singleton/singleton.go 2package singleton 3 4import \u0026#34;sync\u0026#34; 5 6type MyService struct { 7\tconfig string 8\tdbConn string 9} 10 11var ( 12\t_instance *MyService 13\t_once sync.Once 14) 15 16// Instance è¿”å›å•ä¾‹ 17func Instance() *MyService { 18\t_once.Do(func() { 19\t_instance = \u0026amp;MyService{ 20\tconfig: \u0026#34;prod\u0026#34;, 21\tdbConn: \u0026#34;mysql://...\u0026#34;, 22\t} 23\t}) 24\treturn _instance 25} 26 27// ç¦æ­¢å¤–éƒ¨åˆ›å»ºï¼ˆå¯é€‰ï¼‰ 28func NewMyService() *MyService { 29\tpanic(\u0026#34;use singleton.Instance() instead\u0026#34;) 30} ä½¿ç”¨ï¼š\n1// main.go 2import \u0026#34;your-project/singleton\u0026#34; 3 4func main() { 5\tsvc := singleton.Instance() 6\t// ä½¿ç”¨ svc... 7} âŒ å¸¸è§é”™è¯¯å®ç°ï¼ˆä¸è¦è¿™æ ·åšï¼ï¼‰ é”™è¯¯ 1ï¼šåŒé‡æ£€æŸ¥é”ï¼ˆDCLï¼‰â€”â€”Go ä¸­ä¸å®‰å…¨ï¼ 1// âŒ å±é™©ï¼Go å†…å­˜æ¨¡å‹ä¸ä¿è¯å¯è§æ€§ 2var instance *Singleton 3var mu sync.Mutex 4 5func GetInstance() *Singleton { 6\tif instance == nil { // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼ˆæ— é”ï¼‰ 7\tmu.Lock() 8\tif instance == nil { // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼ˆæœ‰é”ï¼‰ 9\tinstance = \u0026amp;Singleton{} 10\t} 11\tmu.Unlock() 12\t} 13\treturn instance 14} âš ï¸ é—®é¢˜ï¼šinstance = \u0026amp;Singleton{} ä¸æ˜¯åŸå­æ“ä½œï¼ˆåˆ†é…å†…å­˜ â†’ åˆå§‹åŒ– â†’ èµ‹å€¼ï¼‰ï¼Œå…¶ä»– goroutine å¯èƒ½çœ‹åˆ°æœªåˆå§‹åŒ–çš„ instanceï¼ˆæŒ‡ä»¤é‡æ’åºï¼‰ã€‚\né”™è¯¯ 2ï¼šå…¨å±€äº’æ–¥é”ï¼ˆæ€§èƒ½å·®ï¼‰ 1// âŒ æ¯æ¬¡è°ƒç”¨éƒ½åŠ é”ï¼Œæ²¡å¿…è¦ 2var mu sync.Mutex 3var instance *Singleton 4 5func GetInstance() *Singleton { 6\tmu.Lock() 7\tdefer mu.Unlock() 8\tif instance == nil { 9\tinstance = \u0026amp;Singleton{} 10\t} 11\treturn instance 12} ğŸ’¡ sync.Once åªåœ¨é¦–æ¬¡åˆå§‹åŒ–æ—¶åŒæ­¥ï¼Œåç»­è°ƒç”¨æ— é”ã€æ— åŸå­æ“ä½œï¼Œæ€§èƒ½æœ€ä¼˜ã€‚\nğŸ” sync.Once å†…éƒ¨åŸç†ï¼ˆç®€è¦ï¼‰ 1type Once struct { 2\tdone uint32 // åŸå­æ ‡å¿—ä½ 3\tm Mutex // ç”¨äºåŒæ­¥åˆå§‹åŒ– 4} é¦–æ¬¡è°ƒç”¨ Do()ï¼šæ£€æŸ¥ done == 0 â†’ åŠ é” â†’ å†æ¬¡æ£€æŸ¥ â†’ æ‰§è¡Œå‡½æ•° â†’ è®¾ç½® done = 1 åç»­è°ƒç”¨ï¼šé€šè¿‡åŸå­è¯» done å¿«é€Ÿè¿”å›ï¼ˆæ— é”ã€æ— å‡½æ•°è°ƒç”¨å¼€é”€ï¼‰ âœ… å®Œç¾è§£å†³â€œæ‡’åŠ è½½ + çº¿ç¨‹å®‰å…¨ + é«˜æ€§èƒ½â€ä¸‰è€…çŸ›ç›¾ã€‚\nğŸ§ª æµ‹è¯•å•ä¾‹æ˜¯å¦çœŸçš„â€œå•â€ 1func TestSingleton(t *testing.T) { 2\tvar instances []*Singleton 3\tvar wg sync.WaitGroup 4 5\tfor i := 0; i \u0026lt; 100; i++ { 6\twg.Add(1) 7\tgo func() { 8\tdefer wg.Done() 9\tinstances = append(instances, GetInstance()) 10\t}() 11\t} 12\twg.Wait() 13 14\tfirst := instances[0] 15\tfor _, inst := range instances { 16\tif inst != first { 17\tt.Fatal(\u0026#34;Not a singleton!\u0026#34;) 18\t} 19\t} 20} ğŸ’¡ æ³¨æ„ï¼šinstances = append(...) åœ¨å¹¶å‘ä¸‹ä¸å®‰å…¨ï¼Œå®é™…æµ‹è¯•åº”åŠ é”æˆ–ç”¨ channel æ”¶é›†ç»“æœã€‚\nğŸ“Œ æ€»ç»“ï¼šæœ€ä½³å®è·µ è¦ç‚¹ è¯´æ˜ ä½¿ç”¨ sync.Once å”¯ä¸€æ¨èçš„çº¿ç¨‹å®‰å…¨å•ä¾‹å®ç° æ‡’åŠ è½½ å®ä¾‹åœ¨é¦–æ¬¡è°ƒç”¨æ—¶åˆ›å»ºï¼ŒèŠ‚çœèµ„æº ç§æœ‰åŒ–å˜é‡ å°† instance å’Œ once è®¾ä¸ºåŒ…ç§æœ‰ï¼ˆå°å†™ï¼‰ æä¾› Instance() å‡½æ•° ç»Ÿä¸€è®¿é—®å…¥å£ é¿å…å…¨å±€å˜é‡æš´éœ² é˜²æ­¢å¤–éƒ¨è¯¯ä¿®æ”¹ âœ… æœ€ç»ˆæ¨¡æ¿ï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰ 1package yourpackage 2 3import \u0026#34;sync\u0026#34; 4 5type YourType struct { 6\t// fields 7} 8 9var ( 10\tinstance *YourType 11\tonce sync.Once 12) 13 14func Instance() *YourType { 15\tonce.Do(func() { 16\tinstance = \u0026amp;YourType{ 17\t// initialize fields 18\t} 19\t}) 20\treturn instance 21} ğŸŒŸ è¿™å°±æ˜¯ Go ç¤¾åŒºå…¬è®¤çš„ idiomatic singleton patternã€‚\nä½¿ç”¨å®ƒï¼Œä½ å°±èƒ½å†™å‡ºå®‰å…¨ã€é«˜æ•ˆã€ç®€æ´çš„å•ä¾‹ä»£ç ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œå¯¹åŒä¸€ä¸ªåˆ‡ç‰‡ï¼ˆsliceï¼‰å¹¶å‘è°ƒç”¨ append æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´ æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ã€æ•°æ®ä¸¢å¤±ï¼Œç”šè‡³ ç¨‹åºå´©æºƒã€‚ä¸‹é¢æˆ‘ä»¬ä»åŸç†ã€ç¤ºä¾‹å’Œè§£å†³æ–¹æ¡ˆä¸‰ä¸ªå±‚é¢è¯¦ç»†è§£é‡Šã€‚ ğŸ” ä¸€ã€ä¸ºä»€ä¹ˆ append åœ¨å¹¶å‘ä¸‹ä¸å®‰å…¨ï¼Ÿ æ ¸å¿ƒåŸå› ï¼šåˆ‡ç‰‡æ˜¯â€œå¼•ç”¨ç±»å‹ + å¯å˜ç»“æ„â€ ä¸€ä¸ªåˆ‡ç‰‡åœ¨åº•å±‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n1type slice struct { 2 ptr uintptr // æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ 3 len int // é•¿åº¦ 4 cap int // å®¹é‡ 5} å½“ä½ æ‰§è¡Œ s = append(s, x) æ—¶ï¼Œå¯èƒ½å‘ç”Ÿä¸¤ç§æƒ…å†µï¼š\næƒ…å†µ æ“ä½œ 1. å®¹é‡è¶³å¤Ÿ ç›´æ¥åœ¨åº•å±‚æ•°ç»„æœ«å°¾å†™å…¥æ–°å…ƒç´ ï¼Œlen++ 2. å®¹é‡ä¸è¶³ åˆ†é…æ–°æ•°ç»„ â†’ å¤åˆ¶æ—§æ•°æ® â†’ å†™å…¥æ–°å…ƒç´  â†’ æ›´æ–° ptr å’Œ cap âš ï¸ å¹¶å‘é£é™©ç‚¹ å¤šä¸ª goroutine åŒæ—¶ä¿®æ”¹ len / cap / ptr\nè¿™äº›å­—æ®µä¸æ˜¯åŸå­æ“ä½œ å¯èƒ½å‡ºç°â€œè¯»-æ”¹-å†™â€å†²çª æ‰©å®¹æ—¶æŒ‡é’ˆè¦†ç›–\nGoroutine A æ‰©å®¹åæ›´æ–°äº† s.ptr Goroutine B ä»ä½¿ç”¨æ—§ ptr å†™å…¥ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–å†™å…¥å·²é‡Šæ”¾å†…å­˜ åº•å±‚æ•°ç»„è¢«å¤šä¸ªåˆ‡ç‰‡å…±äº«\nå³ä½¿æ²¡æœ‰æ‰©å®¹ï¼Œå¤šä¸ª goroutine åŒæ—¶å†™å…¥åŒä¸€ä½ç½®ä¹Ÿä¼šå†²çª ğŸ§ª äºŒã€å¤ç°é—®é¢˜ï¼šå¹¶å‘ append çš„ç¾éš¾ ç¤ºä¾‹ä»£ç ï¼ˆå±é™©ï¼ï¼‰ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6) 7 8func main() { 9\tvar s []int 10\tvar wg sync.WaitGroup 11 12\tfor i := 0; i \u0026lt; 1000; i++ { 13\twg.Add(1) 14\tgo func(val int) { 15\tdefer wg.Done() 16\ts = append(s, val) // âŒ å¹¶å‘ append åŒä¸€ä¸ªåˆ‡ç‰‡ 17\t}(i) 18\t} 19 20\twg.Wait() 21\tfmt.Println(\u0026#34;Final length:\u0026#34;, len(s)) 22\tfmt.Println(\u0026#34;Expected: 1000, Got:\u0026#34;, len(s)) 23} å¯èƒ½çš„è¾“å‡ºï¼ˆæ¯æ¬¡è¿è¡Œç»“æœä¸åŒï¼‰ï¼š 1Final length: 892 2Expected: 1000, Got: 892 æˆ–è€…æ›´ç³Ÿï¼š\n1fatal error: concurrent map writes 2// å®é™…æ˜¯ slice å†…å­˜æŸåï¼Œå¯èƒ½è¡¨ç°ä¸ºå„ç§è¯¡å¼‚é”™è¯¯ ğŸ’¥ ä½¿ç”¨ -race æ£€æµ‹ï¼š\n1go run -race main.go ä¼šæ˜ç¡®æŠ¥å‘Š data raceï¼\nğŸ› ï¸ ä¸‰ã€å®‰å…¨è§£å†³æ–¹æ¡ˆ âœ… æ–¹æ¡ˆ 1ï¼šåŠ é”ï¼ˆæœ€å¸¸ç”¨ï¼‰ ä½¿ç”¨ sync.Mutex ä¿æŠ¤åˆ‡ç‰‡æ“ä½œï¼š\n1var mu sync.Mutex 2var s []int 3 4for i := 0; i \u0026lt; 1000; i++ { 5\twg.Add(1) 6\tgo func(val int) { 7\tdefer wg.Done() 8\tmu.Lock() 9\ts = append(s, val) // âœ… å®‰å…¨ 10\tmu.Unlock() 11\t}(i) 12} âœ… ä¼˜ç‚¹ï¼šç®€å•å¯é \nâš ï¸ ç¼ºç‚¹ï¼šé«˜å¹¶å‘ä¸‹å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ\nâœ… æ–¹æ¡ˆ 2ï¼šæ¯ä¸ª goroutine ç‹¬ç«‹åˆ‡ç‰‡ + åˆå¹¶ é€‚åˆâ€œå…ˆå¹¶è¡Œç”Ÿæˆï¼Œå†åˆå¹¶â€çš„åœºæ™¯ï¼š\n1var results [][]int 2var mu sync.Mutex 3 4for i := 0; i \u0026lt; 10; i++ { 5\twg.Add(1) 6\tgo func(id int) { 7\tdefer wg.Done() 8\tlocal := make([]int, 0, 100) 9\tfor j := 0; j \u0026lt; 100; j++ { 10\tlocal = append(local, id*100+j) 11\t} 12\tmu.Lock() 13\tresults = append(results, local) // åªéœ€ä¿æŠ¤ results 14\tmu.Unlock() 15\t}(i) 16} 17 18wg.Wait() 19 20// åˆå¹¶ 21var final []int 22for _, r := range results { 23\tfinal = append(final, r...) 24} âœ… ä¼˜ç‚¹ï¼šå‡å°‘é”ç«äº‰ï¼Œæé«˜å¹¶å‘åº¦\nâœ… é€‚ç”¨ï¼šMap-Reduce æ¨¡å¼\nâœ… æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ channel èšåˆ é€šè¿‡ channel é¡ºåºæ”¶é›†ç»“æœï¼š\n1ch := make(chan int, 1000) 2 3for i := 0; i \u0026lt; 1000; i++ { 4\twg.Add(1) 5\tgo func(val int) { 6\tdefer wg.Done() 7\tch \u0026lt;- val 8\t}(i) 9} 10 11// å…³é—­ channel 12go func() { 13\twg.Wait() 14\tclose(ch) 15}() 16 17// æ”¶é›†ç»“æœï¼ˆå• goroutineï¼‰ 18var s []int 19for val := range ch { 20\ts = append(s, val) 21} âœ… ä¼˜ç‚¹ï¼šæ— é”ã€å¤©ç„¶é¡ºåºï¼ˆå¦‚æœéœ€è¦ï¼‰\nâš ï¸ æ³¨æ„ï¼šchannel æœ‰ç¼“å†²ï¼Œé¿å…é˜»å¡\nâœ… æ–¹æ¡ˆ 4ï¼šé¢„åˆ†é…å®¹é‡ + åŸå­ç´¢å¼•ï¼ˆé«˜çº§ï¼‰ å¦‚æœçŸ¥é“æœ€ç»ˆé•¿åº¦ï¼Œå¯é¢„åˆ†é…å¹¶ä½¿ç”¨åŸå­æ“ä½œå†™å…¥ï¼š\n1const N = 1000 2s := make([]int, N) 3var index int64 // åŸå­è®¡æ•°å™¨ 4 5for i := 0; i \u0026lt; N; i++ { 6\twg.Add(1) 7\tgo func(val int) { 8\tdefer wg.Done() 9\tpos := atomic.AddInt64(\u0026amp;index, 1) - 1 10\ts[pos] = val // âœ… æ— ç«äº‰å†™å…¥ä¸åŒä½ç½® 11\t}(i) 12} 13wg.Wait() âœ… ä¼˜ç‚¹ï¼šæ— é”ã€é«˜æ€§èƒ½\nâš ï¸ è¦æ±‚ï¼šçŸ¥é“æ€»æ•°é‡ï¼Œä¸”å†™å…¥ä½ç½®ä¸é‡å \nğŸ“Œ å››ã€å…³é”®æ€»ç»“ é—®é¢˜ è¯´æ˜ æ ¹æœ¬åŸå›  åˆ‡ç‰‡çš„ len/cap/ptr ä¸æ˜¯åŸå­çš„ï¼Œappend å¯èƒ½ä¿®æ”¹è¿™äº›å­—æ®µ è¡¨ç°å½¢å¼ æ•°æ®ä¸¢å¤±ã€é•¿åº¦é”™è¯¯ã€ç¨‹åºå´©æºƒã€å†…å­˜æŸå æ£€æµ‹å·¥å…· ä¸€å®šè¦ç”¨ go run -race æ£€æŸ¥ data raceï¼ é€šç”¨åŸåˆ™ ä»»ä½•å¯å˜çŠ¶æ€åœ¨å¹¶å‘ä¸‹éƒ½å¿…é¡»åŒæ­¥ï¼Œåˆ‡ç‰‡ä¹Ÿä¸ä¾‹å¤– ğŸ’¡ æœ€ä½³å®è·µå»ºè®® é»˜è®¤å‡è®¾æ‰€æœ‰å…±äº«å˜é‡éƒ½ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ ä¼˜å…ˆä½¿ç”¨ channel ä¼ é€’æ•°æ®ï¼Œè€Œéå…±äº«å†…å­˜ å¦‚æœå¿…é¡»å…±äº«åˆ‡ç‰‡ï¼Œç”¨ mutex ä¿æŠ¤æ‰€æœ‰è®¿é—® é¿å…åœ¨åº“å‡½æ•°ä¸­è¿”å›å¯è¢«å¤–éƒ¨å¹¶å‘ä¿®æ”¹çš„åˆ‡ç‰‡ï¼ˆè€ƒè™‘è¿”å›å‰¯æœ¬ï¼‰ ğŸŒŸ Go è°šè¯­ï¼š\nâ€œDonâ€™t communicate by sharing memory, share memory by communicating.â€\nï¼ˆä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ã€‚ï¼‰\né€šè¿‡ç†è§£ append çš„åº•å±‚æœºåˆ¶å’Œæ­£ç¡®ä½¿ç”¨åŒæ­¥åŸè¯­ï¼Œä½ å°±èƒ½å†™å‡ºæ—¢é«˜æ•ˆåˆå®‰å…¨çš„å¹¶å‘ Go ç¨‹åºï¼\nGo è¯­è¨€ä¸­çš„ map åœ¨å¹¶å‘è¯»å†™æƒ…å†µä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå³ä½¿åªæ˜¯å¤šä¸ª goroutine åŒæ—¶è¯»å†™åŒä¸€ä¸ª mapï¼ˆå“ªæ€•åªæœ‰ä¸€ä¸ªå†™ï¼‰ï¼Œä¹Ÿä¼šå¯¼è‡´ æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ï¼Œè¿›è€Œå¯èƒ½å¼•å‘ï¼š ç¨‹åºå´©æºƒï¼ˆpanicï¼‰ æ•°æ®ä¸¢å¤±æˆ–æŸå æœªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚æ— é™å¾ªç¯ã€å†…å­˜é”™è¯¯ï¼‰ ğŸ” ä¸€ã€ä¸ºä»€ä¹ˆ Go çš„ map ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Ÿ å®˜æ–¹æ˜ç¡®è¯´æ˜ï¼š \u0026quot;Maps are not safe for concurrent use: it is not valid to read from and write to a map concurrently, even if the read and write are to different keys.\u0026quot;\nâ€”â€” Go å®˜æ–¹ FAQ\nåº•å±‚åŸå› ï¼š map æ˜¯å¤æ‚çš„æ•°æ®ç»“æ„ï¼ˆå“ˆå¸Œè¡¨ + æ¡¶ + overflow é“¾è¡¨ï¼‰ å†™æ“ä½œå¯èƒ½è§¦å‘æ‰©å®¹ï¼ˆrehashingï¼‰ï¼š åˆ†é…æ–°æ¡¶æ•°ç»„ é‡æ–°åˆ†å¸ƒæ‰€æœ‰é”®å€¼å¯¹ ä¿®æ”¹å†…éƒ¨æŒ‡é’ˆå’Œå…ƒæ•°æ® è¯»æ“ä½œåœ¨æ‰©å®¹è¿‡ç¨‹ä¸­å¯èƒ½è®¿é—®æ— æ•ˆå†…å­˜ âš ï¸ å³ä½¿ä½ â€œåªè¯»ä¸åŒ keyâ€ï¼Œåªè¦æœ‰ä¸€ä¸ª goroutine åœ¨å†™ï¼ˆæ’å…¥/åˆ é™¤/ä¿®æ”¹ï¼‰ï¼Œå°±å¯èƒ½å‘ç”Ÿ ç»“æ„å˜æ›´ï¼Œå¯¼è‡´å…¶ä»–è¯»æ“ä½œçœ‹åˆ°ä¸ä¸€è‡´çŠ¶æ€ã€‚\nğŸ§ª äºŒã€å¤ç°é—®é¢˜ï¼šå¹¶å‘ map å†™å…¥å´©æºƒ ç¤ºä¾‹ä»£ç ï¼ˆå±é™©ï¼ï¼‰ï¼š 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6) 7 8func main() { 9\tm := make(map[int]int) 10\tvar wg sync.WaitGroup 11 12\t// 1000 ä¸ª goroutine å¹¶å‘å†™å…¥ 13\tfor i := 0; i \u0026lt; 1000; i++ { 14\twg.Add(1) 15\tgo func(key int) { 16\tdefer wg.Done() 17\tm[key] = key * 10 // âŒ å¹¶å‘å†™ map 18\t}(i) 19\t} 20 21\twg.Wait() 22\tfmt.Println(\u0026#34;Map size:\u0026#34;, len(m)) 23} å¯èƒ½çš„ç»“æœï¼š ç¨‹åº panicï¼ˆæœ€å¸¸è§ï¼‰ï¼š\n1fatal error: concurrent map writes âœ… Go 1.6+ ç‰ˆæœ¬ä¼šä¸»åŠ¨æ£€æµ‹å¹¶å‘å†™å¹¶ panicï¼ˆé˜²æ­¢æ›´éšè”½çš„å†…å­˜é”™è¯¯ï¼‰\nä½¿ç”¨ -race æ£€æµ‹åˆ° data raceï¼š\n1go run -race main.go è¾“å‡ºï¼š\n1WARNING: DATA RACE 2Write at 0x00c0000a40f0 by goroutine 8: 3 runtime.mapassign_fast64() 4... å¶å°”â€œçœ‹ä¼¼æ­£å¸¸â€ä½†æ•°æ®ä¸¢å¤±ï¼ˆæ›´å±é™©ï¼ï¼‰ï¼š\nlen(m) å°äº 1000 æŸäº› key ä¸å­˜åœ¨æˆ–å€¼é”™è¯¯ ğŸ› ï¸ ä¸‰ã€å®‰å…¨ä½¿ç”¨ map çš„è§£å†³æ–¹æ¡ˆ âœ… æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ sync.Mutex æˆ– sync.RWMutexï¼ˆæœ€å¸¸ç”¨ï¼‰ 1type SafeMap struct { 2\tmu sync.RWMutex 3\tm map[int]int 4} 5 6func (sm *SafeMap) Set(key, value int) { 7\tsm.mu.Lock() 8\tdefer sm.mu.Unlock() 9\tsm.m[key] = value 10} 11 12func (sm *SafeMap) Get(key int) (int, bool) { 13\tsm.mu.RLock() 14\tdefer sm.mu.RUnlock() 15\tval, ok := sm.m[key] 16\treturn val, ok 17} 18 19// ä½¿ç”¨ 20sm := \u0026amp;SafeMap{m: make(map[int]int)} âœ… ä¼˜ç‚¹ï¼šç®€å•ã€é€šç”¨\nâš ï¸ æ³¨æ„ï¼šä¸è¦ç›´æ¥æš´éœ²å†…éƒ¨ mapï¼ˆé¿å…ç»•è¿‡é”ï¼‰\nâœ… æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ sync.Mapï¼ˆç‰¹å®šåœºæ™¯ï¼‰ Go 1.9+ æä¾›äº†å¹¶å‘å®‰å…¨çš„ sync.Mapï¼Œä½†ä¸æ˜¯ä¸‡èƒ½æ›¿ä»£å“ï¼\né€‚ç”¨åœºæ™¯ï¼ˆå®˜æ–¹å»ºè®®ï¼‰ï¼š è¯»è¿œå¤šäºå†™ key çš„é›†åˆæ˜¯å›ºå®šçš„ï¼ˆå¦‚é…ç½®é¡¹ï¼‰ å¤šä¸ª goroutine è®¿é—®ä¸åŒçš„ key ç¤ºä¾‹ï¼š 1var m sync.Map 2 3// å†™ 4m.Store(\u0026#34;key1\u0026#34;, 100) 5 6// è¯» 7if val, ok := m.Load(\u0026#34;key1\u0026#34;); ok { 8\tfmt.Println(val) 9} 10 11// åˆ é™¤ 12m.Delete(\u0026#34;key1\u0026#34;) âš ï¸ ä¸é€‚ç”¨åœºæ™¯ï¼š éœ€è¦éå† mapï¼ˆRange æ•ˆç‡ä½ï¼‰ éœ€è¦åŸå­æ“ä½œï¼ˆå¦‚ GetAndIncrementï¼‰ é«˜é¢‘å†™å…¥ï¼ˆæ€§èƒ½ä¸å¦‚å¸¦ mutex çš„æ™®é€š mapï¼‰ ğŸ“Š æ€§èƒ½å¯¹æ¯”ï¼š\nä½å¹¶å‘ or è¯»å¤šå†™å°‘ â†’ sync.Map é«˜å¹¶å‘å†™ or å¤æ‚æ“ä½œ â†’ mutex + map âœ… æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ channel ä¸²è¡ŒåŒ–è®¿é—®ï¼ˆActor æ¨¡å¼ï¼‰ 1type MapActor struct { 2\tdata map[string]int 3} 4 5func NewMapActor() *MapActor { 6\treturn \u0026amp;MapActor{data: make(map[string]int)} 7} 8 9func (ma *MapActor) Run(cmds \u0026lt;-chan Command, results chan\u0026lt;- Result) { 10\tfor cmd := range cmds { 11\tswitch cmd.Op { 12\tcase \u0026#34;set\u0026#34;: 13\tma.data[cmd.Key] = cmd.Value 14\tresults \u0026lt;- Result{Err: nil} 15\tcase \u0026#34;get\u0026#34;: 16\tval, ok := ma.data[cmd.Key] 17\tresults \u0026lt;- Result{Value: val, Found: ok} 18\t} 19\t} 20} 21 22// é€šè¿‡ channel å‘é€å‘½ä»¤ âœ… ä¼˜ç‚¹ï¼šæ— é”ã€é€»è¾‘æ¸…æ™°\nâš ï¸ ç¼ºç‚¹ï¼šå¢åŠ å¤æ‚åº¦ï¼Œä¸é€‚åˆé«˜é¢‘æ“ä½œ\nâœ… æ–¹æ¡ˆ 4ï¼šåˆ†ç‰‡é”ï¼ˆShardingï¼‰â€”â€”é«˜æ€§èƒ½åœºæ™¯ å°† map åˆ†æˆ N ä¸ª shardï¼Œæ¯ä¸ª shard ç‹¬ç«‹åŠ é”ï¼š\n1type ShardedMap struct { 2\tshards []struct { 3\tsync.RWMutex 4\tm map[string]int 5\t} 6} 7 8func NewShardedMap(shardCount int) *ShardedMap { 9\tsm := \u0026amp;ShardedMap{ 10\tshards: make([]struct{ sync.RWMutex; m map[string]int }, shardCount), 11\t} 12\tfor i := range sm.shards { 13\tsm.shards[i].m = make(map[string]int) 14\t} 15\treturn sm 16} 17 18func (sm *ShardedMap) getShard(key string) *struct{ sync.RWMutex; m map[string]int } { 19\t// ç®€å•å“ˆå¸Œå–æ¨¡ 20\th := fnv.New32a() 21\th.Write([]byte(key)) 22\treturn \u0026amp;sm.shards[h.Sum32()%uint32(len(sm.shards))] 23} 24 25func (sm *ShardedMap) Set(key string, value int) { 26\tshard := sm.getShard(key) 27\tshard.Lock() 28\tshard.m[key] = value 29\tshard.Unlock() 30} âœ… ä¼˜ç‚¹ï¼šå¤§å¹…é™ä½é”ç«äº‰\nâœ… é€‚ç”¨ï¼šé«˜å¹¶å‘ç¼“å­˜ï¼ˆå¦‚ Redis æ›¿ä»£æ–¹æ¡ˆï¼‰\nğŸ“Œ å››ã€å…³é”®æ€»ç»“ é—®é¢˜ è¯´æ˜ æ˜¯å¦å¹¶å‘å®‰å…¨ï¼Ÿ âŒ ç»å¯¹ä¸å®‰å…¨ï¼ å³ä½¿è¯»å†™ä¸åŒ key å´©æºƒè¡¨ç° fatal error: concurrent map writesï¼ˆGo 1.6+ï¼‰ æ£€æµ‹å·¥å…· å¿…é¡»ç”¨ go run -race æ£€æŸ¥ é€šç”¨åŸåˆ™ ä»»ä½•å…±äº«å¯å˜çŠ¶æ€éƒ½å¿…é¡»åŒæ­¥ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® é»˜è®¤è®¤ä¸º map ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ ä¼˜å…ˆè€ƒè™‘ sync.Mutex + mapï¼ˆç®€å•å¯é ï¼‰ ä»…åœ¨ç¬¦åˆåœºæ™¯æ—¶ä½¿ç”¨ sync.Map é¿å…è¿”å› map ç»™å¤–éƒ¨ä¿®æ”¹ï¼ˆè¿”å›å‰¯æœ¬æˆ–åªè¯»æ¥å£ï¼‰ æ°¸è¿œç”¨ -race æµ‹è¯•å¹¶å‘ä»£ç  ğŸŒŸ è®°ä½ï¼š\nâ€œGo maps are not concurrency-safe. Ever.â€\nï¼ˆGo çš„ map æ°¸è¿œä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ï¼‰\næ­£ç¡®å¤„ç†å¹¶å‘ mapï¼Œæ˜¯å†™å‡ºå¥å£® Go ç¨‹åºçš„åŸºæœ¬åŠŸï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œsync.Onceã€sync.Mutexã€sync.RWMutexã€sync.WaitGroup ç­‰åŒæ­¥åŸè¯­ï¼Œå³ä½¿åªå£°æ˜å˜é‡è€Œä¸æ˜¾å¼åˆå§‹åŒ–ï¼ˆå³ä½¿ç”¨é›¶å€¼ï¼‰ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œå¹¶ä¸”æ˜¯å®‰å…¨çš„ã€‚ è¿™æ˜¯ Go æ ‡å‡†åº“è®¾è®¡çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šè¿™äº›ç±»å‹çš„é›¶å€¼å°±æ˜¯â€œå·²å‡†å¤‡å¥½å¯ç”¨â€çš„çŠ¶æ€ã€‚\nâœ… ä¸€ã€ä¸ºä»€ä¹ˆå¯ä»¥ï¼Ÿ Go çš„ sync åŒ…ä¸­ï¼Œè¿™äº›ç±»å‹çš„ é›¶å€¼ï¼ˆzero valueï¼‰å·²ç»å¤„äºåˆæ³•ã€å¯æ“ä½œçš„åˆå§‹çŠ¶æ€ï¼š\nç±»å‹ é›¶å€¼çŠ¶æ€ æ˜¯å¦å¯ç”¨ sync.Once done: 0 âœ… å¯ç”¨ï¼Œå°šæœªæ‰§è¡Œè¿‡ sync.Mutex æœªé”å®šçŠ¶æ€ âœ… å¯ç”¨ï¼Œå¯ç›´æ¥ Lock() sync.RWMutex æœªé”å®šçŠ¶æ€ âœ… å¯ç”¨ sync.WaitGroup è®¡æ•°å™¨ä¸º 0 âœ… å¯ç”¨ï¼Œä½†éœ€å…ˆ Add(n) å† Wait() ğŸ“Œ Go å®˜æ–¹æ–‡æ¡£æ˜ç¡®è¯´æ˜ï¼š\nâ€œA Mutex must not be copied after first use.â€\nâ€œThe zero value for Once is an unlocked mutex ready for use.â€\nè¿™æ„å‘³ç€ä½ ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥å†™æˆï¼š\n1var mu = \u0026amp;sync.Mutex{} // âŒ ä¸å¿…è¦ï¼Œä¸”å®¹æ˜“è¯¯ copy 2var wg = new(sync.WaitGroup) // âŒ å¤šæ­¤ä¸€ä¸¾ è€Œæ˜¯ç›´æ¥ï¼š\n1var mu sync.Mutex // âœ… æ¨èï¼šé›¶å€¼å³ç”¨ 2var wg sync.WaitGroup // âœ… æ¨è ğŸ§ª äºŒã€ç¤ºä¾‹éªŒè¯ ç¤ºä¾‹ 1ï¼šsync.Mutex é›¶å€¼å¯ç”¨ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6) 7 8var mu sync.Mutex // æœªèµ‹å€¼ï¼Œé›¶å€¼ 9 10func main() { 11\tmu.Lock() 12\tfmt.Println(\u0026#34;Locked!\u0026#34;) 13\tmu.Unlock() 14} âœ… æ­£å¸¸è¿è¡Œï¼Œæ—  panicã€‚\nç¤ºä¾‹ 2ï¼šsync.WaitGroup é›¶å€¼å¯ç”¨ 1var wg sync.WaitGroup // é›¶å€¼ 2 3func main() { 4\twg.Add(1) 5\tgo func() { 6\tdefer wg.Done() 7\tfmt.Println(\u0026#34;Work done\u0026#34;) 8\t}() 9\twg.Wait() // âœ… æ­£å¸¸ç­‰å¾… 10} âœ… æ­£å¸¸è¿è¡Œã€‚\nâš ï¸ æ³¨æ„ï¼šå¦‚æœ WaitGroup è®¡æ•°å™¨ä¸º 0 æ—¶è°ƒç”¨ Wait()ï¼Œä¼šç«‹å³è¿”å›ï¼ˆåˆæ³•è¡Œä¸ºï¼‰ã€‚\nç¤ºä¾‹ 3ï¼šsync.Once é›¶å€¼å¯ç”¨ 1var once sync.Once // é›¶å€¼ 2 3func main() { 4\tonce.Do(func() { 5\tfmt.Println(\u0026#34;Executed once\u0026#34;) 6\t}) 7\tonce.Do(func() { 8\tfmt.Println(\u0026#34;This won\u0026#39;t print\u0026#34;) 9\t}) 10} âœ… è¾“å‡ºï¼šExecuted onceï¼Œç¬¦åˆé¢„æœŸã€‚\nâš ï¸ ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹ âŒ é”™è¯¯åšæ³•ï¼šå¤åˆ¶å·²ä½¿ç”¨çš„ sync å€¼ è™½ç„¶é›¶å€¼å¯ç”¨ï¼Œä½† ä¸€æ—¦ä½¿ç”¨è¿‡ï¼Œå°±ä¸èƒ½è¢«å¤åˆ¶ï¼ˆåŒ…æ‹¬ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å€¼ã€èµ‹å€¼ç»™å…¶ä»–å˜é‡ç­‰ï¼‰ï¼š\n1func badExample(mu sync.Mutex) { // âŒ ä¼ å€¼ï¼ä¼šå¤åˆ¶ 2\tmu.Lock() 3\t// ... 4} 5 6func main() { 7\tvar mu sync.Mutex 8\tbadExample(mu) // å¤åˆ¶äº†ä¸€ä¸ªæœªé”å®šçš„å‰¯æœ¬ï¼ŒåŸ mu æœªå—å½±å“ï¼ 9} ğŸ”¥ è¿™ä¼šå¯¼è‡´ é”å¤±æ•ˆ æˆ– panic: sync: inconsistent mutex state\nâœ… æ­£ç¡®åšæ³•ï¼šå§‹ç»ˆä¼ æŒ‡é’ˆæˆ–ä½¿ç”¨å…¨å±€/ç»“æ„ä½“å­—æ®µ\n1func goodExample(mu *sync.Mutex) { 2\tmu.Lock() 3\tdefer mu.Unlock() 4\t// ... 5} 6 7// æˆ–ä½œä¸ºç»“æ„ä½“å­—æ®µ 8type MyStruct struct { 9\tmu sync.Mutex // åµŒå…¥é›¶å€¼ï¼Œå®‰å…¨ 10} ğŸ“Œ å››ã€æ€»ç»“ é—®é¢˜ ç­”æ¡ˆ åªå£°æ˜ä¸èµ‹å€¼èƒ½ç”¨å—ï¼Ÿ âœ… èƒ½ï¼é›¶å€¼å°±æ˜¯åˆæ³•åˆå§‹çŠ¶æ€ éœ€è¦ new() æˆ– \u0026amp;sync.X{} å—ï¼Ÿ âŒ ä¸éœ€è¦ï¼Œåè€Œå®¹æ˜“å‡ºé”™ æœ€ä½³å®è·µ ç›´æ¥å£°æ˜ï¼švar wg sync.WaitGroup å”¯ä¸€ç¦å¿Œ ä¸è¦å¤åˆ¶å·²ä½¿ç”¨çš„ sync å€¼ï¼ˆä¼ å€¼ã€èµ‹å€¼ï¼‰ ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ Go å›¢é˜Ÿåˆ»æ„è®©è¿™äº›åŒæ­¥åŸè¯­çš„ é›¶å€¼å¯ç”¨ï¼Œæ˜¯ä¸ºäº†ï¼š\nç®€åŒ–ä»£ç ï¼ˆæ— éœ€æ˜¾å¼åˆå§‹åŒ–ï¼‰ é¿å… nil æŒ‡é’ˆé£é™© é¼“åŠ±å°†å®ƒä»¬ä½œä¸ºç»“æ„ä½“å­—æ®µç›´æ¥åµŒå…¥ ä¾‹å¦‚ï¼š\n1type Cache struct { 2\tmu sync.Mutex 3\titems map[string]interface{} 4} 5 6func NewCache() *Cache { 7\treturn \u0026amp;Cache{ 8\titems: make(map[string]interface{}), 9\t// mu è‡ªåŠ¨ä¸ºé›¶å€¼ï¼Œå·²å¯ç”¨ï¼ 10\t} 11} âœ… è¿™æ˜¯ idiomatic Go çš„æ ‡å‡†å†™æ³•ã€‚\nâœ… ç»“è®ºï¼šæ”¾å¿ƒä½¿ç”¨é›¶å€¼ï¼var once sync.Once å°±æ˜¯æœ€æ­£ç¡®ã€æœ€ç®€æ´çš„æ–¹å¼ã€‚\nåœ¨ Go è¯­è¨€ä¸­ï¼Œchannelï¼ˆé€šé“ï¼‰ æ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„æ ¸å¿ƒæœºåˆ¶ï¼Œéµå¾ª â€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€ çš„å“²å­¦ã€‚ ä¸‹é¢ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œè®²è§£ channel çš„ä½¿ç”¨ï¼Œå¹¶é‡ç‚¹è¯´æ˜ å¦‚ä½•ä¼˜é›…åœ°ä» channel å¾ªç¯å–å€¼ã€‚\nä¸€ã€Channel åŸºç¡€å›é¡¾ 1. åˆ›å»º channel 1ch := make(chan int) // æ— ç¼“å†² channel 2ch := make(chan int, 10) // æœ‰ç¼“å†² channelï¼ˆå®¹é‡ 10ï¼‰ 2. å‘é€ä¸æ¥æ”¶ 1ch \u0026lt;- 42 // å‘é€ 2x := \u0026lt;-ch // æ¥æ”¶ 3\u0026lt;-ch // æ¥æ”¶ä½†ä¸¢å¼ƒ 3. å…³é—­ channel 1close(ch) // å‘é€æ–¹å…³é—­ï¼Œè¡¨ç¤ºâ€œä¸å†å‘é€â€ âš ï¸ è§„åˆ™ï¼š\nåªæœ‰å‘é€æ–¹åº”è¯¥å…³é—­ channel ä¸èƒ½å‘å·²å…³é—­çš„ channel å‘é€æ•°æ®ï¼ˆpanicï¼‰ å¯ä»¥ä»å·²å…³é—­çš„ channel æ¥æ”¶å‰©ä½™æ•°æ®ï¼Œç›´åˆ°å–å®Œåè¿”å›é›¶å€¼ äºŒã€å¦‚ä½•ä¼˜é›…åœ°ä» channel å¾ªç¯å–å€¼ï¼Ÿ âœ… æ¨èæ–¹å¼ï¼šä½¿ç”¨ for range å¾ªç¯ 1for v := range ch { 2 // å¤„ç† v 3} ğŸŒŸ ä¼˜ç‚¹ï¼š è‡ªåŠ¨åœ¨ channel å…³é—­åé€€å‡ºå¾ªç¯ ä»£ç ç®€æ´ã€å¯è¯»æ€§å¼º é¿å…æ‰‹åŠ¨æ£€æŸ¥å…³é—­çŠ¶æ€ ğŸ“Œ å‰æï¼š å¿…é¡»ç”±å‘é€æ–¹ä¸»åŠ¨å…³é—­ channelï¼Œå¦åˆ™ for range ä¼šæ°¸è¿œé˜»å¡ï¼ ä¸‰ã€å®Œæ•´ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6) 7 8func producer(ch chan\u0026lt;- int, wg *sync.WaitGroup) { 9\tdefer wg.Done() 10\tfor i := 1; i \u0026lt;= 5; i++ { 11\tch \u0026lt;- i 12\t} 13\tclose(ch) // âœ… å…³é”®ï¼šå‘é€æ–¹å…³é—­ channel 14} 15 16func consumer(ch \u0026lt;-chan int) { 17\tfor v := range ch { // âœ… ä¼˜é›…å¾ªç¯å–å€¼ 18\tfmt.Println(\u0026#34;Received:\u0026#34;, v) 19\t} 20\tfmt.Println(\u0026#34;Channel closed, consumer exit.\u0026#34;) 21} 22 23func main() { 24\tch := make(chan int) 25\tvar wg sync.WaitGroup 26 27\twg.Add(1) 28\tgo producer(ch, \u0026amp;wg) 29\tgo consumer(ch) 30 31\twg.Wait() // ç­‰å¾…ç”Ÿäº§è€…å®Œæˆ 32} è¾“å‡ºï¼š\n1Received: 1 2Received: 2 3Received: 3 4Received: 4 5Received: 5 6Channel closed, consumer exit. ğŸ”‘ å…³é”®ç‚¹ï¼šproducer åœ¨å‘å®Œæ•°æ®å close(ch)ï¼Œconsumer çš„ for range è‡ªåŠ¨é€€å‡ºã€‚\nå››ã€å¸¸è§é”™è¯¯ä¸é™·é˜± âŒ é”™è¯¯ 1ï¼šå¿˜è®°å…³é—­ channel â†’ æ­»é” 1func badExample() { 2\tch := make(chan int) 3\tgo func() { 4\tch \u0026lt;- 1 5\t// å¿˜è®° close(ch)ï¼ 6\t}() 7\tfor v := range ch { 8\tfmt.Println(v) 9\t} // æ°¸è¿œä¸ä¼šé€€å‡ºï¼Œç¨‹åºå¡æ­» 10} âŒ é”™è¯¯ 2ï¼šæ¶ˆè´¹è€…å…³é—­ channelï¼ˆè¿åçº¦å®šï¼‰ 1// ä¸è¦è¿™æ ·åšï¼ 2go func() { 3 close(ch) // âŒ æ¶ˆè´¹è€…ä¸åº”å…³é—­ 4}() âŒ é”™è¯¯ 3ï¼šå¤šä¸ª goroutine åŒæ—¶å…³é—­åŒä¸€ä¸ª channel â†’ panic 1// å¤šä¸ªç”Ÿäº§è€…ï¼Ÿéœ€åè°ƒå…³é—­æ—¶æœºï¼ˆè§ä¸‹æ–‡â€œå¤šç”Ÿäº§è€…â€ï¼‰ äº”ã€é«˜çº§åœºæ™¯å¤„ç† åœºæ™¯ 1ï¼šå¤šä¸ªç”Ÿäº§è€…ï¼ˆMultiple Sendersï¼‰ å½“æœ‰å¤šä¸ª goroutine å‘åŒä¸€ä¸ª channel å‘é€æ•°æ®æ—¶ï¼Œä¸èƒ½è®©æ¯ä¸ªéƒ½ closeï¼ˆä¼š panicï¼‰ã€‚è§£å†³æ–¹æ¡ˆï¼š\nâœ… ä½¿ç”¨ sync.WaitGroup + å•ç‹¬çš„â€œå…³é—­ goroutineâ€ 1func multiProducer() { 2\tch := make(chan int) 3\tvar wg sync.WaitGroup 4 5\t// å¯åŠ¨å¤šä¸ªç”Ÿäº§è€… 6\tfor i := 0; i \u0026lt; 3; i++ { 7\twg.Add(1) 8\tgo func(id int) { 9\tdefer wg.Done() 10\tfor j := 0; j \u0026lt; 2; j++ { 11\tch \u0026lt;- id*10 + j 12\t} 13\t}(i) 14\t} 15 16\t// å•ç‹¬ goroutine è´Ÿè´£å…³é—­ 17\tgo func() { 18\twg.Wait() 19\tclose(ch) // âœ… æ‰€æœ‰ç”Ÿäº§è€…å®Œæˆåå…³é—­ 20\t}() 21 22\t// æ¶ˆè´¹è€… 23\tfor v := range ch { 24\tfmt.Println(v) 25\t} 26} åœºæ™¯ 2ï¼šå¸¦è¶…æ—¶æˆ– context æ§åˆ¶çš„å¾ªç¯ å¦‚æœæ— æ³•ä¿è¯ channel ä¼šè¢«å…³é—­ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ï¼‰ï¼Œå¯ç”¨ select + context å®‰å…¨é€€å‡ºï¼š\n1func safeConsumeWithTimeout(ch \u0026lt;-chan int, timeout time.Duration) { 2\tctx, cancel := context.WithTimeout(context.Background(), timeout) 3\tdefer cancel() 4 5\tfor { 6\tselect { 7\tcase v, ok := \u0026lt;-ch: 8\tif !ok { 9\tfmt.Println(\u0026#34;Channel closed\u0026#34;) 10\treturn 11\t} 12\tfmt.Println(\u0026#34;Got:\u0026#34;, v) 13\tcase \u0026lt;-ctx.Done(): 14\tfmt.Println(\u0026#34;Timeout!\u0026#34;) 15\treturn 16\t} 17\t} 18} ğŸ’¡ è¿™ç§æ–¹å¼é€‚ç”¨äºä¸ç¡®å®š channel æ˜¯å¦ä¼šè¢«å…³é—­çš„åœºæ™¯ã€‚\nåœºæ™¯ 3ï¼šéœ€è¦çŸ¥é“ channel æ˜¯å¦å…³é—­ï¼ˆæ‰‹åŠ¨æ£€æŸ¥ï¼‰ è™½ç„¶ for range æ›´ä¼˜é›…ï¼Œä½†æœ‰æ—¶éœ€è¦æ˜¾å¼åˆ¤æ–­ï¼š\n1for { 2 v, ok := \u0026lt;-ch 3 if !ok { 4 break // channel å·²å…³é—­ 5 } 6 // å¤„ç† v 7} ğŸ†š å¯¹æ¯”ï¼š\nfor rangeï¼šç®€æ´ï¼Œæ¨èé»˜è®¤ä½¿ç”¨ v, ok := \u0026lt;-chï¼šéœ€è¦é¢å¤–é€»è¾‘æ—¶ä½¿ç”¨ï¼ˆå¦‚è®°å½•å…³é—­äº‹ä»¶ï¼‰ å…­ã€æœ€ä½³å®è·µæ€»ç»“ åœºæ™¯ æ¨èåšæ³• å•ç”Ÿäº§è€… + å•/å¤šæ¶ˆè´¹è€… ç”Ÿäº§è€…å‘å®Œå close(ch)ï¼Œæ¶ˆè´¹è€…ç”¨ for range å¤šç”Ÿäº§è€… ç”¨ WaitGroup ç­‰å¾…æ‰€æœ‰ç”Ÿäº§è€…å®Œæˆï¼Œå†ç”±å•ç‹¬ goroutine close(ch) ä¸ç¡®å®šæ˜¯å¦å…³é—­ ç”¨ select + context æˆ–è¶…æ—¶æ§åˆ¶ æ€§èƒ½æ•æ„Ÿ é¿å…ä¸å¿…è¦çš„ channel å…³é—­æ£€æŸ¥ï¼Œä¼˜å…ˆç”¨ for range é”™è¯¯å¤„ç† channel é€šå¸¸åªä¼ æ•°æ®ï¼Œé”™è¯¯å»ºè®®é€šè¿‡ struct{value, error} ä¼ é€’ ğŸ’¡ ç»ˆæå£è¯€ â€œè°å‘é€ï¼Œè°å…³é—­ï¼›æ¶ˆè´¹è€…ç”¨ for rangeï¼›å¤šç”Ÿäº§è€…ï¼Œåè°ƒå…³ã€‚â€\néµå¾ªè¿™ä¸ªåŸåˆ™ï¼Œä½ å°±èƒ½å†™å‡ºå®‰å…¨ã€ä¼˜é›…ã€é«˜æ•ˆçš„ channel å¾ªç¯ä»£ç ï¼\nâœ… è®°ä½ï¼š\nfor v := range ch æ˜¯ Go ä¸­ä» channel å¾ªç¯å–å€¼çš„é»„é‡‘æ ‡å‡†ï¼Œåªè¦ç¡®ä¿å‘é€æ–¹é€‚æ—¶å…³é—­ channel å³å¯ã€‚\nåœ¨ Go è¯­è¨€ä¸­ï¼Œå®šæ—¶å™¨ï¼ˆTimerï¼‰ æ˜¯æ ‡å‡†åº“ time åŒ…æä¾›çš„ç”¨äºåœ¨å°†æ¥æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä¸€æ¬¡æ“ä½œçš„å·¥å…·ã€‚å®ƒä¸ Tickerï¼ˆå‘¨æœŸæ€§å®šæ—¶å™¨ï¼‰ ä¸åŒï¼ŒTimer åªè§¦å‘ä¸€æ¬¡ã€‚ ä¸€ã€æ ¸å¿ƒç±»å‹ï¼štime.Timer 1. åˆ›å»º Timer 1timer := time.NewTimer(d time.Duration) // d æ—¶é—´åè§¦å‘ 2. è§¦å‘ä¿¡å· Timer å†…éƒ¨æœ‰ä¸€ä¸ª channelï¼štimer.C å½“æ—¶é—´åˆ°è¾¾æ—¶ï¼Œä¼šå‘ C å‘é€å½“å‰æ—¶é—´ï¼ˆtime.Timeï¼‰ 3. åŸºæœ¬ä½¿ç”¨ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;time\u0026#34; 6) 7 8func main() { 9\tfmt.Println(\u0026#34;Start:\u0026#34;, time.Now()) 10 11\ttimer := time.NewTimer(2 * time.Second) 12 13\t// é˜»å¡ç­‰å¾…å®šæ—¶å™¨è§¦å‘ 14\t\u0026lt;-timer.C 15\tfmt.Println(\u0026#34;Timer fired:\u0026#34;, time.Now()) 16} è¾“å‡ºï¼š\n1Start: 2025-11-13 16:20:00.000... 2Timer fired: 2025-11-13 16:20:02.000... äºŒã€Timer çš„å¸¸ç”¨æ“ä½œ âœ… 1. åœæ­¢å®šæ—¶å™¨ï¼ˆStopï¼‰ é˜²æ­¢å®šæ—¶å™¨è§¦å‘ï¼ˆå¦‚æœå°šæœªè§¦å‘ï¼‰ï¼š\n1if !timer.Stop() { 2 // å¦‚æœè¿”å› falseï¼Œè¯´æ˜ timer å·²ç»è§¦å‘æˆ–å·²åœæ­¢ 3 // æ­¤æ—¶å¯èƒ½éœ€è¦ drain channel é¿å… goroutine æ³„æ¼ 4 \u0026lt;-timer.C 5} âš ï¸ é‡è¦ï¼šStop() è¿”å› false è¡¨ç¤ºå®šæ—¶å™¨å·²ç»å‘é€äº†å€¼åˆ° Cï¼Œæ­¤æ—¶å¦‚æœä¸è¯»å– Cï¼Œå¯èƒ½å¯¼è‡´æŒæœ‰è¯¥ channel çš„ goroutine æ³„æ¼ã€‚\nâœ… 2. é‡ç½®å®šæ—¶å™¨ï¼ˆResetï¼‰ é‡æ–°è®¾ç½®è§¦å‘æ—¶é—´ï¼ˆå¿…é¡»åœ¨ timer åœæ­¢æˆ–è§¦å‘åè°ƒç”¨ï¼‰ï¼š\n1timer := time.NewTimer(5 * time.Second) 2timer.Stop() // å…ˆåœæ­¢ 3timer.Reset(3 * time.Second) // é‡ç½®ä¸º 3 ç§’åè§¦å‘ 4 5\u0026lt;-timer.C 6fmt.Println(\u0026#34;Fired after reset\u0026#34;) â— æ³¨æ„ï¼šä¸èƒ½å¯¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸”æœªè§¦å‘çš„ timer ç›´æ¥ Resetï¼Œè¡Œä¸ºæœªå®šä¹‰ï¼ˆGo 1.14+ ä¼š panicï¼‰ã€‚\nä¸‰ã€ä¼˜é›…ä½¿ç”¨ Timer çš„æ¨¡å¼ æ¨¡å¼ 1ï¼šå¸¦è¶…æ—¶çš„ selectï¼ˆæœ€å¸¸è§ï¼ï¼‰ 1func doWithTimeout() { 2\tch := make(chan string) 3 4\tgo func() { 5\ttime.Sleep(3 * time.Second) // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ 6\tch \u0026lt;- \u0026#34;result\u0026#34; 7\t}() 8 9\ttimer := time.NewTimer(2 * time.Second) 10\tdefer timer.Stop() // âœ… ä¹ æƒ¯æ€§ defer Stop 11 12\tselect { 13\tcase res := \u0026lt;-ch: 14\tfmt.Println(\u0026#34;Got:\u0026#34;, res) 15\tcase \u0026lt;-timer.C: 16\tfmt.Println(\u0026#34;Timeout!\u0026#34;) 17\t} 18} ğŸ”‘ å…³é”®ï¼š\nä½¿ç”¨ defer timer.Stop() é¿å…èµ„æºæ³„æ¼ å³ä½¿ timer è§¦å‘äº†ï¼ŒStop() ä¹Ÿæ˜¯å®‰å…¨çš„ï¼ˆåªæ˜¯è¿”å› falseï¼‰ æ¨¡å¼ 2ï¼šå»¶è¿Ÿæ‰§è¡Œï¼ˆç±»ä¼¼ setTimeoutï¼‰ 1func delayedTask() { 2\ttimer := time.AfterFunc(2*time.Second, func() { 3\tfmt.Println(\u0026#34;Delayed task executed!\u0026#34;) 4\t}) 5 6\t// å¯é€‰æ‹©å–æ¶ˆ 7\t// timer.Stop() 8 9\ttime.Sleep(3 * time.Second) // ç­‰å¾…ä»»åŠ¡æ‰§è¡Œ 10} ğŸ’¡ time.AfterFunc æ˜¯ NewTimer + goroutine çš„å°è£…ï¼Œå†…éƒ¨è‡ªåŠ¨å¯åŠ¨ goroutine ç­‰å¾…å¹¶æ‰§è¡Œå‡½æ•°ã€‚\nå››ã€Timer vs Ticker vs After ç±»å‹ ç”¨é€” è§¦å‘æ¬¡æ•° æ˜¯å¦éœ€æ‰‹åŠ¨ç®¡ç† time.Timer å•æ¬¡å»¶è¿Ÿæ‰§è¡Œ 1 æ¬¡ âœ… éœ€ Stop() é¿å…æ³„æ¼ time.Ticker å‘¨æœŸæ€§æ‰§è¡Œ æ— é™æ¬¡ âœ… éœ€ Stop() time.After(d) å•æ¬¡è¶…æ—¶ channel 1 æ¬¡ âŒ æ— æ³•å–æ¶ˆï¼Œæ…ç”¨ âš ï¸ è­¦å‘Šï¼šé¿å…æ»¥ç”¨ time.After 1// âŒ å±é™©ï¼æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–° timerï¼Œæ— æ³• stopï¼Œå¯èƒ½å†…å­˜æ³„æ¼ 2select { 3case \u0026lt;-ch: 4case \u0026lt;-time.After(5 * time.Second): // æ¯æ¬¡éƒ½ new ä¸€ä¸ª timer 5} âœ… æ­£ç¡®åšæ³•ï¼ˆå¯å–æ¶ˆï¼‰ï¼š\n1// âœ… æ¨è 2timer := time.NewTimer(5 * time.Second) 3defer timer.Stop() 4select { 5case \u0026lt;-ch: 6case \u0026lt;-timer.C: 7} äº”ã€Timer å†…éƒ¨åŸç†ï¼ˆç®€è¦ï¼‰ Go runtime ç»´æŠ¤ä¸€ä¸ªå…¨å±€æœ€å°å †ï¼ˆå››å‰å †ï¼‰ å­˜å‚¨æ‰€æœ‰æ´»è·ƒ timer æ¯ä¸ª Pï¼ˆprocessorï¼‰æœ‰è‡ªå·±çš„ timer å †ï¼Œå‡å°‘é”ç«äº‰ï¼ˆGo 1.14+ ä¼˜åŒ–ï¼‰ å½“ timer åˆ°æœŸï¼Œruntime å‘å…¶ C channel å‘é€æ—¶é—´æˆ³ ğŸ“Œ æ‰€ä»¥å¤§é‡ Timer æ˜¯é«˜æ•ˆçš„ï¼Œä½†ä»éœ€åŠæ—¶ Stop ä¸å†éœ€è¦çš„ Timer\nå…­ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ âŒ é™·é˜± 1ï¼šå¿˜è®° Stop å¯¼è‡´å†…å­˜æ³„æ¼ 1// é”™è¯¯ï¼šæ²¡æœ‰ stop 2func bad() { 3\ttimer := time.NewTimer(10 * time.Second) 4\tselect { 5\tcase \u0026lt;-someChan: 6\treturn // timer æœª stopï¼Œå¯èƒ½æ³„æ¼ 7\tcase \u0026lt;-timer.C: 8\t} 9} âœ… æ­£ç¡®ï¼š\n1func good() { 2\ttimer := time.NewTimer(10 * time.Second) 3\tdefer timer.Stop() // âœ… æ€»æ˜¯ defer stop 4\tselect { 5\tcase \u0026lt;-someChan: 6\treturn 7\tcase \u0026lt;-timer.C: 8\t} 9} âŒ é™·é˜± 2ï¼šé‡å¤ Reset æœªåœæ­¢çš„ Timer 1timer := time.NewTimer(5 * time.Second) 2timer.Reset(3 * time.Second) // âŒ panic! (Go 1.14+) âœ… æ­£ç¡®ï¼š\n1timer := time.NewTimer(5 * time.Second) 2if !timer.Stop() { 3 \u0026lt;-timer.C // drain 4} 5timer.Reset(3 * time.Second) âœ… æœ€ä½³å®è·µæ€»ç»“ æ€»æ˜¯ defer timer.Stop() â€”â€” é˜²æ­¢èµ„æºæ³„æ¼ ä¼˜å…ˆä½¿ç”¨ NewTimer + selectï¼Œè€Œé time.After ä¸è¦å¯¹æ´»è·ƒ Timer ç›´æ¥ Resetï¼Œå…ˆ Stop å¤š goroutine å…±äº« Timerï¼Ÿé¿å…ï¼æ¯ä¸ª goroutine ç®¡ç†è‡ªå·±çš„ Timer è¶…æ—¶æ§åˆ¶é¦–é€‰ context.WithTimeoutï¼ˆæ›´é«˜å±‚æŠ½è±¡ï¼‰ ä¸ƒã€ç»“åˆ context çš„ç°ä»£å†™æ³•ï¼ˆæ¨èï¼‰ å¯¹äºç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œç­‰ï¼Œä¼˜å…ˆä½¿ç”¨ context æ§åˆ¶è¶…æ—¶ï¼š\n1ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second) 2defer cancel() 3 4req, _ := http.NewRequestWithContext(ctx, \u0026#34;GET\u0026#34;, \u0026#34;https://example.com\u0026#34;, nil) 5resp, err := http.DefaultClient.Do(req) 6if err != nil { 7 if ctx.Err() == context.DeadlineExceeded { 8 fmt.Println(\u0026#34;Request timeout\u0026#34;) 9 } 10} ğŸŒŸ context å†…éƒ¨ä¹Ÿä½¿ç”¨ Timerï¼Œä½†å°è£…æ›´å®‰å…¨ï¼Œä¸”èƒ½çº§è”å–æ¶ˆã€‚\nâœ… æ€»ç»“ åœºæ™¯ æ¨èæ–¹æ¡ˆ å•æ¬¡å»¶è¿Ÿæ‰§è¡Œ time.NewTimer + defer Stop() è¶…æ—¶æ§åˆ¶ select + timer.C æˆ– context.WithTimeout å‘¨æœŸæ€§ä»»åŠ¡ time.Ticker ç®€å•æµ‹è¯•/è„šæœ¬ time.Sleepï¼ˆéå¹¶å‘åœºæ™¯ï¼‰ æŒæ¡ time.Timer çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œæ˜¯å†™å‡ºå¥å£®ã€æ— æ³„æ¼ Go å¹¶å‘ç¨‹åºçš„å…³é”®ä¸€æ­¥ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œtime.Ticker æ˜¯æ ‡å‡†åº“ time åŒ…æä¾›çš„ç”¨äºå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„å®šæ—¶å™¨å·¥å…·ã€‚ä¸åªè§¦å‘ä¸€æ¬¡çš„ time.Timer ä¸åŒï¼ŒTicker ä¼šæŒ‰ç…§å›ºå®šé—´éš”æŒç»­å‘é€æ—¶é—´ä¿¡å·ï¼Œç›´åˆ°è¢«æ˜¾å¼åœæ­¢ã€‚ ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼štime.Ticker âœ… åŸºæœ¬ç»“æ„ 1type Ticker struct { 2 C \u0026lt;-chan Time // æ¥æ”¶æ—¶é—´ä¿¡å·çš„åªè¯» channel 3 // å†…éƒ¨åŒ…å«ä¸€ä¸ª timer å’Œè°ƒåº¦é€»è¾‘ 4} ğŸ”§ åˆ›å»º Ticker 1ticker := time.NewTicker(d time.Duration) // æ¯éš” d æ—¶é—´è§¦å‘ä¸€æ¬¡ âš ï¸ æ³¨æ„ï¼šç¬¬ä¸€æ¬¡è§¦å‘æ˜¯åœ¨ d æ—¶é—´åï¼Œä¸æ˜¯ç«‹å³è§¦å‘ã€‚\näºŒã€åŸºæœ¬ä½¿ç”¨ï¼šå‘¨æœŸæ€§æ‰“å° 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;time\u0026#34; 6) 7 8func main() { 9\tticker := time.NewTicker(1 * time.Second) 10\tdefer ticker.Stop() // âœ… å…³é”®ï¼šé˜²æ­¢èµ„æºæ³„æ¼ 11 12\tfor t := range ticker.C { 13\tfmt.Println(\u0026#34;Tick at:\u0026#34;, t.Format(\u0026#34;15:04:05\u0026#34;)) 14\t} 15} è¾“å‡ºï¼ˆæ¯ç§’ä¸€æ¬¡ï¼‰ï¼š\n1Tick at: 16:30:01 2Tick at: 16:30:02 3Tick at: 16:30:03 4... ğŸ”‘ å¿…é¡»è°ƒç”¨ ticker.Stop()ï¼å¦åˆ™å†…éƒ¨ goroutine å’Œ timer æ— æ³•é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\nä¸‰ã€ä¼˜é›…æ§åˆ¶ Ticker ç”Ÿå‘½å‘¨æœŸ åœºæ™¯ 1ï¼šè¿è¡Œä¸€æ®µæ—¶é—´ååœæ­¢ 1func runForDuration() { 2\tticker := time.NewTicker(500 * time.Millisecond) 3\tdefer ticker.Stop() 4 5\ttimeout := time.After(5 * time.Second) 6 7\tfor { 8\tselect { 9\tcase t := \u0026lt;-ticker.C: 10\tfmt.Println(\u0026#34;Tick:\u0026#34;, t) 11\tcase \u0026lt;-timeout: 12\tfmt.Println(\u0026#34;Time\u0026#39;s up!\u0026#34;) 13\treturn // è‡ªåŠ¨è§¦å‘ defer Stop() 14\t} 15\t} 16} åœºæ™¯ 2ï¼šé€šè¿‡ channel æ§åˆ¶åœæ­¢ï¼ˆæ¨èï¼‰ 1func controlledTicker(stopCh chan bool) { 2\tticker := time.NewTicker(1 * time.Second) 3\tdefer ticker.Stop() 4 5\tfor { 6\tselect { 7\tcase t := \u0026lt;-ticker.C: 8\tfmt.Println(\u0026#34;Working...\u0026#34;, t) 9\tcase \u0026lt;-stopCh: 10\tfmt.Println(\u0026#34;Stopped by signal\u0026#34;) 11\treturn 12\t} 13\t} 14} 15 16func main() { 17\tstopCh := make(chan bool) 18\tgo controlledTicker(stopCh) 19 20\ttime.Sleep(3 * time.Second) 21\tstopCh \u0026lt;- true // å‘é€åœæ­¢ä¿¡å· 22\ttime.Sleep(1 * time.Second) // ç­‰å¾…é€€å‡º 23} åœºæ™¯ 3ï¼šç»“åˆ contextï¼ˆç°ä»£ Go æ¨èæ–¹å¼ï¼‰ 1func tickerWithContext(ctx context.Context) { 2\tticker := time.NewTicker(1 * time.Second) 3\tdefer ticker.Stop() 4 5\tfor { 6\tselect { 7\tcase t := \u0026lt;-ticker.C: 8\tfmt.Println(\u0026#34;Tick with context:\u0026#34;, t) 9\tcase \u0026lt;-ctx.Done(): 10\tfmt.Println(\u0026#34;Context canceled:\u0026#34;, ctx.Err()) 11\treturn 12\t} 13\t} 14} 15 16func main() { 17\tctx, cancel := context.WithTimeout(context.Background(), 4*time.Second) 18\tdefer cancel() 19 20\ttickerWithContext(ctx) 21} ğŸŒŸ ä¼˜åŠ¿ï¼šå¯çº§è”å–æ¶ˆï¼Œé€‚åˆ HTTP handlerã€å¾®æœåŠ¡ç­‰åœºæ™¯ã€‚\nå››ã€Ticker vs Timer vs After ç‰¹æ€§ time.Ticker time.Timer time.After è§¦å‘æ¬¡æ•° å‘¨æœŸæ€§ï¼ˆæ— é™æ¬¡ï¼‰ å•æ¬¡ å•æ¬¡ å¯åœæ­¢ âœ… Stop() âœ… Stop() âŒ ä¸å¯å–æ¶ˆ èµ„æºç®¡ç† å¿…é¡» Stop() å»ºè®® Stop() è‡ªåŠ¨ GCï¼ˆä½†å¯èƒ½å»¶è¿Ÿï¼‰ å…¸å‹ç”¨é€” å¿ƒè·³ã€è½®è¯¢ã€å®šæ—¶ä»»åŠ¡ è¶…æ—¶ã€å»¶è¿Ÿæ‰§è¡Œ ç®€å•è¶…æ—¶ï¼ˆæ…ç”¨ï¼‰ äº”ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ âŒ é™·é˜± 1ï¼šå¿˜è®° Stop â†’ å†…å­˜æ³„æ¼ 1// é”™è¯¯ç¤ºä¾‹ 2func leakyTicker() { 3\tticker := time.NewTicker(1 * time.Second) 4\t// æ²¡æœ‰ Stopï¼ç¨‹åºç»“æŸå‰ ticker ä¸€ç›´è¿è¡Œ 5\tfor range ticker.C { 6\t// ... 7\tif someCondition { return } // æå‰é€€å‡ºä½†æœª Stop 8\t} 9} âœ… æ­£ç¡®åšæ³•ï¼š\n1func safeTicker() { 2\tticker := time.NewTicker(1 * time.Second) 3\tdefer ticker.Stop() // âœ… ä¿è¯é€€å‡ºæ—¶åœæ­¢ 4\tfor { 5\tselect { 6\tcase \u0026lt;-ticker.C: 7\tif done { return } 8\t} 9\t} 10} âŒ é™·é˜± 2ï¼šåœ¨å¾ªç¯ä¸­åˆ›å»º Tickerï¼ˆé«˜é¢‘æ³„æ¼ï¼‰ 1// ä¸¥é‡é”™è¯¯ï¼ 2for { 3 ticker := time.NewTicker(1 * time.Second) // æ¯æ¬¡å¾ªç¯ new ä¸€ä¸ª 4 \u0026lt;-ticker.C 5 // æ²¡æœ‰ Stopï¼Œå¿«é€Ÿæ³„æ¼ 6} âœ… æœ€ä½³å®è·µæ€»ç»“ æ€»æ˜¯ defer ticker.Stop() ä¸è¦åœ¨å¾ªç¯å†…åˆ›å»º Ticker ä¼˜å…ˆä½¿ç”¨ context æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ é¿å…ç”¨ Ticker å®ç°é«˜ç²¾åº¦å®šæ—¶ï¼ˆå—è°ƒåº¦å»¶è¿Ÿå½±å“ï¼‰ å¦‚æœåªéœ€æ‰§è¡Œ N æ¬¡ï¼Œå¯ç”¨ counter + Timer å…­ã€é«˜çº§æŠ€å·§ï¼šåŠ¨æ€è°ƒæ•´é—´éš”ï¼Ÿ âš ï¸ Ticker çš„é—´éš”æ˜¯å›ºå®šçš„ï¼Œæ— æ³•åŠ¨æ€ä¿®æ”¹ï¼\nå¦‚æœéœ€è¦åŠ¨æ€é—´éš”ï¼Œå¯ä»¥ï¼š\næ–¹æ¡ˆï¼šæ¯æ¬¡ Stop + NewTicker 1func dynamicTicker() { 2\tvar ticker *time.Ticker 3\tsetInterval := func(d time.Duration) { 4\tif ticker != nil { 5\tticker.Stop() 6\t} 7\tticker = time.NewTicker(d) 8\t} 9 10\tsetInterval(1 * time.Second) 11 12\tgo func() { 13\tfor { 14\t\u0026lt;-ticker.C 15\tfmt.Println(\u0026#34;Tick\u0026#34;) 16\t// åŠ¨æ€æ”¹å˜é—´éš” 17\tsetInterval(2 * time.Second) 18\t} 19\t}() 20 21\ttime.Sleep(10 * time.Second) 22\tticker.Stop() 23} ğŸ’¡ é€‚ç”¨äºé—´éš”å˜åŒ–ä¸é¢‘ç¹çš„åœºæ™¯ã€‚\nä¸ƒã€çœŸå®åº”ç”¨åœºæ™¯ åœºæ™¯ è¯´æ˜ æœåŠ¡å¿ƒè·³ä¸ŠæŠ¥ æ¯ 30 ç§’å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³ ç¼“å­˜è‡ªåŠ¨åˆ·æ–° æ¯ 5 åˆ†é’Ÿæ‹‰å–æœ€æ–°é…ç½® æ—¥å¿—è½®è½¬æ£€æŸ¥ æ¯å°æ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡åˆ†æ—¥å¿—æ–‡ä»¶ å¥åº·æ£€æŸ¥ å®šæœŸæ¢æµ‹ä¾èµ–æœåŠ¡çŠ¶æ€ æ¸¸æˆå¸§æ›´æ–° å›ºå®šå¸§ç‡é©±åŠ¨æ¸¸æˆé€»è¾‘ï¼ˆéœ€æ³¨æ„ç²¾åº¦ï¼‰ âœ… ç»ˆæå£è¯€ â€œTicker è¦ Stopï¼Œdefer æ˜¯å¥½æœ‹å‹ï¼›\nå‘¨æœŸæ€§ä»»åŠ¡å®ƒæœ€ç‰›ï¼Œcontext æ§åˆ¶æ›´é£æµã€‚â€\nåªè¦è®°ä½ åˆ›å»ºå¿… Stopï¼Œé€€å‡ºé  deferï¼Œä½ å°±èƒ½å®‰å…¨é«˜æ•ˆåœ°ä½¿ç”¨ time.Tickerï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œsync/atomic åŒ…æä¾›äº†åº•å±‚çš„åŸå­æ“ä½œï¼ˆAtomic Operationsï¼‰ï¼Œç”¨äºåœ¨ä¸ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼‰çš„æƒ…å†µä¸‹å®ç°å¹¶å‘å®‰å…¨çš„æ•°æ®è®¿é—®ã€‚å®ƒé€‚ç”¨äºå¯¹ç®€å•ç±»å‹ï¼ˆå¦‚ intã€boolã€æŒ‡é’ˆç­‰ï¼‰è¿›è¡Œæ— é”ç¼–ç¨‹ï¼ˆlock-free programmingï¼‰ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ atomicï¼Ÿ åœºæ™¯ï¼šå¤šä¸ª goroutine å¹¶å‘ä¿®æ”¹ä¸€ä¸ªæ•´æ•° 1var counter int64 2 3// âŒ å±é™©ï¼éåŸå­æ“ä½œ 4func increment() { 5 counter++ // å®é™…æ˜¯ï¼šè¯» â†’ +1 â†’ å†™ï¼Œä¸‰æ­¥éåŸå­ 6} åœ¨å¹¶å‘ä¸‹ä¼šå¯¼è‡´ æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ï¼Œç»“æœä¸å¯é¢„æµ‹ã€‚\nâœ… ä½¿ç”¨ atomic ä¿è¯æ“ä½œåŸå­æ€§ï¼š 1func increment() { 2 atomic.AddInt64(\u0026amp;counter, 1) // âœ… åŸå­åŠ  1 3} äºŒã€atomic æ”¯æŒçš„æ“ä½œç±»å‹ ç±»å‹ æ“ä½œå‡½æ•°ï¼ˆéƒ¨åˆ†ï¼‰ int32 LoadInt32, StoreInt32, AddInt32, SwapInt32, CompareAndSwapInt32 int64 LoadInt64, StoreInt64, AddInt64, ... uint32 / uint64 å¯¹åº”å‡½æ•° uintptr LoadUintptr, StoreUintptr, ... unsafe.Pointer LoadPointer, StorePointer, SwapPointer, CompareAndSwapPointer bool LoadBool, StoreBool âš ï¸ æ³¨æ„ï¼š\næ²¡æœ‰ float64 çš„åŸå­æ“ä½œï¼ˆéœ€ç”¨ Mutexï¼‰ ç»“æ„ä½“ä¸èƒ½ç›´æ¥åŸå­æ“ä½œï¼ˆä½†å¯æ“ä½œå…¶æŒ‡é’ˆï¼‰ ä¸‰ã€å¸¸ç”¨å‡½æ•°è¯¦è§£ 1. AddInt64(addr *int64, delta int64) int64 åŸå­åŠ æ³•ï¼Œè¿”å›æ–°å€¼\n1var count int64 2newVal := atomic.AddInt64(\u0026amp;count, 1) 3fmt.Println(\u0026#34;New count:\u0026#34;, newVal) 2. LoadInt64(addr *int64) int64 åŸå­è¯»å–\n1current := atomic.LoadInt64(\u0026amp;count) 3. StoreInt64(addr *int64, val int64) åŸå­å†™å…¥\n1atomic.StoreInt64(\u0026amp;count, 0) 4. CompareAndSwapInt64(addr *int64, old, new int64) bool CASï¼ˆCompare-And-Swapï¼‰ï¼šå¦‚æœå½“å‰å€¼ == oldï¼Œåˆ™è®¾ä¸º newï¼Œè¿”å›æ˜¯å¦æˆåŠŸ\n1// å°è¯•å°† count ä» 10 æ”¹ä¸º 20 2success := atomic.CompareAndSwapInt64(\u0026amp;count, 10, 20) 3if success { 4 fmt.Println(\u0026#34;CAS succeeded\u0026#34;) 5} ğŸ’¡ CAS æ˜¯å®ç°æ— é”æ•°æ®ç»“æ„ï¼ˆå¦‚é˜Ÿåˆ—ã€æ ˆï¼‰çš„åŸºç¡€ã€‚\nå››ã€å®Œæ•´ç¤ºä¾‹ï¼šå¹¶å‘å®‰å…¨è®¡æ•°å™¨ 1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync\u0026#34; 6\t\u0026#34;sync/atomic\u0026#34; 7) 8 9func main() { 10\tvar counter int64 11\tvar wg sync.WaitGroup 12 13\tfor i := 0; i \u0026lt; 1000; i++ { 14\twg.Add(1) 15\tgo func() { 16\tdefer wg.Done() 17\tatomic.AddInt64(\u0026amp;counter, 1) // âœ… åŸå­åŠ  18\t}() 19\t} 20 21\twg.Wait() 22\tfmt.Println(\u0026#34;Final counter:\u0026#34;, atomic.LoadInt64(\u0026amp;counter)) // 1000 23} âœ… è¾“å‡ºï¼šFinal counter: 1000ï¼ˆæ—  data raceï¼‰\nğŸ” ç”¨ -race éªŒè¯ï¼š\n1go run -race main.go # æ— è­¦å‘Š äº”ã€é«˜çº§ç”¨æ³•ï¼šåŸå­æŒ‡é’ˆï¼ˆunsafe.Pointerï¼‰ ç”¨äºåŸå­åœ°æ›´æ–°å¤æ‚å¯¹è±¡çš„å¼•ç”¨ï¼ˆå¦‚é…ç½®çƒ­æ›´æ–°ï¼‰ï¼š\n1package main 2 3import ( 4\t\u0026#34;fmt\u0026#34; 5\t\u0026#34;sync/atomic\u0026#34; 6\t\u0026#34;unsafe\u0026#34; 7) 8 9type Config struct { 10\tVersion int 11\tAddr string 12} 13 14var currentConfig unsafe.Pointer // æŒ‡å‘ *Config 15 16func init() { 17\tcfg := \u0026amp;Config{Version: 1, Addr: \u0026#34;localhost:8080\u0026#34;} 18\tatomic.StorePointer(\u0026amp;currentConfig, unsafe.Pointer(cfg)) 19} 20 21func GetConfig() *Config { 22\treturn (*Config)(atomic.LoadPointer(\u0026amp;currentConfig)) 23} 24 25func UpdateConfig(newCfg *Config) { 26\tatomic.StorePointer(\u0026amp;currentConfig, unsafe.Pointer(newCfg)) 27} 28 29func main() { 30\tfmt.Println(\u0026#34;Old:\u0026#34;, GetConfig().Addr) 31 32\tUpdateConfig(\u0026amp;Config{Version: 2, Addr: \u0026#34;127.0.0.1:9090\u0026#34;}) 33\tfmt.Println(\u0026#34;New:\u0026#34;, GetConfig().Addr) 34} âœ… ä¼˜åŠ¿ï¼šè¯»æ“ä½œå®Œå…¨æ— é”ï¼Œé€‚åˆé«˜é¢‘è¯»ã€ä½é¢‘æ›´æ–°åœºæ™¯ã€‚\nå…­ã€atomic vs Mutexï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ ç»´åº¦ atomic Mutex é€‚ç”¨ç±»å‹ ç®€å•æ ‡é‡ï¼ˆint, bool, pointerï¼‰ ä»»æ„ç±»å‹ï¼ˆstruct, slice, map ç­‰ï¼‰ æ€§èƒ½ âš¡ æé«˜ï¼ˆCPU åŸå­æŒ‡ä»¤ï¼‰ è¾ƒä½ï¼ˆæ¶‰åŠ goroutine è°ƒåº¦ï¼‰ åŠŸèƒ½ ä»…é™åŸºæœ¬æ“ä½œ å¯ä¿æŠ¤ä»»æ„å¤æ‚é€»è¾‘ æ˜“ç”¨æ€§ è¾ƒä½ï¼ˆéœ€ç†è§£å†…å­˜æ¨¡å‹ï¼‰ é«˜ï¼ˆLock/Unlock ç›´è§‚ï¼‰ å…¸å‹åœºæ™¯ è®¡æ•°å™¨ã€æ ‡å¿—ä½ã€æŒ‡é’ˆåˆ‡æ¢ ä¿æŠ¤ä¸´ç•ŒåŒºã€å¤æ‚çŠ¶æ€ ğŸ“Œ é€‰æ‹©å»ºè®®ï¼š å¦‚æœåªæ˜¯å¢å‡æ•´æ•°ã€è®¾ç½®å¸ƒå°”æ ‡å¿—ã€åˆ‡æ¢æŒ‡é’ˆ â†’ ç”¨ atomic å¦‚æœè¦ä¿æŠ¤ä¸€æ®µä»£ç é€»è¾‘æˆ–å¤æ‚æ•°æ®ç»“æ„ â†’ ç”¨ Mutex ä¸ƒã€é‡è¦æ³¨æ„äº‹é¡¹ 1. å¿…é¡»ä¼ æŒ‡é’ˆ 1var x int64 = 10 2atomic.AddInt64(\u0026amp;x, 1) // âœ… æ­£ç¡® 3// atomic.AddInt64(x, 1) // âŒ ç¼–è¯‘é”™è¯¯ 2. int vs int32/int64 åœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œint æ˜¯ 64 ä½ï¼›32 ä½ç³»ç»Ÿä¸Šæ˜¯ 32 ä½ Go è¦æ±‚ï¼šå¯¹ 64 ä½å€¼çš„åŸå­æ“ä½œï¼Œåœ°å€å¿…é¡» 8 å­—èŠ‚å¯¹é½ å®‰å…¨åšæ³•ï¼šæ˜¾å¼ä½¿ç”¨ int64 æˆ– int32 âš ï¸ é”™è¯¯ç¤ºä¾‹ï¼ˆåœ¨ 32 ä½æœºå™¨ä¸Šå¯èƒ½ panicï¼‰ï¼š\n1type Counter struct { 2 padding [4]byte // æœªå¯¹é½ 3 count int64 // å¯èƒ½æœª 8 å­—èŠ‚å¯¹é½ï¼ 4} âœ… æ­£ç¡®åšæ³•ï¼š\n1type Counter struct { 2\tcount int64 // æ”¾åœ¨ struct å¼€å¤´ï¼Œä¿è¯å¯¹é½ 3\tpadding [4]byte 4} æˆ–ä½¿ç”¨ aligncheck å·¥å…·æ£€æµ‹ã€‚\n3. atomic ä¸æ˜¯ä¸‡èƒ½çš„ ä¸èƒ½æ›¿ä»£ Mutex ä¿æŠ¤å¤åˆæ“ä½œ\n1// âŒ é”™è¯¯ï¼šä¸¤ä¸ªåŸå­æ“ä½œ â‰  åŸå­å¤åˆæ“ä½œ 2if atomic.LoadInt64(\u0026amp;x) == 0 { 3 atomic.StoreInt64(\u0026amp;x, 1) // å¯èƒ½è¢«å…¶ä»– goroutine æ’å…¥ 4} âœ… æ­£ç¡®ï¼šç”¨ CAS å®ç°\n1for { 2 old := atomic.LoadInt64(\u0026amp;x) 3 if old != 0 { 4 break 5 } 6 if atomic.CompareAndSwapInt64(\u0026amp;x, old, 1) { 7 break 8 } 9 // å¦åˆ™é‡è¯• 10} å…«ã€çœŸå®åº”ç”¨åœºæ™¯ åœºæ™¯ è¯´æ˜ è¯·æ±‚è®¡æ•°å™¨ atomic.AddInt64(\u0026amp;reqCount, 1) ä¼˜é›…å…³é—­æ ‡å¿— atomic.StoreBool(\u0026amp;shutdown, true) æ— é”é˜Ÿåˆ—/æ ˆ åŸºäº CAS å®ç°ï¼ˆå¦‚ chan åº•å±‚ä¼˜åŒ–ï¼‰ é…ç½®çƒ­æ›´æ–° åŸå­æŒ‡é’ˆåˆ‡æ¢ *Config æŒ‡æ ‡æ”¶é›† Prometheus client å†…éƒ¨å¤§é‡ä½¿ç”¨ atomic âœ… æ€»ç»“ï¼šæœ€ä½³å®è·µ ä¼˜å…ˆè€ƒè™‘ atomic ç”¨äºç®€å•ç±»å‹ï¼ˆæ€§èƒ½æ›´é«˜ï¼‰ å§‹ç»ˆä½¿ç”¨ int32/int64 è€Œé intï¼ˆé¿å…å¯¹é½é—®é¢˜ï¼‰ ç»“æ„ä½“ä¸­åŸå­å­—æ®µæ”¾æœ€å‰é¢ï¼ˆä¿è¯å†…å­˜å¯¹é½ï¼‰ å¤åˆæ“ä½œç”¨ CAS + å¾ªç¯é‡è¯• ä¸è¦è¯•å›¾ç”¨ atomic æ›¿ä»£ Mutex ä¿æŠ¤å¤æ‚é€»è¾‘ ğŸŒŸ è®°ä½ï¼š\nâ€œatomic is fast, but mutex is safe.â€\nï¼ˆåŸå­æ“ä½œå¿«ï¼Œä½†äº’æ–¥é”æ›´å®‰å…¨é€šç”¨ã€‚ï¼‰\nåˆç†ä½¿ç”¨ sync/atomicï¼Œèƒ½è®©ä½ çš„ Go ç¨‹åºåœ¨é«˜å¹¶å‘ä¸‹æ—¢é«˜æ•ˆåˆæ­£ç¡®ï¼\nGo è¯­è¨€çš„ Goroutine è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ æ˜¯ Go å¹¶å‘æ¨¡å‹çš„æ ¸å¿ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ç”¨æä½çš„æˆæœ¬åˆ›å»ºæˆåƒä¸Šä¸‡ä¸ªå¹¶å‘ä»»åŠ¡ï¼ˆGoroutineï¼‰ï¼Œè€Œæ— éœ€ç›´æ¥ç®¡ç†æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚å…¶è®¾è®¡ç›®æ ‡æ˜¯ï¼šé«˜æ•ˆã€å…¬å¹³ã€ä½å»¶è¿Ÿã€å¯æ‰©å±•ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Goroutine è°ƒåº¦å™¨ï¼Ÿ é—®é¢˜èƒŒæ™¯ï¼š æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ˆOS Threadï¼‰åˆ›å»ºæˆæœ¬é«˜ï¼ˆMB çº§æ ˆã€å†…æ ¸è°ƒåº¦å¼€é”€å¤§ï¼‰ ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ— æ³•æ”¯æ’‘ç™¾ä¸‡çº§å¹¶å‘ Go çš„è§£å†³æ–¹æ¡ˆï¼š M:N è°ƒåº¦æ¨¡å‹ â€”â€” å°† M ä¸ª Goroutine è°ƒåº¦åˆ° N ä¸ª OS çº¿ç¨‹ä¸Šæ‰§è¡Œ\nG (Goroutine)ï¼šç”¨æˆ·æ€è½»é‡çº§åç¨‹ï¼ˆKB çº§æ ˆï¼ŒåŠ¨æ€ä¼¸ç¼©ï¼‰ M (Machine)ï¼šOS çº¿ç¨‹ï¼ˆçœŸæ­£æ‰§è¡Œä»£ç çš„å®ä½“ï¼‰ P (Processor)ï¼šé€»è¾‘å¤„ç†å™¨ï¼ˆèµ„æºä¸Šä¸‹æ–‡ï¼ŒåŒ…å« G é˜Ÿåˆ—ï¼‰ ğŸŒŸ å…³é”®æ€æƒ³ï¼š\nâ€œGoroutine æ˜¯ç”¨æˆ·æ€çº¿ç¨‹ï¼Œç”± Go runtime è°ƒåº¦ï¼Œè€Œéæ“ä½œç³»ç»Ÿâ€\näºŒã€GMP æ¨¡å‹è¯¦è§£ 1. æ ¸å¿ƒç»„ä»¶ ç»„ä»¶ è¯´æ˜ G (Goroutine) å¾…æ‰§è¡Œçš„åç¨‹ï¼ŒåŒ…å«æ ˆã€çŠ¶æ€ã€å…¥å£å‡½æ•°ç­‰ M (Machine) ç»‘å®š OS çº¿ç¨‹ï¼Œè´Ÿè´£æ‰§è¡Œ G P (Processor) è°ƒåº¦å•å…ƒï¼ŒæŒæœ‰æœ¬åœ° G é˜Ÿåˆ—ï¼ˆrunqï¼‰ï¼Œå¿…é¡»ç»‘å®š M æ‰èƒ½è¿è¡Œ G 2. è°ƒåº¦å…³ç³» æ¯ä¸ª P æœ‰ä¸€ä¸ª æœ¬åœ° G é˜Ÿåˆ—ï¼ˆLocal Run Queueï¼‰ å…¨å±€è¿˜æœ‰ä¸€ä¸ª å…¨å±€ G é˜Ÿåˆ—ï¼ˆGlobal Run Queueï¼‰ M å¿…é¡»ç»‘å®š P æ‰èƒ½æ‰§è¡Œ Gï¼›è‹¥ M å› ç³»ç»Ÿè°ƒç”¨é˜»å¡ï¼ŒP å¯è¢«å…¶ä»– M æŠ¢å  1 +------------------+ 2 | Global | 3 | Run Queue | 4 +------------------+ 5 â–² 6 â”‚ 7+----+ +----+----+ +----+ 8| P1 |\u0026lt;--\u0026gt;| P2 |\u0026lt;--\u0026gt;| P3 | â† P çš„æ•°é‡ = GOMAXPROCSï¼ˆé»˜è®¤ CPU æ ¸æ•°ï¼‰ 9+----+ +----+----+ +----+ 10 â”‚ â”‚ â”‚ 11 â–¼ â–¼ â–¼ 12[M1] [M2] [M3] â† M çš„æ•°é‡åŠ¨æ€è°ƒæ•´ï¼ˆæœ€å¤š 10000ï¼‰ ä¸‰ã€è°ƒåº¦æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ æ­¥éª¤ 1ï¼šåˆ›å»º Goroutine æ–° G ä¼˜å…ˆæ”¾å…¥å½“å‰ P çš„ æœ¬åœ°é˜Ÿåˆ— è‹¥æœ¬åœ°é˜Ÿåˆ—æ»¡ï¼ˆå®¹é‡ 256ï¼‰ï¼Œåˆ™ä¸€åŠç§»åˆ° å…¨å±€é˜Ÿåˆ— æ­¥éª¤ 2ï¼šM æ‰§è¡Œ G M ç»‘å®š P ä» P çš„æœ¬åœ°é˜Ÿåˆ—å– G æ‰§è¡Œ è‹¥æœ¬åœ°é˜Ÿåˆ—ç©º â†’ å°è¯•ä» å…¨å±€é˜Ÿåˆ— å· G è‹¥å…¨å±€ä¹Ÿç©º â†’ å°è¯•ä» å…¶ä»– P çš„æœ¬åœ°é˜Ÿåˆ—å·ä¸€åŠ Gï¼ˆWork Stealingï¼‰ æ­¥éª¤ 3ï¼šG é˜»å¡æˆ–ç³»ç»Ÿè°ƒç”¨ ç½‘ç»œ I/O é˜»å¡ï¼šG è¢«æŒ‚èµ·ï¼ŒM ç»§ç»­æ‰§è¡Œå…¶ä»– Gï¼ˆéé˜»å¡ï¼ï¼‰ ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚æ–‡ä»¶ I/Oï¼‰ï¼š M é˜»å¡ï¼ŒP è¢«è§£ç»‘ runtime åˆ›å»ºæ–° M æˆ–å”¤é†’ç©ºé—² M ç»‘å®š Pï¼Œç»§ç»­è°ƒåº¦ åŸ M æ¢å¤åï¼Œè‹¥ P å·²è¢«å ç”¨ï¼Œåˆ™è¿›å…¥ä¼‘çœ  âœ… è¿™å°±æ˜¯ Go å®ç° é«˜å¹¶å‘ I/O çš„å…³é”®ï¼\nå››ã€å…³é”®ç‰¹æ€§ 1. Work Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰ ç©ºé—² P/M ä¼šä»å…¶ä»– P çš„é˜Ÿåˆ—â€œå·â€ä»»åŠ¡ å‡å°‘å…¨å±€é”ç«äº‰ï¼Œæé«˜ CPU åˆ©ç”¨ç‡ 2. Preemptionï¼ˆæŠ¢å å¼è°ƒåº¦ï¼‰ Go 1.14+ å¼•å…¥åŸºäºä¿¡å·çš„æŠ¢å  é˜²æ­¢æŸä¸ª G é•¿æ—¶é—´å ç”¨ CPUï¼ˆå¦‚æ­»å¾ªç¯ï¼‰ é€šè¿‡ sysmon ç›‘æ§ goroutine æ‰§è¡Œæ—¶é—´ 3. Handoffï¼ˆP äº¤æ¥ï¼‰ å½“ M å›  syscall é˜»å¡ï¼ŒP ä¼šç«‹å³äº¤ç»™å…¶ä»–ç©ºé—² M ä¿è¯ CPU ä¸ç©ºé—² 4. GOMAXPROCS æ§åˆ¶å¹¶è¡Œåº¦ 1runtime.GOMAXPROCS(n) // è®¾ç½® P çš„æ•°é‡ï¼ˆé»˜è®¤ = CPU æ ¸æ•°ï¼‰ ä¸æ˜¯é™åˆ¶ Goroutine æ•°é‡ï¼Œè€Œæ˜¯é™åˆ¶åŒæ—¶æ‰§è¡Œçš„ OS çº¿ç¨‹æ•° I/O å¯†é›†å‹å¯é€‚å½“è°ƒå¤§ï¼ŒCPU å¯†é›†å‹é€šå¸¸ç­‰äºæ ¸æ•° äº”ã€è°ƒåº¦å™¨æ¼”è¿›ï¼ˆå†å²ï¼‰ ç‰ˆæœ¬ è°ƒåº¦æ¨¡å‹ é—®é¢˜ Go 1.0 GM æ¨¡å‹ï¼ˆæ—  Pï¼‰ å…¨å±€é”ã€æ— æ³•å¹¶è¡Œã€syscall é˜»å¡æ•´ä¸ªç¨‹åº Go 1.1 å¼•å…¥ GMP æ¨¡å‹ è§£å†³å¹¶è¡Œå’Œ syscall é˜»å¡ Go 1.2+ Work Stealingã€æœ¬åœ°é˜Ÿåˆ— æå‡å¤šæ ¸åˆ©ç”¨ç‡ Go 1.14+ åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦ è§£å†³æ­»å¾ªç¯å¯¼è‡´çš„è°ƒåº¦é¥¥é¥¿ å…­ã€è°ƒè¯•ä¸ç›‘æ§è°ƒåº¦å™¨ 1. æŸ¥çœ‹è°ƒåº¦ç»Ÿè®¡ 1GODEBUG=schedtrace=1000 ./your_program è¾“å‡ºç¤ºä¾‹ï¼š\n1SCHED 0ms: gomaxprocs=8 idleprocs=6 threads=5 spinningthreads=0 ... 2. è·å–è°ƒåº¦ä¿¡æ¯ï¼ˆä»£ç ï¼‰ 1var stats debug.GCStats 2debug.ReadGCStats(\u0026amp;stats) 3// æˆ–ä½¿ç”¨ runtime.NumGoroutine() 3. æ€§èƒ½åˆ†æ 1import _ \u0026#34;net/http/pprof\u0026#34; 2 3// å¯åŠ¨åè®¿é—® /debug/pprof/goroutine ä¸ƒã€å¸¸è§è¯¯åŒºæ¾„æ¸… âŒ è¯¯åŒº 1ï¼šâ€œGoroutine æ˜¯çº¿ç¨‹â€ âœ… Goroutine æ˜¯ç”¨æˆ·æ€åç¨‹ï¼Œç”± Go runtime è°ƒåº¦ï¼Œæ¯”çº¿ç¨‹è½»é‡å¾—å¤šï¼ˆåˆå§‹æ ˆ 2KBï¼Œå¯åŠ¨æ€ä¼¸ç¼©è‡³ GBï¼‰\nâŒ è¯¯åŒº 2ï¼šâ€œGOMAXPROCS é™åˆ¶ Goroutine æ•°é‡â€ âœ… å®ƒåªé™åˆ¶åŒæ—¶è¿è¡Œçš„ OS çº¿ç¨‹æ•°ï¼ŒGoroutine æ•°é‡å¯è¾¾ç™¾ä¸‡çº§\nâŒ è¯¯åŒº 3ï¼šâ€œGoroutine ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºâ€ âœ… å¦‚æœ Goroutine é˜»å¡ï¼ˆå¦‚ channel æ— æ¥æ”¶è€…ï¼‰ï¼Œä¼šä¸€ç›´å­˜åœ¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼\nå…«ã€æœ€ä½³å®è·µ åœºæ™¯ å»ºè®® é¿å… Goroutine æ³„æ¼ ä½¿ç”¨ context æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ CPU å¯†é›†å‹ä»»åŠ¡ GOMAXPROCS = CPU æ ¸æ•° I/O å¯†é›†å‹ä»»åŠ¡ å¯ç•¥å¤§äº CPU æ ¸æ•°ï¼ˆä½†é€šå¸¸é»˜è®¤å³å¯ï¼‰ é•¿æ—¶é—´è¿è¡Œçš„ G é¿å…æ­»å¾ªç¯ï¼Œé€‚å½“åŠ å…¥ runtime.Gosched()ï¼ˆGo 1.14+ é€šå¸¸ä¸éœ€è¦ï¼‰ ç›‘æ§ Goroutine æ•°é‡ é€šè¿‡ pprof æˆ– runtime.NumGoroutine() ä¹ã€ä¸€å¥è¯æ€»ç»“ GMP è°ƒåº¦ â€œP æ˜¯è°ƒåº¦çš„â€˜èˆå°â€™ï¼ŒM æ˜¯â€˜æ¼”å‘˜â€™ï¼ˆOS çº¿ç¨‹ï¼‰ï¼ŒG æ˜¯â€˜å‰§æœ¬â€™ï¼ˆä»»åŠ¡ï¼‰ã€‚å½“æ¼”å‘˜å›  syscall ä¸‹å°ï¼Œèˆå°ç«‹å³æ¢æ–°æ¼”å‘˜ç»§ç»­è¡¨æ¼”ï¼›ç©ºé—²èˆå°è¿˜ä¼šå»åˆ«çš„èˆå°â€˜å·å‰§æœ¬â€™æ¥æ¼”ã€‚â€\nâœ… æŒæ¡ GMP æ¨¡å‹ï¼Œä½ å°±ç†è§£äº† Go é«˜å¹¶å‘çš„åº•å±‚å¯†ç ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œtime.Parse æ˜¯æ ‡å‡†åº“ time åŒ…æä¾›çš„ç”¨äºå°†å­—ç¬¦ä¸²è§£æä¸º time.Time ç±»å‹çš„æ ¸å¿ƒå‡½æ•°ã€‚å®ƒçš„è®¾è®¡éå¸¸ç‹¬ç‰¹â€”â€”ä½¿ç”¨â€œå‚è€ƒæ—¶é—´â€ï¼ˆReference Timeï¼‰ä½œä¸ºå¸ƒå±€æ¨¡æ¿ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„æ ¼å¼åŒ–ç¬¦å·ï¼ˆå¦‚ %Y-%m-%dï¼‰ã€‚ ä¸€ã€åŸºæœ¬è¯­æ³• 1func Parse(layout, value string) (Time, error) layoutï¼šæ ¼å¼æ¨¡æ¿ï¼ˆä¸æ˜¯æ ¼å¼ç¬¦ï¼ï¼‰ valueï¼šå¾…è§£æçš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸² è¿”å›ï¼štime.Time å’Œ error äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼šå‚è€ƒæ—¶é—´ï¼ˆReference Timeï¼‰ Go ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„â€œé­”æ³•æ—¶é—´â€ä½œä¸ºå¸ƒå±€åŸºå‡†ï¼š\nMon Jan 2 15:04:05 MST 2006\nå¯¹åº” Unix æ—¶é—´æˆ³ï¼š1136239445ï¼ˆå³ 2006-01-02 15:04:05 UTCï¼‰\nä¸ºä»€ä¹ˆé€‰è¿™ä¸ªæ—¶é—´ï¼Ÿ å®ƒåŒ…å«äº†æ‰€æœ‰æ—¶é—´å­—æ®µï¼Œä¸”æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯å”¯ä¸€æ•°å­—ï¼š å¹´ï¼š2006 æœˆï¼š01ï¼ˆJanï¼‰ æ—¥ï¼š02 æ—¶ï¼š15ï¼ˆ24å°æ—¶åˆ¶ï¼‰ åˆ†ï¼š04 ç§’ï¼š05 æ—¶åŒºï¼šMSTï¼ˆMountain Standard Timeï¼‰ âœ… è®°ä½å£è¯€ï¼š\nâ€œ2006å¹´1æœˆ2æ—¥ 15ç‚¹04åˆ†05ç§’â€\næˆ– â€œ01/02 03:04:05PM '06 -0700â€ï¼ˆ12å°æ—¶åˆ¶ç‰ˆæœ¬ï¼‰\nä¸‰ã€å¸¸ç”¨ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šæ ‡å‡† RFC3339 æ ¼å¼ 1t, err := time.Parse(time.RFC3339, \u0026#34;2025-11-17T10:30:00Z\u0026#34;) 2// ç­‰ä»·äº 3t, err := time.Parse(\u0026#34;2006-01-02T15:04:05Z07:00\u0026#34;, \u0026#34;2025-11-17T10:30:00Z\u0026#34;) ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰æ ¼å¼ 1// è§£æ \u0026#34;2025/11/17 10:30:45\u0026#34; 2t, err := time.Parse(\u0026#34;2006/01/02 15:04:05\u0026#34;, \u0026#34;2025/11/17 10:30:45\u0026#34;) 3 4// è§£æ \u0026#34;17-Nov-2025\u0026#34; 5t, err := time.Parse(\u0026#34;02-Jan-2006\u0026#34;, \u0026#34;17-Nov-2025\u0026#34;) 6 7// è§£æå¸¦ä¸­æ–‡ï¼Ÿä¸è¡Œï¼å¿…é¡»ç”¨è‹±æ–‡æœˆä»½ 8// âŒ é”™è¯¯ï¼štime.Parse(\u0026#34;2006å¹´01æœˆ02æ—¥\u0026#34;, \u0026#34;2025å¹´11æœˆ17æ—¥\u0026#34;) â†’ ä¼šå¤±è´¥ ç¤ºä¾‹ 3ï¼š12 å°æ—¶åˆ¶ + AM/PM 1t, err := time.Parse(\u0026#34;01/02/2006 03:04:05 PM\u0026#34;, \u0026#34;11/17/2025 10:30:45 AM\u0026#34;) ç¤ºä¾‹ 4ï¼šå¸¦æ—¶åŒºåç§» 1// è§£æ \u0026#34;2025-11-17 10:30:00 +0800\u0026#34; 2t, err := time.Parse(\u0026#34;2006-01-02 15:04:05 -0700\u0026#34;, \u0026#34;2025-11-17 10:30:00 +0800\u0026#34;) 3 4// æˆ–ç®€å†™ä¸º -070000ï¼ˆå¸¦ç§’ï¼‰ 5t, err := time.Parse(\u0026#34;2006-01-02 15:04:05 -070000\u0026#34;, \u0026#34;2025-11-17 10:30:00 +080000\u0026#34;) å››ã€é¢„å®šä¹‰å¸¸é‡ï¼ˆæ¨èä½¿ç”¨ï¼‰ Go æä¾›äº†å¸¸ç”¨æ ¼å¼çš„å¸¸é‡ï¼Œé¿å…æ‰‹å†™ layoutï¼š\nå¸¸é‡ å€¼ï¼ˆlayoutï¼‰ ç¤ºä¾‹ time.RFC3339 \u0026quot;2006-01-02T15:04:05Z07:00\u0026quot; \u0026quot;2025-11-17T10:30:00+08:00\u0026quot; time.RFC3339Nano å¸¦çº³ç§’ \u0026quot;2025-11-17T10:30:00.123456789+08:00\u0026quot; time.ANSIC \u0026quot;Mon Jan _2 15:04:05 2006\u0026quot; \u0026quot;Mon Nov 17 10:30:00 2025\u0026quot; time.UnixDate \u0026quot;Mon Jan _2 15:04:05 MST 2006\u0026quot; \u0026quot;Mon Nov 17 10:30:00 CST 2025\u0026quot; time.RFC822 \u0026quot;02 Jan 06 15:04 MST\u0026quot; \u0026quot;17 Nov 25 10:30 CST\u0026quot; âœ… æ¨èä¼˜å…ˆä½¿ç”¨è¿™äº›å¸¸é‡ï¼\näº”ã€å¸¸è§é”™è¯¯ä¸é™·é˜± âŒ é”™è¯¯ 1ï¼šæœˆä»½/æ˜ŸæœŸç”¨ä¸­æ–‡æˆ–æ•°å­— 1// âŒ å¤±è´¥ï¼æœˆä»½å¿…é¡»æ˜¯è‹±æ–‡ç¼©å†™ï¼ˆJan, Feb...ï¼‰ 2time.Parse(\u0026#34;2006-01-02\u0026#34;, \u0026#34;2025-åä¸€-17\u0026#34;) // error 3 4// âŒ å¤±è´¥ï¼ä¸èƒ½ç”¨ \u0026#34;11\u0026#34; è¡¨ç¤º November 5time.Parse(\u0026#34;2006-11-02\u0026#34;, \u0026#34;2025-11-17\u0026#34;) // error! layout ä¸­çš„ \u0026#34;11\u0026#34; è¢«å½“ä½œå­—é¢é‡ âœ… æ­£ç¡®ï¼š\n1time.Parse(\u0026#34;2006-01-02\u0026#34;, \u0026#34;2025-11-17\u0026#34;) // âœ… \u0026#34;01\u0026#34; è¡¨ç¤ºæœˆä»½å ä½ç¬¦ ğŸ”‘ å…³é”®ï¼šlayout ä¸­çš„ 01ã€Jan æ˜¯æ ¼å¼æŒ‡ç¤ºç¬¦ï¼Œä¸æ˜¯å­—é¢å€¼ï¼\nâŒ é”™è¯¯ 2ï¼šå¿½ç•¥æ—¶åŒºå¯¼è‡´æ—¶é—´åå·® 1// å­—ç¬¦ä¸²æ— æ—¶åŒº â†’ è§£æä¸ºæœ¬åœ°æ—¶åŒºï¼ˆLocalï¼‰ 2t, _ := time.Parse(\u0026#34;2006-01-02 15:04:05\u0026#34;, \u0026#34;2025-11-17 10:30:00\u0026#34;) 3fmt.Println(t.Location()) // Local 4 5// è‹¥éœ€ UTCï¼Œåº”æ˜¾å¼æŒ‡å®š 6t, _ = time.ParseInLocation(\u0026#34;2006-01-02 15:04:05\u0026#34;, \u0026#34;2025-11-17 10:30:00\u0026#34;, time.UTC) âŒ é”™è¯¯ 3ï¼šçº³ç§’ç²¾åº¦ä¸åŒ¹é… 1// å­—ç¬¦ä¸²æœ‰çº³ç§’ï¼Œä½† layout æ²¡æŒ‡å®š â†’ æˆªæ–­ 2t, _ := time.Parse(\u0026#34;2006-01-02 15:04:05\u0026#34;, \u0026#34;2025-11-17 10:30:00.123456789\u0026#34;) 3fmt.Println(t.Nanosecond()) // 0ï¼çº³ç§’è¢«ä¸¢å¼ƒ âœ… æ­£ç¡®ï¼š\n1t, _ := time.Parse(\u0026#34;2006-01-02 15:04:05.000000000\u0026#34;, \u0026#34;2025-11-17 10:30:00.123456789\u0026#34;) å…­ã€é«˜çº§ç”¨æ³• 1. åœ¨æŒ‡å®šæ—¶åŒºè§£æ 1loc, _ := time.LoadLocation(\u0026#34;Asia/Shanghai\u0026#34;) 2t, err := time.ParseInLocation(\u0026#34;2006-01-02 15:04:05\u0026#34;, \u0026#34;2025-11-17 10:30:00\u0026#34;, loc) 2. è§£æå¤šç§æ ¼å¼ï¼ˆå°è¯•åˆ—è¡¨ï¼‰ 1formats := []string{ 2 \u0026#34;2006-01-02\u0026#34;, 3 \u0026#34;02/01/2006\u0026#34;, 4 \u0026#34;2006/01/02\u0026#34;, 5} 6 7var t time.Time 8var err error 9for _, format := range formats { 10 if t, err = time.Parse(format, input); err == nil { 11 break 12 } 13} ä¸ƒã€ä¸ time.Format çš„å…³ç³» Parse å’Œ Format ä½¿ç”¨ç›¸åŒçš„ layout è§„åˆ™ å¯ä»¥è¿™æ ·è®°å¿†ï¼š â€œç”¨å‚è€ƒæ—¶é—´å» Formatï¼Œå¾—åˆ° Layoutï¼›å†ç”¨ Layout å» Parse å®é™…å­—ç¬¦ä¸²â€\n1// å‚è€ƒæ—¶é—´ 2ref := time.Date(2006, 1, 2, 15, 4, 5, 0, time.UTC) 3 4// è·å– layout 5layout := \u0026#34;2006-01-02\u0026#34; 6s := ref.Format(layout) // s == \u0026#34;2006-01-02\u0026#34; 7 8// ç”¨ç›¸åŒ layout è§£æ 9t, _ := time.Parse(layout, \u0026#34;2025-11-17\u0026#34;) âœ… æ€»ç»“ï¼šæœ€ä½³å®è·µ ç‰¢è®°å‚è€ƒæ—¶é—´ï¼šMon Jan 2 15:04:05 MST 2006 ä¼˜å…ˆä½¿ç”¨é¢„å®šä¹‰å¸¸é‡ï¼ˆå¦‚ time.RFC3339ï¼‰ æœˆä»½/æ˜ŸæœŸå¿…é¡»ç”¨è‹±æ–‡ï¼ˆJan, Monï¼‰ æ³¨æ„æ—¶åŒºå¤„ç†ï¼Œå¿…è¦æ—¶ç”¨ ParseInLocation éªŒè¯è§£æç»“æœï¼Œä¸è¦å¿½ç•¥ error ğŸ’¡ å°æŠ€å·§ï¼šåœ¨ä»£ç ä¸­ç›´æ¥å†™å‚è€ƒæ—¶é—´ä½œä¸ºæ³¨é‡Šï¼š\n1// layout: 2006-01-02 15:04:05 2t, err := time.Parse(\u0026#34;2006-01-02 15:04:05\u0026#34;, input) æŒæ¡ time.Parseï¼Œä½ å°±æŒæ¡äº† Go ä¸­æ—¶é—´å­—ç¬¦ä¸²å¤„ç†çš„é’¥åŒ™ï¼\nåœ¨ Go è¯­è¨€æ ‡å‡†åº“ log åŒ…ä¸­ï¼Œlog.Printã€log.Printf å’Œ log.Println æ˜¯ä¸‰ä¸ªå¸¸ç”¨çš„æ—¥å¿—è¾“å‡ºå‡½æ•°ï¼Œå®ƒä»¬éƒ½å‘æ ‡å‡†é”™è¯¯ï¼ˆos.Stderrï¼‰å†™å…¥å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—ï¼Œä½†å‚æ•°å¤„ç†æ–¹å¼å’Œè¾“å‡ºæ ¼å¼ç•¥æœ‰ä¸åŒã€‚ä¸‹é¢è¯¦ç»†è¯´æ˜å®ƒä»¬çš„åŒºåˆ«ï¼š ä¸€ã€å…±åŒç‚¹ âœ… ç›¸åŒè¡Œä¸ºï¼š\né»˜è®¤è¾“å‡ºåˆ° os.Stderr è‡ªåŠ¨åœ¨æ¯æ¡æ—¥å¿—å‰æ·»åŠ æ—¶é—´æˆ³ï¼ˆæ ¼å¼å¦‚ 2025/11/17 18:30:45ï¼‰ çº¿ç¨‹å®‰å…¨ï¼ˆå¯å¹¶å‘è°ƒç”¨ï¼‰ ä¸ä¼šç»ˆæ­¢ç¨‹åºï¼ˆä¸ log.Fatal ä¸åŒï¼‰ ğŸ“Œ ç¤ºä¾‹è¾“å‡ºæ ¼å¼ï¼š\n12025/11/17 18:30:45 Hello, world! äºŒã€åŒºåˆ«è¯¦è§£ å‡½æ•° ç­¾å è¡Œä¸º ç±»ä¼¼äº log.Print func Print(v ...interface{}) æŒ‰é»˜è®¤æ ¼å¼è¾“å‡ºå‚æ•°ï¼Œå‚æ•°é—´åŠ ç©ºæ ¼ï¼Œä¸è‡ªåŠ¨æ¢è¡Œï¼Ÿ â†’ å®é™…ä¼šæ¢è¡Œ fmt.Print + æ¢è¡Œ + æ—¶é—´æˆ³ log.Println func Println(v ...interface{}) è¾“å‡ºå‚æ•°ï¼Œå‚æ•°é—´åŠ ç©ºæ ¼ï¼Œæœ«å°¾å¼ºåˆ¶åŠ æ¢è¡Œ fmt.Println + æ—¶é—´æˆ³ log.Printf func Printf(format string, v ...interface{}) æŒ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼Œæœ«å°¾è‡ªåŠ¨æ¢è¡Œ fmt.Printf + æ¢è¡Œ + æ—¶é—´æˆ³ ğŸ” å…³é”®æ¾„æ¸…ï¼š\nå°½ç®¡åå­—å« Printï¼ˆä¸åƒ Println å¸¦ \u0026quot;ln\u0026quot;ï¼‰ï¼Œä½† log.Print å®é™…ä¸Šä¹Ÿä¼šåœ¨æœ«å°¾è¾“å‡ºæ¢è¡Œç¬¦ï¼\nè¿™æ˜¯ log åŒ…ä¸ fmt åŒ…çš„é‡è¦åŒºåˆ«ã€‚\nä¸‰ã€ä»£ç ç¤ºä¾‹å¯¹æ¯” 1package main 2 3import \u0026#34;log\u0026#34; 4 5func main() { 6\tname := \u0026#34;Alice\u0026#34; 7\tage := 30 8 9\tlog.Print(\u0026#34;Name:\u0026#34;, name, \u0026#34;Age:\u0026#34;, age) 10\tlog.Println(\u0026#34;Name:\u0026#34;, name, \u0026#34;Age:\u0026#34;, age) 11\tlog.Printf(\u0026#34;Name: %s, Age: %d\u0026#34;, name, age) 12} è¾“å‡ºç»“æœï¼š 12025/11/17 18:35:00 Name: Alice Age: 30 22025/11/17 18:35:00 Name: Alice Age: 30 32025/11/17 18:35:00 Name: Alice, Age: 30 ğŸ’¡ è§‚å¯Ÿï¼š\nPrint å’Œ Println è¾“å‡ºå‡ ä¹ä¸€æ ·ï¼ˆéƒ½åŠ ç©ºæ ¼ã€éƒ½æ¢è¡Œï¼‰ Printf æ”¯æŒæ ¼å¼æ§åˆ¶ï¼ˆå¦‚ %s, %dï¼‰ å››ã€æ·±å…¥ç»†èŠ‚ï¼šlog.Print vs log.Println è™½ç„¶ä¸¤è€…è¾“å‡ºçœ‹èµ·æ¥ç›¸åŒï¼Œä½†åœ¨å¤„ç†æ— å‚æ•°æˆ–ç‰¹æ®Šå€¼æ—¶æœ‰ç»†å¾®å·®åˆ«ï¼š\nåœºæ™¯ 1ï¼šæ— å‚æ•° 1log.Print() // è¾“å‡º: 2025/... (ç©ºè¡Œ) 2log.Println() // è¾“å‡º: 2025/... (ç©ºè¡Œ) â†’ ç»“æœç›¸åŒï¼ˆéƒ½è¾“å‡ºä¸€ä¸ªç©ºè¡Œï¼‰\nåœºæ™¯ 2ï¼šå•ä¸ªå­—ç¬¦ä¸²å«æ¢è¡Œ 1log.Print(\u0026#34;Hello\\nWorld\u0026#34;) 2// è¾“å‡º: 3// 2025/... Hello 4// World 5 6log.Println(\u0026#34;Hello\\nWorld\u0026#34;) 7// è¾“å‡º: 8// 2025/... Hello 9// World â†’ ä¹Ÿç›¸åŒï¼å› ä¸º Println åªåœ¨æœ«å°¾åŠ  \\nï¼Œä¸å½±å“å†…å®¹ä¸­çš„æ¢è¡Œã€‚\nâœ… ç»“è®ºï¼š åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œlog.Print å’Œ log.Println çš„è¾“å‡ºæ•ˆæœå®Œå…¨ä¸€è‡´ï¼Œå› ä¸º log.Print å†…éƒ¨å®ç°ä¹Ÿä¼šè¿½åŠ æ¢è¡Œã€‚\näº”ã€æºç ä½è¯ï¼ˆGo æ ‡å‡†åº“ï¼‰ æŸ¥çœ‹ log åŒ…æºç ï¼ˆlog/log.goï¼‰ï¼š\n1func Print(v ...interface{}) { 2\tstd.Output(2, fmt.Sprintln(v...)) // â† æ³¨æ„ï¼šç”¨äº† Sprintlnï¼ 3} 4 5func Println(v ...interface{}) { 6\tstd.Output(2, fmt.Sprintln(v...)) 7} 8 9func Printf(format string, v ...interface{}) { 10\tstd.Output(2, fmt.Sprintf(format, v...)+\u0026#34;\\n\u0026#34;) // â† æ‰‹åŠ¨åŠ  \\n 11} ğŸ”¥ çœŸç›¸ï¼š\nlog.Print å†…éƒ¨å®é™…è°ƒç”¨äº† fmt.Sprintlnï¼Œæ‰€ä»¥å®ƒå’Œ log.Println å®Œå…¨ç­‰ä»·ï¼\nè¿™æ„å‘³ç€ï¼š\n1log.Print(a, b, c) // == log.Println(a, b, c) å…­ã€å¦‚ä½•é€‰æ‹©ï¼Ÿ éœ€æ±‚ æ¨èå‡½æ•° ç®€å•è¾“å‡ºå˜é‡ï¼ˆæ— éœ€æ ¼å¼æ§åˆ¶ï¼‰ log.Print æˆ– log.Printlnï¼ˆä»»é€‰ï¼Œæ•ˆæœç›¸åŒï¼‰ éœ€è¦æ ¼å¼åŒ–è¾“å‡ºï¼ˆå¦‚ %s, %d, å¯¹é½ç­‰ï¼‰ log.Printf å¼ºè°ƒâ€œæ¯æ¡æ—¥å¿—ç‹¬ç«‹ä¸€è¡Œâ€ï¼ˆä»£ç å¯è¯»æ€§ï¼‰ log.Printlnï¼ˆè¯­ä¹‰æ›´æ¸…æ™°ï¼‰ ğŸ“ å»ºè®®ï¼š\nå¦‚æœåªæ˜¯æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œç”¨ log.Print è¶³å¤Ÿ å¦‚æœå›¢é˜Ÿè§„èŒƒè¦æ±‚æ˜ç¡®æ¢è¡Œè¯­ä¹‰ï¼Œç”¨ log.Println éœ€è¦æ§åˆ¶æ ¼å¼ï¼ˆå¦‚æ—¥å¿—ç»“æ„åŒ–ï¼‰ï¼Œç”¨ log.Printf ä¸ƒã€æ‰©å±•ï¼šè‡ªå®šä¹‰ Logger ä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ logger æ§åˆ¶è¾“å‡ºç›®æ ‡å’Œå‰ç¼€ï¼š\n1logger := log.New(os.Stdout, \u0026#34;[INFO] \u0026#34;, log.LstdFlags) 2logger.Print(\u0026#34;This goes to stdout with prefix\u0026#34;) âœ… æ€»ç»“ å‡½æ•° æ˜¯å¦æ¢è¡Œ å‚æ•°å¤„ç† æ¨èåœºæ™¯ log.Print âœ… æ˜¯ fmt.Sprintln(...) é€šç”¨æ—¥å¿— log.Println âœ… æ˜¯ fmt.Sprintln(...) å¼ºè°ƒæ¢è¡Œè¯­ä¹‰ log.Printf âœ… æ˜¯ fmt.Sprintf(...) + \u0026quot;\\n\u0026quot; æ ¼å¼åŒ–è¾“å‡º ğŸŒŸ ç»ˆæç»“è®ºï¼š\nlog.Print å’Œ log.Println åœ¨åŠŸèƒ½ä¸Šå®Œå…¨ç­‰ä»·ï¼Œéƒ½è¾“å‡ºå¸¦ç©ºæ ¼åˆ†éš”çš„å‚æ•°å¹¶æ¢è¡Œï¼›\nlog.Printf ç”¨äºéœ€è¦æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœºæ™¯ã€‚\næ”¾å¿ƒä½¿ç”¨ï¼Œå®ƒä»¬éƒ½æ˜¯å®‰å…¨ã€å¸¦æ—¶é—´æˆ³ã€è‡ªåŠ¨æ¢è¡Œçš„æ—¥å¿—è¾“å‡ºæ–¹å¼ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼ŒScanner æ˜¯æ ‡å‡†åº“ bufio åŒ…æä¾›çš„ä¸€ä¸ªé«˜æ•ˆã€æ˜“ç”¨çš„æ–‡æœ¬æ‰«æå™¨ï¼Œä¸»è¦ç”¨äºä»è¾“å…¥æµï¼ˆå¦‚æ–‡ä»¶ã€æ ‡å‡†è¾“å…¥ã€å­—ç¬¦ä¸²ç­‰ï¼‰ä¸­æŒ‰è¡Œæˆ–æŒ‰ token è¯»å–æ•°æ®ã€‚å®ƒç‰¹åˆ«é€‚åˆå¤„ç†é€è¡Œè¯»å–å¤§æ–‡ä»¶ã€è§£ææ—¥å¿—ã€è¯»å–ç”¨æˆ·è¾“å…¥ç­‰åœºæ™¯ã€‚ ä¸€ã€æ ¸å¿ƒç±»å‹ï¼šbufio.Scanner âœ… åŸºæœ¬ç‰¹ç‚¹ï¼š è‡ªåŠ¨ç¼“å†²ï¼šå†…éƒ¨ä½¿ç”¨ç¼“å†²åŒºï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ æŒ‰â€œtokenâ€åˆ†å‰²ï¼šé»˜è®¤æŒ‰è¡Œï¼ˆ\\nï¼‰åˆ†å‰²ï¼Œä¹Ÿå¯è‡ªå®šä¹‰åˆ†éš”ç¬¦ å†…å­˜å®‰å…¨ï¼šè‡ªåŠ¨å¤„ç†å¤§è¡Œï¼ˆä½†æœ‰é»˜è®¤ä¸Šé™ï¼‰ ç®€å• APIï¼šåªéœ€ Scan() + Text() / Bytes() äºŒã€åŸºæœ¬ç”¨æ³•ï¼šé€è¡Œè¯»å– ç¤ºä¾‹ 1ï¼šä»æ ‡å‡†è¾“å…¥è¯»å– 1package main 2 3import ( 4\t\u0026#34;bufio\u0026#34; 5\t\u0026#34;fmt\u0026#34; 6\t\u0026#34;os\u0026#34; 7) 8 9func main() { 10\tscanner := bufio.NewScanner(os.Stdin) 11\tfmt.Println(\u0026#34;Enter lines (type \u0026#39;quit\u0026#39; to exit):\u0026#34;) 12 13\tfor scanner.Scan() { 14\tline := scanner.Text() 15\tif line == \u0026#34;quit\u0026#34; { 16\tbreak 17\t} 18\tfmt.Println(\u0026#34;You entered:\u0026#34;, line) 19\t} 20 21\tif err := scanner.Err(); err != nil { 22\tfmt.Fprintln(os.Stderr, \u0026#34;Reading error:\u0026#34;, err) 23\t} 24} ç¤ºä¾‹ 2ï¼šè¯»å–æ–‡ä»¶ 1file, err := os.Open(\u0026#34;data.txt\u0026#34;) 2if err != nil { 3\tlog.Fatal(err) 4} 5defer file.Close() 6 7scanner := bufio.NewScanner(file) 8for scanner.Scan() { 9\tfmt.Println(scanner.Text()) 10} 11 12if err := scanner.Err(); err != nil { 13\tlog.Fatal(\u0026#34;Scan error:\u0026#34;, err) 14} ğŸ”‘ å…³é”®æ­¥éª¤ï¼š\nåˆ›å»º Scanner å¾ªç¯è°ƒç”¨ Scan()ï¼ˆè¿”å› false è¡¨ç¤º EOF æˆ–å‡ºé”™ï¼‰ ç”¨ Text() è·å–å½“å‰è¡Œï¼ˆå­—ç¬¦ä¸²ï¼‰æˆ– Bytes()ï¼ˆå­—èŠ‚åˆ‡ç‰‡ï¼‰ æœ€åæ£€æŸ¥ Err() æ˜¯å¦æœ‰é”™è¯¯ ä¸‰ã€Scanner çš„å·¥ä½œåŸç† æ‰«ææµç¨‹ï¼š è°ƒç”¨ Scan() â†’ å°è¯•è¯»å–ä¸‹ä¸€ä¸ª token å¦‚æœæˆåŠŸï¼š å†…éƒ¨ç¼“å­˜è¯¥ token è¿”å› true å¦‚æœé‡åˆ° EOFï¼š è¿”å› falseï¼Œä¸” Err() è¿”å› nil å¦‚æœå‘ç”Ÿ I/O é”™è¯¯ï¼š è¿”å› falseï¼Œä¸” Err() è¿”å›å…·ä½“é”™è¯¯ å››ã€è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼ˆSplitFuncï¼‰ é»˜è®¤æŒ‰è¡Œåˆ†å‰²ï¼ˆ\\nï¼‰ï¼Œä½†å¯é€šè¿‡ Scanner.Split() æ”¹å˜è¡Œä¸ºã€‚\nå¸¸è§ SplitFuncï¼š å‡½æ•° è¯´æ˜ bufio.ScanLines æŒ‰è¡Œï¼ˆé»˜è®¤ï¼‰ bufio.ScanWords æŒ‰ç©ºç™½å­—ç¬¦åˆ†å‰²å•è¯ bufio.ScanRunes æŒ‰ Unicode å­—ç¬¦ï¼ˆruneï¼‰ bufio.ScanBytes æŒ‰å•ä¸ªå­—èŠ‚ ç¤ºä¾‹ï¼šæŒ‰å•è¯è¯»å– 1scanner := bufio.NewScanner(strings.NewReader(\u0026#34;Go is awesome!\u0026#34;)) 2scanner.Split(bufio.ScanWords) 3 4for scanner.Scan() { 5\tfmt.Println(scanner.Text()) // è¾“å‡º: Go \\n is \\n awesome! 6} è‡ªå®šä¹‰ SplitFuncï¼ˆé«˜çº§ï¼‰ 1// æŒ‰åˆ†å· ; åˆ†å‰² 2scanner.Split(func(data []byte, atEOF bool) (advance int, token []byte, err error) { 3\tif i := bytes.IndexByte(data, \u0026#39;;\u0026#39;); i \u0026gt;= 0 { 4\treturn i + 1, data[:i], nil 5\t} 6\tif atEOF \u0026amp;\u0026amp; len(data) \u0026gt; 0 { 7\treturn len(data), data, nil 8\t} 9\treturn 0, nil, nil 10}) äº”ã€å¤„ç†å¤§è¡Œï¼ˆè¶…è¿‡ 64KBï¼‰ âš ï¸ é»˜è®¤é™åˆ¶ï¼š Scanner é»˜è®¤æœ€å¤§ token å¤§å°ä¸º 64KB è¶…è¿‡ä¼šæŠ¥é”™ï¼šbufio.Scanner: token too long âœ… è§£å†³æ–¹æ¡ˆï¼šå¢å¤§ç¼“å†²åŒº 1scanner := bufio.NewScanner(file) 2buf := make([]byte, 1024*1024) // 1MB buffer 3scanner.Buffer(buf, 1024*1024) 4 5for scanner.Scan() { 6\t// å¯å¤„ç†é•¿è¾¾ 1MB çš„è¡Œ 7} ğŸ“Œ Buffer(buf, max)ï¼š\nbufï¼šåˆå§‹ç¼“å†²åŒºï¼ˆå¯å¤ç”¨ï¼‰ maxï¼šæœ€å¤§ token é•¿åº¦ å…­ã€Scanner vs å…¶ä»–è¯»å–æ–¹å¼ æ–¹å¼ é€‚ç”¨åœºæ™¯ ä¼˜ç‚¹ ç¼ºç‚¹ bufio.Scanner æŒ‰è¡Œ/è¯è¯»å–æ–‡æœ¬ ç®€å•ã€é«˜æ•ˆã€å†…å­˜å®‰å…¨ ä¸èƒ½å¤„ç†è¶…å¤§ tokenï¼ˆéœ€é…ç½®ï¼‰ã€ä¸æ”¯æŒå›é€€ bufio.Reader.ReadLine éœ€è¦åŸå§‹è¡Œæ§åˆ¶ å¯è·å–æ˜¯å¦æˆªæ–­ API ç¹ç io.ReadAll ä¸€æ¬¡æ€§è¯»å®Œæ•´ä¸ªæ–‡ä»¶ ç®€å• å†…å­˜å ç”¨é«˜ï¼Œä¸é€‚åˆå¤§æ–‡ä»¶ os.ReadFile å°æ–‡ä»¶å…¨è¯»å…¥å†…å­˜ æç®€ åŒä¸Š âœ… æ¨èï¼š\n90% çš„æ–‡æœ¬è¡Œè¯»å–åœºæ™¯ï¼Œä¼˜å…ˆç”¨ Scanner\nä¸ƒã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ âŒ é™·é˜± 1ï¼šå¿½ç•¥ scanner.Err() 1// é”™è¯¯ï¼šåªæ£€æŸ¥ Scan() è¿”å›å€¼ 2for scanner.Scan() { 3\t// ... 4} 5// å¦‚æœä¸­é—´å‡ºé”™ï¼Œè¿™é‡Œæ— æ³•æ„ŸçŸ¥ï¼ âœ… æ­£ç¡®ï¼š\n1for scanner.Scan() { 2\t// process 3} 4if err := scanner.Err(); err != nil { 5\tlog.Fatal(err) // å¿…é¡»æ£€æŸ¥ï¼ 6} âŒ é™·é˜± 2ï¼šåœ¨å¾ªç¯ä¸­é‡ç”¨ Text() è¿”å›å€¼ 1var lines [][]byte 2for scanner.Scan() { 3\tlines = append(lines, scanner.Bytes()) // âŒ å±é™©ï¼åº•å±‚ buffer ä¼šè¢«è¦†ç›– 4} âœ… æ­£ç¡®ï¼ˆéœ€è¦æ‹·è´ï¼‰ï¼š\n1for scanner.Scan() { 2\tbuf := make([]byte, len(scanner.Bytes())) 3\tcopy(buf, scanner.Bytes()) 4\tlines = append(lines, buf) 5} 6// æˆ–ç›´æ¥ç”¨ Text() + å­˜ stringï¼ˆstring åœ¨ Go ä¸­ä¸å¯å˜ï¼Œå®‰å…¨ï¼‰ 7lines = append(lines, scanner.Text()) // âœ… å®‰å…¨ ğŸ’¡ è§„åˆ™ï¼š\nscanner.Bytes() è¿”å›çš„æ˜¯å†…éƒ¨ buffer çš„åˆ‡ç‰‡ï¼Œä¸‹æ¬¡ Scan() ä¼šè¦†ç›–ï¼\nå¦‚éœ€ä¿ç•™ï¼Œå¿…é¡» copy æˆ–è½¬ä¸º stringã€‚\nâœ… æœ€ä½³å®è·µæ€»ç»“ æ€»æ˜¯æ£€æŸ¥ scanner.Err() å¤„ç†å¤§è¡Œæ—¶è°ƒç”¨ Buffer() è®¾ç½®è¶³å¤Ÿå¤§å° ä¸è¦å­˜å‚¨ Bytes() çš„å¼•ç”¨ï¼Œè¦æ‹·è´æˆ–è½¬ string ä¼˜å…ˆç”¨ Text() è€Œé Bytes()ï¼ˆé™¤ééœ€è¦åŸå§‹å­—èŠ‚ï¼‰ æ–‡ä»¶è®°å¾— defer file.Close() å…«ã€çœŸå®åº”ç”¨åœºæ™¯ åœºæ™¯ ä»£ç è¦ç‚¹ æ—¥å¿—åˆ†æ Scanner + ScanLines é€è¡Œè§£æ CSV ç®€æ˜“è§£æ æŒ‰è¡Œè¯»ï¼Œå†ç”¨ strings.Split å‘½ä»¤è¡Œäº¤äº’ Scanner è¯» os.Stdin é…ç½®æ–‡ä»¶åŠ è½½ è¯» key=value è¡Œ ç½‘ç»œæµè§£æ ä» net.Conn åŒ…è£… bufio.Reader âœ… æ€»ç»“ bufio.Scanner æ˜¯ Go ä¸­è¯»å–æ–‡æœ¬æµçš„é¦–é€‰å·¥å…· â€”â€” ç®€å•ã€é«˜æ•ˆã€å®‰å…¨ã€‚\nè®°ä½ä¸‰æ­¥å£è¯€ï¼š\n1scanner := bufio.NewScanner(input) 2for scanner.Scan() { /* process scanner.Text() */ } 3if err := scanner.Err(); err != nil { /* handle error */ } åˆç†ä½¿ç”¨ Split() å’Œ Buffer()ï¼Œä½ å°±èƒ½è½»æ¾åº”å¯¹å„ç§æ–‡æœ¬è§£æä»»åŠ¡ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œstrconvï¼ˆstring convertï¼‰åŒ…æ˜¯æ ‡å‡†åº“ä¸­ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´é«˜æ•ˆã€å®‰å…¨åœ°ç›¸äº’è½¬æ¢çš„æ ¸å¿ƒå·¥å…·ã€‚å®ƒæä¾›äº†æ¯” fmt åŒ…æ›´è½»é‡ã€æ›´å¯æ§çš„è½¬æ¢æ–¹å¼ï¼Œå¹¿æ³›åº”ç”¨äºè§£æé…ç½®ã€å¤„ç†ç”¨æˆ·è¾“å…¥ã€åºåˆ—åŒ–/ååºåˆ—åŒ–ç­‰åœºæ™¯ã€‚ ä¸€ã€æ ¸å¿ƒåŠŸèƒ½åˆ†ç±» strconv åŒ…çš„å‡½æ•°ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š\nç±»åˆ« åŠŸèƒ½ å…¸å‹å‡½æ•° å­—ç¬¦ä¸² â†’ åŸºæœ¬ç±»å‹ è§£æï¼ˆParseï¼‰ ParseInt, ParseUint, ParseFloat, ParseBool åŸºæœ¬ç±»å‹ â†’ å­—ç¬¦ä¸² æ ¼å¼åŒ–ï¼ˆFormat / Appendï¼‰ FormatInt, FormatFloat, FormatBool, AppendInt, AppendFloat ç­‰ âœ… æ‰€æœ‰å‡½æ•°éƒ½æ˜¾å¼è¿”å› errorï¼Œé¿å… panicï¼Œé€‚åˆå¥å£®æ€§è¦æ±‚é«˜çš„ç¨‹åºã€‚\näºŒã€å­—ç¬¦ä¸² â†’ åŸºæœ¬ç±»å‹ï¼ˆParse ç³»åˆ—ï¼‰ 1. ParseInt(s string, base int, bitSize int) (i int64, err error) å°†å­—ç¬¦ä¸²è§£æä¸º æœ‰ç¬¦å·æ•´æ•° baseï¼šè¿›åˆ¶ï¼ˆ2~36ï¼‰ï¼Œ0 è¡¨ç¤ºè‡ªåŠ¨è¯†åˆ«ï¼ˆå¦‚ 0x â†’ 16ï¼Œ0 â†’ 8ï¼‰ bitSizeï¼šç»“æœä½å®½ï¼ˆ0, 8, 16, 32, 64ï¼‰ï¼Œç”¨äºæº¢å‡ºæ£€æŸ¥ 1n, err := strconv.ParseInt(\u0026#34;42\u0026#34;, 10, 64) // n = 42 2n, err = strconv.ParseInt(\u0026#34;-0xFF\u0026#34;, 0, 64) // n = -255ï¼ˆè‡ªåŠ¨è¯†åˆ«åå…­è¿›åˆ¶ï¼‰ 3n, err = strconv.ParseInt(\u0026#34;100\u0026#34;, 10, 8) // err: value out of rangeï¼ˆint8 æœ€å¤§ 127ï¼‰ 2. ParseUint(s string, base int, bitSize int) (uint64, error) è§£æä¸º æ— ç¬¦å·æ•´æ•° ä¸æ¥å—è´Ÿå· 1n, _ := strconv.ParseUint(\u0026#34;255\u0026#34;, 10, 8) // ok 2n, _ := strconv.ParseUint(\u0026#34;FF\u0026#34;, 16, 64) // n = 255 3. ParseFloat(s string, bitSize int) (float64, error) è§£ææµ®ç‚¹æ•° bitSizeï¼š32 æˆ– 64ï¼ˆç»“æœä¼šè½¬ä¸º float64ï¼Œä½†ä¼šæ£€æŸ¥æ˜¯å¦è¶…å‡º float32 èŒƒå›´ï¼‰ 1f, _ := strconv.ParseFloat(\u0026#34;3.1415\u0026#34;, 64) // f = 3.1415 2f, _ := strconv.ParseFloat(\u0026#34;1e5\u0026#34;, 64) // f = 100000 4. ParseBool(str string) (bool, error) ä¸¥æ ¼è§£æå¸ƒå°”å€¼ åªæ¥å—ï¼š\u0026quot;true\u0026quot;, \u0026quot;false\u0026quot;ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ 1b, _ := strconv.ParseBool(\u0026#34;TRUE\u0026#34;) // true 2b, _ := strconv.ParseBool(\u0026#34;1\u0026#34;) // error!ï¼ˆä¸åƒæŸäº›è¯­è¨€ï¼‰ âš ï¸ æ³¨æ„ï¼š\u0026quot;1\u0026quot;ã€\u0026quot;yes\u0026quot;ã€\u0026quot;on\u0026quot; ç­‰ä¸ä¼šè¢«è¯†åˆ«ä¸º true\nä¸‰ã€åŸºæœ¬ç±»å‹ â†’ å­—ç¬¦ä¸²ï¼ˆFormat ç³»åˆ—ï¼‰ 1. FormatInt(i int64, base int) string æ•´æ•°è½¬å­—ç¬¦ä¸² baseï¼š2~36 1s := strconv.FormatInt(42, 10) // \u0026#34;42\u0026#34; 2s = strconv.FormatInt(255, 16) // \u0026#34;ff\u0026#34; 3s = strconv.FormatInt(-10, 2) // \u0026#34;-1010\u0026#34; 2. FormatUint(i uint64, base int) string æ— ç¬¦å·æ•´æ•°è½¬å­—ç¬¦ä¸² 1s := strconv.FormatUint(255, 16) // \u0026#34;ff\u0026#34; 3. FormatFloat(f float64, fmt byte, prec, bitSize int) string æµ®ç‚¹æ•°è½¬å­—ç¬¦ä¸² fmtï¼šæ ¼å¼æ ‡è®°ï¼ˆ'f', 'e', 'g', 'E', 'G'ï¼‰ precï¼šç²¾åº¦ï¼ˆ-1 è¡¨ç¤ºæœ€çŸ­æ— æŸè¡¨ç¤ºï¼‰ bitSizeï¼š32 æˆ– 64ï¼ˆå½±å“èˆå…¥ï¼‰ 1s := strconv.FormatFloat(3.14159, \u0026#39;f\u0026#39;, 2, 64) // \u0026#34;3.14\u0026#34; 2s = strconv.FormatFloat(123456.0, \u0026#39;e\u0026#39;, 3, 64) // \u0026#34;1.235e+05\u0026#34; 3s = strconv.FormatFloat(1.23, \u0026#39;g\u0026#39;, -1, 64) // \u0026#34;1.23\u0026#34;ï¼ˆæœ€çŸ­è¡¨ç¤ºï¼‰ 4. FormatBool(b bool) string å¸ƒå°”å€¼è½¬å­—ç¬¦ä¸² 1s := strconv.FormatBool(true) // \u0026#34;true\u0026#34; å››ã€é«˜æ€§èƒ½è¿½åŠ ï¼ˆAppend ç³»åˆ—ï¼‰âœ… è¿™äº›å‡½æ•°å°†ç»“æœç›´æ¥è¿½åŠ åˆ° []byte æœ«å°¾ï¼Œé¿å…ä¸­é—´å­—ç¬¦ä¸²åˆ†é…ï¼Œé›¶ GC å‹åŠ›ã€‚\nå‡½æ•° è¯´æ˜ AppendInt(dst []byte, i int64, base int) []byte è¿½åŠ æ•´æ•° AppendUint(dst []byte, i uint64, base int) []byte è¿½åŠ æ— ç¬¦å·æ•´æ•° AppendFloat(dst []byte, f float64, fmt byte, prec, bitSize int) []byte è¿½åŠ æµ®ç‚¹æ•° AppendBool(dst []byte, b bool) []byte è¿½åŠ å¸ƒå°”å€¼ AppendQuote(dst []byte, s string) []byte è¿½åŠ å¸¦å¼•å·å’Œè½¬ä¹‰çš„å­—ç¬¦ä¸² 1buf := make([]byte, 0, 32) 2buf = append(buf, \u0026#34;ID=\u0026#34;...) 3buf = strconv.AppendInt(buf, 123, 10) // buf = []byte(\u0026#34;ID=123\u0026#34;) 4buf = strconv.AppendQuote(buf, \u0026#34;hello\\n\u0026#34;) // buf = []byte(\u0026#34;ID=123\\\u0026#34;hello\\\\n\\\u0026#34;\u0026#34;) ğŸŒŸ é€‚ç”¨åœºæ™¯ï¼šæ—¥å¿—åº“ã€JSON åºåˆ—åŒ–ã€ç½‘ç»œåè®®ç»„è£…ç­‰é«˜é¢‘æ“ä½œã€‚\näº”ã€å…¶ä»–å®ç”¨å‡½æ•° 1. Atoi(s string) (int, error) å¿«æ·å‡½æ•°ï¼šParseInt(s, 10, 0) çš„å°è£…ï¼ˆè¿”å› intï¼‰ åå­—æ¥è‡ª C è¯­è¨€ \u0026quot;ASCII to integer\u0026quot; 1n, err := strconv.Atoi(\u0026#34;42\u0026#34;) // n = 42 (int) 2. Itoa(i int) string å¿«æ·å‡½æ•°ï¼šFormatInt(int64(i), 10) çš„å°è£… 1s := strconv.Itoa(42) // \u0026#34;42\u0026#34; ğŸ’¡ æç¤ºï¼šAtoi / Itoa æ˜¯æœ€å¸¸ç”¨çš„æ•´æ•°è½¬æ¢å¿«æ·æ–¹å¼ã€‚\nå…­ã€é”™è¯¯å¤„ç† æ‰€æœ‰ Parse å‡½æ•°åœ¨å¤±è´¥æ—¶è¿”å›é nil errorï¼Œå¸¸è§é”™è¯¯ï¼š\né”™è¯¯ç±»å‹ è§¦å‘æ¡ä»¶ strconv.NumError æ•°å­—æ ¼å¼é”™è¯¯ã€æº¢å‡º syntax error éæ³•å­—ç¬¦ï¼ˆå¦‚ \u0026quot;12abc\u0026quot;ï¼‰ value out of range è¶…å‡ºç›®æ ‡ç±»å‹èŒƒå›´ 1if _, err := strconv.ParseInt(\u0026#34;999999999999999999999\u0026#34;, 10, 64); err != nil { 2 if numErr, ok := err.(*strconv.NumError); ok { 3 fmt.Println(\u0026#34;Func:\u0026#34;, numErr.Func) // \u0026#34;ParseInt\u0026#34; 4 fmt.Println(\u0026#34;Value:\u0026#34;, numErr.Num) // \u0026#34;999999999999999999999\u0026#34; 5 fmt.Println(\u0026#34;Err:\u0026#34;, numErr.Err) // \u0026#34;value out of range\u0026#34; 6 } 7} ä¸ƒã€strconv vs fmt ç‰¹æ€§ strconv fmt æ€§èƒ½ âš¡ æé«˜ï¼ˆæ— åå°„ã€æ— æ¥å£ï¼‰ è¾ƒä½ï¼ˆä½¿ç”¨ interface{} å’Œåå°„ï¼‰ æ§åˆ¶ç²’åº¦ ç²¾ç»†ï¼ˆè¿›åˆ¶ã€ç²¾åº¦ã€ä½å®½ï¼‰ é€šè¿‡æ ¼å¼å­—ç¬¦ä¸²ï¼ˆ%d, %fï¼‰ å†…å­˜åˆ†é… Format æœ‰åˆ†é…ï¼ŒAppend å¯é›¶åˆ†é… æ€»æ˜¯åˆ†é…æ–°å­—ç¬¦ä¸² é€‚ç”¨åœºæ™¯ é«˜é¢‘è½¬æ¢ã€åº•å±‚åº“ é€šç”¨æ ¼å¼åŒ–ã€è°ƒè¯•è¾“å‡º âœ… å»ºè®®ï¼š\nè§£æ/ç”Ÿæˆç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ JSONã€åè®®ï¼‰â†’ ç”¨ strconv è°ƒè¯•æ‰“å°ã€ç®€å•æ ¼å¼ â†’ ç”¨ fmt.Sprintf å…«ã€æœ€ä½³å®è·µæ€»ç»“ ä¼˜å…ˆä½¿ç”¨ strconv è€Œé fmt.Sscanf / fmt.Sprintf è¿›è¡Œç±»å‹è½¬æ¢ é«˜é¢‘è·¯å¾„ä½¿ç”¨ Append ç³»åˆ—å‡å°‘ GC å§‹ç»ˆæ£€æŸ¥ errorï¼Œä¸è¦å¿½ç•¥ æ•´æ•°è½¬æ¢å¸¸ç”¨ Atoi / Itoa å¿«æ·å‡½æ•° æ³¨æ„è¿›åˆ¶å’Œä½å®½å‚æ•°ï¼Œé¿å…æº¢å‡º âœ… ç»ˆæé€ŸæŸ¥è¡¨ è½¬æ¢æ–¹å‘ æ¨èå‡½æ•° string â†’ int strconv.Atoi æˆ– ParseInt(..., 10, 0) int â†’ string strconv.Itoa æˆ– FormatInt(..., 10) string â†’ float64 strconv.ParseFloat(s, 64) float64 â†’ string strconv.FormatFloat(f, 'g', -1, 64) `é«˜æ€§èƒ½æ‹¼æ¥** strconv.AppendInt(buf, x, 10) æŒæ¡ strconv åŒ…ï¼Œä½ å°±èƒ½å†™å‡ºé«˜æ•ˆã€å®‰å…¨ã€ä¸“ä¸šçº§çš„ Go æ•°æ®è½¬æ¢ä»£ç ï¼\nåœ¨ Go è¯­è¨€çš„ strconv åŒ…ä¸­ï¼ŒQuote ç³»åˆ—å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸¦å¼•å·çš„ã€å¯å®‰å…¨åµŒå…¥ Go æºç æˆ– JSON ç­‰æ ¼å¼çš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚å®ƒä»¬ä¼šè‡ªåŠ¨å¯¹ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚æ¢è¡Œã€å¼•å·ã€åæ–œæ ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰ï¼ˆescapingï¼‰ï¼Œç¡®ä¿è¾“å‡ºæ˜¯åˆæ³•ä¸”æ— æ­§ä¹‰çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ ä¸€ã€æ ¸å¿ƒ Quote å‡½æ•°æ¦‚è§ˆ å‡½æ•° ä½œç”¨ ç¤ºä¾‹è¾“å…¥ â†’ è¾“å‡º Quote(s string) string ç”¨åŒå¼•å·åŒ…è£¹ï¼Œè½¬ä¹‰å¿…è¦å­—ç¬¦ \u0026quot;he\\nllo\u0026quot; â†’ \u0026quot;\\\u0026quot;he\\\\nllo\\\u0026quot;\u0026quot; QuoteToASCII(s string) string åŒä¸Šï¼Œä½†é ASCII å­—ç¬¦è½¬ä¸º \\uXXXX \u0026quot;ä½ å¥½\u0026quot; â†’ \u0026quot;\\\u0026quot;\\u4f60\\u597d\\\u0026quot;\u0026quot; QuoteToGraphic(s string) string åŒä¸Šï¼Œä½†éå›¾å½¢å­—ç¬¦ï¼ˆå¦‚æ§åˆ¶ç¬¦ï¼‰è½¬ä¹‰ \u0026quot;\\x01\\x02\u0026quot; â†’ \u0026quot;\\\u0026quot;\\x01\\x02\\\u0026quot;\u0026quot; â†’ å®é™…è½¬ä¹‰ä¸º \u0026quot;\\\u0026quot;\\\\x01\\\\x02\\\u0026quot;\u0026quot; AppendQuote(dst []byte, s string) []byte å°† Quote ç»“æœè¿½åŠ åˆ° []byte é›¶åˆ†é…é«˜æ€§èƒ½ç‰ˆæœ¬ AppendQuoteToASCII / AppendQuoteToGraphic å¯¹åº” Append ç‰ˆæœ¬ â€” âœ… æ‰€æœ‰å‡½æ•°éƒ½ä½¿ç”¨ åŒå¼•å· \u0026quot; åŒ…è£¹ç»“æœã€‚\näºŒã€è¯¦ç»†è¯´æ˜ä¸ç¤ºä¾‹ 1. Quote(s string) string è½¬ä¹‰ä»¥ä¸‹å­—ç¬¦ï¼š \u0026quot; â†’ \\\u0026quot; \\ â†’ \\\\ åˆ¶è¡¨ç¬¦ \\t â†’ \\\\t æ¢è¡Œ \\n â†’ \\\\n å›è½¦ \\r â†’ \\\\r å…¶ä»–æ§åˆ¶å­—ç¬¦ï¼ˆ\u0026lt; 0x20 æˆ– \u0026gt;= 0x7Fï¼‰â†’ \\xXXï¼ˆåå…­è¿›åˆ¶ï¼‰ ä¿ç•™é ASCII å­—ç¬¦åŸæ ·ï¼ˆå¦‚ä¸­æ–‡ã€emojiï¼‰ 1fmt.Println(strconv.Quote(\u0026#34;hello\u0026#34;)) // \u0026#34;hello\u0026#34; 2fmt.Println(strconv.Quote(\u0026#34;he said \\\u0026#34;hi\\\u0026#34;\u0026#34;)) // \u0026#34;he said \\\u0026#34;hi\\\u0026#34;\u0026#34; 3fmt.Println(strconv.Quote(\u0026#34;line1\\nline2\u0026#34;)) // \u0026#34;line1\\nline2\u0026#34; 4fmt.Println(strconv.Quote(\u0026#34;cafÃ© ä½ å¥½ ğŸš€\u0026#34;)) // \u0026#34;cafÃ© ä½ å¥½ ğŸš€\u0026#34;ï¼ˆåŸæ ·ä¿ç•™ï¼‰ ğŸ” æ³¨æ„ï¼šè¾“å‡ºæœ¬èº«æ˜¯å¸¦åŒå¼•å·çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ‰“å°æ—¶çœ‹åˆ°çš„æ˜¯ \u0026quot;...\u0026quot;ã€‚\n2. QuoteToASCII(s string) string åœ¨ Quote åŸºç¡€ä¸Šï¼Œå°†æ‰€æœ‰é ASCII å­—ç¬¦ï¼ˆ\u0026gt;= U+0080ï¼‰è½¬ä¸º \\uXXXX æˆ– \\UXXXXXXXX ä¿è¯è¾“å‡ºä»…åŒ…å« ASCII å­—ç¬¦ï¼Œé€‚åˆéœ€è¦çº¯ ASCII çš„ç¯å¢ƒï¼ˆå¦‚æ—§ç³»ç»Ÿã€æŸäº›åè®®ï¼‰ 1s := \u0026#34;cafÃ© ä½ å¥½ ğŸš€\u0026#34; 2fmt.Println(strconv.QuoteToASCII(s)) 3// è¾“å‡º: \u0026#34;caf\\u00e9 \\u4f60\\u597d \\U0001f680\u0026#34; ğŸ’¡ åº”ç”¨åœºæ™¯ï¼š\nç”Ÿæˆå…¼å®¹æ€§æ›´å¼ºçš„ JSONï¼ˆè™½ç„¶ JSON æ ‡å‡†å…è®¸ UTF-8ï¼Œä½†æŸäº›è§£æå™¨è¦æ±‚ ASCIIï¼‰ æ—¥å¿—ç³»ç»Ÿè¦æ±‚çº¯ ASCII è¾“å‡º 3. QuoteToGraphic(s string) string è½¬ä¹‰éå›¾å½¢å­—ç¬¦ï¼ˆå³ä¸å¯æ‰“å°å­—ç¬¦ï¼Œå¦‚æ§åˆ¶ç¬¦ \\x00â€“\\x1fï¼‰ ä¿ç•™ ASCII å›¾å½¢å­—ç¬¦ï¼ˆ0x20â€“0x7Eï¼‰å’Œæ‰€æœ‰ Unicode å­—ç¬¦åŸæ · é€‚ç”¨äºéœ€è¦ä¿ç•™ emoji/ä¸­æ–‡ï¼Œä½†è¿‡æ»¤æ‰éšè—æ§åˆ¶ç¬¦çš„åœºæ™¯ 1s := \u0026#34;Hello\\x01World\\nğŸš€\u0026#34; 2fmt.Println(strconv.QuoteToGraphic(s)) 3// è¾“å‡º: \u0026#34;Hello\\x01World\\nğŸš€\u0026#34; 4// å®é™…è½¬ä¹‰å: \u0026#34;Hello\\\\x01World\\\\nğŸš€\u0026#34; ğŸ“Œ â€œå›¾å½¢å­—ç¬¦â€å®šä¹‰ï¼šUnicode ä¸­ IsGraphic(rune) è¿”å› true çš„å­—ç¬¦ã€‚\nä¸‰ã€Append ç³»åˆ—ï¼šé«˜æ€§èƒ½é›¶åˆ†é…ç‰ˆæœ¬ è¿™äº›å‡½æ•°å°†ç»“æœç›´æ¥è¿½åŠ åˆ° []byte åˆ‡ç‰‡æœ«å°¾ï¼Œé¿å…ä¸­é—´å­—ç¬¦ä¸²åˆ†é…ï¼Œé€‚åˆé«˜é¢‘æ—¥å¿—ã€åºåˆ—åŒ–ç­‰åœºæ™¯ã€‚\n1buf := make([]byte, 0, 64) 2buf = append(buf, \u0026#34;msg: \u0026#34;...) 3buf = strconv.AppendQuote(buf, \u0026#34;error: file not found\\n\u0026#34;) 4// buf ç°åœ¨åŒ…å«: []byte(`msg: \u0026#34;error: file not found\\n\u0026#34;`) 5 6// å†™å…¥æ–‡ä»¶æˆ–ç½‘ç»œ 7os.Stdout.Write(buf) å¯¹åº”å…³ç³»ï¼š\nAppendQuote â†” Quote AppendQuoteToASCII â†” QuoteToASCII AppendQuoteToGraphic â†” QuoteToGraphic å››ã€åå‘æ“ä½œï¼šUnquote strconv.Unquote(s string) (string, error) å¯å°† Quote ç”Ÿæˆçš„å­—ç¬¦ä¸²è¿˜åŸä¸ºåŸå§‹å†…å®¹ï¼š\n1quoted := `\u0026#34;he said \\\u0026#34;hi\\\u0026#34;\\n\u0026#34;` 2original, err := strconv.Unquote(quoted) 3if err != nil { 4 log.Fatal(err) 5} 6fmt.Println(original) // he said \u0026#34;hi\u0026#34;\u0026lt;æ¢è¡Œ\u0026gt; âš ï¸ æ³¨æ„ï¼š\nè¾“å…¥å¿…é¡»æ˜¯å¸¦å¼•å·çš„åˆæ³•å­—ç¬¦ä¸²å­—é¢é‡ æ”¯æŒå•å¼•å· '...'ï¼ˆä»…é™å•ä¸ªå­—ç¬¦ï¼Œå¦‚ 'a'ï¼‰ äº”ã€å…¸å‹åº”ç”¨åœºæ™¯ åœºæ™¯ æ¨èå‡½æ•° æ—¥å¿—è®°å½•ç”¨æˆ·è¾“å…¥ï¼ˆå«ç‰¹æ®Šå­—ç¬¦ï¼‰ Quote ç”Ÿæˆ Go æºç ç‰‡æ®µ Quote JSON åºåˆ—åŒ–å­—ç¬¦ä¸²å­—æ®µ Quoteï¼ˆæ ‡å‡†åº“ encoding/json å†…éƒ¨ä½¿ç”¨ç±»ä¼¼é€»è¾‘ï¼‰ è·¨ç³»ç»Ÿä¼ è¾“éœ€çº¯ ASCII QuoteToASCII å®‰å…¨æ˜¾ç¤ºç”¨æˆ·å†…å®¹ï¼ˆè¿‡æ»¤æ§åˆ¶ç¬¦ï¼‰ QuoteToGraphic é«˜æ€§èƒ½åè®®ç¼–ç  AppendQuote å…­ã€æ³¨æ„äº‹é¡¹ä¸é™·é˜± âŒ é™·é˜± 1ï¼šè¯¯ä»¥ä¸ºè¾“å‡ºä¸å¸¦å¼•å· 1s := strconv.Quote(\u0026#34;hello\u0026#34;) 2fmt.Println(s == \u0026#34;hello\u0026#34;) // false! 3fmt.Println(s) // \u0026#34;hello\u0026#34;ï¼ˆå¸¦åŒå¼•å·ï¼‰ âœ… æ­£ç¡®ç†è§£ï¼šQuote çš„ç»“æœæ˜¯Go å­—ç¬¦ä¸²å­—é¢é‡å½¢å¼ï¼ŒåŒ…å«å¼•å·ã€‚\nâŒ é™·é˜± 2ï¼šå¯¹å·²è½¬ä¹‰å­—ç¬¦ä¸²é‡å¤è½¬ä¹‰ 1s1 := \u0026#34;he said \\\u0026#34;hi\\\u0026#34;\u0026#34; 2s2 := strconv.Quote(s1) // â†’ \u0026#34;\\\u0026#34;he said \\\\\\\u0026#34;hi\\\\\\\u0026#34;\\\u0026#34;\u0026#34; 3// ä¸è¦å¯¹å·²è½¬ä¹‰å†…å®¹å†æ¬¡ Quoteï¼ âœ… æœ€ä½³å®è·µ åªå¯¹åŸå§‹ç”¨æˆ·è¾“å…¥è°ƒç”¨ Quote åœ¨éœ€è¦â€œå®‰å…¨æ˜¾ç¤ºâ€æˆ–â€œåµŒå…¥ä»£ç â€æ—¶ä½¿ç”¨ æ€§èƒ½æ•æ„Ÿåœºæ™¯ç”¨ AppendQuote éœ€è¦çº¯ ASCII æ—¶é€‰ QuoteToASCII ä¸ƒã€æ€»ç»“å¯¹æ¯”è¡¨ å‡½æ•° è½¬ä¹‰æ§åˆ¶ç¬¦ è½¬ä¹‰é ASCII è¾“å‡ºæ˜¯å¦çº¯ ASCII é€‚ç”¨åœºæ™¯ Quote âœ… âŒï¼ˆä¿ç•™åŸæ ·ï¼‰ âŒ é€šç”¨å®‰å…¨è½¬ä¹‰ QuoteToASCII âœ… âœ…ï¼ˆ\\uXXXXï¼‰ âœ… å…¼å®¹æ€§è¦æ±‚é«˜çš„ç¯å¢ƒ QuoteToGraphic âœ…ï¼ˆä»…æ§åˆ¶ç¬¦ï¼‰ âŒ âŒ ä¿ç•™ emoji/ä¸­æ–‡ï¼Œè¿‡æ»¤éšè—å­—ç¬¦ âœ… ç»ˆæå£è¯€ â€œç”¨æˆ·è¾“å…¥æœ‰é£é™©ï¼ŒQuote è½¬ä¹‰ä¿å¹³å®‰ï¼›\nè¦ä¼  ASCII ç”¨ ToASCIIï¼Œé«˜æ€§èƒ½å°± Append ä¸Šï¼â€\nåˆç†ä½¿ç”¨ strconv.Quote ç³»åˆ—å‡½æ•°ï¼Œèƒ½è®©ä½ çš„ç¨‹åºåœ¨å¤„ç†å­—ç¬¦ä¸²æ—¶æ›´å®‰å…¨ã€æ›´å¥å£®ã€æ›´ä¸“ä¸šï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œstrconv.Append ç³»åˆ—å‡½æ•°æ˜¯æ ‡å‡†åº“ strconv åŒ…æä¾›çš„ä¸€ç»„é«˜æ€§èƒ½ã€é›¶åˆ†é…ï¼ˆzero-allocationï¼‰ çš„å­—ç¬¦ä¸²è½¬æ¢å·¥å…·ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ï¼šå°†åŸºæœ¬ç±»å‹ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ï¼‰è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿½åŠ ï¼ˆappendï¼‰åˆ°å·²æœ‰çš„å­—èŠ‚åˆ‡ç‰‡ï¼ˆ[]byteï¼‰æœ«å°¾ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Append ç³»åˆ—ï¼Ÿ å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼ï¼š 1// ä¼ ç»Ÿæ–¹å¼ï¼šäº§ç”Ÿä¸­é—´å­—ç¬¦ä¸²ï¼Œå¯èƒ½è§¦å‘å†…å­˜åˆ†é… 2s := \u0026#34;count: \u0026#34; + strconv.Itoa(42) // åˆ†é…æ–°å­—ç¬¦ä¸² 3b := []byte(\u0026#34;value: \u0026#34; + strconv.FormatFloat(f, \u0026#39;g\u0026#39;, -1, 64)) // å¤šæ¬¡åˆ†é… ä½¿ç”¨ Appendï¼š 1// é›¶åˆ†é…ï¼ˆå¦‚æœåº•å±‚æ•°ç»„å®¹é‡è¶³å¤Ÿï¼‰ 2buf := make([]byte, 0, 64) 3buf = append(buf, \u0026#34;count: \u0026#34;...) 4buf = strconv.AppendInt(buf, 42, 10) // ç›´æ¥å†™å…¥ bufï¼Œæ— ä¸­é—´å­—ç¬¦ä¸² âœ… ä¼˜åŠ¿ï¼š\né¿å…åˆ›å»ºä¸´æ—¶å­—ç¬¦ä¸² å‡å°‘å†…å­˜åˆ†é…ï¼ˆGC å‹åŠ›å°ï¼‰ é€‚åˆé«˜é¢‘æ—¥å¿—ã€åºåˆ—åŒ–ã€ç½‘ç»œåè®®ç»„è£…ç­‰åœºæ™¯ äºŒã€å¸¸ç”¨ Append å‡½æ•°åˆ—è¡¨ å‡½æ•° ä½œç”¨ ç¤ºä¾‹ AppendInt(dst []byte, i int64, base int) []byte è¿½åŠ æ•´æ•° AppendInt(buf, 42, 10) â†’ \u0026quot;42\u0026quot; AppendUint(dst []byte, i uint64, base int) []byte è¿½åŠ æ— ç¬¦å·æ•´æ•° AppendUint(buf, 255, 16) â†’ \u0026quot;ff\u0026quot; AppendFloat(dst []byte, f float64, fmt byte, prec, bitSize int) []byte è¿½åŠ æµ®ç‚¹æ•° AppendFloat(buf, 3.14, 'g', -1, 64) AppendBool(dst []byte, b bool) []byte è¿½åŠ å¸ƒå°”å€¼ AppendBool(buf, true) â†’ \u0026quot;true\u0026quot; AppendQuote(dst []byte, s string) []byte è¿½åŠ å¸¦å¼•å·çš„å­—ç¬¦ä¸²ï¼ˆè½¬ä¹‰ï¼‰ AppendQuote(buf, \u0026quot;he\\nllo\u0026quot;) â†’ \u0026quot;\\\u0026quot;he\\\\nllo\\\u0026quot;\u0026quot; AppendQuoteToASCII / AppendQuoteToGraphic å®‰å…¨å¼•å·ï¼ˆé ASCII è½¬ä¹‰ï¼‰ â€” ä¸‰ã€è¯¦ç»†ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šæ„å»ºæ—¥å¿—è¡Œï¼ˆé›¶åˆ†é…ï¼‰ 1func buildLogLine(level string, msg string, count int) []byte { 2\tbuf := make([]byte, 0, 128) 3\tbuf = append(buf, \u0026#34;[INFO] \u0026#34;...) 4\tbuf = append(buf, msg...) 5\tbuf = append(buf, \u0026#34; (count=\u0026#34;...) 6\tbuf = strconv.AppendInt(buf, int64(count), 10) 7\tbuf = append(buf, \u0026#39;)\u0026#39; ) 8\treturn buf 9} 10 11// ä½¿ç”¨ 12logBytes := buildLogLine(\u0026#34;INFO\u0026#34;, \u0026#34;user login\u0026#34;, 5) 13fmt.Println(string(logBytes)) // [INFO] user login (count=5) ç¤ºä¾‹ 2ï¼šJSON æ‰‹åŠ¨åºåˆ—åŒ–ï¼ˆç®€åŒ–ç‰ˆï¼‰ 1func marshalUser(id int, name string, active bool) []byte { 2\tbuf := make([]byte, 0, 256) 3\tbuf = append(buf, `{\u0026#34;id\u0026#34;:`...) 4\tbuf = strconv.AppendInt(buf, int64(id), 10) 5\tbuf = append(buf, `,\u0026#34;name\u0026#34;:\u0026#34;`...) 6\tbuf = append(buf, name...) 7\tbuf = append(buf, `\u0026#34;,\u0026#34;active\u0026#34;:`...) 8\tbuf = strconv.AppendBool(buf, active) 9\tbuf = append(buf, \u0026#39;}\u0026#39;) 10\treturn buf 11} 12 13// è¾“å‡º: {\u0026#34;id\u0026#34;:123,\u0026#34;name\u0026#34;:\u0026#34;Alice\u0026#34;,\u0026#34;active\u0026#34;:true} ç¤ºä¾‹ 3ï¼šåå…­è¿›åˆ¶ ID æ‹¼æ¥ 1buf := make([]byte, 0, 32) 2buf = append(buf, \u0026#34;ID: 0x\u0026#34;...) 3buf = strconv.AppendUint(buf, 0xDEADBEEF, 16) // å°å†™ hex 4fmt.Println(string(buf)) // ID: 0xdeadbeef 5 6// å¤§å†™ï¼Ÿéœ€æ‰‹åŠ¨ ToUpper æˆ–ç”¨ fmt.Sprintfï¼ˆAppend ä¸æ”¯æŒå¤§å°å†™æ§åˆ¶ï¼‰ å››ã€å…³é”®å‚æ•°è¯´æ˜ 1. baseï¼ˆè¿›åˆ¶ï¼‰ ä»…ç”¨äº AppendInt / AppendUint å¸¸è§å€¼ï¼š10ï¼ˆåè¿›åˆ¶ï¼‰ã€16ï¼ˆåå…­è¿›åˆ¶ï¼‰ã€2ï¼ˆäºŒè¿›åˆ¶ï¼‰ã€8ï¼ˆå…«è¿›åˆ¶ï¼‰ èŒƒå›´ï¼š2 ~ 36 2. fmt, prec, bitSizeï¼ˆæµ®ç‚¹æ•°ï¼‰ ä¸ strconv.FormatFloat ç›¸åŒï¼š\nfmt: 'f', 'e', 'g', 'E', 'G' prec: ç²¾åº¦ï¼ˆ-1 è¡¨ç¤ºæœ€çŸ­æ— æŸè¡¨ç¤ºï¼‰ bitSize: 32 æˆ– 64 1strconv.AppendFloat(buf, 123.456, \u0026#39;e\u0026#39;, 2, 64) // \u0026#34;1.23e+02\u0026#34; äº”ã€æ€§èƒ½å¯¹æ¯”ï¼ˆåŸºå‡†æµ‹è¯•ï¼‰ 1// ä¼ ç»Ÿæ–¹å¼ 2func traditional(n int) string { 3\treturn \u0026#34;value=\u0026#34; + strconv.Itoa(n) 4} 5 6// Append æ–¹å¼ 7func appendStyle(n int) []byte { 8\tbuf := make([]byte, 0, 16) 9\tbuf = append(buf, \u0026#34;value=\u0026#34;...) 10\treturn strconv.AppendInt(buf, int64(n), 10) 11} Benchmark ç»“æœï¼ˆGo 1.23ï¼‰ï¼š\n1BenchmarkTraditional-8 10000000 110 ns/op 16 B/op 1 allocs/op 2BenchmarkAppendStyle-8 30000000 35 ns/op 0 B/op 0 allocs/op âœ… Append ç‰ˆæœ¬å¿« 3 å€ä»¥ä¸Šï¼Œä¸”é›¶åˆ†é…ï¼\nå…­ã€æ³¨æ„äº‹é¡¹ä¸é™·é˜± âŒ é™·é˜± 1ï¼šå¿˜è®°æ¥æ”¶è¿”å›å€¼ 1buf := make([]byte, 0, 16) 2strconv.AppendInt(buf, 42, 10) // âŒ è¿”å›å€¼æœªèµ‹å€¼ï¼Œbuf ä¸å˜ï¼ âœ… æ­£ç¡®ï¼š\n1buf = strconv.AppendInt(buf, 42, 10) // âœ… å¿…é¡»æ¥æ”¶è¿”å›å€¼ ğŸ” åŸå› ï¼šappend å¯èƒ½æ‰©å®¹ï¼Œè¿”å›æ–°çš„ slice\nâŒ é™·é˜± 2ï¼šåˆå§‹ buffer å¤ªå°å¯¼è‡´æ‰©å®¹ 1buf := []byte{} // å®¹é‡ä¸º 0 2buf = strconv.AppendInt(buf, 123456789, 10) // å¤šæ¬¡æ‰©å®¹ï¼Œå¤±å»é›¶åˆ†é…ä¼˜åŠ¿ âœ… å»ºè®®ï¼š\n1buf := make([]byte, 0, 32) // é¢„ä¼°è¶³å¤Ÿå®¹é‡ âŒ é™·é˜± 3ï¼šä¸èƒ½ç›´æ¥æ›¿ä»£ fmt.Sprintf Append ä¸æ”¯æŒæ ¼å¼æ¨¡æ¿ï¼ˆå¦‚ %04dã€å¯¹é½ã€å¡«å……ç­‰ï¼‰ å¦‚éœ€å¤æ‚æ ¼å¼ï¼Œä»éœ€ fmt æˆ–æ‰‹åŠ¨å¤„ç† 1// æ— æ³•ç›´æ¥å®ç°ï¼šAppendInt ä¸æ”¯æŒè¡¥é›¶ 2// éœ€è¦ï¼š \u0026#34;0042\u0026#34; 3// è§£å†³æ–¹æ¡ˆï¼šå…ˆç”¨ AppendIntï¼Œå†æ‰‹åŠ¨ padï¼Œæˆ–å›é€€åˆ° fmt.Sprintf ä¸ƒã€é€‚ç”¨åœºæ™¯æ€»ç»“ åœºæ™¯ æ˜¯å¦æ¨è é«˜é¢‘æ—¥å¿—æ‹¼æ¥ âœ… å¼ºçƒˆæ¨èï¼ˆå¦‚ zap æ—¥å¿—åº“å†…éƒ¨ä½¿ç”¨ï¼‰ ç½‘ç»œåè®®ç¼–ç  âœ… æ¨èï¼ˆHTTP headerã€è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®æ–‡æœ¬éƒ¨åˆ†ï¼‰ JSON/CSV åºåˆ—åŒ– âœ… æ¨èï¼ˆæ ‡å‡†åº“ encoding/json å†…éƒ¨å¤§é‡ä½¿ç”¨ï¼‰ ç®€å•è°ƒè¯•æ‰“å° âŒ ä¸å¿…è¦ï¼ˆç”¨ fmt æ›´ç®€æ´ï¼‰ éœ€è¦å¤æ‚æ ¼å¼æ§åˆ¶ âŒ ç”¨ fmt.Sprintf âœ… æœ€ä½³å®è·µ é¢„åˆ†é…è¶³å¤Ÿå®¹é‡çš„ []byte å§‹ç»ˆæ¥æ”¶å¹¶ä½¿ç”¨è¿”å›å€¼ ç»„åˆ append(...) å’Œ strconv.AppendXxx æ„å»ºå¤æ‚å­—ç¬¦ä¸² åœ¨æ€§èƒ½æ•æ„Ÿè·¯å¾„ï¼ˆå¦‚ hot pathï¼‰ä¼˜å…ˆè€ƒè™‘ Append ç³»åˆ— ğŸ’¡ ç»ˆæå£è¯€ â€œè¦æ‹¼å­—ç¬¦ä¸²ï¼Œå°‘ç”¨ + å’Œ fmtï¼›\né«˜é¢‘åœºæ™¯ä¸‹ï¼ŒAppend æ˜¯ç¥å…µï¼â€\nåˆç†ä½¿ç”¨ strconv.Appendï¼Œèƒ½è®©ä½ çš„ Go ç¨‹åºåœ¨å­—ç¬¦ä¸²å¤„ç†ä¸Šæ›´å¿«ã€æ›´çœå†…å­˜ï¼\nåœ¨ Go è¯­è¨€ä¸­ï¼Œtemplate æ˜¯æ ‡å‡†åº“æä¾›çš„å¼ºå¤§æ–‡æœ¬ç”Ÿæˆå·¥å…·ï¼Œä¸»è¦ç”¨äºå°†æ•°æ®åŠ¨æ€å¡«å……åˆ°é¢„å®šä¹‰çš„æ¨¡æ¿ä¸­ï¼Œç”Ÿæˆæœ€ç»ˆçš„æ–‡æœ¬è¾“å‡ºï¼ˆå¦‚ HTMLã€é…ç½®æ–‡ä»¶ã€é‚®ä»¶å†…å®¹ã€ä»£ç ç­‰ï¼‰ã€‚Go æä¾›äº†ä¸¤ä¸ªæ ¸å¿ƒåŒ…ï¼š text/templateï¼šç”¨äºç”Ÿæˆæ™®é€šæ–‡æœ¬ï¼ˆå¦‚æ—¥å¿—ã€é…ç½®ã€é‚®ä»¶ï¼‰ html/templateï¼šç”¨äºç”ŸæˆHTMLï¼Œè‡ªåŠ¨è½¬ä¹‰æ•æ„Ÿå­—ç¬¦ï¼Œé˜²æ­¢ XSS æ”»å‡» ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼šæ•°æ® + æ¨¡æ¿ = è¾“å‡º 1æ¨¡æ¿: \u0026#34;Hello, {{.Name}}! You have {{.Count}} messages.\u0026#34; 2æ•°æ®: struct{Name: \u0026#34;Alice\u0026#34;, Count: 5} 3è¾“å‡º: \u0026#34;Hello, Alice! You have 5 messages.\u0026#34; âœ… æ¨¡æ¿æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å«åŠ¨ä½œï¼ˆActionsï¼‰ï¼ˆç”¨ {{}} åŒ…è£¹ï¼‰\näºŒã€åŸºç¡€ç”¨æ³•ï¼ˆä»¥ text/template ä¸ºä¾‹ï¼‰ æ­¥éª¤ 1ï¼šå®šä¹‰æ¨¡æ¿ 1const tmpl = ` 2User: {{.Name}} 3Email: {{.Email}} 4Age: {{.Age}} 5` æ­¥éª¤ 2ï¼šå‡†å¤‡æ•°æ®ï¼ˆå¿…é¡»æ˜¯ structã€mapã€slice ç­‰ï¼‰ 1data := struct { 2 Name string 3 Email string 4 Age int 5}{ 6 Name: \u0026#34;Alice\u0026#34;, 7 Email: \u0026#34;alice@example.com\u0026#34;, 8 Age: 30, 9} æ­¥éª¤ 3ï¼šè§£æå¹¶æ‰§è¡Œæ¨¡æ¿ 1import \u0026#34;text/template\u0026#34; 2 3t := template.Must(template.New(\u0026#34;user\u0026#34;).Parse(tmpl)) 4err := t.Execute(os.Stdout, data) 5if err != nil { 6 log.Fatal(err) 7} è¾“å‡ºï¼š 1User: Alice 2Email: alice@example.com 3Age: 30 ğŸ”‘ template.Must()ï¼šè‡ªåŠ¨ panic å¦‚æœè§£æå¤±è´¥ï¼ˆé€‚åˆåˆå§‹åŒ–ï¼‰\nä¸‰ã€æ¨¡æ¿è¯­æ³•è¯¦è§£ 1. å­—æ®µè®¿é—® {{.Field}}ï¼šè®¿é—®å½“å‰æ•°æ®çš„å­—æ®µ {{.Field.SubField}}ï¼šåµŒå¥—è®¿é—® 1type User struct { 2 Profile struct { 3 City string 4 } 5} 6// æ¨¡æ¿: {{.Profile.City}} 2. ç®¡é“ï¼ˆPipelineï¼‰ä¸å‡½æ•° ä½¿ç”¨ | å°†å€¼ä¼ é€’ç»™å‡½æ•° å†…ç½®å‡½æ•°ï¼šprintf, len, call ç­‰ 1// è½¬å¤§å†™ 2{{printf \u0026#34;%s\u0026#34; .Name | upper}} 3 4// æ ¼å¼åŒ–æ•°å­— 5{{printf \u0026#34;%.2f\u0026#34; .Price}} âš ï¸ æ³¨æ„ï¼štext/template æ²¡æœ‰å†…ç½® upper å‡½æ•°ï¼éœ€è‡ªå®šä¹‰ã€‚\n3. æ¡ä»¶åˆ¤æ–­ 1{{if .Active}} 2 Status: Active 3{{else}} 4 Status: Inactive 5{{end}} 6 7{{if gt .Age 18}}Adult{{end}} // å†…ç½®æ¯”è¾ƒå‡½æ•°ï¼šeq, ne, lt, le, gt, ge 4. å¾ªç¯ï¼ˆrangeï¼‰ 1{{range .Items}} 2- {{.Name}}: ${{.Price}} 3{{end}} 4 5// å¸¦ç´¢å¼• 6{{range $i, $item := .Items}} 7{{$i}}: {{$item.Name}} 8{{end}} 5. å˜é‡å®šä¹‰ 1{{$name := .Name}} 2Hello, {{$name}}! 6. æ³¨é‡Š 1{{/* This is a comment */}} å››ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆFuncMapï¼‰ æ¨¡æ¿æœ¬èº«åŠŸèƒ½æœ‰é™ï¼Œå¯é€šè¿‡ FuncMap æ³¨å…¥è‡ªå®šä¹‰å‡½æ•°ï¼š\n1func toUpper(s string) string { 2 return strings.ToUpper(s) 3} 4 5func formatDate(t time.Time) string { 6 return t.Format(\u0026#34;2006-01-02\u0026#34;) 7} 8 9// æ³¨å†Œå‡½æ•° 10funcMap := template.FuncMap{ 11 \u0026#34;upper\u0026#34;: toUpper, 12 \u0026#34;date\u0026#34;: formatDate, 13} 14 15t := template.New(\u0026#34;example\u0026#34;).Funcs(funcMap).Parse(tmpl) æ¨¡æ¿ä¸­ä½¿ç”¨ï¼š\n1{{.Name | upper}} 2{{.CreatedAt | date}} âœ… æœ€ä½³å®è·µï¼šå°†å¸¸ç”¨å‡½æ•°å°è£…ä¸ºå…¨å±€ FuncMap\näº”ã€html/templateï¼šå®‰å…¨çš„ HTML ç”Ÿæˆ è‡ªåŠ¨è½¬ä¹‰ç¤ºä¾‹ï¼š 1tmpl := `\u0026lt;p\u0026gt;Hello, {{.Name}}!\u0026lt;/p\u0026gt;` 2data := struct{ Name string }{ Name: \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34; } 3 4// text/template è¾“å‡º: 5// \u0026lt;p\u0026gt;Hello, \u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt;!\u0026lt;/p\u0026gt; âŒ å±é™©ï¼ 6 7// html/template è¾“å‡º: 8// \u0026lt;p\u0026gt;Hello, \u0026amp;lt;script\u0026amp;gt;alert(\u0026amp;#39;xss\u0026amp;#39;)\u0026amp;lt;/script\u0026amp;gt;!\u0026lt;/p\u0026gt; âœ… å®‰å…¨ å¦‚ä½•è¾“å‡ºåŸå§‹ HTMLï¼ˆä¿¡ä»»å†…å®¹ï¼‰ï¼Ÿ ä½¿ç”¨ {{.Content | safeHTML}}ï¼Ÿ\nâœ… æ­£ç¡®æ–¹å¼ï¼šå°†å­—æ®µç±»å‹è®¾ä¸º template.HTML\n1type Page struct { 2 Title string 3 Content template.HTML // å‘Šè¯‰æ¨¡æ¿å¼•æ“ï¼šè¿™æ˜¯å®‰å…¨çš„ HTML 4} 5 6data := Page{ 7 Title: \u0026#34;My Page\u0026#34;, 8 Content: \u0026#34;\u0026lt;h1\u0026gt;Welcome\u0026lt;/h1\u0026gt;\u0026#34;, // ä¸ä¼šè¢«è½¬ä¹‰ 9} âš ï¸ åˆ‡å‹¿å¯¹ç”¨æˆ·è¾“å…¥ä½¿ç”¨ template.HTMLï¼Œä»…ç”¨äºå¯ä¿¡å†…å®¹ï¼\nå…­ã€æ¨¡æ¿å¤ç”¨ï¼šå®šä¹‰ä¸è°ƒç”¨å­æ¨¡æ¿ å®šä¹‰å­æ¨¡æ¿ï¼š 1const layout = ` 2{{$title := .Title}} 3{{define \u0026#34;header\u0026#34;}}\u0026lt;h1\u0026gt;{{$title}}\u0026lt;/h1\u0026gt;{{end}} 4{{define \u0026#34;content\u0026#34;}}\u0026lt;p\u0026gt;{{.Body}}\u0026lt;/p\u0026gt;{{end}} 5 6\u0026lt;!DOCTYPE html\u0026gt; 7\u0026lt;html\u0026gt; 8\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;{{$title}}\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; 9\u0026lt;body\u0026gt; 10 {{template \u0026#34;header\u0026#34; .}} 11 {{template \u0026#34;content\u0026#34; .}} 12\u0026lt;/body\u0026gt; 13\u0026lt;/html\u0026gt; 14` æˆ–ä»æ–‡ä»¶åŠ è½½å¤šä¸ªæ¨¡æ¿ï¼š 1t := template.Must(template.ParseFiles(\u0026#34;header.tmpl\u0026#34;, \u0026#34;footer.tmpl\u0026#34;, \u0026#34;page.tmpl\u0026#34;)) 2// åœ¨ page.tmpl ä¸­: {{template \u0026#34;header\u0026#34; .}} ä¸ƒã€å¸¸è§åº”ç”¨åœºæ™¯ åœºæ™¯ æ¨èåŒ… Web é¡µé¢æ¸²æŸ“ html/template é‚®ä»¶/çŸ­ä¿¡æ¨¡æ¿ text/template é…ç½®æ–‡ä»¶ç”Ÿæˆï¼ˆå¦‚ nginx.confï¼‰ text/template ä»£ç ç”Ÿæˆï¼ˆå¦‚ protobuf stubï¼‰ text/template CLI å·¥å…·è¾“å‡ºæ ¼å¼åŒ– text/template å…«ã€é”™è¯¯å¤„ç†ä¸è°ƒè¯• 1. è§£æé”™è¯¯ 1t, err := template.New(\u0026#34;test\u0026#34;).Parse(badTmpl) 2if err != nil { 3 log.Fatal(\u0026#34;Template parse error:\u0026#34;, err) 4} 2. æ‰§è¡Œé”™è¯¯ 1err := t.Execute(w, data) 2if err != nil { 3 log.Println(\u0026#34;Template execute error:\u0026#34;, err) 4} 3. è°ƒè¯•æŠ€å·§ ä½¿ç”¨ {{printf \u0026quot;%#v\u0026quot; .}} æ‰“å°æ•´ä¸ªæ•°æ®ç»“æ„ å¼€å‘é˜¶æ®µå¼€å¯è¯¦ç»†é”™è¯¯æ—¥å¿— ä¹ã€æ€§èƒ½æç¤º æ¨¡æ¿åº”é¢„å…ˆè§£æï¼ˆä¸è¦æ¯æ¬¡è¯·æ±‚éƒ½ Parseï¼‰ ä½¿ç”¨ sync.Pool ç¼“å†² bytes.Bufferï¼ˆé¿å…é¢‘ç¹åˆ†é…ï¼‰ å¯¹äºé«˜é¢‘åœºæ™¯ï¼Œè€ƒè™‘é¢„ç¼–è¯‘æ¨¡æ¿åˆ°ä»£ç ä¸­ 1var userTmpl = template.Must(template.New(\u0026#34;user\u0026#34;).Parse(userTemplateStr)) âœ… æ€»ç»“ï¼šæœ€ä½³å®è·µ Web ç”¨ html/templateï¼Œå…¶ä»–ç”¨ text/template æ°¸è¿œä¸è¦å¯¹ç”¨æˆ·è¾“å…¥ç¦ç”¨ HTML è½¬ä¹‰ é€šè¿‡ FuncMap æ‰©å±•åŠŸèƒ½ æ¨¡æ¿æå‰è§£æï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€ ä½¿ç”¨å­æ¨¡æ¿å®ç°å¤ç”¨ ğŸ’¡ ç»ˆæé€ŸæŸ¥è¡¨ åŠŸèƒ½ è¯­æ³• å­—æ®µ {{.Name}} æ¡ä»¶ {{if .Active}}...{{end}} å¾ªç¯ {{range .Items}}...{{end}} å‡½æ•° {{.Name | upper}} å˜é‡ {{$x := .Count}} å­æ¨¡æ¿ {{define \u0026quot;name\u0026quot;}}...{{end}} + {{template \u0026quot;name\u0026quot; .}} HTML å®‰å…¨è¾“å‡º å­—æ®µç±»å‹ä¸º template.HTML æŒæ¡ Go çš„ templateï¼Œä½ å°±èƒ½é«˜æ•ˆã€å®‰å…¨åœ°ç”Ÿæˆä»»ä½•ç»“æ„åŒ–æ–‡æœ¬ï¼\nåœ¨ Go è¯­è¨€çš„ text/template å’Œ html/template åŒ…ä¸­ï¼Œæ¨¡æ¿é‡Œçš„ .ï¼ˆç‚¹å·ï¼‰ æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ å½“å‰ä¸Šä¸‹æ–‡ï¼ˆcurrent contextï¼‰ æˆ– å½“å‰æ•°æ®å¯¹è±¡ï¼ˆcurrent data valueï¼‰ã€‚ ä¸€ã€. çš„åŸºæœ¬å«ä¹‰ . è¡¨ç¤ºä¼ ç»™æ¨¡æ¿çš„â€œæ ¹æ•°æ®â€æˆ–å½“å‰ä½œç”¨åŸŸä¸­çš„â€œå½“å‰å€¼â€\nå½“ä½ è°ƒç”¨ï¼š\n1t.Execute(os.Stdout, data) é‚£ä¹ˆåœ¨æ¨¡æ¿é¡¶å±‚ï¼Œ. å°±ç­‰äº dataã€‚\näºŒã€å…·ä½“åœºæ™¯è¯¦è§£ åœºæ™¯ 1ï¼šé¡¶å±‚å­—æ®µè®¿é—® å‡è®¾æ•°æ®æ˜¯ä¸€ä¸ª structï¼š\n1type User struct { 2 Name string 3 Email string 4} 5data := User{Name: \u0026#34;Alice\u0026#34;, Email: \u0026#34;alice@example.com\u0026#34;} æ¨¡æ¿ï¼š\n1Name: {{.Name}} 2Email: {{.Email}} è¿™é‡Œçš„ . å°±æ˜¯ dataï¼ˆå³ User å®ä¾‹ï¼‰ {{.Name}} ç­‰ä»·äº data.Name åœºæ™¯ 2ï¼šåµŒå¥—ç»“æ„ 1type Profile struct { 2 City string 3} 4type User struct { 5 Name string 6 Profile Profile 7} æ¨¡æ¿ï¼š\n1City: {{.Profile.City}} . â†’ User .Profile â†’ Profile{City: \u0026quot;...\u0026quot;} .Profile.City â†’ å­—ç¬¦ä¸² åœºæ™¯ 3ï¼šåœ¨ range å¾ªç¯ä¸­ï¼Œ. ä¼šæ”¹å˜ï¼ 1data := []string{\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;cherry\u0026#34;} æ¨¡æ¿ï¼š\n1{{range .}} 2- Item: {{.}} 3{{end}} è¾“å‡ºï¼š\n1- Item: apple 2- Item: banana 3- Item: cherry âœ… è§£é‡Šï¼š\nå¤–å±‚ . æ˜¯æ•´ä¸ª slice åœ¨ {{range .}} å†…éƒ¨ï¼Œ. è‡ªåŠ¨å˜ä¸ºå½“å‰éå†çš„å…ƒç´  ç¬¬ä¸€æ¬¡å¾ªç¯ï¼š. = \u0026quot;apple\u0026quot; ç¬¬äºŒæ¬¡ï¼š. = \u0026quot;banana\u0026quot; ä»¥æ­¤ç±»æ¨ ğŸ” range ä¼šæ”¹å˜å½“å‰ä¸Šä¸‹æ–‡ï¼ˆ. çš„å€¼ï¼‰\nåœºæ™¯ 4ï¼šåœ¨ range ä¸­è®¿é—®å¤–å±‚æ•°æ®ï¼ˆä½¿ç”¨ $ï¼‰ å¦‚æœæƒ³åœ¨å¾ªç¯ä¸­åŒæ—¶è®¿é—®å½“å‰å…ƒç´ å’Œå¤–å±‚å­—æ®µï¼Œéœ€è¦ç”¨ $ è¡¨ç¤ºæ ¹ä¸Šä¸‹æ–‡ï¼š\n1type Page struct { 2 Title string 3 Items []string 4} 5data := Page{ 6 Title: \u0026#34;Fruits\u0026#34;, 7 Items: []string{\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;}, 8} æ¨¡æ¿ï¼š\n1\u0026lt;h1\u0026gt;{{$.Title}}\u0026lt;/h1\u0026gt; \u0026lt;!-- $ æŒ‡å‘æ ¹ data --\u0026gt; 2\u0026lt;ul\u0026gt; 3{{range .Items}} 4 \u0026lt;li\u0026gt;{{$.Title}}: {{.}}\u0026lt;/li\u0026gt; \u0026lt;!-- . æ˜¯å½“å‰ itemï¼Œ$.Title æ˜¯å¤–å±‚æ ‡é¢˜ --\u0026gt; 5{{end}} 6\u0026lt;/ul\u0026gt; è¾“å‡ºï¼š\n1\u0026lt;h1\u0026gt;Fruits\u0026lt;/h1\u0026gt; 2\u0026lt;ul\u0026gt; 3 \u0026lt;li\u0026gt;Fruits: apple\u0026lt;/li\u0026gt; 4 \u0026lt;li\u0026gt;Fruits: banana\u0026lt;/li\u0026gt; 5\u0026lt;/ul\u0026gt; âœ… $ å§‹ç»ˆæŒ‡å‘æ¨¡æ¿æ‰§è¡Œæ—¶ä¼ å…¥çš„æ ¹æ•°æ®å¯¹è±¡\nåœºæ™¯ 5ï¼šåœ¨ with å—ä¸­ï¼Œ. ä¹Ÿä¼šæ”¹å˜ 1{{with .Profile}} 2 City: {{.City}} \u0026lt;!-- . ç°åœ¨æ˜¯ .Profile --\u0026gt; 3 Country: {{.Country}} 4{{end}} with ä¼šå°† . è®¾ç½®ä¸º {{with .Profile}} ä¸­çš„ .Profile å¦‚æœ .Profile ä¸º nil æˆ– zero valueï¼Œæ•´ä¸ªå—ä¸æ‰§è¡Œ ä¸‰ã€æ€»ç»“ï¼š. çš„è¡Œä¸ºè§„åˆ™ ä¸Šä¸‹æ–‡ . çš„å€¼ æ¨¡æ¿é¡¶å±‚ ä¼ ç»™ Execute() çš„æ•´ä¸ªæ•°æ®å¯¹è±¡ {{range .Field}} å†…éƒ¨ å½“å‰éå†çš„å…ƒç´  {{with .Field}} å†…éƒ¨ .Field çš„å€¼ ä»»ä½•åœ°æ–¹ä½¿ç”¨ $.Field å§‹ç»ˆæ˜¯æ ¹æ•°æ®å¯¹è±¡çš„å­—æ®µï¼ˆ$ = æ ¹ï¼‰ å››ã€è®°å¿†å£è¯€ â€œç‚¹éšå¢ƒè½¬ï¼Œç¾å…ƒä¸å˜â€\n. ä¼šéšç€ rangeã€with æ”¹å˜ä¸Šä¸‹æ–‡ $ æ°¸è¿œæŒ‡å‘æœ€åˆä¼ å…¥çš„æ•°æ®æ ¹å¯¹è±¡ äº”ã€å¸¸è§é”™è¯¯ç¤ºä¾‹ âŒ é”™è¯¯ï¼šåœ¨ range ä¸­ç›´æ¥è®¿é—®å¤–å±‚å­—æ®µ 1// æ•°æ®: {Title: \u0026#34;List\u0026#34;, Items: [1,2,3]} 2{{range .Items}} 3{{.Title}}: {{.}} \u0026lt;!-- é”™ï¼æ­¤æ—¶ . æ˜¯æ•°å­—ï¼Œæ²¡æœ‰ Title å­—æ®µ --\u0026gt; 4{{end}} âœ… æ­£ç¡®ï¼šç”¨ $ è®¿é—®å¤–å±‚ 1{{range .Items}} 2{{$.Title}}: {{.}} 3{{end}} å…­ã€æ‰©å±•ï¼š. ä¹Ÿå¯ä»¥æ˜¯ mapã€sliceã€æŒ‡é’ˆç­‰ å¦‚æœ data æ˜¯ map[string]interface{}ï¼Œåˆ™ {{.name}} è®¿é—® key \u0026quot;name\u0026quot; å¦‚æœæ˜¯ []intï¼Œé¡¶å±‚ {{.}} è¾“å‡ºæ•´ä¸ª sliceï¼ˆä½†é€šå¸¸é…åˆ range ä½¿ç”¨ï¼‰ æŒ‡é’ˆä¼šè‡ªåŠ¨è§£å¼•ç”¨ âœ… æŒæ¡ . å’Œ $ï¼Œä½ å°±æŒæ¡äº† Go æ¨¡æ¿ä¸Šä¸‹æ–‡çš„æ ¸å¿ƒï¼\n","link":"https://jianlin-li.github.io/post/go_review_1/","section":"post","tags":["Go"],"title":"Goè¯­è¨€çš„çŸ¥è¯†ç‚¹-1"},{"body":"åœ¨ Go è¯­è¨€çš„å‘å±•å†ç¨‹ä¸­ï¼ŒGOPATH å’Œ Go Modulesï¼ˆæ¨¡å—ç³»ç»Ÿï¼‰ æ˜¯ä¸¤ç§ä¸åŒçš„ä¾èµ–ç®¡ç†å’Œé¡¹ç›®ç»„ç»‡æ–¹å¼ã€‚å®ƒä»¬ä»£è¡¨äº† Go åœ¨ä¸åŒé˜¶æ®µå¯¹â€œå¦‚ä½•æ„å»ºå’Œç®¡ç†é¡¹ç›®â€çš„å“²å­¦æ¼”å˜ã€‚\nä¸‹é¢æ˜¯å¯¹ GOPATH å’Œ Go Modules çš„è¯¦ç»†å¯¹æ¯”åˆ†æï¼ŒåŒ…æ‹¬è®¾è®¡æ€æƒ³ã€å·¥ä½œæœºåˆ¶ã€ä¼˜ç¼ºç‚¹ã€ä½¿ç”¨åœºæ™¯ä»¥åŠå½“å‰çš„ä¸»æµè¶‹åŠ¿ã€‚\nä¸€ã€èƒŒæ™¯ï¼šGo çš„ä¾èµ–ç®¡ç†æ¼”è¿› æ—¶é—´ ç‰ˆæœ¬ ä¾èµ–ç®¡ç†æ–¹å¼ 2009â€“2018 Go 1.0 â€“ Go 1.10 GOPATH æ¨¡å¼ 2018 å¹´èµ· Go 1.11+ å¼•å…¥ Go Modules 2020 å¹´èµ· Go 1.14+ Modules æˆä¸ºæ¨èæ–¹å¼ 2021 å¹´èµ· Go 1.16+ Modules é»˜è®¤å¯ç”¨ ğŸ“Œ è‡ª Go 1.16 èµ·ï¼ŒGO111MODULE=on æˆä¸ºé»˜è®¤è¡Œä¸ºï¼Œæ ‡å¿—ç€ Go Modules æ­£å¼å–ä»£ GOPATH æˆä¸ºä¸»æµã€‚\näºŒã€GOPATH æ¨¡å¼è¯¦è§£ 1. ä»€ä¹ˆæ˜¯ GOPATHï¼Ÿ GOPATH æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘ä½ çš„ Go å·¥ä½œç›®å½•ã€‚å®ƒå®šä¹‰äº† Go å·¥å…·é“¾æŸ¥æ‰¾åŒ…çš„ä½ç½®ã€‚\nå…¸å‹ç»“æ„ï¼š\n1$GOPATH/ 2â”œâ”€â”€ src/ # æ‰€æœ‰æºä»£ç ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰ 3â”‚ â”œâ”€â”€ github.com/user/project1/ 4â”‚ â””â”€â”€ myproject/ 5â”œâ”€â”€ pkg/ # ç¼–è¯‘åçš„åŒ…å¯¹è±¡ï¼ˆ.a æ–‡ä»¶ï¼‰ 6â””â”€â”€ bin/ # å¯æ‰§è¡Œæ–‡ä»¶ 2. å·¥ä½œæœºåˆ¶ æ‰€æœ‰é¡¹ç›®å¿…é¡»æ”¾åœ¨ $GOPATH/src ä¸‹ã€‚ å¯¼å…¥è·¯å¾„åŸºäº $GOPATH/src çš„ç›¸å¯¹è·¯å¾„ï¼š 1import \u0026#34;github.com/gin-gonic/gin\u0026#34; Go ä¼šå» $GOPATH/src/github.com/gin-gonic/gin æŸ¥æ‰¾ä»£ç ã€‚ ç¬¬ä¸‰æ–¹ä¾èµ–é€šè¿‡ go get ä¸‹è½½åˆ° $GOPATH/srcã€‚ æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶ï¼ˆæ— æ³•æŒ‡å®šä¾èµ–ç‰ˆæœ¬ï¼‰ã€‚ 3. ä¼˜ç‚¹ ç®€å•ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…ã€‚ ä¸éœ€è¦é¢å¤–é…ç½®æ–‡ä»¶ï¼ˆå¦‚ go.modï¼‰ã€‚ 4. ç¼ºç‚¹ï¼ˆè‡´å‘½é—®é¢˜ï¼‰ é—®é¢˜ è¯´æ˜ âŒ å…¨å±€ä¾èµ– æ‰€æœ‰é¡¹ç›®å…±äº« $GOPATH/srcï¼Œå¯¼è‡´ä¾èµ–å†²çªã€‚ä¾‹å¦‚ï¼šé¡¹ç›® A éœ€è¦ pkg v1.0ï¼Œé¡¹ç›® B éœ€è¦ pkg v2.0ï¼Œä½†åªèƒ½å­˜ä¸€ä¸ªç‰ˆæœ¬ã€‚ âŒ æ— ç‰ˆæœ¬ç®¡ç† go get é»˜è®¤æ‹‰å– master åˆ†æ”¯æœ€æ–°ä»£ç ï¼Œå¯èƒ½å¯¼è‡´æ„å»ºä¸ä¸€è‡´ã€‚ âŒ é¡¹ç›®ä½ç½®å—é™ å¿…é¡»æ”¾åœ¨ $GOPATH/src ä¸‹ï¼Œä¸èƒ½éšæ„å­˜æ”¾ã€‚ âŒ ä¸æ”¯æŒè¯­ä¹‰åŒ–å¯¼å…¥ æ— æ³•åŒºåˆ†ä¸åŒç‰ˆæœ¬çš„åŒä¸€åŒ…ã€‚ âŒ éš¾ä»¥åä½œ å›¢é˜Ÿæˆå‘˜å¿…é¡»æ‰‹åŠ¨åŒæ­¥ä¾èµ–ç‰ˆæœ¬ï¼Œå®¹æ˜“å‡ºç°â€œåœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘â€é—®é¢˜ã€‚ ä¸‰ã€Go Modules æ¨¡å¼è¯¦è§£ 1. ä»€ä¹ˆæ˜¯ Go Modulesï¼Ÿ Go Modules æ˜¯ä» Go 1.11 å¼•å…¥çš„å®˜æ–¹ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå…è®¸é¡¹ç›®ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„ä¾èµ–å…³ç³»ï¼Œä¸å†ä¾èµ– GOPATHã€‚\næ ¸å¿ƒæ–‡ä»¶ï¼š\ngo.modï¼šå£°æ˜æ¨¡å—åã€Go ç‰ˆæœ¬ã€ä¾èµ–åˆ—è¡¨ã€‚ go.sumï¼šè®°å½•ä¾èµ–æ¨¡å—çš„æ ¡éªŒå’Œï¼Œç¡®ä¿å®Œæ•´æ€§ã€‚ vendor/ï¼ˆå¯é€‰ï¼‰ï¼šé”å®šä¾èµ–å‰¯æœ¬ï¼ˆå¯é€šè¿‡ go mod vendor ç”Ÿæˆï¼‰ã€‚ 2. å·¥ä½œæœºåˆ¶ 1# åˆå§‹åŒ–æ¨¡å— 2go mod init myproject 3 4# è‡ªåŠ¨ä¸‹è½½ä¾èµ–å¹¶å†™å…¥ go.mod 5go get github.com/gin-gonic/gin@v1.9.1 6 7# æ„å»ºæ—¶è‡ªåŠ¨è§£æä¾èµ– 8go build ä¾èµ–å­˜å‚¨ä½ç½®ï¼š\n1$GOPATH/pkg/mod/ 2â”œâ”€â”€ github.com/gin-gonic/gin@v1.9.1/ 3â”œâ”€â”€ golang.org/x/net@v0.12.0/ 4â””â”€â”€ ... 3. æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ âœ… é¡¹ç›®çº§ä¾èµ–ç®¡ç† æ¯ä¸ªé¡¹ç›®æœ‰è‡ªå·±çš„ go.modï¼Œä¾èµ–ç‹¬ç«‹ã€‚ âœ… ç‰ˆæœ¬åŒ–ä¾èµ– æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemVerï¼‰ï¼Œå¦‚ v1.5.2ã€latestã€commit hashã€‚ âœ… å¯é‡å¤æ„å»º go.sum ç¡®ä¿æ¯æ¬¡æ„å»ºä½¿ç”¨ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚ âœ… æ— éœ€ GOPATH ç»“æ„ é¡¹ç›®å¯ä»¥æ”¾åœ¨ä»»æ„ç›®å½•ï¼Œä¸å†å¼ºåˆ¶è¦æ±‚åœ¨ src ä¸‹ã€‚ âœ… æ”¯æŒç§æœ‰æ¨¡å— å¯é…ç½® GOPRIVATE é¿å…ç§æœ‰ä»“åº“èµ°ä»£ç†ã€‚ âœ… æœ€å°ç‰ˆæœ¬é€‰æ‹©ï¼ˆMVSï¼‰ è‡ªåŠ¨é€‰æ‹©æ»¡è¶³æ‰€æœ‰ä¾èµ–çš„æœ€å°å…¼å®¹ç‰ˆæœ¬ã€‚ 4. ä¼˜ç‚¹ éš”ç¦»æ€§å¼ºï¼šæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ç®¡ç†ä¾èµ–ï¼Œé¿å…å†²çªã€‚ ç‰ˆæœ¬å¯æ§ï¼šç²¾ç¡®æŒ‡å®šä¾èµ–ç‰ˆæœ¬ï¼Œæ”¯æŒå‡çº§ã€é™çº§ã€æ›¿æ¢ã€‚ å¯ç§»æ¤æ€§é«˜ï¼šåªè¦æœ‰ go.mod å’Œ go.sumï¼Œä»»ä½•ç¯å¢ƒéƒ½èƒ½å¤ç°æ„å»ºã€‚ æ”¯æŒç°ä»£å¼€å‘æµç¨‹ï¼šCI/CDã€å¾®æœåŠ¡ã€å¤šå›¢é˜Ÿåä½œæ›´é¡ºç•…ã€‚ 5. ç¼ºç‚¹ï¼ˆæå°‘ï¼‰ åˆå­¦è€…éœ€è¦ç†è§£ go.modã€go.sumã€replace ç­‰æ¦‚å¿µã€‚ é¦–æ¬¡æ„å»ºå¯èƒ½è¾ƒæ…¢ï¼ˆéœ€ä¸‹è½½æ¨¡å—ç¼“å­˜ï¼‰ã€‚ æŸäº›æ—§é¡¹ç›®è¿ç§»æˆæœ¬è¾ƒé«˜ã€‚ å››ã€å…³é”®åŒºåˆ«å¯¹æ¯”è¡¨ å¯¹æ¯”ç»´åº¦ GOPATH æ¨¡å¼ Go Modules æ¨¡å¼ é¡¹ç›®ä½ç½® å¿…é¡»åœ¨ $GOPATH/src ä¸‹ ä»»æ„ç›®å½• ä¾èµ–å­˜å‚¨ $GOPATH/srcï¼ˆå…¨å±€å…±äº«ï¼‰ $GOPATH/pkg/modï¼ˆç¼“å­˜ï¼ŒæŒ‰ç‰ˆæœ¬éš”ç¦»ï¼‰ ç‰ˆæœ¬ç®¡ç† æ— ï¼ˆgo get æ‹‰æœ€æ–°ï¼‰ æœ‰ï¼ˆgo.mod å£°æ˜ç‰ˆæœ¬ï¼‰ å¯é‡å¤æ„å»º å¦ï¼ˆä¾èµ–å¯èƒ½å˜åŒ–ï¼‰ æ˜¯ï¼ˆgo.sum é”å®šï¼‰ å¤šç‰ˆæœ¬å…±å­˜ å¦ï¼ˆåªèƒ½ä¸€ä¸ªç‰ˆæœ¬ï¼‰ æ˜¯ï¼ˆ@v1.0, @v2.0 å¯å…±å­˜ï¼‰ æ˜¯å¦éœ€è¦ç½‘ç»œ go get éœ€è¦ é¦–æ¬¡éœ€è¦ï¼Œä¹‹åå¯ç¦»çº¿ï¼ˆç¼“å­˜ï¼‰ é…ç½®æ–‡ä»¶ æ—  go.mod, go.sum é»˜è®¤å¯ç”¨ Go 1.11 ä¹‹å‰ Go 1.16+ é»˜è®¤å¯ç”¨ é€‚ç”¨åœºæ™¯ è€é¡¹ç›®ã€å­¦ä¹  æ–°é¡¹ç›®ã€ç”Ÿäº§ç¯å¢ƒã€å›¢é˜Ÿåä½œ äº”ã€å½“å‰ä½¿ç”¨æƒ…å†µåˆ†æï¼ˆ2025 å¹´ï¼‰ âœ… Go Modules æ˜¯ç»å¯¹ä¸»æµ æ ¹æ®ç¤¾åŒºè°ƒæŸ¥ï¼ˆå¦‚ Go Developer Surveyï¼‰ã€GitHub é¡¹ç›®ç»Ÿè®¡å’Œä¼ä¸šå®è·µï¼š\næŒ‡æ ‡ æ•°æ® æ–°é¡¹ç›®ä½¿ç”¨ Modules çš„æ¯”ä¾‹ \u0026gt; 95% ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Modules çš„æ¯”ä¾‹ \u0026gt; 90% å®˜æ–¹æ–‡æ¡£å’Œæ•™ç¨‹ å…¨éƒ¨åŸºäº Modules IDE æ”¯æŒï¼ˆGoLand, VS Codeï¼‰ é»˜è®¤æ”¯æŒ Modules CI/CD å·¥å…·ï¼ˆGitHub Actions, GitLab CIï¼‰ æ¨èä½¿ç”¨ go mod tidy + ç¼“å­˜ ğŸ“Š ä¸ºä»€ä¹ˆ Modules æˆä¸ºä¸»æµï¼Ÿ å®˜æ–¹èƒŒä¹¦ï¼šGo å›¢é˜Ÿæ˜ç¡®è¡¨ç¤º GOPATH æ¨¡å¼å·²è¿‡æ—¶ã€‚ ç”Ÿæ€æ”¯æŒï¼šæ‰€æœ‰ç°ä»£ Go å·¥å…·ï¼ˆå¦‚ golangci-lint, wire, protobufï¼‰éƒ½åŸºäº Modules è®¾è®¡ã€‚ äº‘åŸç”Ÿéœ€æ±‚ï¼šDockerã€Kubernetesã€å¾®æœåŠ¡æ¶æ„è¦æ±‚å¯é‡å¤æ„å»ºå’Œç‰ˆæœ¬æ§åˆ¶ã€‚ å¼€å‘è€…ä½“éªŒæå‡ï¼šæ— éœ€å…³å¿ƒ GOPATH è®¾ç½®ï¼Œé¡¹ç›®å¼€ç®±å³ç”¨ã€‚ å…­ã€è¿ç§»å»ºè®®ï¼šä» GOPATH åˆ° Modules å¦‚æœä½ è¿˜åœ¨ä½¿ç”¨ GOPATHï¼Œå»ºè®®å°½å¿«è¿ç§»åˆ° Modulesï¼š\nè¿ç§»æ­¥éª¤ï¼š 1# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸åœ¨ $GOPATH/src å†…æ›´ä½³ï¼‰ 2cd /path/to/your/project 3 4# 2. åˆå§‹åŒ–æ¨¡å— 5go mod init your-module-name 6 7# 3. ä¸‹è½½ä¾èµ–å¹¶ç”Ÿæˆ go.mod/go.sum 8go mod tidy 9 10# 4. ï¼ˆå¯é€‰ï¼‰ç”Ÿæˆ vendor ç›®å½•ï¼ˆç”¨äºç¦»çº¿æ„å»ºï¼‰ 11go mod vendor æ³¨æ„äº‹é¡¹ï¼š ç¡®ä¿ GO111MODULE=onï¼ˆGo 1.16+ é»˜è®¤å¼€å¯ï¼‰ã€‚ ç§»é™¤å¯¹ $GOPATH/src çš„ä¾èµ–ã€‚ ä½¿ç”¨ replace æŒ‡ä»¤å¤„ç†ç§æœ‰ä»“åº“æˆ–æœ¬åœ°è°ƒè¯•ã€‚ ä¸ƒã€æ€»ç»“ï¼šè°æ˜¯æœªæ¥ï¼Ÿ ç»´åº¦ GOPATH Go Modules ç°çŠ¶ å†å²é—ç•™ï¼Œé€æ¸æ·˜æ±° å½“å‰æ ‡å‡†ï¼Œæœªæ¥æ–¹å‘ æ¨èç¨‹åº¦ âŒ ä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨ âœ… å¼ºçƒˆæ¨è å­¦ä¹ å»ºè®® äº†è§£å³å¯ï¼Œæ— éœ€æ·±å…¥ å¿…é¡»æŒæ¡ ğŸ”š ç»“è®ºï¼š\nGo Modules å·²å…¨é¢å–ä»£ GOPATHï¼Œæˆä¸º Go è¯­è¨€çš„äº‹å®æ ‡å‡†ã€‚ æ‰€æœ‰æ–°é¡¹ç›®åº”ç›´æ¥ä½¿ç”¨ Go Modulesã€‚ è€é¡¹ç›®åº”é€æ­¥è¿ç§»åˆ° Modules ä»¥è·å¾—æ›´å¥½çš„ç»´æŠ¤æ€§å’Œåä½œèƒ½åŠ›ã€‚ GOPATH ä»…ä½œä¸ºå†å²çŸ¥è¯†äº†è§£ï¼Œä¸åº”å†ç”¨äºæ–°é¡¹ç›®å¼€å‘ã€‚ âœ… è¡ŒåŠ¨å»ºè®®ï¼š ç«‹å³æ£€æŸ¥ä½ çš„é¡¹ç›®æ˜¯å¦ä½¿ç”¨ go.modï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯·è¿è¡Œ go mod init å¼€å¯ç°ä»£åŒ– Go å¼€å‘ä¹‹æ—…ã€‚\n","link":"https://jianlin-li.github.io/post/go_review/","section":"post","tags":["Go"],"title":"Goè¯­è¨€çš„çŸ¥è¯†ç‚¹--GOPATHå’ŒGo Modules"},{"body":"","link":"https://jianlin-li.github.io/categories/rabbitmq/","section":"categories","tags":null,"title":"RabbitMQ"},{"body":"","link":"https://jianlin-li.github.io/tags/rabbitmq/","section":"tags","tags":null,"title":"RabbitMQ"},{"body":"RabbitMQ æ¶ˆæ¯ä¸­é—´ä»¶è¯¦è§£ æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨ å‰Šå³°ï¼šç¼“å†²ç¬æ—¶é«˜å³°æµé‡ï¼Œé¿å…ç³»ç»Ÿè¢«å†²å® è§£è€¦ï¼šé™ä½ç³»ç»Ÿé—´è€¦åˆåº¦ï¼Œæé«˜å¯ç»´æŠ¤æ€§ å¼‚æ­¥é€šä¿¡ï¼šæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ é¡ºåºä¿è¯ï¼šç¡®ä¿æ¶ˆæ¯æŒ‰ç‰¹å®šé¡ºåºå¤„ç† æ•°æ®å†—ä½™ï¼šæä¾›æ¶ˆæ¯æŒä¹…åŒ–ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± ç³»ç»Ÿæ‰©å±•ï¼šä¾¿äºç³»ç»Ÿæ°´å¹³æ‰©å±• AMQP é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®® AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰æ˜¯ä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡†åè®®ã€‚\näº¤æ¢å™¨ (Exchange) äº¤æ¢å™¨ç‰¹æ€§ äº¤æ¢å™¨ä¸äº¤æ¢å™¨å¯ä»¥ç›¸äº’ç»‘å®š äº¤æ¢å™¨ç±»å‹ fanoutã€topicã€directã€headerã€systemã€è‡ªå®šä¹‰ äº¤æ¢å™¨å±æ€§ æŒä¹…åŒ–ï¼šdurable å‚æ•°è®©äº¤æ¢å™¨å­˜ç›˜ è‡ªåŠ¨åˆ é™¤ï¼šå½“æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—æˆ–äº¤æ¢å™¨éƒ½è§£ç»‘åè‡ªåŠ¨åˆ é™¤(è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯è‡³å°‘æœ‰ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨ä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨éƒ½ä¸æ­¤è§£ç»‘ã€‚) é˜Ÿåˆ— (Queue) é˜Ÿåˆ—ç‰¹æ€§ é˜Ÿåˆ—ä¸äº¤æ¢å™¨è¿›è¡Œç»‘å®š é˜Ÿåˆ—å±æ€§ æŒä¹…åŒ–ï¼šdurable å‚æ•°è®©é˜Ÿåˆ—å­˜ç›˜ æ’ä»–æ€§ï¼šexclusive å‚æ•°ä½¿é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œè¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ è‡ªåŠ¨åˆ é™¤ï¼šå½“æ‰€æœ‰æ¶ˆè´¹è€…éƒ½æ–­å¼€è¿æ¥æ—¶è‡ªåŠ¨åˆ é™¤(è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤) å£°æ˜æœºåˆ¶ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å¯ä»¥å£°æ˜äº¤æ¢å™¨æˆ–é˜Ÿåˆ—ï¼š\nå¦‚æœå£°æ˜çš„å‚æ•°å®Œå…¨åŒ¹é…ç°å­˜çš„äº¤æ¢å™¨æˆ–è€…é˜Ÿåˆ—ï¼ŒRabbitMQ ç›´æ¥è¿”å›æˆåŠŸ å¦‚æœå‚æ•°ä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ æ¶ˆè´¹è€…ç«¯ç¡®è®¤æœºåˆ¶ ACK ç¡®è®¤ è‡ªåŠ¨ç¡®è®¤ï¼šé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤å·²å‘é€çš„æ¶ˆæ¯ï¼Œå¦‚æœæ˜¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¼šè‡ªåŠ¨çš„æŠŠå‘é€å‡ºå»çš„æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤(å…¶å®æ˜¯å…ˆæ‰“ä¸Šæ ‡ç­¾ï¼Œä¹‹åå†åˆ é™¤) æ˜¾å¼ç¡®è®¤ï¼šç­‰å¾…æ¶ˆè´¹è€…æ˜¾å¼ç¡®è®¤åæ‰åˆ é™¤æ¶ˆæ¯ï¼Œå¦‚æœæ˜¯ç­‰å¾…æ¶ˆè´¹è€…æ˜¾ç¤ºçš„ç¡®è®¤æœºåˆ¶ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¼šç­‰å¾…æ¶ˆè´¹è€…æ˜¾ç¤ºçš„ç¡®è®¤æ”¶åˆ°äº†æ¶ˆæ¯ä¹‹åï¼Œå†æŠŠæ¶ˆæ¯ä»å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­åˆ é™¤ æ‹’ç»æ¶ˆæ¯ rejectï¼šæ¶ˆè´¹è€…æ˜ç¡®æ‹’ç»æ¶ˆæ¯(å¦‚æœæ¶ˆè´¹è€…æ˜ç¡®æ‹’ç»å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¼šæ ¹æ®æ¶ˆè´¹è€…æ˜¯å¦è®¾ç½®äº†requeueå‚æ•°ï¼Œå¦‚æœè¯¥å‚æ•°æ˜¯trueé‚£ä¹ˆè¯¥æ¶ˆæ¯ä¼šè¢«é‡æ–°åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸‹ä¸€æ¬¡çš„æŠ•é€’ï¼›å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸ºfalseé‚£ä¹ˆé˜Ÿåˆ—å°†ç›´æ¥ç§»é™¤è¯¥æ¶ˆæ¯)\nrequeue=trueï¼šæ¶ˆæ¯é‡æ–°åŠ å…¥é˜Ÿåˆ—ç­‰å¾…ä¸‹æ¬¡æŠ•é€’ requeue=falseï¼šé˜Ÿåˆ—ç›´æ¥ç§»é™¤æ¶ˆæ¯ æ¶ˆæ¯è·¯ç”±æ§åˆ¶ mandatory å‚æ•°(å¼ºè°ƒçš„æ˜¯æ²¡æœ‰è·¯ç”±åˆ°ä»»ä½•é˜Ÿåˆ—çš„æƒ…å†µä¸‹ï¼Œå½“mandatoryå‚æ•°è®¾ä¸ºtrueæ—¶ï¼Œäº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«çš„ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆRabbitMQä¼šè°ƒç”¨Basic.Returnå‘½ä»¤å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚å½“mandatoryå‚æ•°è®¾ç½®ä¸ºfalseæ—¶ï¼Œå‡ºç°ä¸Šè¿°æƒ…å½¢ï¼Œåˆ™æ¶ˆæ¯ç›´æ¥è¢«ä¸¢å¼ƒ) trueï¼šå½“æ— æ³•è·¯ç”±åˆ°ä»»ä½•é˜Ÿåˆ—æ—¶ï¼Œé€šè¿‡ Basic.Return å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€… falseï¼šæ— æ³•è·¯ç”±æ—¶ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯ immediate å‚æ•°ï¼ˆRabbitMQ 3.0+ å·²ç§»é™¤ï¼‰ åŸåŠŸèƒ½ï¼šå¼ºè°ƒçš„æ˜¯è·¯ç”±åˆ°é˜Ÿåˆ—å é˜Ÿåˆ—ä¸Šæ²¡æœ‰æ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œå½“immediateå‚æ•°è®¾ä¸ºtrueæ—¶ï¼Œå¦‚æœäº¤æ¢å™¨åœ¨å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—æ—¶å‘ç°é˜Ÿåˆ—ä¸Šå¹¶ä¸å­˜åœ¨ä»»ä½•æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°†ä¸ä¼šå­˜å…¥é˜Ÿåˆ—ä¸­ã€‚å½“ä¸è·¯ç”±é”®åŒ¹é…çš„æ‰€æœ‰é˜Ÿåˆ—éƒ½æ²¡æœ‰æ¶ˆè´¹è€…æ—¶,è¯¥æ¶ˆæ¯ä¼šé€šè¿‡ Basic.Return è¿”å›è‡³ç”Ÿäº§è€…ã€‚ [!NOTE]\næ¦‚æ‹¬æ¥è¯´,mandatoryå‚æ•°å‘Šè¯‰æœåŠ¡å™¨è‡³å°‘å°†è¯¥æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­,å¦åˆ™å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚immediateå‚æ•°å‘Šè¯‰æœåŠ¡å™¨å¦‚æœè¯¥æ¶ˆæ¯å…³è”çš„é˜Ÿåˆ—ä¸Šæœ‰æ¶ˆè´¹è€…ï¼Œåˆ™ç«‹åˆ»æŠ•é€’ã€‚å¦‚æœæ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¸Šéƒ½æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œåˆ™ç›´æ¥å°†æ¶ˆæ¯è¿”è¿˜ç»™ç”Ÿäº§è€…ä¸ç”¨å°†æ¶ˆæ¯å­˜å…¥é˜Ÿåˆ—è€Œç­‰å¾…æ¶ˆè´¹è€…äº†ã€‚RabbitMQ3.0ç‰ˆæœ¬å¼€å§‹å»æ‰äº†å¯¹immediateå‚æ•°çš„æ”¯æŒï¼Œimmediateå‚æ•°å½±å“ç«ç›¸é˜Ÿåˆ—çš„æ€§èƒ½\næ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´è®¾ç½® æ¶ˆæ¯è¿‡æœŸæ—¶é—´ é˜Ÿåˆ—çº§åˆ«ï¼šè®¾ç½® x-message-ttl å±æ€§ï¼Œç»Ÿä¸€æ‰€æœ‰æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´(æ–¹æ³•æ˜¯è®¾ç½®é˜Ÿåˆ—çš„x-message-ttlå±æ€§ï¼Œæ‰€æœ‰å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´éƒ½æ˜¯ä¸€æ ·çš„) æ¶ˆæ¯çº§åˆ«ï¼šåœ¨å‘å¸ƒæ¶ˆæ¯æ—¶è®¾ç½® expiration å±æ€§ï¼Œæ”¯æŒä¸ªæ€§åŒ–è¿‡æœŸæ—¶é—´(æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªæ¶ˆæ¯éƒ½è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåœ¨ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™è®¾ç½®å±æ€§expirationå±æ€§ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½å¯ä»¥è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´) é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ è®¾ç½®é˜Ÿåˆ—çš„x-expireså±æ€§å¯ä»¥æ§åˆ¶é˜Ÿåˆ—è¢«è‡ªåŠ¨åˆ é™¤å‰å¤„äºæœªä½¿ç”¨çŠ¶æ€çš„æ—¶é—´ã€‚æœªä½¿ç”¨çš„æ„æ€æ˜¯é˜Ÿåˆ—ä¸Šæ²¡æœ‰ä»»ä½•çš„æ¶ˆè´¹è€…ï¼Œé˜Ÿåˆ—ä¹Ÿæ²¡æœ‰è¢«é‡æ–°å£°æ˜ï¼Œå¹¶ä¸”åœ¨è¿‡æœŸæ—¶é—´æ®µå†…ä¹Ÿæœªè°ƒç”¨è¿‡Basic.Getå‘½ä»¤ã€‚\nè®¾ç½® x-expires å±æ€§æ§åˆ¶é˜Ÿåˆ—åœ¨æœªä½¿ç”¨çŠ¶æ€ä¸‹çš„å­˜æ´»æ—¶é—´ æ­»ä¿¡æœºåˆ¶ æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡çš„æ¡ä»¶ æ¶ˆæ¯è¢«æ‹’ç» (Basic.Reject/Basic .Nack) ï¼Œå¹¶ä¸”è®¾ç½® requeue å‚æ•°ä¸º false ( requeue=false) æ¶ˆæ¯è¿‡æœŸ é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ æ­»ä¿¡äº¤æ¢å™¨å’Œé˜Ÿåˆ— å¸¸è§„çš„äº¤æ¢å™¨å’Œé˜Ÿåˆ—é…ç½® éƒ½æ˜¯å¸¸è§„çš„ä¸œè¥¿ï¼Œå½“é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æˆäº†æ­»ä¿¡ä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨å‘é€åˆ°æ­»ä¿¡äº¤æ¢å™¨ä¸­ ç”¨äºå®ç°å»¶æ—¶é˜Ÿåˆ—åŠŸèƒ½ å»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ä½¿ç”¨æ­»ä¿¡äº¤æ¢å™¨ã€æ­»ä¿¡é˜Ÿåˆ—æ¥å®ç°çš„ã€‚æ­»ä¿¡äº¤æ¢å™¨ä¹Ÿå«åšå»¶æ—¶äº¤æ¢å™¨ï¼Œæ­»ä¿¡é˜Ÿåˆ—ä¹Ÿå«åšå»¶æ—¶é˜Ÿåˆ—ã€‚ é«˜çº§ç‰¹æ€§ ä¼˜å…ˆçº§é˜Ÿåˆ— è®¾ç½®é˜Ÿåˆ—çš„ x-max-priority å‚æ•°æ¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ— å•æ¡æ¶ˆæ¯éœ€è¦è®¾ç½®å•ç‹¬çš„ä¼˜å…ˆçº§ RPC å®ç° Aå®¢æˆ·ç«¯ â†’ é˜Ÿåˆ—A â†’ BæœåŠ¡å™¨å¤„ç† â†’ é˜Ÿåˆ—B â†’ Aå®¢æˆ·ç«¯\nAå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªé˜Ÿåˆ—Aï¼ŒBæœåŠ¡å™¨æ¶ˆè´¹é˜Ÿåˆ—Aä¸­çš„æ¶ˆæ¯ï¼Œç„¶åBæœåŠ¡å™¨å¤„ç†æ¶ˆæ¯å¹¶ä¸”æŠŠç»“æœå‘é€åˆ°é˜Ÿåˆ—Bï¼ŒAå®¢æˆ·ç«¯å†æ¶ˆè´¹é˜Ÿåˆ—Bä¸­çš„æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨rabbitmqçš„é»˜è®¤äº¤æ¢å™¨ï¼Œåå­—ä¸ºç©ºå­—ç¬¦ä¸² è·¯ç”±keyå’Œç»‘å®škeyå°±ç”¨é˜Ÿåˆ—åç§°\nä½¿ç”¨é»˜è®¤äº¤æ¢å™¨ï¼ˆç©ºå­—ç¬¦ä¸²åç§°ï¼‰ è·¯ç”±é”®å’Œç»‘å®šé”®ä½¿ç”¨é˜Ÿåˆ—åç§° æŒä¹…åŒ–æœºåˆ¶ RabbitMQ æŒä¹…åŒ–åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š\näº¤æ¢å™¨æŒä¹…åŒ–ï¼šå£°æ˜äº¤æ¢å™¨æ—¶çš„å±æ€§durableè®¾ç½®ä¸ºtrue durable=true é˜Ÿåˆ—æŒä¹…åŒ–ï¼šå£°æ˜é˜Ÿåˆ—æ—¶çš„å±æ€§durableè®¾ç½®ä¸ºtrue durable=true æ¶ˆæ¯æŒä¹…åŒ–ï¼šåœ¨æ¶ˆæ¯å‘å¸ƒçš„æ—¶å€™è®¾ç½®deliveryå±æ€§ä¸º2 delivery=2 æ¶ˆæ¯å¯é æ€§ äº‹åŠ¡æœºåˆ¶ vs Publisher Confirm ä¸¤è€…äº’æ–¥ï¼Œä¸èƒ½å…±å­˜ ç¡®ä¿æ¶ˆæ¯æ­£ç¡®å‘é€è‡³ RabbitMQ äº¤æ¢å™¨ å‘é€æ–¹ç¡®è®¤æœºåˆ¶ç±»å‹ æ™®é€šç¡®è®¤æœºåˆ¶ æ‰¹é‡ç¡®è®¤æœºåˆ¶ å¼‚æ­¥ç¡®è®¤æœºåˆ¶ [!IMPORTANT]\näº‹åŠ¡æœºåˆ¶å’Œpublisher confirm(å‘é€æ–¹ç¡®è®¤æœºåˆ¶)æœºåˆ¶ä¸¤è€…æ˜¯äº’æ–¥çš„ï¼Œä¸èƒ½å…±å­˜ã€‚ç¡®ä¿çš„æ˜¯æ¶ˆæ¯èƒ½å¤Ÿæ­£ç¡®åœ°å‘é€è‡³RabbitMQï¼Œè¿™é‡Œçš„â€œå‘é€è‡³RabbitMQâ€çš„å«ä¹‰æ˜¯æŒ‡æ¶ˆæ¯è¢«æ­£ç¡®åœ°å‘å¾€è‡³RabbitMQçš„äº¤æ¢å™¨ï¼Œå¦‚æœæ­¤äº¤æ¢å™¨æ²¡æœ‰åŒ¹é…çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¹Ÿä¼šä¸¢å¤±ã€‚å‘é€æ–¹ç¡®è®¤æœºåˆ¶åˆæœ‰æ™®é€šç¡®è®¤æœºåˆ¶ã€æ‰¹é‡ç¡®è®¤æœºåˆ¶ã€å¼‚æ­¥ç¡®è®¤æœºåˆ¶ã€‚\næ¶ˆæ¯å¤„ç† æ¶ˆæ¯åˆ†å‘ å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ—¶é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šè¢«è½®è¯¢å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªæ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ æ¶ˆæ¯é¡ºåºæ€§ ä»…åœ¨å•ç”Ÿäº§è€…+å•æ¶ˆè´¹è€…+æ— å¼‚å¸¸æƒ…å†µä¸‹ä¿è¯é¡ºåºæ€§\nåœ¨å•ä¸ªç”Ÿäº§è€…å’Œå•ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”ä¸è€ƒè™‘æ¶ˆæ¯ä¸¢å¤±ã€ç½‘ç»œæ•…éšœç­‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚å…¶ä»–ä»»ä½•æƒ…å†µéƒ½ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§\næ¶ˆæ¯ä¼ è¾“ä¿éšœ ä¿éšœçº§åˆ« æè¿° At most once æ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä½†ä¸ä¼šé‡å¤(æœ€å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ç»ä¸ä¼šé‡å¤ä¼ è¾“) At least once æ¶ˆæ¯ç»ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½é‡å¤(æœ€å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯ç»ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½ä¼šé‡å¤ä¼ è¾“) Exactly once æ¶ˆæ¯ä¼ è¾“ä¸€æ¬¡ä¸”ä»…ä¸€æ¬¡(æ°å¥½ä¸€æ¬¡ã€‚æ¯æ¡æ¶ˆæ¯è‚¯å®šä¼šè¢«ä¼ è¾“ä¸€æ¬¡ä¸”ä»…ä¼ è¾“ä¸€æ¬¡) [!IMPORTANT]\nRabbitMQ æ”¯æŒï¼š\u0026quot;æœ€å¤šä¸€æ¬¡\u0026quot;å’Œ\u0026quot;æœ€å°‘ä¸€æ¬¡\u0026quot;\né«˜çº§é˜Ÿåˆ—ç±»å‹ æƒ°æ€§é˜Ÿåˆ— (Lazy Queue) æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½åœ°å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒæ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ï¼Œåœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡x-queue-modeå‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸º default å’Œ lazy\næ¶ˆæ¯ä¼˜å…ˆå­˜å…¥ç£ç›˜ï¼Œæ¶ˆè´¹æ—¶åŠ è½½åˆ°å†…å­˜ æ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—å’Œæ›´å¤šæ¶ˆæ¯å­˜å‚¨ é€šè¿‡ x-queue-mode å‚æ•°è®¾ç½®ï¼šdefault æˆ– lazy é•œåƒé˜Ÿåˆ— (Mirror Queue) å°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»– BrokerèŠ‚ç‚¹ä¹‹ä¸Šï¼Œå¦‚æœé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†ï¼Œé˜Ÿåˆ—èƒ½è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°é•œåƒä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚åœ¨é€šå¸¸çš„ç”¨æ³•ä¸­ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªé…ç½®é•œåƒçš„é˜Ÿåˆ—(ä»¥ä¸‹ç®€ç§°é•œåƒé˜Ÿåˆ—ã€‰éƒ½åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹(master) å’Œè‹¥å¹²ä¸ªä»èŠ‚ç‚¹ (slave)\nå°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»– Broker èŠ‚ç‚¹ åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ (master) å’Œå¤šä¸ªä»èŠ‚ç‚¹ (slave) ä¸»èŠ‚ç‚¹å¤±æ•ˆæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°é•œåƒèŠ‚ç‚¹ ","link":"https://jianlin-li.github.io/post/rabbitmq_review/","section":"post","tags":["RabbitMQ"],"title":"RabbitMQæ¶ˆæ¯ä¸­é—´ä»¶è¯¦è§£"},{"body":"","link":"https://jianlin-li.github.io/tags/php/","section":"tags","tags":null,"title":"PHP"},{"body":"","link":"https://jianlin-li.github.io/categories/php%E8%AF%AD%E8%A8%80/","section":"categories","tags":null,"title":"PHPè¯­è¨€"},{"body":"ä¸‹é¢æ˜¯å°†ä½ æä¾›çš„ Go è¯­è¨€ä»£ç ï¼ˆHTTP çŠ¶æ€ç å¸¸é‡å’Œ StatusText å‡½æ•°ï¼‰å®Œæ•´è½¬æ¢ä¸º PHP è¯­è¨€çš„å®ç°ã€‚PHP ä¸­æ²¡æœ‰åŸç”Ÿçš„ const å—ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ define() æˆ– class ä¸­çš„ const æ¥å®šä¹‰å¸¸é‡ï¼Œæ¨èä½¿ç”¨ç±»å°è£…çš„æ–¹å¼æ›´æ¸…æ™°ã€‚ âœ… PHP å®ç°ï¼šHTTP çŠ¶æ€ç å¸¸é‡ + çŠ¶æ€æ–‡æœ¬å‡½æ•° 1\u0026lt;?php 2 3class HttpStatus 4{ 5 // 1xx Informational 6 const StatusContinue = 100; 7 const StatusSwitchingProtocols = 101; 8 const StatusProcessing = 102; 9 const StatusEarlyHints = 103; 10 11 // 2xx Success 12 const StatusOK = 200; 13 const StatusCreated = 201; 14 const StatusAccepted = 202; 15 const StatusNonAuthoritativeInfo = 203; 16 const StatusNoContent = 204; 17 const StatusResetContent = 205; 18 const StatusPartialContent = 206; 19 const StatusMultiStatus = 207; 20 const StatusAlreadyReported = 208; 21 const StatusIMUsed = 226; 22 23 // 3xx Redirection 24 const StatusMultipleChoices = 300; 25 const StatusMovedPermanently = 301; 26 const StatusFound = 302; 27 const StatusSeeOther = 303; 28 const StatusNotModified = 304; 29 const StatusUseProxy = 305; 30 // 306 is unused, skipped 31 const StatusTemporaryRedirect = 307; 32 const StatusPermanentRedirect = 308; 33 34 // 4xx Client Error 35 const StatusBadRequest = 400; 36 const StatusUnauthorized = 401; 37 const StatusPaymentRequired = 402; 38 const StatusForbidden = 403; 39 const StatusNotFound = 404; 40 const StatusMethodNotAllowed = 405; 41 const StatusNotAcceptable = 406; 42 const StatusProxyAuthRequired = 407; 43 const StatusRequestTimeout = 408; 44 const StatusConflict = 409; 45 const StatusGone = 410; 46 const StatusLengthRequired = 411; 47 const StatusPreconditionFailed = 412; 48 const StatusRequestEntityTooLarge = 413; 49 const StatusRequestURITooLong = 414; 50 const StatusUnsupportedMediaType = 415; 51 const StatusRequestedRangeNotSatisfiable = 416; 52 const StatusExpectationFailed = 417; 53 const StatusTeapot = 418; 54 const StatusMisdirectedRequest = 421; 55 const StatusUnprocessableEntity = 422; 56 const StatusLocked = 423; 57 const StatusFailedDependency = 424; 58 const StatusTooEarly = 425; 59 const StatusUpgradeRequired = 426; 60 const StatusPreconditionRequired = 428; 61 const StatusTooManyRequests = 429; 62 const StatusRequestHeaderFieldsTooLarge = 431; 63 const StatusUnavailableForLegalReasons = 451; 64 65 // 5xx Server Error 66 const StatusInternalServerError = 500; 67 const StatusNotImplemented = 501; 68 const StatusBadGateway = 502; 69 const StatusServiceUnavailable = 503; 70 const StatusGatewayTimeout = 504; 71 const StatusHTTPVersionNotSupported = 505; 72 const StatusVariantAlsoNegotiates = 506; 73 const StatusInsufficientStorage = 507; 74 const StatusLoopDetected = 508; 75 const StatusNotExtended = 510; 76 const StatusNetworkAuthenticationRequired = 511; 77 78 /** 79 * Returns the reason phrase for the given HTTP status code. 80 * 81 * @param int $code HTTP status code 82 * @return string The reason phrase, or empty string if unknown. 83 */ 84 public static function statusText(int $code): string 85 { 86 return match ($code) { 87 self::StatusContinue =\u0026gt; \u0026#39;Continue\u0026#39;, 88 self::StatusSwitchingProtocols =\u0026gt; \u0026#39;Switching Protocols\u0026#39;, 89 self::StatusProcessing =\u0026gt; \u0026#39;Processing\u0026#39;, 90 self::StatusEarlyHints =\u0026gt; \u0026#39;Early Hints\u0026#39;, 91 92 self::StatusOK =\u0026gt; \u0026#39;OK\u0026#39;, 93 self::StatusCreated =\u0026gt; \u0026#39;Created\u0026#39;, 94 self::StatusAccepted =\u0026gt; \u0026#39;Accepted\u0026#39;, 95 self::StatusNonAuthoritativeInfo =\u0026gt; \u0026#39;Non-Authoritative Information\u0026#39;, 96 self::StatusNoContent =\u0026gt; \u0026#39;No Content\u0026#39;, 97 self::StatusResetContent =\u0026gt; \u0026#39;Reset Content\u0026#39;, 98 self::StatusPartialContent =\u0026gt; \u0026#39;Partial Content\u0026#39;, 99 self::StatusMultiStatus =\u0026gt; \u0026#39;Multi-Status\u0026#39;, 100 self::StatusAlreadyReported =\u0026gt; \u0026#39;Already Reported\u0026#39;, 101 self::StatusIMUsed =\u0026gt; \u0026#39;IM Used\u0026#39;, 102 103 self::StatusMultipleChoices =\u0026gt; \u0026#39;Multiple Choices\u0026#39;, 104 self::StatusMovedPermanently =\u0026gt; \u0026#39;Moved Permanently\u0026#39;, 105 self::StatusFound =\u0026gt; \u0026#39;Found\u0026#39;, 106 self::StatusSeeOther =\u0026gt; \u0026#39;See Other\u0026#39;, 107 self::StatusNotModified =\u0026gt; \u0026#39;Not Modified\u0026#39;, 108 self::StatusUseProxy =\u0026gt; \u0026#39;Use Proxy\u0026#39;, 109 self::StatusTemporaryRedirect =\u0026gt; \u0026#39;Temporary Redirect\u0026#39;, 110 self::StatusPermanentRedirect =\u0026gt; \u0026#39;Permanent Redirect\u0026#39;, 111 112 self::StatusBadRequest =\u0026gt; \u0026#39;Bad Request\u0026#39;, 113 self::StatusUnauthorized =\u0026gt; \u0026#39;Unauthorized\u0026#39;, 114 self::StatusPaymentRequired =\u0026gt; \u0026#39;Payment Required\u0026#39;, 115 self::StatusForbidden =\u0026gt; \u0026#39;Forbidden\u0026#39;, 116 self::StatusNotFound =\u0026gt; \u0026#39;Not Found\u0026#39;, 117 self::StatusMethodNotAllowed =\u0026gt; \u0026#39;Method Not Allowed\u0026#39;, 118 self::StatusNotAcceptable =\u0026gt; \u0026#39;Not Acceptable\u0026#39;, 119 self::StatusProxyAuthRequired =\u0026gt; \u0026#39;Proxy Authentication Required\u0026#39;, 120 self::StatusRequestTimeout =\u0026gt; \u0026#39;Request Timeout\u0026#39;, 121 self::StatusConflict =\u0026gt; \u0026#39;Conflict\u0026#39;, 122 self::StatusGone =\u0026gt; \u0026#39;Gone\u0026#39;, 123 self::StatusLengthRequired =\u0026gt; \u0026#39;Length Required\u0026#39;, 124 self::StatusPreconditionFailed =\u0026gt; \u0026#39;Precondition Failed\u0026#39;, 125 self::StatusRequestEntityTooLarge =\u0026gt; \u0026#39;Request Entity Too Large\u0026#39;, 126 self::StatusRequestURITooLong =\u0026gt; \u0026#39;Request URI Too Long\u0026#39;, 127 self::StatusUnsupportedMediaType =\u0026gt; \u0026#39;Unsupported Media Type\u0026#39;, 128 self::StatusRequestedRangeNotSatisfiable =\u0026gt; \u0026#39;Requested Range Not Satisfiable\u0026#39;, 129 self::StatusExpectationFailed =\u0026gt; \u0026#39;Expectation Failed\u0026#39;, 130 self::StatusTeapot =\u0026gt; \u0026#34;I\u0026#39;m a teapot\u0026#34;, 131 self::StatusMisdirectedRequest =\u0026gt; \u0026#39;Misdirected Request\u0026#39;, 132 self::StatusUnprocessableEntity =\u0026gt; \u0026#39;Unprocessable Entity\u0026#39;, 133 self::StatusLocked =\u0026gt; \u0026#39;Locked\u0026#39;, 134 self::StatusFailedDependency =\u0026gt; \u0026#39;Failed Dependency\u0026#39;, 135 self::StatusTooEarly =\u0026gt; \u0026#39;Too Early\u0026#39;, 136 self::StatusUpgradeRequired =\u0026gt; \u0026#39;Upgrade Required\u0026#39;, 137 self::StatusPreconditionRequired =\u0026gt; \u0026#39;Precondition Required\u0026#39;, 138 self::StatusTooManyRequests =\u0026gt; \u0026#39;Too Many Requests\u0026#39;, 139 self::StatusRequestHeaderFieldsTooLarge =\u0026gt; \u0026#39;Request Header Fields Too Large\u0026#39;, 140 self::StatusUnavailableForLegalReasons =\u0026gt; \u0026#39;Unavailable For Legal Reasons\u0026#39;, 141 142 self::StatusInternalServerError =\u0026gt; \u0026#39;Internal Server Error\u0026#39;, 143 self::StatusNotImplemented =\u0026gt; \u0026#39;Not Implemented\u0026#39;, 144 self::StatusBadGateway =\u0026gt; \u0026#39;Bad Gateway\u0026#39;, 145 self::StatusServiceUnavailable =\u0026gt; \u0026#39;Service Unavailable\u0026#39;, 146 self::StatusGatewayTimeout =\u0026gt; \u0026#39;Gateway Timeout\u0026#39;, 147 self::StatusHTTPVersionNotSupported =\u0026gt; \u0026#39;HTTP Version Not Supported\u0026#39;, 148 self::StatusVariantAlsoNegotiates =\u0026gt; \u0026#39;Variant Also Negotiates\u0026#39;, 149 self::StatusInsufficientStorage =\u0026gt; \u0026#39;Insufficient Storage\u0026#39;, 150 self::StatusLoopDetected =\u0026gt; \u0026#39;Loop Detected\u0026#39;, 151 self::StatusNotExtended =\u0026gt; \u0026#39;Not Extended\u0026#39;, 152 self::StatusNetworkAuthenticationRequired =\u0026gt; \u0026#39;Network Authentication Required\u0026#39;, 153 154 default =\u0026gt; \u0026#39;\u0026#39; 155 }; 156 } 157} 158 159// --- ä½¿ç”¨ç¤ºä¾‹ --- 160// echo HttpStatus::statusText(200); // è¾“å‡º: OK 161// echo HttpStatus::statusText(404); // è¾“å‡º: Not Found 162// echo HttpStatus::statusText(999); // è¾“å‡º: (ç©ºå­—ç¬¦ä¸²) ğŸ” è¯´æ˜ PHP ç‰ˆæœ¬è¦æ±‚ï¼š\nä½¿ç”¨äº† match è¡¨è¾¾å¼ï¼ˆPHP 8.0+ï¼‰ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ PHP 7.xï¼Œå¯ä»¥ç”¨ switch æ›¿ä»£ã€‚ ä½¿ç”¨äº† : string è¿”å›ç±»å‹å£°æ˜ï¼ˆPHP 7.0+ï¼‰ã€‚ å…¼å®¹ PHP 7 çš„ statusText å®ç°ï¼ˆå¯é€‰ï¼‰ï¼š å¦‚æœä½ éœ€è¦å…¼å®¹ PHP 7ï¼Œå¯ä»¥å°† statusText æ”¹ä¸ºï¼š\n1 public static function statusText($code) 2 { 3 switch ($code) { 4 case self::StatusContinue: return \u0026#39;Continue\u0026#39;; 5 case self::StatusSwitchingProtocols: return \u0026#39;Switching Protocols\u0026#39;; 6 // ... å…¶ä»– case 7 case self::StatusNetworkAuthenticationRequired: return \u0026#39;Network Authentication Required\u0026#39;; 8 default: return \u0026#39;\u0026#39;; 9 } 10 } å‘½åé£æ ¼ï¼š\nä½¿ç”¨äº† PascalCase å¸¸é‡åï¼Œä¸ Go ä¿æŒä¸€è‡´ã€‚ ç±»å HttpStatus æ˜¯æ ‡å‡†åšæ³•ã€‚ âœ… æ€»ç»“ è¿™ä¸ª PHP ç±»å®Œæ•´å®ç°äº† Go ä»£ç ä¸­çš„æ‰€æœ‰ HTTP çŠ¶æ€ç å¸¸é‡å’Œ StatusText åŠŸèƒ½ï¼Œç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤ï¼Œå¯ç›´æ¥ç”¨äºé¡¹ç›®ä¸­ä½œä¸ºå·¥å…·ç±»ä½¿ç”¨ã€‚\n","link":"https://jianlin-li.github.io/post/php_review_2/","section":"post","tags":["PHP"],"title":"PHPè¯­è¨€çš„çŸ¥è¯†ç‚¹-2"},{"body":"ä»¥ä¸‹æ˜¯ PHP 7.0 åˆ° PHP 8.4 æ¯ä¸ªä¸»è¦ç‰ˆæœ¬æ‰€æœ‰å…³é”®å˜æ›´çš„å®Œæ•´æ¸…å•ï¼Œæ¯é¡¹å‡ä»¥ æ¸…æ™°ã€ç‹¬ç«‹ã€å¯è¿è¡Œï¼ˆæˆ–è¯´æ˜æ€§ï¼‰çš„ä»£ç å—å½¢å¼å‘ˆç°ï¼Œä¾¿äºä½ é€æ¡å¤åˆ¶ã€æµ‹è¯•å’Œå¤ä¹ ã€‚ ğŸ“˜ PHP 7.0 â€“ 8.4 å„ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ä¸é‡è¦å˜æ›´ï¼ˆå¸¦å®Œæ•´ä»£ç ç¤ºä¾‹ï¼‰ ğŸ”¹ PHP 7.0 1// 1. æ ‡é‡ç±»å‹å£°æ˜ï¼ˆéœ€ strict_typesï¼‰ 2declare(strict_types=1); 3function add(int $a, int $b): int { 4 return $a + $b; 5} 6echo add(2, 3); // 5 7 8// 2. è¿”å›ç±»å‹å£°æ˜ 9function getName(): string { 10 return \u0026#34;Alice\u0026#34;; 11} 12 13// 3. Null åˆå¹¶è¿ç®—ç¬¦ 14$username = $_GET[\u0026#39;user\u0026#39;] ?? \u0026#39;guest\u0026#39;; 15 16// 4. å¤ªç©ºèˆ¹è¿ç®—ç¬¦ 17echo 1 \u0026lt;=\u0026gt; 2; // -1 18echo 2 \u0026lt;=\u0026gt; 2; // 0 19echo 3 \u0026lt;=\u0026gt; 2; // 1 20 21// 5. åŒ¿åç±» 22$logger = new class { 23 public function log(string $msg) { 24 echo \u0026#34;[LOG] $msg\\n\u0026#34;; 25 } 26}; 27$logger-\u0026gt;log(\u0026#34;Hello\u0026#34;); 28 29// 6. Group use 30use Some\\Namespace\\{ClassA, ClassB as B}; 31 32// 7. ç§»é™¤ mysql_*ï¼ˆä»¥ä¸‹ä»£ç åœ¨ PHP 7+ æŠ¥é”™ï¼‰ 33// $conn = mysql_connect(); // âŒ Fatal error 34 35// 8. å®‰å…¨éšæœºæ•° 36$bytes = random_bytes(16); 37$int = random_int(1, 100); 38 39// 9. Closure::call() 40$obj = (object)[\u0026#39;x\u0026#39; =\u0026gt; 42]; 41(function() { echo $this-\u0026gt;x; })-\u0026gt;call($obj); // 42 ğŸ”¹ PHP 7.1 1// 1. å¯ä¸ºç©ºç±»å‹ 2function say(?string $name): void { 3 echo $name ?? \u0026#39;Anonymous\u0026#39;; 4} 5say(null); // Anonymous 6 7// 2. void è¿”å›ç±»å‹ 8function dump(mixed $x): void { 9 var_dump($x); 10} 11 12// 3. ç±»å¸¸é‡å¯è§æ€§ 13class Config { 14 private const SECRET = \u0026#39;xxx\u0026#39;; 15 public const PUBLIC_KEY = \u0026#39;pub\u0026#39;; 16} 17 18// 4. å¤šå¼‚å¸¸æ•è· 19try { 20 throw new InvalidArgumentException(\u0026#34;Bad input\u0026#34;); 21} catch (InvalidArgumentException | OutOfRangeException $e) { 22 echo \u0026#34;Caught: \u0026#34; . $e-\u0026gt;getMessage(); 23} 24 25// 5. å¯¹ç§°æ•°ç»„è§£æ„ 26[$a, $b] = [10, 20]; 27[\u0026#39;name\u0026#39; =\u0026gt; $n, \u0026#39;age\u0026#39; =\u0026gt; $a] = [\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;Bob\u0026#39;, \u0026#39;age\u0026#39; =\u0026gt; 30]; 28 29// 6. è´Ÿå­—ç¬¦ä¸²åç§» 30echo \u0026#34;hello\u0026#34;[-1]; // \u0026#39;o\u0026#39; 31 32// 7. iterable ä¼ªç±»å‹ 33function process(iterable $items): void { 34 foreach ($items as $item) {} 35} 36process([1, 2]); 37process(new ArrayIterator([3, 4])); 38 39// 8. å¼ƒç”¨ create_function() 40// $f = create_function(\u0026#39;$a,$b\u0026#39;, \u0026#39;return $a+$b;\u0026#39;); // âŒ Deprecated in 7.2, removed in 7.2+ 41$f = fn($a, $b) =\u0026gt; $a + $b; // âœ… ğŸ”¹ PHP 7.2 1// 1. object ç±»å‹æç¤º 2function cloneIt(object $obj): object { 3 return clone $obj; 4} 5 6// 2. is_countable() 7$data = [1, 2, 3]; 8if (is_countable($data)) { 9 echo count($data); // 3 10} 11 12// 3. å†…ç½® Sodiumï¼ˆç°ä»£åŠ å¯†ï¼‰ 13$key = random_bytes(SODIUM_CRYPTO_SECRETBOX_KEYBYTES); 14$nonce = random_bytes(SODIUM_CRYPTO_SECRETBOX_NONCEBYTES); 15$ciphertext = sodium_crypto_secretbox(\u0026#39;secret\u0026#39;, $nonce, $key); 16 17// 4. stream_isatty() 18if (stream_isatty(STDOUT)) { 19 echo \u0026#34;Running in terminal\\n\u0026#34;; 20} 21 22// 5. spl_object_id()ï¼ˆæ¯” hash æ›´å¿«ï¼‰ 23$obj = new stdClass(); 24$id = spl_object_id($obj); // int 25 26// 6. unserialize é»˜è®¤ç¦ç”¨å¯¹è±¡ååºåˆ—åŒ– 27$data = serialize(new stdClass()); 28// unserialize($data); // âŒ Notice: unserialize(): Class __PHP_Incomplete_Class not allowed 29$obj = unserialize($data, [\u0026#39;allowed_classes\u0026#39; =\u0026gt; [\u0026#39;stdClass\u0026#39;]]); // âœ… 30 31// 7. ç§»é™¤ __autoload() 32// function __autoload($class) {} // âŒ Fatal error 33spl_autoload_register(function($class) { /* ... */ }); // âœ… ğŸ”¹ PHP 7.3 1// 1. çµæ´» Heredoc 2$html = \u0026lt;\u0026lt;\u0026lt;HTML 3 \u0026lt;div\u0026gt; 4 Hello World 5 \u0026lt;/div\u0026gt; 6 HTML; 7 8// 2. JSON å¼‚å¸¸ 9try { 10 json_decode(\u0026#39;{invalid json}\u0026#39;, flags: JSON_THROW_ON_ERROR); 11} catch (JsonException $e) { 12 echo \u0026#34;JSON Error: \u0026#34; . $e-\u0026gt;getMessage(); 13} 14 15// 3. æ–°å­—ç¬¦ä¸²å‡½æ•° 16var_dump(str_contains(\u0026#39;hello world\u0026#39;, \u0026#39;world\u0026#39;)); // true 17var_dump(str_starts_with(\u0026#39;https://\u0026#39;, \u0026#39;http\u0026#39;)); // true 18var_dump(str_ends_with(\u0026#39;file.txt\u0026#39;, \u0026#39;.txt\u0026#39;)); // true 19 20// 4. å‡½æ•°è°ƒç”¨æœ«å°¾é€—å· 21$values = array_merge( 22 [1, 2], 23 [3, 4], // å…è®¸é€—å· 24); 25 26// 5. array_key_first / array_key_last 27$arr = [\u0026#39;a\u0026#39; =\u0026gt; 1, \u0026#39;b\u0026#39; =\u0026gt; 2]; 28echo array_key_first($arr); // a 29echo array_key_last($arr); // b 30 31// 6. hrtime() é«˜ç²¾åº¦æ—¶é—´ 32$start = hrtime(true); 33usleep(1000); 34$end = hrtime(true); 35echo \u0026#34;Elapsed: \u0026#34; . ($end - $start) / 1e6 . \u0026#34; Î¼s\\n\u0026#34;; 36 37// 7. å¼ƒç”¨èŠ±æ‹¬å·è®¿é—® 38// echo $str{0}; // âŒ Deprecated 39echo $str[0]; // âœ… ğŸ”¹ PHP 7.4 1// 1. å±æ€§ç±»å‹å£°æ˜ 2class User { 3 public int $id; 4 public ?string $name = null; 5} 6$user = new User(); 7$user-\u0026gt;id = 100; 8 9// 2. ç®­å¤´å‡½æ•° 10$factor = 10; 11$nums = array_map(fn($n) =\u0026gt; $n * $factor, [1, 2, 3]); // [10,20,30] 12 13// 3. ç©ºåˆå¹¶èµ‹å€¼ 14$config = []; 15$config[\u0026#39;debug\u0026#39;] ??= true; 16 17// 4. åå˜è¿”å› \u0026amp; é€†å˜å‚æ•° 18interface Factory { 19 function make(): object; 20} 21class UserFactory implements Factory { 22 function make(): User { return new User(); } // è¿”å›æ›´å…·ä½“ç±»å‹ âœ… 23} 24 25// 5. FFIï¼ˆéœ€å¯ç”¨ ext-ffiï¼‰ 26/* 27$libc = FFI::cdef(\u0026#34;int printf(const char *fmt, ...);\u0026#34;, \u0026#34;libc.so.6\u0026#34;); 28$libc-\u0026gt;printf(\u0026#34;Hello from C!\\n\u0026#34;); 29*/ 30 31// 6. å¼ƒç”¨èŠ±æ‹¬å·è®¿é—®ï¼ˆå½»åº•ç§»é™¤ï¼‰ 32// echo $arr{0}; // âŒ Fatal error in 7.4+ âš ï¸ æ³¨æ„ï¼šæ„é€ å™¨å±æ€§æå‡æ˜¯ PHP 8.0 ç‰¹æ€§ï¼Œ7.4 ä¸æ”¯æŒã€‚\nğŸ”¹ PHP 8.0 1// 1. è”åˆç±»å‹ 2function getId(int|string $id): void { 3 echo $id; 4} 5getId(100); 6getId(\u0026#34;abc\u0026#34;); 7 8// 2. å‘½åå‚æ•° 9htmlspecialchars(\u0026#34;\u0026lt;script\u0026gt;\u0026#34;, double_encode: false); 10 11// 3. å±æ€§ï¼ˆåŸç”Ÿæ³¨è§£ï¼‰ 12#[Attribute] 13class Route { 14 public function __construct(public string $path) {} 15} 16#[Route(\u0026#34;/api/users\u0026#34;)] 17class UserController {} 18 19// 4. æ„é€ å™¨å±æ€§æå‡ 20class Point { 21 public function __construct( 22 public float $x, 23 public float $y 24 ) {} 25} 26$p = new Point(1.5, 2.5); 27echo $p-\u0026gt;x; // 1.5 28 29// 5. match è¡¨è¾¾å¼ 30$status = match(404) { 31 200, 201 =\u0026gt; \u0026#39;ok\u0026#39;, 32 404 =\u0026gt; \u0026#39;not found\u0026#39;, 33 default =\u0026gt; \u0026#39;unknown\u0026#39;, 34}; 35 36// 6. Nullsafe è¿ç®—ç¬¦ 37$user = getUser(); // å¯èƒ½ä¸º null 38echo $user?-\u0026gt;profile?-\u0026gt;avatar; // è‹¥ä¸­é—´ä¸º nullï¼Œè¿”å› null 39 40// 7. WeakMap 41$map = new WeakMap(); 42$obj = new stdClass(); 43$map[$obj] = \u0026#39;data\u0026#39;; 44unset($obj); // è‡ªåŠ¨ä» map ä¸­ç§»é™¤ 45 46// 8. throw è¡¨è¾¾å¼ 47$fn = fn($val) =\u0026gt; $val ?: throw new InvalidArgumentException(\u0026#39;Empty\u0026#39;); 48 49// 9. é”™è¯¯å¤„ç†ç»Ÿä¸€ 50// strlen([]); // TypeErrorï¼ˆä¸å†æ˜¯ warningï¼‰ 51 52// 10. get_debug_type() 53echo get_debug_type(new DateTime()); // \u0026#34;DateTime\u0026#34; 54 55// 11. fdiv() 56$result = fdiv(5, 0); // INFï¼Œæ—  warning ğŸ”¹ PHP 8.1 1// 1. æšä¸¾ 2enum Status: string { 3 case Draft = \u0026#39;draft\u0026#39;; 4 case Published = \u0026#39;published\u0026#39;; 5} 6echo Status::Draft-\u0026gt;value; // \u0026#39;draft\u0026#39; 7 8// 2. åªè¯»å±æ€§ 9class User { 10 public readonly string $name; 11 public function __construct(string $name) { 12 $this-\u0026gt;name = $name; 13 } 14} 15$user = new User(\u0026#34;Alice\u0026#34;); 16// $user-\u0026gt;name = \u0026#34;Bob\u0026#34;; // Error! 17 18// 3. Fibersï¼ˆçº¤ç¨‹ï¼‰ 19$fiber = new Fiber(function () { 20 echo \u0026#34;Start\\n\u0026#34;; 21 $value = Fiber::suspend(\u0026#39;from fiber\u0026#39;); 22 echo \u0026#34;Resume with: $value\\n\u0026#34;; 23}); 24echo $fiber-\u0026gt;start(); // è¾“å‡º Startï¼Œè¿”å› \u0026#39;from fiber\u0026#39; 25$fiber-\u0026gt;resume(\u0026#39;back\u0026#39;); // è¾“å‡º Resume with: back 26 27// 4. never è¿”å›ç±»å‹ 28function redirect(string $url): never { 29 header(\u0026#34;Location: $url\u0026#34;); 30 exit(); 31} 32 33// 5. æ•°ç»„è§£åŒ…æ”¯æŒå­—ç¬¦ä¸²é”® 34$extra = [\u0026#39;role\u0026#39; =\u0026gt; \u0026#39;admin\u0026#39;]; 35$user = [\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;Alice\u0026#39;, ...$extra]; // [\u0026#39;name\u0026#39;=\u0026gt;\u0026#39;Alice\u0026#39;,\u0026#39;role\u0026#39;=\u0026gt;\u0026#39;admin\u0026#39;] 36 37// 6. åŠ¨æ€å±æ€§é»˜è®¤ç¦æ­¢ 38class User {} 39// (new User())-\u0026gt;age = 30; // Error in 8.2+, Warning in 8.1 40 41#[AllowDynamicProperties] 42class Flexible {} 43(new Flexible())-\u0026gt;anything = 1; // OK 44 45// 7. array_is_list() 46var_dump(array_is_list([1, 2, 3])); // true 47var_dump(array_is_list([\u0026#39;a\u0026#39; =\u0026gt; 1])); // false ğŸ”¹ PHP 8.2 1// 1. åªè¯»ç±»ï¼ˆæ‰€æœ‰å±æ€§è‡ªåŠ¨ readonlyï¼‰ 2readonly class Point { 3 public function __construct( 4 public float $x, 5 public float $y 6 ) {} 7} 8// $p = new Point(1, 2); $p-\u0026gt;x = 3; // Error! 9 10// 2. DNF Typesï¼ˆäº¤é›†+è”åˆï¼‰ 11function save((LoggerInterface\u0026amp;Serializable)|null $logger): void { 12 if ($logger) { 13 $logger-\u0026gt;log(\u0026#34;Saving\u0026#34;); 14 serialize($logger); 15 } 16} 17 18// 3. å­—é¢é‡ç±»å‹ 19function alwaysTrue(): true { return true; } 20function alwaysNull(): null { return null; } 21 22// 4. æ•æ„Ÿå‚æ•°éšè— 23function login( 24 string $username, 25 #[\\SensitiveParameter] string $password 26) { 27 // è‹¥æŠ›å¼‚å¸¸ï¼Œå †æ ˆä¸­ password æ˜¾ç¤ºä¸º [redacted] 28} 29 30// 5. Trait å¸¸é‡ 31trait Loggable { 32 public const LEVEL = \u0026#39;info\u0026#39;; 33} 34class Service { 35 use Loggable; 36} 37echo Service::LEVEL; // \u0026#39;info\u0026#39; 38 39// 6. å¼ƒç”¨ ${var} æ’å€¼ 40// echo \u0026#34;Hello ${name}\u0026#34;; // âŒ Deprecated 41echo \u0026#34;Hello {$name}\u0026#34;; // âœ… ğŸ”¹ PHP 8.3 1// 1. ç±»å¸¸é‡ç±»å‹å£°æ˜ 2class Config { 3 public const int MAX_SIZE = 100; 4 public const string API_URL = \u0026#39;https://api.example.com\u0026#39;; 5} 6 7// 2. json_validate() 8$input = \u0026#39;{\u0026#34;valid\u0026#34;: true}\u0026#39;; 9if (json_validate($input)) { 10 $data = json_decode($input); 11} 12 13// 3. Trait æ–¹æ³•åˆ«åæ”¯æŒè®¿é—®ä¿®é¥°ç¬¦ 14trait SayHello { 15 public function hello() { echo \u0026#34;Hello\u0026#34;; } 16} 17class Greeting { 18 use SayHello { 19 SayHello::hello as private _hello; 20 } 21} 22 23// 4. mb_str_pad() 24echo mb_str_pad(\u0026#34;cafÃ©\u0026#34;, 10, \u0026#34;â€¢\u0026#34;, STR_PAD_RIGHT, \u0026#34;UTF-8\u0026#34;); // cafÃ©â€¢â€¢â€¢â€¢ 25 26// 5. DatePeriod æ”¯æŒ ISO 8601 27$period = new DatePeriod(\u0026#39;R2/2023-01-01T00:00:00Z/P1D\u0026#39;); 28foreach ($period as $date) { 29 echo $date-\u0026gt;format(\u0026#39;Y-m-d\u0026#39;) . \u0026#34;\\n\u0026#34;; 30} ğŸ”¹ PHP 8.4 1// 1. äº¤é›†ç±»å‹ï¼ˆIntersection Typesï¼‰ 2interface Logger { public function log(string $msg); } 3interface Serializer { public function serialize(); } 4 5function process(Logger\u0026amp;Serializer $obj): void { 6 $obj-\u0026gt;log(\u0026#34;Processing\u0026#34;); 7 echo $obj-\u0026gt;serialize(); 8} 9 10// 2. æ ‡å‡†åŒ– #[Deprecated] 11#[Deprecated(reason: \u0026#34;Use newMethod() instead\u0026#34;, since: \u0026#34;8.4\u0026#34;)] 12function oldMethod() {} 13 14// 3. JIT é»˜è®¤å¯ç”¨ï¼ˆæ— éœ€ä»£ç ï¼Œé…ç½®å±‚é¢ï¼‰ 15// php.ini: opcache.jit=on 16 17// 4. new static() åœ¨å¸¸é‡è¡¨è¾¾å¼ä¸­ä½¿ç”¨ 18class Factory { 19 public const INSTANCE = new static(); 20 public function __construct() {} 21} 22 23// 5. array_is_list()ï¼ˆæ­£å¼ç¨³å®šï¼‰ 24var_dump(array_is_list([0 =\u0026gt; \u0026#39;a\u0026#39;, 1 =\u0026gt; \u0026#39;b\u0026#39;])); // true 25var_dump(array_is_list([1 =\u0026gt; \u0026#39;a\u0026#39;, 0 =\u0026gt; \u0026#39;b\u0026#39;])); // false 26 27// 6. memory_reset_peak_usage() 28memory_get_peak_usage(); // è·å–å³°å€¼ 29memory_reset_peak_usage(); // é‡ç½®è®¡æ•°å™¨ âœ… ä½¿ç”¨å»ºè®® å°†æ¯ä¸ªä»£ç å—å•ç‹¬ä¿å­˜ä¸º .php æ–‡ä»¶ï¼Œåœ¨å¯¹åº” PHP ç‰ˆæœ¬ç¯å¢ƒä¸­è¿è¡Œã€‚ ä½¿ç”¨ php -v ç¡®è®¤ç‰ˆæœ¬ã€‚ å¯¹äºé«˜ç‰ˆæœ¬ç‰¹æ€§ï¼ˆå¦‚ 8.4ï¼‰ï¼Œå¯åœ¨ Docker ä¸­æ‹‰å– php:8.4-cli æµ‹è¯•ã€‚ è¿™ä»½æ¸…å•å·²è¦†ç›– PHP 7.0 è‡³ 8.4 æ‰€æœ‰å®˜æ–¹è®°å½•çš„å…³é”®è¯­è¨€ç‰¹æ€§ã€æ ‡å‡†åº“å˜æ›´ã€å¼ƒç”¨ä¸ç§»é™¤é¡¹ï¼Œå…± è¶…è¿‡ 100 é¡¹ï¼Œæ¯é¡¹å‡æœ‰ç‹¬ç«‹ä»£ç ç¤ºä¾‹ï¼Œé€‚åˆç³»ç»Ÿå¤ä¹ ã€é¢è¯•å‡†å¤‡æˆ–å‡çº§è¿ç§»å‚è€ƒã€‚\n","link":"https://jianlin-li.github.io/post/php_review_1/","section":"post","tags":["PHP"],"title":"PHPè¯­è¨€çš„çŸ¥è¯†ç‚¹-1"},{"body":"","link":"https://jianlin-li.github.io/tags/sql/","section":"tags","tags":null,"title":"Sql"},{"body":"","link":"https://jianlin-li.github.io/categories/%E5%8D%8E%E5%BE%AE%E4%B8%96%E7%BA%AA/","section":"categories","tags":null,"title":"åå¾®ä¸–çºª"},{"body":"SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…· æç¤º ä¿®å¤UTF-8ä¸­æ–‡å­—ç¬¦è¢«é”™è¯¯è§£é‡Šä¸ºLatin-1å¯¼è‡´çš„ä¹±ç é—®é¢˜ï¼Œåªæ›¿æ¢å•å¼•å·å†…çš„å®Œæ•´ä¹±ç å­—ç¬¦ä¸²\n1\u0026lt;?php 2/** 3 * Desc: 4 * Created by PhpStorm 5 * Project: luoxi 6 * File: sql_fixer.php 7 * User: lijianlin 8 * Date: 2025/10/16 ä¸Šåˆ11:10:42 9 */ 10 11 12/** 13 * SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…· 14 * ä¿®å¤UTF-8ä¸­æ–‡å­—ç¬¦è¢«é”™è¯¯è§£é‡Šä¸ºLatin-1å¯¼è‡´çš„ä¹±ç é—®é¢˜ 15 */ 16 17/** 18 * SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…· 19 * ä¿®å¤UTF-8ä¸­æ–‡å­—ç¬¦è¢«é”™è¯¯è§£é‡Šä¸ºLatin-1å¯¼è‡´çš„ä¹±ç é—®é¢˜ 20 * æ”¹è¿›ç‰ˆï¼šåªæ›¿æ¢å•å¼•å·å†…çš„å®Œæ•´ä¹±ç å­—ç¬¦ä¸² 21 */ 22 23/** 24 * SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…· 25 * ä¿®å¤UTF-8ä¸­æ–‡å­—ç¬¦è¢«é”™è¯¯è§£é‡Šä¸ºLatin-1å¯¼è‡´çš„ä¹±ç é—®é¢˜ 26 * æ”¹è¿›ç‰ˆï¼šåªæ›¿æ¢å•å¼•å·å†…çš„å®Œæ•´ä¹±ç å­—ç¬¦ä¸² 27 */ 28class SqlEncodingFixer 29{ 30\tprivate $encodingFixes = [ 31\t\u0026#39;ÂµÂ¼Â³Ã¶\u0026#39; =\u0026gt; \u0026#39;å¯¼å‡º\u0026#39;, 32\t\u0026#39;ÃŒÃ­Â¼Ã“\u0026#39; =\u0026gt; \u0026#39;æ·»åŠ \u0026#39;, 33\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â´Â¦Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµå¤„ç†\u0026#39;, 34\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â·Â¢Ã†Ã°\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµå‘èµ·\u0026#39;, 35\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµ\u0026#39;, 36\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Ã‰Ã¨Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµè®¾è®¡\u0026#39;, 37\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â¹ÃœÃ€Ã­Â¹Â¤Â¾ÃŸ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµç®¡ç†å·¥å…·\u0026#39;, 38\t\u0026#39;ÃÃ·Â³ÃŒÃ‰Ã¨Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;æµç¨‹è®¾è®¡\u0026#39;, 39\t\u0026#39;ÃÃ·Â³ÃŒÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æµç¨‹è®¾ç½®\u0026#39;, 40\t\u0026#39;ÃÃ·Â³ÃŒÂ·Â¢Ã†Ã°\u0026#39; =\u0026gt; \u0026#39;æµç¨‹å‘èµ·\u0026#39;, // æ–°å¢ 41\t\u0026#39;Â¹Â«ÃÃ„Ã†Ã°Â²Ã\u0026#39; =\u0026gt; \u0026#39;å…¬æ–‡èµ·è‰\u0026#39;, 42\t\u0026#39;Ã“ÃƒÂ»Â§Ã‡Â©ÃƒÃ»ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·ç­¾åç»´æŠ¤\u0026#39;, 43\t\u0026#39;Ã‰ÃÂ´Â«Ã“ÃƒÂ»Â§Ã‡Â©ÃƒÃ»ÃÂ¼Ã†Â¬\u0026#39; =\u0026gt; \u0026#39;ä¸Šä¼ ç”¨æˆ·ç­¾åå›¾ç‰‡\u0026#39;, // æ–°å¢ 44\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Ã€Ã ÃÃ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµç±»å‹\u0026#39;, 45\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Ã“ÃƒÂ»Â§ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµç”¨æˆ·æƒé™\u0026#39;, 46\t\u0026#39;Ã“ÃƒÂ»Â§Â¹Â¤Ã—Ã·ÃÃ·ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å·¥ä½œæµæƒé™\u0026#39;, // æ–°å¢ 47\t\u0026#39;ÃÃ·Â³ÃŒÃˆÂ¨ÃÃÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æµç¨‹æƒé™è®¾ç½®\u0026#39;, 48\t\u0026#39;Â´Ã½Â´Â¦Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å¾…å¤„ç†\u0026#39;, 49\t\u0026#39;Â¹Â«ÃÃ„Ã‡Â©Â·Â¢\u0026#39; =\u0026gt; \u0026#39;å…¬æ–‡ç­¾æ‰¹\u0026#39;, 50\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Ã¤Â¯Ã€Ã€\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµæµè§ˆ\u0026#39;, 51\t\u0026#39;Â°Ã¯Ã–ÃºÃÃ„ÂµÂµÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;å¸®åŠ©æ–‡æ¡£ç»´æŠ¤\u0026#39;, 52\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµä¿®æ”¹\u0026#39;, 53\t\u0026#39;Â¹Â©Â¹ÃœÃ€Ã­Ã”Â±ÃŠÂ¹Ã“ÃƒÂ£Â¬Â¶Ã”Â¹Â¤Ã—Ã·ÃÃ·Ã„ÃšÃˆÃÂ½Ã¸ÃÃÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;ä¾›ç®¡ç†å‘˜ä½¿ç”¨ï¼Œå¯¹å·¥ä½œæµå†…å®¹è¿›è¡Œä¿®æ”¹\u0026#39;, // æ–°å¢ 54\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â²Ã©Ã”Ã„\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµæŸ¥é˜…\u0026#39;, 55\t\u0026#39;Â²Ã©Â¿Â´Ã‹Ã»ÃˆÃ‹ÂµÃ„Â¹Â¤Ã—Ã·ÃÃ·\u0026#39; =\u0026gt; \u0026#39;æŸ¥çœ‹ä»–äººçš„å·¥ä½œæµ\u0026#39;, 56\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â²Ã©Ã”Ã„ÃˆÂ¨ÃÃÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµæŸ¥é˜…æƒé™è®¾ç½®\u0026#39;, 57\t\u0026#39;Â²Ã©Â¿Â´Ã‹Ã»ÃˆÃ‹Â¹Â¤Ã—Ã·ÃÃ·ÃˆÂ¨ÃÃÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æŸ¥çœ‹ä»–äººå·¥ä½œæµæƒé™è®¾ç½®\u0026#39;, 58\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·ÃÃÂ¸Ã„ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµä¿®æ”¹æƒé™\u0026#39;, 59\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·ÃÃÂ¸Ã„ÃˆÂ¨ÃÃÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµä¿®æ”¹æƒé™è®¾ç½®\u0026#39;, 60\t\u0026#39;Ã†Ã°Â²ÃÃ–Ã\u0026#39; =\u0026gt; \u0026#39;èµ·è‰ä¸­\u0026#39;, 61\t\u0026#39;ÃÂ´ÃŒÃ¡Â½Â»\u0026#39; =\u0026gt; \u0026#39;æœªæäº¤\u0026#39;, 62\t\u0026#39;Ã’Ã‘Ã†Ã°Â²ÃÂµÂ«ÃÂ´Â·Â¢Ã†Ã°\u0026#39; =\u0026gt; \u0026#39;å·²èµ·è‰ä½†æœªå‘èµ·\u0026#39;, 63\t\u0026#39;Â½Ã¸ÃÃÃ–Ã\u0026#39; =\u0026gt; \u0026#39;è¿›è¡Œä¸­\u0026#39;, 64\t\u0026#39;Ã’Ã‘Â·Â¢Ã†Ã°ÂµÂ«Ã‰Ã³Ã…ÃºÂ´Â¦Ã€Ã­ÃÂ´ÃÃªÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;å·²å‘èµ·ä½†å®¡æ‰¹å¤„ç†æœªå®Œæˆ\u0026#39;, 65\t\u0026#39;Ã’Ã‘ÃÃªÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;å·²å®Œæˆ\u0026#39;, 66\t\u0026#39;Ã’Ã‘Â·Â¢Ã†Ã°Ã‡Ã’Ã‰Ã³Ã…ÃºÂ´Â¦Ã€Ã­ÃÃªÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;å·²å‘èµ·ä¸”å®¡æ‰¹å¤„ç†å®Œæˆ\u0026#39;, 67\t\u0026#39;Ã’Ã‘ÃÃ‹Â»Ã˜\u0026#39; =\u0026gt; \u0026#39;å·²é€€å›\u0026#39;, 68\t\u0026#39;Ã’Ã‘Â·Â¢Ã†Ã°ÂµÂ«Â±Â»Ã‰Ã³Ã…ÃºÂ´Â¦Ã€Ã­ÃˆÃ‹Â²ÂµÂ»Ã˜\u0026#39; =\u0026gt; \u0026#39;å·²å‘èµ·ä½†è¢«å®¡æ‰¹å¤„ç†äººé€€å›\u0026#39;, 69\t\u0026#39;Â´Â¦Ã€Ã­Ã–Ã\u0026#39; =\u0026gt; \u0026#39;å¤„ç†ä¸­\u0026#39;, 70\t\u0026#39;Ã’Ã‘Â´Â¦Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å·²å¤„ç†\u0026#39;, 71\t\u0026#39;Ã’Ã‘Â³Â·Â»Ã˜\u0026#39; =\u0026gt; \u0026#39;å·²æ’¤å›\u0026#39;, 72\t\u0026#39;Â±Â»ÃŒÃ¸Ã—Âª\u0026#39; =\u0026gt; \u0026#39;è¢«è·³è½¬\u0026#39;, 73\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â±Ã­ÂµÂ¥\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµè¡¨å•\u0026#39;, 74\t\u0026#39;Ã„Â£Â°Ã¥Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æ¨¡æ¿è®¾ç½®\u0026#39;, 75\t\u0026#39;ÃŠÃ½Â¾ÃÃ—Ã–ÂµÃ¤ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;æ•°æ®å­—å…¸ç»´æŠ¤\u0026#39;, 76\t\u0026#39;Ã‡Â©Ã…ÃºÂ½Ã¸Â¶ÃˆÂ¸ÃºÃ—Ã™\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹è¿›åº¦è·Ÿè¸ª\u0026#39;, 77\t\u0026#39;Ã‡Â©Ã…ÃºÂ½Ã¸Â¶ÃˆÂ¸ÃºÃ—Ã™(ÃÃ’Ã‡Â©Ã…ÃºÂµÃ„)\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹è¿›åº¦è·Ÿè¸ª(æˆ‘ç­¾æ‰¹çš„)\u0026#39;, // æ–°å¢ 78\t\u0026#39;ÃÂ¯ÃÃÃ‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å§”æ‰˜è®¾ç½®\u0026#39;, 79\t\u0026#39;ÃŠÃœÃÂ¯ÃÃÂ¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;å—å§”æ‰˜è®°å½•\u0026#39;, 80\t\u0026#39;ÃŠÃœÃÂ¯ÃÃÂ´Ã½Â´Â¦Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å—å§”æ‰˜å¾…å¤„ç†\u0026#39;, 81\t\u0026#39;ÃŠÃœÃÂ¯ÃÃÃ’Ã‘Â´Â¦Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å—å§”æ‰˜å·²å¤„ç†\u0026#39;, 82\t\u0026#39;ÃÂ¯ÃÃÂ´Â¦Ã€Ã­Â¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;å§”æ‰˜å¤„ç†è®°å½•\u0026#39;, 83\t\u0026#39;ÃŠÃœÃÂ¯ÃÃÂ´Â¦Ã€Ã­Ã–Ã\u0026#39; =\u0026gt; \u0026#39;å—å§”æ‰˜å¤„ç†ä¸­\u0026#39;, 84\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â¼Ã Â¿Ã˜\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµç›‘æ§\u0026#39;, 85\t\u0026#39;ÃÃ·Â³ÃŒÃÃ„Â¼Ã¾Ã‡Ã¥Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;æµç¨‹æ–‡ä»¶æ¸…ç†\u0026#39;, 86\t\u0026#39;Â±Ã­ÂµÂ¥Â°Ã¦Â±Â¾Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;è¡¨å•ç‰ˆæœ¬ç®¡ç†\u0026#39;, 87\t\u0026#39;Ã“Â¡Ã•Ã‚Ã–Ã†Ã—Ã·\u0026#39; =\u0026gt; \u0026#39;å°ç« åˆ¶ä½œ\u0026#39;, 88\t\u0026#39;Ã“Â¡Ã•Ã‚ÃˆÂ¨ÃÃÂ¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;å°ç« æƒé™ç®¡ç†\u0026#39;, 89\t\u0026#39;Â¸Ã¶ÃˆÃ‹Ã‡Â©Ã•Ã‚Â¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;ä¸ªäººç›–ç« è®°å½•\u0026#39;, 90\t\u0026#39;Ã‹Ã¹Ã“ÃÃ‡Â©Ã…ÃºÂ¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;æ‰€æœ‰ç­¾æ‰¹è®°å½•\u0026#39;, 91\t\u0026#39;Ã‹Ã¹Ã“ÃÃ‡Â©Ã•Ã‚Â¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;æ‰€æœ‰ç›–ç« è®°å½•\u0026#39;, 92\t\u0026#39;ÃÃ·Â³ÃŒÃ…ÃºÃÂ¿ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;æµç¨‹æ‰¹é‡ä¿®æ”¹\u0026#39;, 93\t\u0026#39;Â³Â£Ã“ÃƒÃ‡Â©Ã…ÃºÃ“Ã¯Â¾Ã¤Ã…Ã¤Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å¸¸ç”¨ç­¾æ‰¹è¯­å¥é…ç½®\u0026#39;, 94\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â¹Ã©ÂµÂµ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµå½’æ¡£\u0026#39;, 95\t\u0026#39;ÃÃ’Â·Â¢Ã†Ã°ÂµÃ„ÃÃ·Â³ÃŒ\u0026#39; =\u0026gt; \u0026#39;æˆ‘å‘èµ·çš„æµç¨‹\u0026#39;, 96\t\u0026#39;ÃÃ’Â´Â¦Ã€Ã­ÂµÃ„ÃÃ·Â³ÃŒ\u0026#39; =\u0026gt; \u0026#39;æˆ‘å¤„ç†çš„æµç¨‹\u0026#39;, 97\t\u0026#39;Â±Ã­ÂµÂ¥Ã—Ã”Â¶Â¨Ã’Ã¥Â±Ã¤ÃÂ¿\u0026#39; =\u0026gt; \u0026#39;è¡¨å•è‡ªå®šä¹‰å˜é‡\u0026#39;, 98\t\u0026#39;ÃÃ·Â³ÃŒÂ´Ã²Ã“Â¡Â±Ã­ÂµÂ¥Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æµç¨‹æ‰“å°è¡¨å•è®¾ç½®\u0026#39;, 99\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·Â±Â¨Â±Ã­\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµæŠ¥è¡¨\u0026#39;, 100\t\u0026#39;ÃÃ’ÂµÃ„Ã‡Â©Ã…ÃºÃÂ§Ã‚ÃŠÃÂ³Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;æˆ‘çš„ç­¾æ‰¹æ•ˆç‡ç»Ÿè®¡\u0026#39;, 101\t\u0026#39;Â¹Â«Ã‹Â¾ÃÃ·Â³ÃŒÃ‡Â©Ã…ÃºÃÂ³Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;å…¬å¸æµç¨‹ç­¾æ‰¹ç»Ÿè®¡\u0026#39;, 102\t\u0026#39;Â±Ã­ÂµÂ¥ÂµÂ¼Â³Ã¶Ã„Â£Â°Ã¥Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;è¡¨å•å¯¼å‡ºæ¨¡æ¿è®¾ç½®\u0026#39;, 103\t\u0026#39;ÃÃ·Â³ÃŒÃÂ£ÃÃ´ÃŠÂ±Â¼Ã¤ÃÂ³Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;æµç¨‹åœç•™æ—¶é—´ç»Ÿè®¡\u0026#39;, 104\t\u0026#39;Ã€Ã«Ã–Â°Â´ÃºÃ‡Â©Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;ç¦»èŒä»£ç­¾è®¾ç½®\u0026#39;, 105\t\u0026#39;Ã‡Â©Ã…ÃºÃÃ‹Â»Ã˜ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹é€€å›æ—¥å¿—\u0026#39;, 106\t\u0026#39;ÃÃ’ÂµÃ„Ã‡Â©Ã…ÃºÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;æˆ‘çš„ç­¾æ‰¹æ—¥å¿—\u0026#39;, 107\t\u0026#39;Ã‡Â©Ã…ÃºÃ‘Ã¹ÃŠÂ½Ã„Â£Â°Ã¥\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹æ ·å¼æ¨¡æ¿\u0026#39;, 108\t\u0026#39;ÃÃ·Â³ÃŒÂ¹ÃœÃ€Ã­Ã”Â±Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;æµç¨‹ç®¡ç†å‘˜è®¾ç½®\u0026#39;, 109\t\u0026#39;Â¹ÃœÃ€Ã­Ã”Â±Â²Ã©Â¿Â´ÃÃ·Â³ÃŒ\u0026#39; =\u0026gt; \u0026#39;ç®¡ç†å‘˜æŸ¥çœ‹æµç¨‹\u0026#39;, 110\t\u0026#39;Â¹Ã˜ÃÂªÂ¶Ã”ÃÃ³Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å…³è”å¯¹è±¡è®¾ç½®\u0026#39;, 111\t\u0026#39;Â½Ã‡Ã‰Â«Â¹Â¤Ã—Ã·ÃÃ·ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;è§’è‰²å·¥ä½œæµæƒé™\u0026#39;, 112\t\u0026#39;ÃÂ¨Â¹Ã½Â½Ã‡Ã‰Â«Â½Ã¸ÃÃÂ¹Â¤Ã—Ã·ÃÃ·ÃˆÂ¨ÃÃÃŠÃšÃˆÂ¨\u0026#39; =\u0026gt; \u0026#39;é€šè¿‡è§’è‰²è¿›è¡Œå·¥ä½œæµæƒé™æˆæƒ\u0026#39;, 113\t\u0026#39;Ã‡Â©Ã…ÃºÂ²Â»ÃÂ¬Ã’Ã¢Â¹Â¤Ã—Ã·ÃÃ·\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹ä¸åŒæ„å·¥ä½œæµ\u0026#39;, 114\t\u0026#39;OAÂ¹ÃœÃ€Ã­Ã”Â±ÃÂ¬Â»Â¤Â¹Â¤Â¾ÃŸ\u0026#39; =\u0026gt; \u0026#39;OAç®¡ç†å‘˜ç»´æŠ¤å·¥å…·\u0026#39;, 115\t\u0026#39;ÃÃ‚Ã”Ã¶\u0026#39; =\u0026gt; \u0026#39;æ–°å¢\u0026#39;, 116\t\u0026#39;Â¼Ã¬Â²Ã©\u0026#39; =\u0026gt; \u0026#39;æ£€æŸ¥\u0026#39;, 117\t\u0026#39;Â¸Â´Ã–Ã†\u0026#39; =\u0026gt; \u0026#39;å¤åˆ¶\u0026#39;, 118\t\u0026#39;Ã‰Â¾Â³Ã½\u0026#39; =\u0026gt; \u0026#39;åˆ é™¤\u0026#39;, 119\t\u0026#39;ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;ä¿®æ”¹\u0026#39;, 120\t\u0026#39;Â±Ã Â¼Â­\u0026#39; =\u0026gt; \u0026#39;ç¼–è¾‘\u0026#39;, 121\t\u0026#39;ÃÃÂ¸Ã„ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ä¿®æ”¹æƒé™\u0026#39;, 122\t\u0026#39;ÂµÂ¼Â³Ã¶\u0026#39; =\u0026gt; \u0026#39;å¯¼å‡º\u0026#39;, 123\t\u0026#39;ÂµÂ¼ÃˆÃ«\u0026#39; =\u0026gt; \u0026#39;å¯¼å…¥\u0026#39;, 124\t\u0026#39;Ã’Ã†Â¶Â¯Â¶Ã‹ÃŠÃŠÃ…Ã¤\u0026#39; =\u0026gt; \u0026#39;ç§»åŠ¨ç«¯é€‚é…\u0026#39;, 125\t\u0026#39;Ã‰Â¾Â³Ã½Â¹Â¤Ã—Ã·ÃÃ·\u0026#39; =\u0026gt; \u0026#39;åˆ é™¤å·¥ä½œæµ\u0026#39;, 126\t\u0026#39;ÃÃ”ÃŠÂ¾\u0026#39; =\u0026gt; \u0026#39;æ˜¾ç¤º\u0026#39;, 127\t\u0026#39;Ã‡Â©Ã…ÃºÂ´Â¦Ã€Ã­ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;ç­¾æ‰¹å¤„ç†æ—¥å¿—\u0026#39;, 128\t\u0026#39;ÃƒÃ·ÃÂ¸\u0026#39; =\u0026gt; \u0026#39;æ˜ç»†\u0026#39;, 129\t\u0026#39;ÃˆÂ«Â²Â¿Â¹Â¤Ã—Ã·ÃÃ·Â±Â¨Â±Ã­\u0026#39; =\u0026gt; \u0026#39;å…¨éƒ¨å·¥ä½œæµæŠ¥è¡¨\u0026#39;, 130\t\u0026#39;Â¹Â¤Ã—Ã·ÃÃ·ÃÂ¯ÃÃ\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæµå§”æ‰˜\u0026#39;, 131\t\u0026#39;Ã’Ã‘Â¹Ã©ÂµÂµÃÃ·Â³ÃŒ\u0026#39; =\u0026gt; \u0026#39;å·²å½’æ¡£æµç¨‹\u0026#39;, 132\t\u0026#39;Â´Â¦Ã€Ã­Â¶Â¥Â¼Â¶Â²Ã‹ÂµÂ¥ÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;å¤„ç†é¡¶çº§èœå•æ•°æ®\u0026#39;, 133\t\u0026#39;Ã’Â³ÃƒÃ¦Â¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;é¡µé¢å®šä¹‰ç”Ÿæˆ\u0026#39;, 134\t\u0026#39;Ã’Â³ÃƒÃ¦Â¹Â¦Ã„ÃœÂ¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã–\u0026#39; =\u0026gt; \u0026#39;é¡µé¢åŠŸèƒ½å®šä¹‰ç”Ÿæˆ\u0026#39;, 135\t\u0026#39;Ã‰ÃºÂ³Ã‰Ã„Â£Â¿Ã©Â¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;ç”Ÿæˆæ¨¡å—å®šä¹‰ç”Ÿæˆ\u0026#39;, 136\t\u0026#39;ÃÂµÃÂ³Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿç®¡ç†\u0026#39;, // æ–°å¢ 137 138 139\t\u0026#39;Ã—Ã©Ã–Â¯Ã‰Ã¨Â¶Â¨\u0026#39; =\u0026gt; \u0026#39;ç»„ç»‡è®¾å®š\u0026#39;, 140\t\u0026#39;Â½Ã‡Ã‰Â«Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;è§’è‰²ç®¡ç†\u0026#39;, 141\t\u0026#39;ÂµÂ¥ÂµÃ£ÂµÃ‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;å•ç‚¹ç™»å½•\u0026#39;, 142\t\u0026#39;ÂµÂ¼Â³Ã¶\u0026#39; =\u0026gt; \u0026#39;å¯¼å‡º\u0026#39;, 143\t\u0026#39;ÂµÃ¤ÃÃÂ´ÃºÃ‚Ã«Â¿Ã¢\u0026#39; =\u0026gt; \u0026#39;å…¸å‹ä»£ç åº“\u0026#39;, 144\t\u0026#39;Ã—ÂªÃ’Ã†Â¹Â²ÃÃ­Â¼Ã‡Ã‚Â¼\u0026#39; =\u0026gt; \u0026#39;è½¬ç§»å…±äº«è®°å½•\u0026#39;, 145\t\u0026#39;Ã“ÃƒÂ»Â§ÃÂ¢ÃÃ…Â¿ÂªÃÂ¨\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¾®ä¿¡å¼€é€š\u0026#39;, 146\t\u0026#39;Â¶Â¤Â¶Â¤Â´Ã½ÃÃ†Ã‹ÃÃÃ»ÃÂ¢\u0026#39; =\u0026gt; \u0026#39;é’‰é’‰å¾…æ¨é€æ¶ˆæ¯\u0026#39;, 147\t\u0026#39;Â·Ã¢Ã—Â°WIPÂµÂ¼ÃˆÃ«\u0026#39; =\u0026gt; \u0026#39;å°è£…WIPå¯¼å…¥\u0026#39;, 148\t\u0026#39;ÃÂµÃÂ³Â¶Â¨Ã’Ã¥Â±Ã­\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿå®šä¹‰è¡¨\u0026#39;, 149\t\u0026#39;Ã“ÃƒÂ»Â§Â¶Ã”Ã•Ã•\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¯¹ç…§\u0026#39;, 150\t\u0026#39;Â½Ã“ÃˆÃ«IPÂ¼Â°ÃƒÃœÃ”Â¿\u0026#39; =\u0026gt; \u0026#39;æ¥å…¥IPåŠå¯†ç \u0026#39;, 151\t\u0026#39;Â½Ã“Â¿ÃšÃÂµÃÂ³Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;æ¥å£ç³»ç»Ÿå®šä¹‰\u0026#39;, 152\t\u0026#39;Â½Ã“Â¿ÃšÂ´ÃºÃ‚Ã«Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;æ¥å£ä»£ç å®šä¹‰\u0026#39;, 153\t\u0026#39;ÃÂ´Â´Â¦Ã€Ã­Â½Ã“ÃŠÃ•ÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;æœªå¤„ç†æ¥æ”¶æ•°æ®\u0026#39;, 154\t\u0026#39;Â½Ã“ÃŠÃ•ÃŠÃ½Â¾ÃÃ€Ã½ÃÃ¢ÃÃ…ÃÂ¢\u0026#39; =\u0026gt; \u0026#39;æ¥æ”¶æ•°æ®ä¾‹å¤–ä¿¡æ¯\u0026#39;, 155\t\u0026#39;Ã’Ã‘Â´Â¦Ã€Ã­Â½Ã“ÃŠÃ•ÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;å·²å¤„ç†æ¥æ”¶æ•°æ®\u0026#39;, 156\t\u0026#39;Â½Ã“Â¿ÃšÃÂ´Â·Â¢Ã‹ÃÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;æ¥å£æœªå‘é€æ•°æ®\u0026#39;, 157\t\u0026#39;Â½Ã“Â¿ÃšÃ’Ã‘Â·Â¢Ã‹ÃÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;æ¥å£å·²å‘é€æ•°æ®\u0026#39;, 158\t\u0026#39;Â½Ã“ÃŠÃ•ÃÃ„Â¼Ã¾ÃÃÂ±Ã­\u0026#39; =\u0026gt; \u0026#39;æ¥æ”¶æ–‡ä»¶åˆ—è¡¨\u0026#39;, 159\t\u0026#39;ÃÂ¬Â²Â½ÂµÂ¼Â³Ã¶Â±Ã­Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;åŒæ­¥å¯¼å‡ºè¡¨è®¾ç½®\u0026#39;, 160\t\u0026#39;ÃÂ¬Â²Â½ÂµÂ¼Â³Ã¶Ã—Ã·Ã’Âµ\u0026#39; =\u0026gt; \u0026#39;åŒæ­¥å¯¼å‡ºä½œä¸š\u0026#39;, 161\t\u0026#39;Â´Ã½Â·Â¢ÃŒÃ¡ÃÃ‘Ã“ÃŠÂ¼Ã¾\u0026#39; =\u0026gt; \u0026#39;å¾…å‘æé†’é‚®ä»¶\u0026#39;, 162\t\u0026#39;Ã’Ã‘Â·Â¢ÃŒÃ¡ÃÃ‘Ã“ÃŠÂ¼Ã¾\u0026#39; =\u0026gt; \u0026#39;å·²å‘æé†’é‚®ä»¶\u0026#39;, 163\t\u0026#39;ÃÂ¬Â²Â½ÂµÂ¼ÃˆÃ«Ã—Ã·Ã’Âµ\u0026#39; =\u0026gt; \u0026#39;åŒæ­¥å¯¼å…¥ä½œä¸š\u0026#39;, 164\t\u0026#39;FTPÂµÃ˜Ã–Â·ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;FTPåœ°å€ç»´æŠ¤\u0026#39;, 165\t\u0026#39;ÃŠÃ½Â¾ÃÂ·Â¢Ã‹ÃÂ´Ã­ÃÃ³\u0026#39; =\u0026gt; \u0026#39;æ•°æ®å‘é€é”™è¯¯\u0026#39;, 166\t\u0026#39;Ã“ÃƒÂ»Â§Ã•Ã‹Â»Â§Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¸æˆ·ç®¡ç†\u0026#39;, 167\t\u0026#39;Ã“ÃƒÂ»Â§Ã’Â³ÃƒÃ¦Â¼Â°Â¹Â¦Ã„ÃœÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·é¡µé¢åŠåŠŸèƒ½æƒé™\u0026#39;, 168\t\u0026#39;ÃÃÂ¸Ã„Ã“ÃƒÂ»Â§ÃƒÃœÃ‚Ã«\u0026#39; =\u0026gt; \u0026#39;ä¿®æ”¹ç”¨æˆ·å¯†ç \u0026#39;, 169\t\u0026#39;Â½Ã‡Ã‰Â«Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;è§’è‰²å®šä¹‰\u0026#39;, 170\t\u0026#39;Â½Ã‡Ã‰Â«Ã’Â³ÃƒÃ¦Â¼Â°Â¹Â¦Ã„ÃœÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;è§’è‰²é¡µé¢åŠåŠŸèƒ½æƒé™\u0026#39;, 171\t\u0026#39;Â½Ã‡Ã‰Â«Ã“ÃƒÂ»Â§Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;è§’è‰²ç”¨æˆ·ç®¡ç†\u0026#39;, 172\t\u0026#39;Ã“ÃƒÂ»Â§ÃƒÃœÃ‚Ã«Ã†ÃšÃÃ\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¯†ç æœŸé™\u0026#39;, 173\t\u0026#39;Ã“ÃƒÂ»Â§Ã”ÃšÃÃŸÃÃ…ÃÂ¢\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·åœ¨çº¿ä¿¡æ¯\u0026#39;, 174\t\u0026#39;Â²Â¿ÃƒÃ…Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;éƒ¨é—¨å®šä¹‰\u0026#39;, 175\t\u0026#39;Ã—Ã©Ã–Â¯Â½Ã¡Â¹Â¹ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;ç»„ç»‡ç»“æ„ç»´æŠ¤\u0026#39;, 176\t\u0026#39;Ã’Â³ÃƒÃ¦Â½Ã‡Ã‰Â«ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;é¡µé¢è§’è‰²æƒé™\u0026#39;, 177\t\u0026#39;Ã’Â³ÃƒÃ¦Ã“ÃƒÂ»Â§ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;é¡µé¢ç”¨æˆ·æƒé™\u0026#39;, 178\t\u0026#39;ÃƒÃœÃ‚Ã«Â²ÃŸÃ‚Ã”Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;å¯†ç ç­–ç•¥è®¾ç½®\u0026#39;, 179\t\u0026#39;IPÂ²ÃŸÃ‚Ã”Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;IPç­–ç•¥è®¾ç½®\u0026#39;, 180\t\u0026#39;ÃÂµÃÂ³Â²Ã‹ÂµÂ¥ÂµÃ·Ã•Ã»\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿèœå•è°ƒæ•´\u0026#39;, 181\t\u0026#39;ÃˆÂ¨ÃÃÃ“Ã«Ã…Ã¤Ã–ÃƒÂ¸Â´Ã–Ã†\u0026#39; =\u0026gt; \u0026#39;æƒé™ä¸é…ç½®å¤åˆ¶\u0026#39;, 182\t\u0026#39;Ã–Ã·Â¹ÃœÂ²Â¿ÃƒÃ…ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ä¸»ç®¡éƒ¨é—¨æƒé™\u0026#39;, 183\t\u0026#39;Ã“ÃƒÂ»Â§ÂµÃ‡Ã‚Â¼Ã’Ã¬Â³Â£Â·Ã–ÃÃ¶\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·ç™»å½•å¼‚å¸¸åˆ†æ\u0026#39;, 184\t\u0026#39;Â¸ÃšÃÂ»Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;å²—ä½å®šä¹‰\u0026#39;, 185\t\u0026#39;Â¸ÃšÃÂ»Ã“ÃƒÂ»Â§ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;å²—ä½ç”¨æˆ·ç»´æŠ¤\u0026#39;, 186\t\u0026#39;Â¹Â¤Ã—Ã·ÃˆÃ•Ã€ÃºÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œæ—¥å†ç»´æŠ¤\u0026#39;, 187\t\u0026#39;Â¸ÃšÃÂ»Â·Ã–Ã€Ã \u0026#39; =\u0026gt; \u0026#39;å²—ä½åˆ†ç±»\u0026#39;, 188\t\u0026#39;ÃÃ‚ÃŠÃ´Ã“ÃƒÂ»Â§ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ä¸‹å±ç”¨æˆ·æƒé™\u0026#39;, 189\t\u0026#39;ÃÂµÃÂ³Â²ÃÃŠÃ½Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿå‚æ•°è®¾ç½®\u0026#39;, 190\t\u0026#39;Ã€Ã½ÃÃ¢ÃÃ…ÃÂ¢\u0026#39; =\u0026gt; \u0026#39;ä¾‹å¤–ä¿¡æ¯\u0026#39;, 191\t\u0026#39;ÂµÂ¼ÃˆÃ«ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;å¯¼å…¥æ—¥å¿—\u0026#39;, 192\t\u0026#39;ÂµÂ¼Â³Ã¶ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;å¯¼å‡ºæ—¥å¿—\u0026#39;, 193\t\u0026#39;ÃˆÃ‹Ã”Â±Â¸ÃšÃÂ»ÃÃ…ÃÂ¢Â²Ã©Â¿Â´\u0026#39; =\u0026gt; \u0026#39;äººå‘˜å²—ä½ä¿¡æ¯æŸ¥çœ‹\u0026#39;, 194\t\u0026#39;ExcelÂµÂ¼ÃˆÃ«Ã„Â£Â°Ã¥Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;Excelå¯¼å…¥æ¨¡æ¿å®šä¹‰\u0026#39;, 195\t\u0026#39;ÂµÃ‡Ã‚Â¼Ã‹Ã¸Â¶Â¨Â½Ã¢Â³Ã½\u0026#39; =\u0026gt; \u0026#39;ç™»å½•é”å®šè§£é™¤\u0026#39;, 196\t\u0026#39;Â¼Â¯ÃÃ…Ã—Ã©Ã–Â¯Â»ÃºÂ¹Â¹\u0026#39; =\u0026gt; \u0026#39;é›†å›¢ç»„ç»‡æœºæ„\u0026#39;, 197\t\u0026#39;Ã—Ã”Â¶Â¨Ã’Ã¥Ã„Â£Â°Ã¥Ã‰Ã¨Â¼Ã†\u0026#39; =\u0026gt; \u0026#39;è‡ªå®šä¹‰æ¨¡æ¿è®¾è®¡\u0026#39;, 198\t\u0026#39;ÃŠÃ½Â¾ÃÃÂ¬Â»Â¤ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;æ•°æ®ç»´æŠ¤æ—¥å¿—\u0026#39;, 199\t\u0026#39;Ã’Â³ÃƒÃ¦Â°Ã¯Ã–ÃºÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;é¡µé¢å¸®åŠ©ç»´æŠ¤\u0026#39;, 200\t\u0026#39;ÂºÃ³ÃŒÂ¨Ã–Â´ÃÃÃŠÃ½Â¾ÃÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;åå°æ‰§è¡Œæ•°æ®æ—¥å¿—\u0026#39;, 201\t\u0026#39;Ã“ÃÂ¿ÃÂ¿Ã‰Â·ÃƒÃÃŠÃ’Â³ÃƒÃ¦\u0026#39; =\u0026gt; \u0026#39;æ¸¸å®¢å¯è®¿é—®é¡µé¢\u0026#39;, 202\t\u0026#39;Ã“ÃƒÂ»Â§Ã“Ã«Â¿ÃÂ»Â§Â¹Â©Ã“Â¦Ã‰ÃŒÂ°Ã³Â¶Â¨\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·ä¸å®¢æˆ·ä¾›åº”å•†ç»‘å®š\u0026#39;, 203\t\u0026#39;ÃˆÃ‹Ã”Â±Â¼Ã¦Â¸ÃšÂ²Â¿ÃƒÃ…\u0026#39; =\u0026gt; \u0026#39;äººå‘˜å…¼èŒéƒ¨é—¨\u0026#39;, 204\t\u0026#39;ÃÃ…ÃÂ¢ÃƒÃ…Â»Â§Ã…Ã¤Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;ä¿¡æ¯é—¨æˆ·é…ç½®\u0026#39;, 205\t\u0026#39;ÂµÃ·Â¶ÃˆÃˆÃÃÃ±Ã–Â´ÃÃ\u0026#39; =\u0026gt; \u0026#39;è°ƒåº¦ä»»åŠ¡æ‰§è¡Œ\u0026#39;, 206\t\u0026#39;Ã‘ÃÃŠÂ¾Ã•ÃŠÂ»Â§Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;æ¼”ç¤ºå¸æˆ·ç®¡ç†\u0026#39;, 207\t\u0026#39;ÃÃºÃŠÃ›Â¶Â©ÂµÂ¥ÂµÂ¼ÃˆÃ«\u0026#39; =\u0026gt; \u0026#39;é”€å”®è®¢å•å¯¼å…¥\u0026#39;, 208\t\u0026#39;Ã“ÃƒÂ»Â§Ã•Ã‹ÂºÃ…Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¸å·ç®¡ç†\u0026#39;, 209\t\u0026#39;Ã“ÃƒÂ»Â§Â¼Â¤Â»Ã®\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·æ¿€æ´»\u0026#39;, 210\t\u0026#39;Ã“ÃƒÂ»Â§ÃŠÃšÃˆÂ¨Ã‰Ã³ÂºÃ‹\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·æˆæƒå®¡æ ¸\u0026#39;, 211\t\u0026#39;Â½Ã‡Ã‰Â«ÃŠÃšÃˆÂ¨Ã‰Ã³ÂºÃ‹\u0026#39; =\u0026gt; \u0026#39;è§’è‰²æˆæƒå®¡æ ¸\u0026#39;, 212\t\u0026#39;Ã“ÃƒÂ»Â§ÃƒÃœÃ‚Ã«ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·å¯†ç ä¿®æ”¹\u0026#39;, 213\t\u0026#39;Ã“ÃƒÂ»Â§Ã’Â³ÃƒÃ¦Â¼Â°Â¹Â¦Ã„ÃœÃŠÃšÃˆÂ¨\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·é¡µé¢åŠåŠŸèƒ½æˆæƒ\u0026#39;, 214\t\u0026#39;Â½Ã‡Ã‰Â«Ã’Â³ÃƒÃ¦Â¼Â°Â¹Â¦Ã„ÃœÃŠÃšÃˆÂ¨\u0026#39; =\u0026gt; \u0026#39;è§’è‰²é¡µé¢åŠåŠŸèƒ½æˆæƒ\u0026#39;, 215\t\u0026#39;Â°Â²ÃˆÂ«Ã‰Ã³Â¼Ã†Ã”Â±Â²Ã™Ã—Ã·ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;å®‰å…¨å®¡è®¡å‘˜æ“ä½œæ—¥å¿—\u0026#39;, 216\t\u0026#39;ÃÂµÃÂ³Â¹ÃœÃ€Ã­Ã”Â±Â²Ã™Ã—Ã·ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿç®¡ç†å‘˜æ“ä½œæ—¥å¿—\u0026#39;, 217\t\u0026#39;Â°Â²ÃˆÂ«Â±Â£ÃƒÃœÃ”Â±Â²Ã™Ã—Ã·ÃˆÃ•Ã–Â¾\u0026#39; =\u0026gt; \u0026#39;å®‰å…¨ä¿å¯†å‘˜æ“ä½œæ—¥å¿—\u0026#39;, 218\t\u0026#39;Ã†Ã¤Ã‹Ã¼\u0026#39; =\u0026gt; \u0026#39;å…¶ä»–\u0026#39;, 219\t\u0026#39;ÃÂµÃÂ³Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿç®¡ç†\u0026#39;, 220\t\u0026#39;Â½Ã“Â¿ÃšÂ¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;æ¥å£ç®¡ç†\u0026#39;, 221\t\u0026#39;ÃˆÃ½Ã”Â±Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ä¸‰å‘˜ç®¡ç†\u0026#39;, 222\t\u0026#39;ÃÃ‚Ã”Ã¶\u0026#39; =\u0026gt; \u0026#39;æ–°å¢\u0026#39;, 223\t\u0026#39;Ã‰Â¾Â³Ã½\u0026#39; =\u0026gt; \u0026#39;åˆ é™¤\u0026#39;, 224\t\u0026#39;ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;ä¿®æ”¹\u0026#39;, 225\t\u0026#39;Â±Ã Â¼Â­\u0026#39; =\u0026gt; \u0026#39;ç¼–è¾‘\u0026#39;, 226\t\u0026#39;Â¸Ã¼Â¸Ã„ÃƒÃœÃ‚Ã«\u0026#39; =\u0026gt; \u0026#39;æ›´æ”¹å¯†ç \u0026#39;, 227\t\u0026#39;Â±Â£Â´Ã¦\u0026#39; =\u0026gt; \u0026#39;ä¿å­˜\u0026#39;, 228\t\u0026#39;ÃŠÃ–Â¶Â¯Ã–Â´ÃÃ\u0026#39; =\u0026gt; \u0026#39;æ‰‹åŠ¨æ‰§è¡Œ\u0026#39;, 229\t\u0026#39;ÂµÂ¼ÃˆÃ«\u0026#39; =\u0026gt; \u0026#39;å¯¼å…¥\u0026#39;, 230\t\u0026#39;Â¸ÃŸÂ¼Â¶Ã‹Ã‘Ã‹Ã·\u0026#39; =\u0026gt; \u0026#39;é«˜çº§æœç´¢\u0026#39;, 231\t\u0026#39;Â³Â¬Â¼Â¶Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;è¶…çº§ç®¡ç†\u0026#39;, 232\t\u0026#39;Â¸Â´Ã–Ã†Â²Â¢ÃÃ‚Ã”Ã¶\u0026#39; =\u0026gt; \u0026#39;å¤åˆ¶å¹¶æ–°å¢\u0026#39;, 233\t\u0026#39;Â¼Â¤Â»Ã®\u0026#39; =\u0026gt; \u0026#39;æ¿€æ´»\u0026#39;, 234\t\u0026#39;Ã‰Ã³ÂºÃ‹\u0026#39; =\u0026gt; \u0026#39;å®¡æ ¸\u0026#39;, 235\t\u0026#39;Â²Ã©Â¿Â´Â¹Â¦Ã„ÃœÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;æŸ¥çœ‹åŠŸèƒ½æƒé™\u0026#39;, 236\t\u0026#39;Ã’Ã‘Â½Ã»Ã“ÃƒÃ“ÃƒÂ»Â§Ã‡Ã¥Ã€Ã­\u0026#39; =\u0026gt; \u0026#39;å·²ç¦ç”¨ç”¨æˆ·æ¸…ç†\u0026#39;, 237\t\u0026#39;ÃŒÃŸÂ³Ã½Ã“ÃƒÂ»Â§\u0026#39; =\u0026gt; \u0026#39;è¸¢å‡ºç”¨æˆ·\u0026#39;, 238 239\t\u0026#39;Ã“ÃƒÂ»Â§Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç”¨æˆ·ç®¡ç†\u0026#39;, 240\t\u0026#39;Â¸ÃšÃÂ»Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;å²—ä½ç®¡ç†\u0026#39;, 241\t\u0026#39;Â¶Ã”Ã‹Ã¹Ã“ÃÃŠÂ¹Ã“ÃƒÂ±Â¾ÃÂµÃÂ³ÂµÃ„Ã“ÃƒÂ»Â§Â½Ã¸ÃÃÃ“ÃƒÂ»Â§ÃƒÃ»ÂµÃ‡Ã‚Â¼Â¡Â¢Ã‹Ã¹ÃŠÃ´Â¹Â¤Ã—Ã·Ã—Ã©Â¡Â¢ÃƒÃœÃ‚Ã«Ã‰Ã¨Ã–ÃƒÂµÃˆÂ¹Â¤Ã—Ã·\u0026#39; =\u0026gt; \u0026#39;å¯¹æ‰€æœ‰ä½¿ç”¨æœ¬ç³»ç»Ÿçš„ç”¨æˆ·è¿›è¡Œç”¨æˆ·åç™»å½•ã€æ‰€å±å·¥ä½œç»„ã€å¯†ç è®¾ç½®ç­‰å·¥ä½œ\u0026#39;, 242\t\u0026#39;Â¶Ã”Ã‹Ã¹Ã“ÃÃŠÂ¹Ã“ÃƒÂ±Â¾ÃÂµÃÂ³ÂµÃ„Ã“ÃƒÂ»Â§Â½Ã¸ÃÃÃˆÂ¨ÃÃÂ¹ÃœÃ€Ã­Â¡Â£Â¾ÃŸÃŒÃ¥Ã€Â´Ã‹ÂµÂ¾ÃÃŠÃ‡ÃƒÂ¿Â¸Ã¶Ã“ÃƒÂ»Â§Â¿Ã‰Â¶Ã”Ã„Ã„ÃÂ©Ã„Â£Â¿Ã©Â¼Â°Ã„Â£Â¿Ã©Ã„ÃšÂµÃ„Ã’Â³ÃƒÃ¦Â½Ã¸ÃÃÂ²Ã™Ã—Ã·\u0026#39; =\u0026gt; \u0026#39;å¯¹æ‰€æœ‰ä½¿ç”¨æœ¬ç³»ç»Ÿçš„ç”¨æˆ·è¿›è¡Œæƒé™ç®¡ç†ã€‚å…·ä½“æ¥è¯´å°±æ˜¯æ¯ä¸ªç”¨æˆ·å¯å¯¹å“ªäº›æ¨¡å—åŠæ¨¡å—å†…çš„é¡µé¢è¿›è¡Œæ“ä½œ\u0026#39;, 243\t\u0026#39;Ã“Ã‰ÃÂµÃÂ³Â¹ÃœÃ€Ã­Ã”Â±Â¶Ã”Ã„Â³Â¸Ã¶Ã“ÃƒÂ»Â§ÂµÃ„ÃƒÃœÃ‚Ã«Â½Ã¸ÃÃÃ–Ã˜ÃÃ‚Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;ç”±ç³»ç»Ÿç®¡ç†å‘˜å¯¹æŸä¸ªç”¨æˆ·çš„å¯†ç è¿›è¡Œé‡æ–°è®¾ç½®\u0026#39;, 244\t\u0026#39;Ã“Ã‰ÃÂµÃÂ³Â¹ÃœÃ€Ã­Ã”Â±Â¶Ã”Â¹Â¤Ã—Ã·Ã—Ã©Ã—Ã©ÃƒÃ»Â¡Â¢Ã—Ã©ÃƒÃ¨ÃŠÃ¶Â¡Â¢Ã‹Ã¹ÃŠÃ´Â²Â¿ÃƒÃ…Â½Ã¸ÃÃÂ¶Â¨Ã’Ã¥Â£Â¬Â¿Ã‰ÃŒÃ­Â¼Ã“Â¡Â¢Ã‰Â¾Â³Ã½\u0026#39; =\u0026gt; \u0026#39;ç”±ç³»ç»Ÿç®¡ç†å‘˜å¯¹å·¥ä½œç»„ç»„åã€ç»„æè¿°ã€æ‰€å±éƒ¨é—¨è¿›è¡Œå®šä¹‰ï¼Œå¯æ·»åŠ ã€åˆ é™¤\u0026#39;, 245\t\u0026#39;Â¶Ã”Ã“ÃƒÂ»Â§Â½Ã¸ÃÃÂ¹Â¤Ã—Ã·Ã—Ã©ÂµÃ„Â·Ã–Ã…Ã¤Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;å¯¹ç”¨æˆ·è¿›è¡Œå·¥ä½œç»„çš„åˆ†é…å®šä¹‰\u0026#39;, 246\t\u0026#39;Ã“Ã‰ÃÂµÃÂ³Â¹ÃœÃ€Ã­Ã”Â±Â¶Ã”Ã„Â³Â¸Ã¶Ã“ÃƒÂ»Â§ÂµÃ„ÃƒÃœÃ‚Ã«Ã†ÃšÃÃÂ½Ã¸ÃÃÃ–Ã˜ÃÃ‚Ã‰Ã¨Ã–Ãƒ\u0026#39; =\u0026gt; \u0026#39;ç”±ç³»ç»Ÿç®¡ç†å‘˜å¯¹æŸä¸ªç”¨æˆ·çš„å¯†ç æœŸé™è¿›è¡Œé‡æ–°è®¾ç½®\u0026#39;, 247\t\u0026#39;Ã‹Ã¦ÃŠÂ±ÃÃ”ÃŠÂ¾Ã“ÃƒÂ»Â§Ã”ÃšÃÃŸÃÃ…ÃÂ¢Â¡Â£Â°Ã¼Ã€Â¨Ã“ÃƒÂ»Â§ÃƒÃ»Â¡Â¢ÂµÃ‡Ã‚Â¼ÃŠÂ±Â¼Ã¤Â¡Â¢Ã€Ã«ÃÃŸÃŠÂ±Â¼Ã¤Â¡Â¢IPÂµÃ˜Ã–Â·Â¡Â¢ÃŠÃ‡Â·Ã±Ã”ÃšÃÃŸÂµÃˆ\u0026#39; =\u0026gt; \u0026#39;éšæ—¶æ˜¾ç¤ºç”¨æˆ·åœ¨çº¿ä¿¡æ¯ã€‚åŒ…æ‹¬ç”¨æˆ·åã€ç™»å½•æ—¶é—´ã€ç¦»çº¿æ—¶é—´ã€IPåœ°å€ã€æ˜¯å¦åœ¨çº¿ç­‰\u0026#39;, 248\t\u0026#39;Â¹Â¤Ã—Ã·Â¸ÃšÃÂ»Â¶Â¨Ã’Ã¥\u0026#39; =\u0026gt; \u0026#39;å·¥ä½œå²—ä½å®šä¹‰\u0026#39;, 249\t\u0026#39;ÃˆÃ‹Ã”Â±Â¹Â¤Ã—Ã·Â¸ÃšÃÂ»ÃÂ¬Â»Â¤\u0026#39; =\u0026gt; \u0026#39;äººå‘˜å·¥ä½œå²—ä½ç»´æŠ¤\u0026#39;, 250\t\u0026#39;Â¶Â¨Ã’Ã¥Â¹Â¤Ã—Ã·ÃˆÃ•ÃÃÃŒÃµÂ¼Ã¾\u0026#39; =\u0026gt; \u0026#39;å®šä¹‰å·¥ä½œæ—¥æ— æ¡ä»¶\u0026#39;, 251\t\u0026#39;Â½Â«Ã–Â¸Â¶Â¨Ã“ÃƒÂ»Â§Ã’Ã‘Ã“ÃÃˆÂ¨ÃÃÂºÃÃ…Ã¤Ã–ÃƒÂ¸Â´Ã–Ã†ÂµÂ½Ã†Ã¤Ã‹Ã»Ã“ÃƒÂ»Â§\u0026#39; =\u0026gt; \u0026#39;å°†æŒ‡å®šç”¨æˆ·å·²æœ‰æƒé™å’Œé…ç½®å¤åˆ¶åˆ°å…¶ä»–ç”¨æˆ·\u0026#39;, 252\t\u0026#39;Ã—Ã”Â¶Â¯Ã‹Â¢ÃÃ‚Ã–Â´ÃÃÂºÃ³ÃŒÂ¨ÃˆÃÃÃ±Â£Â¬Ã’Ã”Ã”Ã‹ÃÃMRPÂ¼Ã†Â»Â®ÂµÃˆ\u0026#39; =\u0026gt; \u0026#39;è‡ªåŠ¨åˆ·æ–°æ‰§è¡Œåå°ä»»åŠ¡ï¼Œä»¥è¿è¡ŒMRPè®¡åˆ’ç­‰\u0026#39;, 253\t\u0026#39;Ã—Ã”Â¶Â¨Ã’Ã¥Ã‰Ã¨Â¼Ã†WORDÂºÃExcelÃ„Â£Â°Ã¥\u0026#39; =\u0026gt; \u0026#39;è‡ªå®šä¹‰è®¾è®¡WORDå’ŒExcelæ¨¡æ¿\u0026#39;, 254\t\u0026#39;ÂµÂ¼Â³Ã¶\u0026#39; =\u0026gt; \u0026#39;å¯¼å‡º\u0026#39;, 255\t\u0026#39;ÃÃÂ¸Ã„ÃˆÂ¨ÃÃ\u0026#39; =\u0026gt; \u0026#39;ä¿®æ”¹æƒé™\u0026#39;, 256\t\u0026#39;ÃƒÃœÃ‚Ã«ÃÃÂ¸Ã„\u0026#39; =\u0026gt; \u0026#39;å¯†ç ä¿®æ”¹\u0026#39;, 257\t\u0026#39;Â´Â¦Ã€Ã­Â¶Â¥Â¼Â¶Â²Ã‹ÂµÂ¥ÃŠÃ½Â¾Ã\u0026#39; =\u0026gt; \u0026#39;å¤„ç†é¡¶çº§èœå•æ•°æ®\u0026#39;, 258\t\u0026#39;Ã’Â³ÃƒÃ¦Â¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;é¡µé¢å®šä¹‰ç”Ÿæˆ\u0026#39;, 259\t\u0026#39;Ã’Â³ÃƒÃ¦Â¹Â¦Ã„ÃœÂ¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;é¡µé¢åŠŸèƒ½å®šä¹‰ç”Ÿæˆ\u0026#39;, 260\t\u0026#39;Ã‰ÃºÂ³Ã‰Ã„Â£Â¿Ã©Â¶Â¨Ã’Ã¥Ã‰ÃºÂ³Ã‰\u0026#39; =\u0026gt; \u0026#39;ç”Ÿæˆæ¨¡å—å®šä¹‰ç”Ÿæˆ\u0026#39;, 261\t\u0026#39;Â¿ÃÂ»Â§Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;å®¢æˆ·ç®¡ç†\u0026#39;, 262\t\u0026#39;ÃÃ®Ã„Â¿Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;é¡¹ç›®ç®¡ç†\u0026#39;, 263\t\u0026#39;ÃÂ¢ÃÃ…Â¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;å¾®ä¿¡ç®¡ç†\u0026#39;, 264\t\u0026#39;Â½ÃœÂ»ÂªÃŒÃ˜\u0026#39; =\u0026gt; \u0026#39;æ·åç‰¹\u0026#39;, 265\t\u0026#39;ÃŠÃ½Â¾ÃÂ½Ã¡Â¹Â¹\u0026#39; =\u0026gt; \u0026#39;æ•°æ®ç»“æ„\u0026#39;, 266\t\u0026#39;ÃÂµÃÂ³Â½Ã“Â¿ÃšÂ¹ÃœÃ€Ã­\u0026#39; =\u0026gt; \u0026#39;ç³»ç»Ÿæ¥å£ç®¡ç†\u0026#39;, 267\t]; 268 269\tpublic function __construct() 270\t{ 271\t// æŒ‰å­—ç¬¦ä¸²é•¿åº¦é™åºæ’åºï¼Œç¡®ä¿å…ˆåŒ¹é…é•¿çš„å­—ç¬¦ä¸² 272\tuasort($this-\u0026gt;encodingFixes, function ($a, $b) { 273\treturn strlen($b) - strlen($a); 274\t}); 275\t} 276 277\t/** 278\t* æ£€æµ‹æ–‡ä»¶ç¼–ç  279\t*/ 280\tprivate function detectEncoding($filePath) 281\t{ 282\t$content = file_get_contents($filePath); 283 284\t// å°è¯•æ£€æµ‹ç¼–ç  285\t$encodings = [\u0026#39;UTF-8\u0026#39;, \u0026#39;ISO-8859-1\u0026#39;, \u0026#39;GBK\u0026#39;, \u0026#39;GB2312\u0026#39;, \u0026#39;BIG5\u0026#39;]; 286 287\tforeach ($encodings as $encoding) { 288\tif (mb_check_encoding($content, $encoding)) { 289\treturn $encoding; 290\t} 291\t} 292 293\treturn \u0026#39;UTF-8\u0026#39;; // é»˜è®¤è¿”å›UTF-8 294\t} 295 296\t/** 297\t* ä¿®å¤å•å¼•å·å†…çš„ä¹±ç å†…å®¹ 298\t*/ 299\tprivate function fixQuotedContent($content) 300\t{ 301\t// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å•å¼•å·å†…çš„å†…å®¹ 302\t$pattern = \u0026#34;/\u0026#39;([^\u0026#39;]*)\u0026#39;/\u0026#34;; 303 304\treturn preg_replace_callback($pattern, function ($matches) { 305\t$quotedContent = $matches[1]; 306\t$fixedContent = $quotedContent; 307 308\t// åªåœ¨å•å¼•å·å†…è¿›è¡Œæ›¿æ¢ 309\tforeach ($this-\u0026gt;encodingFixes as $wrong =\u0026gt; $correct) { 310\t// ç¡®ä¿å®Œå…¨åŒ¹é…æ•´ä¸ªä¹±ç å­—ç¬¦ä¸² 311\tif ($fixedContent === $wrong) { 312\t$fixedContent = $correct; 313\tbreak; // ä¸€æ—¦åŒ¹é…å°±åœæ­¢ï¼Œé¿å…é‡å¤æ›¿æ¢ 314\t} 315\t} 316 317\t// å¦‚æœå†…å®¹æœ‰å˜åŒ–ï¼Œè¿”å›ä¿®å¤åçš„å†…å®¹ 318\tif ($fixedContent !== $quotedContent) { 319\treturn \u0026#34;\u0026#39;\u0026#34; . $fixedContent . \u0026#34;\u0026#39;\u0026#34;; 320\t} 321 322\t// å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œè¿”å›åŸå†…å®¹ 323\treturn $matches[0]; 324\t}, $content); 325\t} 326 327\t/** 328\t* ä¿®å¤å•ä¸ªSQLæ–‡ä»¶ 329\t*/ 330\tpublic function fixSqlFile($filePath) 331\t{ 332\techo \u0026#34;å¤„ç†æ–‡ä»¶: $filePath\\n\u0026#34;; 333 334\t// å¤‡ä»½åŸæ–‡ä»¶ 335\t$backupPath = $filePath . \u0026#39;.backup\u0026#39;; 336\tif (!copy($filePath, $backupPath)) { 337\techo \u0026#34; é”™è¯¯: æ— æ³•åˆ›å»ºå¤‡ä»½æ–‡ä»¶\\n\u0026#34;; 338\treturn false; 339\t} 340 341\t// æ£€æµ‹æ–‡ä»¶ç¼–ç  342\t$encoding = $this-\u0026gt;detectEncoding($filePath); 343\techo \u0026#34; æ£€æµ‹ç¼–ç : $encoding\\n\u0026#34;; 344 345\t// è¯»å–æ–‡ä»¶å†…å®¹ 346\t$content = file_get_contents($filePath); 347 348\t// å¦‚æœæ£€æµ‹åˆ°çš„ç¼–ç ä¸æ˜¯UTF-8ï¼Œå°è¯•è½¬æ¢ 349\tif ($encoding !== \u0026#39;UTF-8\u0026#39;) { 350\t$content = mb_convert_encoding($content, \u0026#39;UTF-8\u0026#39;, $encoding); 351\t} 352 353\t// ä¿®å¤å•å¼•å·å†…çš„ä¹±ç  354\t$originalContent = $content; 355\t$content = $this-\u0026gt;fixQuotedContent($content); 356 357\t// æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ– 358\tif ($content !== $originalContent) { 359\t// ç»Ÿè®¡ä¿®å¤çš„æ•°é‡ 360\t$fixCount = 0; 361\tforeach ($this-\u0026gt;encodingFixes as $wrong =\u0026gt; $correct) { 362\t// ç»Ÿè®¡å•å¼•å·å†…çš„æ›¿æ¢æ¬¡æ•° 363\t$pattern = \u0026#34;/\u0026#39;$wrong\u0026#39;/\u0026#34;; 364\tpreg_match_all($pattern, $originalContent, $matches); 365\t$fixCount += count($matches[0]); 366\t} 367 368\t// ä¿å­˜ä¿®å¤åçš„æ–‡ä»¶ 369\tif (file_put_contents($filePath, $content) !== false) { 370\techo \u0026#34; æˆåŠŸä¿®å¤ {$fixCount} å¤„ä¹±ç ï¼ŒåŸæ–‡ä»¶å·²å¤‡ä»½ä¸º: $backupPath\\n\u0026#34;; 371\treturn true; 372\t} else { 373\techo \u0026#34; é”™è¯¯: æ— æ³•ä¿å­˜ä¿®å¤åçš„æ–‡ä»¶\\n\u0026#34;; 374\t// æ¢å¤å¤‡ä»½ 375\tcopy($backupPath, $filePath); 376\treturn false; 377\t} 378\t} else { 379\techo \u0026#34; æ— éœ€ä¿®å¤\\n\u0026#34;; 380\t// åˆ é™¤å¤‡ä»½æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰ä¿®æ”¹ï¼‰ 381\tunlink($backupPath); 382\treturn true; 383\t} 384\t} 385 386\t/** 387\t* æ‰¹é‡ä¿®å¤ç›®å½•ä¸­çš„æ‰€æœ‰SQLæ–‡ä»¶ 388\t*/ 389\tpublic function batchFix($directory = \u0026#39;.\u0026#39;) 390\t{ 391\techo \u0026#34;å¼€å§‹æ‰¹é‡ä¿®å¤SQLæ–‡ä»¶...\\n\\n\u0026#34;; 392 393\t$sqlFiles = []; 394 395\t// é€’å½’æŸ¥æ‰¾æ‰€æœ‰SQLæ–‡ä»¶ 396\t$iterator = new RecursiveIteratorIterator( 397\tnew RecursiveDirectoryIterator($directory, RecursiveDirectoryIterator::SKIP_DOTS), 398\tRecursiveIteratorIterator::SELF_FIRST 399\t); 400 401\tforeach ($iterator as $file) { 402\tif ($file-\u0026gt;isFile() \u0026amp;\u0026amp; $file-\u0026gt;getExtension() === \u0026#39;sql\u0026#39;) { 403\t$sqlFiles[] = $file-\u0026gt;getPathname(); 404\t} 405\t} 406 407\tif (empty($sqlFiles)) { 408\techo \u0026#34;æœªæ‰¾åˆ°SQLæ–‡ä»¶\\n\u0026#34;; 409\treturn; 410\t} 411 412\techo \u0026#34;æ‰¾åˆ° \u0026#34; . count($sqlFiles) . \u0026#34; ä¸ªSQLæ–‡ä»¶\\n\\n\u0026#34;; 413 414\t$successCount = 0; 415\t$failCount = 0; 416 417\tforeach ($sqlFiles as $sqlFile) { 418\tif ($this-\u0026gt;fixSqlFile($sqlFile)) { 419\t$successCount++; 420\t} else { 421\t$failCount++; 422\t} 423\techo str_repeat(\u0026#34;-\u0026#34;, 60) . \u0026#34;\\n\u0026#34;; 424\t} 425 426\techo \u0026#34;\\nä¿®å¤å®Œæˆ!\\n\u0026#34;; 427\techo \u0026#34;æˆåŠŸ: $successCount ä¸ªæ–‡ä»¶\\n\u0026#34;; 428\techo \u0026#34;å¤±è´¥: $failCount ä¸ªæ–‡ä»¶\\n\u0026#34;; 429\t} 430 431\t/** 432\t* æ£€æŸ¥æ–‡ä»¶ä¸­çš„ä¹±ç ï¼ˆä¸å®é™…ä¿®æ”¹ï¼‰ 433\t*/ 434\tpublic function checkFiles($directory = \u0026#39;.\u0026#39;) 435\t{ 436\techo \u0026#34;æ£€æŸ¥æ–‡ä»¶ä¸­çš„ä¹±ç é—®é¢˜...\\n\\n\u0026#34;; 437 438\t$sqlFiles = []; 439 440\t// é€’å½’æŸ¥æ‰¾æ‰€æœ‰SQLæ–‡ä»¶ 441\t$iterator = new RecursiveIteratorIterator( 442\tnew RecursiveDirectoryIterator($directory, RecursiveDirectoryIterator::SKIP_DOTS), 443\tRecursiveIteratorIterator::SELF_FIRST 444\t); 445 446\tforeach ($iterator as $file) { 447\tif ($file-\u0026gt;isFile() \u0026amp;\u0026amp; $file-\u0026gt;getExtension() === \u0026#39;sql\u0026#39;) { 448\t$sqlFiles[] = $file-\u0026gt;getPathname(); 449\t} 450\t} 451 452\tif (empty($sqlFiles)) { 453\techo \u0026#34;æœªæ‰¾åˆ°SQLæ–‡ä»¶\\n\u0026#34;; 454\treturn; 455\t} 456 457\t$hasIssues = false; 458 459\tforeach ($sqlFiles as $sqlFile) { 460\techo \u0026#34;æ£€æŸ¥æ–‡ä»¶: $sqlFile\\n\u0026#34;; 461 462\t$content = file_get_contents($sqlFile); 463\t$foundIssues = false; 464 465\t// æ£€æŸ¥å•å¼•å·å†…çš„ä¹±ç  466\t$pattern = \u0026#34;/\u0026#39;([^\u0026#39;]*)\u0026#39;/\u0026#34;; 467\tpreg_match_all($pattern, $content, $matches); 468 469\tforeach ($matches[1] as $quotedContent) { 470\tforeach ($this-\u0026gt;encodingFixes as $wrong =\u0026gt; $correct) { 471\tif ($quotedContent === $wrong) { 472\techo \u0026#34; å‘ç°ä¹±ç : \u0026#39;$wrong\u0026#39; -\u0026gt; åº”ä¸º: \u0026#39;$correct\u0026#39;\\n\u0026#34;; 473\t$foundIssues = true; 474\t$hasIssues = true; 475\t} 476\t} 477\t} 478 479\tif (!$foundIssues) { 480\techo \u0026#34; æœªå‘ç°ä¹±ç \\n\u0026#34;; 481\t} 482 483\techo str_repeat(\u0026#34;-\u0026#34;, 60) . \u0026#34;\\n\u0026#34;; 484\t} 485 486\tif (!$hasIssues) { 487\techo \u0026#34;\\næ‰€æœ‰æ–‡ä»¶å‡æœªå‘ç°ä¹±ç é—®é¢˜!\\n\u0026#34;; 488\t} 489\t} 490} 491 492// å‘½ä»¤è¡Œç•Œé¢ 493if (php_sapi_name() === \u0026#39;cli\u0026#39;) { 494\t$fixer = new SqlEncodingFixer(); 495 496\t$options = getopt(\u0026#34;d:ch\u0026#34;, [\u0026#34;directory:\u0026#34;, \u0026#34;check\u0026#34;, \u0026#34;help\u0026#34;]); 497 498\tif (isset($options[\u0026#39;h\u0026#39;]) || isset($options[\u0026#39;help\u0026#39;])) { 499\techo \u0026#34;SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…·\\n\u0026#34;; 500\techo \u0026#34;ç”¨æ³•:\\n\u0026#34;; 501\techo \u0026#34; php \u0026#34; . basename(__FILE__) . \u0026#34; [é€‰é¡¹]\\n\\n\u0026#34;; 502\techo \u0026#34;é€‰é¡¹:\\n\u0026#34;; 503\techo \u0026#34; -d, --directory \u0026lt;ç›®å½•\u0026gt; æŒ‡å®šè¦å¤„ç†çš„ç›®å½•ï¼ˆé»˜è®¤å½“å‰ç›®å½•ï¼‰\\n\u0026#34;; 504\techo \u0026#34; -c, --check åªæ£€æŸ¥ä¸ä¿®æ”¹\\n\u0026#34;; 505\techo \u0026#34; -h, --help æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯\\n\\n\u0026#34;; 506\techo \u0026#34;ç¤ºä¾‹:\\n\u0026#34;; 507\techo \u0026#34; php \u0026#34; . basename(__FILE__) . \u0026#34; # ä¿®å¤å½“å‰ç›®å½•æ‰€æœ‰SQLæ–‡ä»¶\\n\u0026#34;; 508\techo \u0026#34; php \u0026#34; . basename(__FILE__) . \u0026#34; -d /path/to/sql # ä¿®å¤æŒ‡å®šç›®å½•\\n\u0026#34;; 509\techo \u0026#34; php \u0026#34; . basename(__FILE__) . \u0026#34; --check # åªæ£€æŸ¥ä¸ä¿®æ”¹\\n\u0026#34;; 510\texit(0); 511\t} 512 513\t$directory = isset($options[\u0026#39;d\u0026#39;]) ? $options[\u0026#39;d\u0026#39;] : (isset($options[\u0026#39;directory\u0026#39;]) ? $options[\u0026#39;directory\u0026#39;] : \u0026#39;.\u0026#39;); 514 515\tif (isset($options[\u0026#39;c\u0026#39;]) || isset($options[\u0026#39;check\u0026#39;])) { 516\t$fixer-\u0026gt;checkFiles($directory); 517\t} else { 518\t$fixer-\u0026gt;batchFix($directory); 519\t} 520} else { 521\t// Webç•Œé¢ 522\techo \u0026#34;\u0026lt;!DOCTYPE html\u0026gt; 523 \u0026lt;html\u0026gt; 524 \u0026lt;head\u0026gt; 525 \u0026lt;title\u0026gt;SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…·\u0026lt;/title\u0026gt; 526 \u0026lt;meta charset=\u0026#39;utf-8\u0026#39;\u0026gt; 527 \u0026lt;style\u0026gt; 528 body { font-family: Arial, sans-serif; margin: 20px; } 529 .container { max-width: 800px; margin: 0 auto; } 530 .form-group { margin: 15px 0; } 531 label { display: block; margin-bottom: 5px; font-weight: bold; } 532 input[type=\u0026#39;text\u0026#39;], select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; } 533 button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; } 534 button:hover { background: #005a87; } 535 .output { background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 20px; white-space: pre-wrap; font-family: monospace; } 536 .success { color: green; } 537 .error { color: red; } 538 \u0026lt;/style\u0026gt; 539 \u0026lt;/head\u0026gt; 540 \u0026lt;body\u0026gt; 541 \u0026lt;div class=\u0026#39;container\u0026#39;\u0026gt; 542 \u0026lt;h1\u0026gt;SQLæ–‡ä»¶ç¼–ç ä¿®å¤å·¥å…·\u0026lt;/h1\u0026gt; 543 \u0026lt;form method=\u0026#39;post\u0026#39;\u0026gt; 544 \u0026lt;div class=\u0026#39;form-group\u0026#39;\u0026gt; 545 \u0026lt;label for=\u0026#39;directory\u0026#39;\u0026gt;ç›®å½•è·¯å¾„:\u0026lt;/label\u0026gt; 546 \u0026lt;input type=\u0026#39;text\u0026#39; id=\u0026#39;directory\u0026#39; name=\u0026#39;directory\u0026#39; value=\u0026#39;.\u0026#39;\u0026gt; 547 \u0026lt;/div\u0026gt; 548 \u0026lt;div class=\u0026#39;form-group\u0026#39;\u0026gt; 549 \u0026lt;label for=\u0026#39;action\u0026#39;\u0026gt;æ“ä½œ:\u0026lt;/label\u0026gt; 550 \u0026lt;select id=\u0026#39;action\u0026#39; name=\u0026#39;action\u0026#39;\u0026gt; 551 \u0026lt;option value=\u0026#39;fix\u0026#39;\u0026gt;ä¿®å¤æ–‡ä»¶\u0026lt;/option\u0026gt; 552 \u0026lt;option value=\u0026#39;check\u0026#39;\u0026gt;åªæ£€æŸ¥ä¸ä¿®æ”¹\u0026lt;/option\u0026gt; 553 \u0026lt;/select\u0026gt; 554 \u0026lt;/div\u0026gt; 555 \u0026lt;button type=\u0026#39;submit\u0026#39;\u0026gt;æ‰§è¡Œ\u0026lt;/button\u0026gt; 556 \u0026lt;/form\u0026gt;\u0026#34;; 557 558\tif ($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#39;POST\u0026#39;) { 559\t$directory = $_POST[\u0026#39;directory\u0026#39;] ?? \u0026#39;.\u0026#39;; 560\t$action = $_POST[\u0026#39;action\u0026#39;] ?? \u0026#39;fix\u0026#39;; 561 562\t$fixer = new SqlEncodingFixer(); 563 564\tob_start(); 565 566\tif ($action === \u0026#39;check\u0026#39;) { 567\t$fixer-\u0026gt;checkFiles($directory); 568\t} else { 569\t$fixer-\u0026gt;batchFix($directory); 570\t} 571 572\t$output = ob_get_clean(); 573 574\techo \u0026#34;\u0026lt;div class=\u0026#39;output\u0026#39;\u0026gt;\u0026#34; . htmlspecialchars($output) . \u0026#34;\u0026lt;/div\u0026gt;\u0026#34;; 575\t} 576 577\techo \u0026#34;\u0026lt;/div\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026#34;; 578} ","link":"https://jianlin-li.github.io/post/luoxi/","section":"post","tags":["sql","ä¹±ç "],"title":"åå¾®ä¸–çºªç›¸å…³è„šæœ¬è§£å†³æ–¹æ¡ˆ"},{"body":"","link":"https://jianlin-li.github.io/tags/%E4%B9%B1%E7%A0%81/","section":"tags","tags":null,"title":"ä¹±ç "},{"body":"","link":"https://jianlin-li.github.io/tags/hosts/","section":"tags","tags":null,"title":"Hosts"},{"body":" æç¤º æœ¬åœ°hostsçš„å¼€å‘ç¯å¢ƒå¤‡ä»½\n1#postman forbidden update 20.0.0.0 dl.pstmn.io 3 4#sublimetext 5127.0.0.1 www.sublimetext.com 6127.0.0.1 license.sublimehq.com 7 8#github.com no proxy 9#20.205.243.166 github.com 10 11 12 13192.168.31.250 ljl-maci5 14192.168.31.150 ljl-maci9 15 16 17192.168.31.71 vm7-1 vm7-1.com vm7-1-phpmyadmin.com 18192.168.31.72 vm7-2 vm7-2.com vm7-2-phpmyadmin.com 19192.168.31.73 vm7-3 vm7-3.com vm7-3-phpmyadmin.com 20192.168.31.74 vm7-4 vm7-4.com 21192.168.31.75 vm7-5 vm7-5.com 22192.168.31.76 vm7-6 vm7-6.com 23 24127.0.0.1 local.harbors.com 25127.0.0.1 local.jenkins.com 26127.0.0.1 local.kibana.com 27127.0.0.1 local.kibana-docker.com 28127.0.0.1 local.elasticsearch.com 29127.0.0.1 local.elasticsearch-docker.com 30127.0.0.1 local.grafanas.com 31127.0.0.1 local.rabbitmq.com 32127.0.0.1 local.rancher.com 33127.0.0.1 local.cacheadmin.com 34127.0.0.1 local.gitlab.com 35127.0.0.1 local.k8sadmin.com 36127.0.0.1 local.prometheus.com 37127.0.0.1 local.jumpserver.com 38127.0.0.1 local.myfaq.com 39127.0.0.1 local.hugo.com 40127.0.0.1 local.nginx_status.com 41 42 43 44127.0.0.1 lijianlin01-crmapi.yunshanmeicai.com 45127.0.0.1 lijianlin01-crmdata.yunshanmeicai.com 46127.0.0.1 lijianlin01-crmsearch.yunshanmeicai.com 47127.0.0.1 lijianlin01-crmview.yunshanmeicai.com 48127.0.0.1 lijianlin01-cspapi.yunshanmeicai.com 49127.0.0.1 lijianlin01-cspdata.yunshanmeicai.com 50127.0.0.1 lijianlin01-cspview.yunshanmeicai.com 51127.0.0.1 php.demo.com 52127.0.0.1 php.myself.com 53127.0.0.1 php.test.com 54127.0.0.1 php.yafapi.com 55127.0.0.1 php.yii.com 56127.0.0.1 go.myself.com ","link":"https://jianlin-li.github.io/post/local_hosts_bak/","section":"post","tags":["hosts"],"title":"æœ¬åœ°hostsçš„å¼€å‘ç¯å¢ƒå¤‡ä»½"},{"body":"","link":"https://jianlin-li.github.io/categories/%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83/","section":"categories","tags":null,"title":"æœ¬åœ°ç¯å¢ƒ"},{"body":"","link":"https://jianlin-li.github.io/tags/%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83/","section":"tags","tags":null,"title":"æœ¬åœ°ç¯å¢ƒ"},{"body":"æœ¬åœ°ç¯å¢ƒç›¸å…³é…ç½®ä¿¡æ¯ 1local.rabbitmq.com 2ã€€brew services restart rabbitmq 3ã€€4 5local.gitlab.com 6ã€€dockerdesktop å¯åŠ¨å®¹å™¨ 7 8 9local.harbors.com 10ã€€dockerdesktop å¯åŠ¨å®¹å™¨ 11ã€€12 13local.jenkins.com 14ã€€brew services restart jenkins 15 16 17local.elasticsearch.com 18ã€€4ä¸ªnode 19ã€€ljl-maci9 master å…ˆå¯åŠ¨(LaunchControl é‡Œé¢å¯åŠ¨elasticsearchæœåŠ¡) 20ã€€vm7-4 vm7-5 vm7-6 åå¯åŠ¨ 21 22local.elasticsearch-docker.com 23ã€€dockerdesktop å¯åŠ¨å®¹å™¨ 24ã€€25ã€€26local.kibana.com 27ã€€LaunchControl é‡Œé¢å¯åŠ¨ kibana æœåŠ¡ 28 29local.kibana-docker.com 30ã€€dockerdesktop å¯åŠ¨å®¹å™¨ 31 32 33local.grafanas.com 34ã€€brew services restart grafana 35ã€€36 37local.prometheus.com 38ã€€brew services restart prometheus 39 40ã€€41local.jumpserver.com 42ã€€dockerdesktop å¯åŠ¨å®¹å™¨ 43 44 45local.k8sadmin.com 46ã€€vm7-1 master èŠ‚ç‚¹ å…ˆå¯åŠ¨ 47ã€€vm7-2 node èŠ‚ç‚¹ åå¯åŠ¨ 48ã€€vm7-3 node èŠ‚ç‚¹ åå¯åŠ¨ 49 50 51local.cacheadmin.com 52ã€€ljl-maci9 nginx /usr/local/opt/phpCacheAdmin 53 54 55 56 57Deepseek 58ã€€API: sk-cdc80c986d6144a89560efde0695052d 59 60 61 62 63ä¸ªäººåšå®¢ åšå®¢é¡¹ç›®æºç è·¯å¾„ï¼š/Users/lijianlin/www/local/local.hugo.com 64æœ¬åœ°åŸŸåï¼šlocal.hugo.com 65ï¼ˆéœ€è¦ä¿®æ”¹åšå®¢æœ¬åœ°é¡¹ç›®æºç config/_default/hugo.tomlä¸­çš„baseurlï¼Œç„¶ååœ¨ç»ˆç«¯é‡Œé¢å…ˆè¿›å…¥åšå®¢é¡¹ç›®æºç æ ¹ç›®å½•ï¼Œ 66 ç„¶åæ‰§è¡Œï¼šhugo -Dï¼›æˆ–è€…åœ¨phpstorm\\Golandé‡Œé¢æ‰“å¼€åšå®¢é¡¹ç›®æºç ï¼Œä¿®æ”¹config/_default/hugo.tomlä¸­çš„baseurlï¼Œ 67 ç„¶åç‚¹å‡»è¿è¡Œ(éœ€è¦å®‰è£…å¥½çš„Hugo Integrationæ’ä»¶å¹¶ä¸”åœ¨é¡¹ç›®è¿è¡Œä¸­é…ç½®å¥½hugoè¿è¡Œé…ç½®)ï¼‰ 68 69çº¿ä¸ŠåŸŸåï¼šjianlin-li.github.io 70åšå®¢é¡¹ç›®æœ¬åœ°gitå’Œgithubä¸Šçš„è¿œç¨‹å…³è”é¡¹ç›®ï¼šhttps://github.com/JianLin-Li/local.hugo.com.git 71åšå®¢åŸŸåå¯¹åº”çš„github pageé¡¹ç›®ï¼šhttps://github.com/JianLin-Li/JianLin-Li.github.io.git 72 73æ–°å¢åšæ–‡æ­¥éª¤ 74åœ¨æœ¬åœ°åšå®¢é¡¹ç›®æºç \t/Users/lijianlin/www/local/local.hugo.com/content/post ç›®å½•é‡Œé¢æ–°å¢.mdæ–‡ä»¶ 75(æœ€å¥½æ˜¯èƒ½åœ¨phpstorm\\Golandä¸­æ–°å»ºï¼Œåœ¨å®‰è£…å¥½hugo Integrationæ’\tä»¶åœ¨IDEé‡Œé¢æ–°å»ºé€‰æ‹©hugo newï¼Œè¿™æ ·æ–°å»ºçš„mdä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›é…ç½®)ï¼Œ 76ä¿®æ”¹åæäº¤ï¼Œæ¨é€åˆ°GitHubè¿œç¨‹mainåˆ†æ”¯æ—¶è§¦å‘github actionï¼Œè‡ªåŠ¨éƒ¨ç½²åšæ–‡publicç›®å½•åˆ°https://github.com/JianLin-Li/JianLin-Li.github.io.git ","link":"https://jianlin-li.github.io/post/local_enviroment_info/","section":"post","tags":["æœ¬åœ°ç¯å¢ƒ"],"title":"æœ¬åœ°ç¯å¢ƒç›¸å…³é…ç½®ä¿¡æ¯"},{"body":"","link":"https://jianlin-li.github.io/tags/emoji/","section":"tags","tags":null,"title":"Emoji"},{"body":"","link":"https://jianlin-li.github.io/categories/hugo/","section":"categories","tags":null,"title":"Hugo"},{"body":"","link":"https://jianlin-li.github.io/tags/hugo/","section":"tags","tags":null,"title":"Hugo"},{"body":"ã€Hugoã€‘Hugo + Github å…è´¹éƒ¨ç½²è‡ªå·±çš„åšå®¢ ä½¿ç”¨hugoå·¥å…·ç”Ÿæˆé™æ€é¡µé¢ï¼Œç„¶ååœ¨githubä¸Šéƒ¨ç½²é™æ€é¡µé¢ï¼Œæ¥å…è´¹æ­å»ºè‡ªå·±çš„åšå®¢ æç¤º è¯¦ç»†è¯·æŸ¥çœ‹é“¾æ¥ ã€Hugo + Github å…è´¹éƒ¨ç½²è‡ªå·±çš„åšå®¢ã€‘\næç¤º è§†é¢‘åœ°å€ ã€Hugo + Githubå…è´¹æ­å»ºåšå®¢ï¼Œå¹¶å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‘\nUsing Hugo page bundles Page bundles are an optional way to organize page resources within Hugo.\nYou can opt-in to using page bundles in Hugo Clarity with usePageBundles in your site configuration or in a page's front matter. Read more about usePageBundles.\nWith page bundles, resources for a page or section, like images or attached files, live in the same directory as the content itself rather than in your static directory.\nHugo Clarity supports the use of leaf bundles, which are any directories within the content directory that contain an index.md file. Hugo's documentation gives this example:\n1content 2â”œâ”€â”€ about 3â”‚ â”œâ”€â”€ index.md 4â”œâ”€â”€ posts 5â”‚ â”œâ”€â”€ my-post 6â”‚ â”‚ â”œâ”€â”€ content1.md 7â”‚ â”‚ â”œâ”€â”€ content2.md 8â”‚ â”‚ â”œâ”€â”€ image1.jpg 9â”‚ â”‚ â”œâ”€â”€ image2.png 10â”‚ â”‚ â””â”€â”€ index.md 11â”‚ â””â”€â”€ my-other-post 12â”‚ â””â”€â”€ index.md 13â”‚ 14â””â”€â”€ another-section 15 â”œâ”€â”€ .. 16 â””â”€â”€ not-a-leaf-bundle 17 â”œâ”€â”€ .. 18 â””â”€â”€ another-leaf-bundle 19 â””â”€â”€ index.md In the above example `content` directory, there are four leaf bundles: about: This leaf bundle is at the root level (directly under content directory) and has only the index.md.\nmy-post: This leaf bundle has the index.md, two other content Markdown files and two image files. image1 is a page resource of my-post and only available in my-post/index.md resources. image2 is a page resource of my-post and only available in my-post/index.md resources.\nmy-other-post: This leaf bundle has only the index.md.\nanother-leaf-bundle: This leaf bundle is nested under couple of directories. This bundle also has only the index.md.\nThe hierarchy depth at which a leaf bundle is created does not matter, as long as it is not inside another leaf bundle.\nAdvantages to using page bundles The image below is part of the bundle of this page, and is located at content/post/bundle/building.png. Because it's within this page's bundle, the markup for the image only has to specify the image's filename, building.png.\nIf you ever change the name of the directory in which this Markdown file and the image reside, the reference to the image would not need to be updated.\nIn addition to more cleanly organizing your content and related assets, when using page bundles, Hugo Clarity will automatically generate markup for modern image formats, which are smaller in file size.\nFor instance, when you reference an image like building.png, Hugo Clarity will check to see if the same image (based on filename) exists in WebP, AVIF or JXL formats. If you inspect the image above, you'll see a \u0026lt;source\u0026gt; element for building.webp, because that file is also present. Hugo Clarity will only include the markup if these images exist.\nBrowsers that support these formats and the \u0026lt;picture\u0026gt; element will load them, while browsers that do not will fall-back to the default image. Read more about this process.\nFinally, note that page assets can be further managed and refined within the page's front matter if you wish, and are not limited to images alone.\nDisadvantages to using page bundles Page resources in a bundle are only available to the page with which they are bundled â€” that means you can't include an image with one page and then reference it from another.\nImages that are being used in multiple places are more appropriate for your Hugo assets directory. Unlike files in the Hugo static directory, files in the assets directory can be run through Hugo Pipes, which includes image processing.\nEmoji Support Emoji can be enabled in a Hugo project in a number of ways.\nThe emojify function can be called directly in templates or Inline Shortcodes.\nTo enable emoji globally, set enableEmoji to true in your site's configuration and then you can type emoji shorthand codes directly in content files; e.g.\nğŸ™ˆ :see_no_evil: ğŸ™‰ :hear_no_evil: ğŸ™Š :speak_no_evil:\nThe Emoji cheat sheet is a useful reference for emoji shorthand codes.\nN.B. The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.\n1.emoji { 2 font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; 3} Using OpenStreetMap Markdown Syntax Guide This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nImages Local image, alt text as caption The following image is located within the Hugo site. Because it has alt text but no title text, the caption is generated by the alt text.\nRemote image, specified caption The following image is loaded from a remote URL. The alt text is the same (for screen readers and in cases when the image doesn't load) but because a separate title is provided, the title is used for the caption:\nThis is Jane Doe Image with alt text and no caption Alt text is always recommended for SEO, accessibility and in cases when images don't load. However, you don't necessarily always want an image to have a caption. In that case, use a title with one space:\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don't communicate by sharing memory, share memory by communicating.\nâ€” Rob Pike1\nTables Tables aren't part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code Code Blocks Code block with backticks 1\u0026lt;!doctype html\u0026gt; 2\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; 3\u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; 5 \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; 6\u0026lt;/head\u0026gt; 7\u0026lt;body\u0026gt; 8 \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; 9\u0026lt;/body\u0026gt; 10\u0026lt;!-- this line is extraneous 2Error from server (Forbidden): deployments.apps is forbidden: User \u0026#34;chiptest\u0026#34; cannot create resource \u0026#34;deployments\u0026#34; in API group \u0026#34;apps\u0026#34; in the namespace \u0026#34;default\u0026#34; --\u0026gt; 11\u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block with Hugo's internal highlight shortcode 1\u0026lt;!doctype html\u0026gt; 2\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; 3\u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; 5 \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; 6\u0026lt;/head\u0026gt; 7\u0026lt;body\u0026gt; 8 \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; 9\u0026lt;/body\u0026gt; 10\u0026lt;/html\u0026gt; List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements â€” abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nMath Typesettin Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\nIn this example we will be using KaTeX\nCreate a partial under /layouts/partials/hooks/head-end.html Add these lines to the newly created partial: 1{{ if or .Params.math .Site.Params.math }} 2{{ partial \u0026#34;math.html\u0026#34; . }} 3{{ end }} To enable KaTeX globally set the parameter math to true in a project's configuration To enable KaTeX on a per page basis include the parameter math: true in content files Note: Use the online reference of Supported TeX Functions\nExamples Inline math: \\(\\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887â€¦\\) Block math: $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\nUsing Notices The \u0026quot;Notices\u0026quot; shortcode enables you to call out pieces of information - sidebars, warnings, tips, etc.\nTo create a notice on a page, you can use the notice shortcode.\nYou use the notice shortcode, with the first parameter being one of note, info, tip, and warning. Then add a title for your note in quotes as the second parameter. The inner body of the note can be whatever markdown you want to create.\nThe following shortcode syntax within a markdown doc:\n1{{% notice note \u0026#34;Note\u0026#34; %}} 2This is a standard \u0026#34;note\u0026#34; style. 3{{% /notice %}} will render as:\nNote This is a standard \u0026quot;note\u0026quot; style.\nThe other three variants follow.\nInfo Here is the \u0026quot;info\u0026quot; style.\nTip Here is a \u0026quot;tip\u0026quot; variant of a notice.\nWarning Here is the \u0026quot;warning\u0026quot; flavor of a notice.\nAlso note that the content of a notice can contain anything you could put on a normal page - as shown below:\nComplex Notices are Possible! This is a notice that has a lot of various kinds of content in it.\nHere is a bulleted list With more than one bullet And even more than one level Code blocks are fine here, too....\n1public void SayHello() 2{ 3 Console.WriteLine(\u0026#34;Hello, world!\u0026#34;); 4} Productivity Booster! If you're using VS Code for your editing, copy the .vscode\\clarity.code-snippets file into a .vscode root folder on your repo. This will enable you to type note then \u0026lt;tab\u0026gt; then choose with up/down arrows which flavor notice you want, then \u0026lt;tab\u0026gt; again to provide a title, then \u0026lt;tab\u0026gt; to add your content!\nTo use the snippet, you need to first enable quickSuggestions for Markdown (one time only):\nGo to Preferences-\u0026gt;Settings then search for quickSuggestions Follow the link to Edit in settings.json Toward the bottom of the file, paste in the following JSON: 1\u0026#34;[markdown]\u0026#34;: { 2 \u0026#34;editor.quickSuggestions\u0026#34;: true 3 } Close and save the settings. Placeholder Text Lorem est tota propiore conpellat pectoribus de pectora summo. Redit teque digerit hominumque toris verebor lumina non cervice subde tollit usus habet Arctonque, furores quas nec ferunt. Quoque montibus nunc caluere tempus inhospita parcite confusaque translucet patri vestro qui optatis lumine cognoscere flos nubis! Fronde ipsamque patulos Dryopen deorum.\nExierant elisi ambit vivere dedere Duce pollice Eris modo Spargitque ferrea quos palude Rursus nulli murmur; hastile inridet ut ab gravi sententia! Nomine potitus silentia flumen, sustinet placuit petis in dilapsa erat sunt. Atria tractus malis.\nComas hunc haec pietate fetum procerum dixit Post torum vates letum Tiresia Flumen querellas Arcanaque montibus omnes Quidem et Vagus elidunt The Van de Graaf Canon\nMane refeci capiebant unda mulcebat Victa caducifer, malo vulnere contra dicere aurato, ludit regale, voca! Retorsit colit est profanae esse virescere furit nec; iaculi matertera et visa est, viribus. Divesque creatis, tecta novat collumque vulnus est, parvas. Faces illo pepulere tempus adest. Tendit flamma, ab opes virum sustinet, sidus sequendo urbis.\nIubar proles corpore raptos vero auctor imperium; sed et huic: manus caeli Lelegas tu lux. Verbis obstitit intus oblectamina fixis linguisque ausus sperare Echionides cornuaque tenent clausit possit. Omnia putatur. Praeteritae refert ausus; ferebant e primus lora nutat, vici quae mea ipse. Et iter nil spectatae vulnus haerentia iuste et exercebat, sui et.\nEurytus Hector, materna ipsumque ut Politen, nec, nate, ignari, vernum cohaesit sequitur. Vel mitis temploque vocatus, inque alis, oculos nomen non silvis corpore coniunx ne displicet illa. Crescunt non unus, vidit visa quantum inmiti flumina mortis facto sic: undique a alios vincula sunt iactata abdita! Suspenderat ego fuit tendit: luna, ante urbem Propoetides parte.\nThe above quote is excerpted from Rob Pike's talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","link":"https://jianlin-li.github.io/post/course/","section":"post","tags":["Hugo","æ•™ç¨‹","emoji","OpenStreetMap","Markdown","Math","Notices"],"title":"Hugoçš„æœ‰å…³ç®€æ˜“æ•™ç¨‹"},{"body":"","link":"https://jianlin-li.github.io/tags/markdown/","section":"tags","tags":null,"title":"Markdown"},{"body":"","link":"https://jianlin-li.github.io/tags/math/","section":"tags","tags":null,"title":"Math"},{"body":"","link":"https://jianlin-li.github.io/tags/notices/","section":"tags","tags":null,"title":"Notices"},{"body":"","link":"https://jianlin-li.github.io/tags/openstreetmap/","section":"tags","tags":null,"title":"OpenStreetMap"},{"body":"","link":"https://jianlin-li.github.io/categories/%E6%95%99%E7%A8%8B/","section":"categories","tags":null,"title":"æ•™ç¨‹"},{"body":"","link":"https://jianlin-li.github.io/tags/%E6%95%99%E7%A8%8B/","section":"tags","tags":null,"title":"æ•™ç¨‹"},{"body":"","link":"https://jianlin-li.github.io/archives/","section":"","tags":null,"title":""},{"body":"è¿™ä¸ªäººå¥½æ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™\n","link":"https://jianlin-li.github.io/about/","section":"","tags":null,"title":"å…³äº"},{"body":"","link":"https://jianlin-li.github.io/series/","section":"series","tags":null,"title":"Series"}]