<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>RabbitMQ on 浩瀚天空</title>
    <link>https://jianlin-li.github.io/tags/rabbitmq/</link>
    <description>Recent content in RabbitMQ on 浩瀚天空</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>Copyright © 1989–2025, 李建林 </copyright>
    <lastBuildDate>Tue, 10 Jun 2025 15:04:49 +0800</lastBuildDate><atom:link href="https://jianlin-li.github.io/tags/rabbitmq/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>RabbitMQ消息中间件详解</title>
      <link>https://jianlin-li.github.io/post/rabbitmq_review/</link>
      <pubDate>Tue, 10 Jun 2025 15:04:49 +0800</pubDate>
      
      <guid>https://jianlin-li.github.io/post/rabbitmq_review/</guid>
      <description>
        
          
            &lt;h1 id=&#34;rabbitmq-消息中间件详解&#34;&gt;RabbitMQ 消息中间件详解&lt;/h1&gt;
&lt;h2 id=&#34;消息中间件的作用&#34;&gt;消息中间件的作用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;削峰&lt;/strong&gt;：缓冲瞬时高峰流量，避免系统被冲垮&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;解耦&lt;/strong&gt;：降低系统间耦合度，提高可维护性&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;异步通信&lt;/strong&gt;：提高系统响应速度，减少等待时间&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;顺序保证&lt;/strong&gt;：确保消息按特定顺序处理&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;数据冗余&lt;/strong&gt;：提供消息持久化，防止数据丢失&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;系统扩展&lt;/strong&gt;：便于系统水平扩展&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;amqp-高级消息队列协议&#34;&gt;AMQP 高级消息队列协议&lt;/h2&gt;
&lt;p&gt;AMQP（Advanced Message Queuing Protocol）是一个提供统一消息服务的应用层标准协议。&lt;/p&gt;
&lt;h2 id=&#34;交换器-exchange&#34;&gt;交换器 (Exchange)&lt;/h2&gt;
&lt;h3 id=&#34;交换器特性&#34;&gt;交换器特性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;交换器与交换器可以相互绑定&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;交换器类型&#34;&gt;交换器类型&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fanout&lt;/code&gt;、&lt;code&gt;topic&lt;/code&gt;、&lt;code&gt;direct&lt;/code&gt;、&lt;code&gt;header&lt;/code&gt;、&lt;code&gt;system&lt;/code&gt;、自定义&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;交换器属性&#34;&gt;交换器属性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;持久化&lt;/strong&gt;：&lt;code&gt;durable&lt;/code&gt; 参数让交换器存盘&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;自动删除&lt;/strong&gt;：当所有绑定的队列或交换器都解绑后自动删除(自动删除的前提是至少有一个队列或者交换器与这个交换器绑定，之后所有与这个交换器绑定的队列或者交换器都与此解绑。)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;队列-queue&#34;&gt;队列 (Queue)&lt;/h2&gt;
&lt;h3 id=&#34;队列特性&#34;&gt;队列特性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;队列与交换器进行绑定&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;队列属性&#34;&gt;队列属性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;持久化&lt;/strong&gt;：&lt;code&gt;durable&lt;/code&gt; 参数让队列存盘&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;排他性&lt;/strong&gt;：&lt;code&gt;exclusive&lt;/code&gt; 参数使队列仅对首次声明它的连接可见，连接断开时自动删除&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;自动删除&lt;/strong&gt;：当所有消费者都断开连接时自动删除(至少有一个消费者连接到这个队列，之后所有与这个队列连接的消费者都断开时，才会自动删除)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;声明机制&#34;&gt;声明机制&lt;/h2&gt;
&lt;p&gt;生产者和消费者都可以声明交换器或队列：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果声明的参数完全匹配现存的交换器或者队列，RabbitMQ 直接返回成功&lt;/li&gt;
&lt;li&gt;如果参数不匹配，则抛出异常&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;消费者端确认机制&#34;&gt;消费者端确认机制&lt;/h2&gt;
&lt;h3 id=&#34;ack-确认&#34;&gt;ACK 确认&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;自动确认&lt;/strong&gt;：队列自动删除已发送的消息，如果是自动确认机制，那么队列会自动的把发送出去的消息从队列中删除(其实是先打上标签，之后再删除)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;显式确认&lt;/strong&gt;：等待消费者显式确认后才删除消息，如果是等待消费者显示的确认机制，那么队列会等待消费者显示的确认收到了消息之后，再把消息从内存或者硬盘中删除&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;拒绝消息&#34;&gt;拒绝消息&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;reject&lt;/strong&gt;：消费者明确拒绝消息(如果消费者明确拒绝当前收到的消息，那么队列会根据消费者是否设置了requeue参数，如果该参数是true那么该消息会被重新加入到队列中等待下一次的投递；如果该参数设置为false那么队列将直接移除该消息)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;requeue=true&lt;/code&gt;：消息重新加入队列等待下次投递&lt;/li&gt;
&lt;li&gt;&lt;code&gt;requeue=false&lt;/code&gt;：队列直接移除消息&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;消息路由控制&#34;&gt;消息路由控制&lt;/h2&gt;
&lt;h3 id=&#34;mandatory-参数强调的是没有路由到任何队列的情况下当mandatory参数设为true时交换器无法根据自身的类型和路由键找到一个符合条件的队列那么rabbitmq会调用basicreturn命令将消息返回给生产者当mandatory参数设置为false时出现上述情形则消息直接被丢弃&#34;&gt;mandatory 参数(强调的是没有路由到任何队列的情况下，当mandatory参数设为true时，交换器无法根据自身的类型和路由键找到一个符合条件的队列，那么RabbitMQ会调用Basic.Return命令将消息返回给生产者。当mandatory参数设置为false时，出现上述情形，则消息直接被丢弃)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;true&lt;/code&gt;：当无法路由到任何队列时，通过 &lt;code&gt;Basic.Return&lt;/code&gt; 将消息返回给生产者&lt;/li&gt;
&lt;li&gt;&lt;code&gt;false&lt;/code&gt;：无法路由时直接丢弃消息&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;immediate-参数rabbitmq-30-已移除&#34;&gt;immediate 参数（RabbitMQ 3.0+ 已移除）&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;原功能：强调的是路由到队列后 队列上没有消费者的情况下，当immediate参数设为true时，如果交换器在将消息路由到队列时发现队列上并不存在任何消费者，那么这条消息将不会存入队列中。当与路由键匹配的所有队列都没有消费者时,该消息会通过 Basic.Return 返回至生产者。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;[!NOTE]&lt;/p&gt;
&lt;p&gt;概括来说,mandatory参数告诉服务器至少将该消息路由到一个队列中,否则将消息返回给生产者。immediate参数告诉服务器如果该消息关联的队列上有消费者，则立刻投递。如果所有匹配的队列上都没有消费者，则直接将消息返还给生产者不用将消息存入队列而等待消费者了。RabbitMQ3.0版本开始去掉了对immediate参数的支持，immediate参数影响竞相队列的性能&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;消息的过期时间设置&#34;&gt;消息的过期时间设置&lt;/h2&gt;
&lt;h3 id=&#34;消息过期时间&#34;&gt;消息过期时间&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;队列级别&lt;/strong&gt;：设置 &lt;code&gt;x-message-ttl&lt;/code&gt; 属性，统一所有消息的过期时间(方法是设置队列的x-message-ttl属性，所有入队列的消息的过期时间都是一样的)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;消息级别&lt;/strong&gt;：在发布消息时设置 &lt;code&gt;expiration&lt;/code&gt; 属性，支持个性化过期时间(方法是为每个消息都设置过期时间，在生产者发布消息的时候设置属性expiration属性，每个消息都可以设置不同的过期时间)&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;队列过期时间&#34;&gt;队列过期时间&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;设置队列的x-expires属性可以控制队列被自动删除前处于未使用状态的时间。未使用的意思是队列上没有任何的消费者，队列也没有被重新声明，并且在过期时间段内也未调用过Basic.Get命令。&lt;/strong&gt;&lt;/p&gt;
          
          
        
      </description>
    </item>
    
  </channel>
</rss>
